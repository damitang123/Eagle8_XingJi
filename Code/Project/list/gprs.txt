; generated by Component: ARM Compiler 5.05 (build 41) Tool: ArmCC [4d0eb9]
; commandline ArmCC [--list --split_sections -c --asm --interleave -o.\obj\gprs.o --asm_dir=.\list\ --list_dir=.\list\ --depend=.\obj\gprs.d --cpu=Cortex-M3 --apcs=interwork -O3 -I..\Board_Support_Package -I..\Config -I..\GUI\Core -I..\GUI\JPEG -I..\GUI\LCDDriver -I..\GUI\MultiLayer -I..\GUI\Widget -I..\GUI\WM -I..\Libraries\CMSIS\CM3\CoreSupport -I..\Libraries\CMSIS\CM3\DeviceSupport\ST\STM32F10x -I..\Libraries\CMSIS\Include -I..\Libraries\STM32F10x_StdPeriph_Driver\inc -I..\User\Res -I..\User\UserWindow -I..\User -I..\USB\inc -IC:\Keil_v5\ARM\RV31\INC -IC:\Keil_v5\ARM\CMSIS\Include -IC:\Keil_v5\ARM\Inc\ST\STM32F10x -D__MICROLIB -DSTM32F10X_HD -DVECT_TAB_FLASH -DUSE_STDPERIPH_DRIVER --no_multibyte_chars ..\User\gprs.c]
                          THUMB

                          AREA ||i.GPRS_Change_Baudrate||, CODE, READONLY, ALIGN=2

                  GPRS_Change_Baudrate PROC
;;;2916   
;;;2917   static void GPRS_Change_Baudrate(eGPRSMessage eMessageType)
000000  b570              PUSH     {r4-r6,lr}
;;;2918   {
;;;2919   	char *pStr;
;;;2920   	const char *pCmdStr = "AT+IPR=115200\r\n";
;;;2921   	static sGPRSSendCmdQ *p = NULL;
;;;2922   
;;;2923   	switch(eMessageType)
;;;2924   	{
;;;2925   		case eGPRSChangeState:
;;;2926   			p = Get_Free_SendCmdQ();
000002  4c1d              LDR      r4,|L1.120|
000004  a518              ADR      r5,|L1.104|
000006  2801              CMP      r0,#1                 ;2923
000008  d017              BEQ      |L1.58|
00000a  2802              CMP      r0,#2                 ;2923
00000c  d12b              BNE      |L1.102|
;;;2927   			if(p)
;;;2928   			{
;;;2929   				p->nNowState = eGSM_ChangeBaudRate;
;;;2930   				p->pSendCmd = (char *)pCmdStr;
;;;2931   				p->nCmdLength = strlen(pCmdStr);
;;;2932   				GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
;;;2933   			}
;;;2934   			break;
;;;2935   			
;;;2936   		case eGPRSATData:
;;;2937   			pStr = strstr(pGPRSProcessPtr,"AT+IPR=115200\r\r\nOK\r\n");
00000e  a11b              ADR      r1,|L1.124|
000010  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000012  f7fffffe          BL       strstr
;;;2938   			if(pStr)
000016  2800              CMP      r0,#0
000018  d025              BEQ      |L1.102|
;;;2939   			{
;;;2940   				p->bInvalidBuffer = false;
00001a  6a21              LDR      r1,[r4,#0x20]  ; p
00001c  2000              MOVS     r0,#0
00001e  7448              STRB     r0,[r1,#0x11]
;;;2941   				GPRS_Uart_Init(115200);
000020  f44f30e1          MOV      r0,#0x1c200
000024  f7fffffe          BL       GPRS_Uart_Init
000028  f1040164          ADD      r1,r4,#0x64
;;;2942   				GprsHal_Switch_State(eGSM_Enable_Echo);
00002c  2007              MOVS     r0,#7
00002e  7048              STRB     r0,[r1,#1]
;;;2943   				TRACE_PRINTF("GPRS-->Change new baudrate = 115200.\r\n");
000030  e8bd4070          POP      {r4-r6,lr}
000034  a017              ADR      r0,|L1.148|
000036  f7ffbffe          B.W      User_Debug_Printf
                  |L1.58|
00003a  f7fffffe          BL       Get_Free_SendCmdQ
00003e  6220              STR      r0,[r4,#0x20]         ;2927  ; p
000040  2800              CMP      r0,#0                 ;2927
000042  d010              BEQ      |L1.102|
000044  2106              MOVS     r1,#6                 ;2929
000046  7001              STRB     r1,[r0,#0]            ;2929
000048  f8c05001          STR      r5,[r0,#1]            ;2930
00004c  4628              MOV      r0,r5                 ;2931
00004e  f7fffffe          BL       strlen
000052  b281              UXTH     r1,r0                 ;2931
000054  6a20              LDR      r0,[r4,#0x20]         ;2931  ; p
000056  f8a01005          STRH     r1,[r0,#5]            ;2931
00005a  f8d00001          LDR      r0,[r0,#1]            ;2932
00005e  e8bd4070          POP      {r4-r6,lr}            ;2932
000062  f7ffbffe          B.W      GPRS_Transmit_Data
                  |L1.102|
;;;2944   			}
;;;2945   			break;
;;;2946   	}
;;;2947   }
000066  bd70              POP      {r4-r6,pc}
;;;2948   
                          ENDP

                  |L1.104|
000068  41542b49          DCB      "AT+IPR=115200\r\n",0
00006c  50523d31
000070  31353230
000074  300d0a00
                  |L1.120|
                          DCD      ||.data||
                  |L1.124|
00007c  41542b49          DCB      "AT+IPR=115200\r\r\nOK\r\n",0
000080  50523d31
000084  31353230
000088  300d0d0a
00008c  4f4b0d0a
000090  00      
000091  00                DCB      0
000092  00                DCB      0
000093  00                DCB      0
                  |L1.148|
000094  47505253          DCB      "GPRS-->Change new baudrate = 115200.\r\n",0
000098  2d2d3e43
00009c  68616e67
0000a0  65206e65
0000a4  77206261
0000a8  75647261
0000ac  7465203d
0000b0  20313135
0000b4  3230302e
0000b8  0d0a00  
0000bb  00                DCB      0

                          AREA ||i.GPRS_Cmd_Add_MessageHead||, CODE, READONLY, ALIGN=2

                  GPRS_Cmd_Add_MessageHead PROC
;;;3096   
;;;3097   static void GPRS_Cmd_Add_MessageHead(eGPRSMessage eMessageType)
000000  b570              PUSH     {r4-r6,lr}
;;;3098   {
;;;3099   	const char *pCmdStr = "AT+CIPHEAD=1\r\n";
;;;3100   	static sGPRSSendCmdQ *p = NULL;
;;;3101   
;;;3102   	switch(eMessageType)
;;;3103   	{
;;;3104   		case eGPRSChangeState:
;;;3105   			p = Get_Free_SendCmdQ();
000002  4c1b              LDR      r4,|L2.112|
000004  a516              ADR      r5,|L2.96|
000006  2801              CMP      r0,#1                 ;3102
000008  d013              BEQ      |L2.50|
00000a  2802              CMP      r0,#2                 ;3102
00000c  d127              BNE      |L2.94|
;;;3106   			if(p)
;;;3107   			{
;;;3108   				p->nNowState = eGSM_Add_MessageHead;
;;;3109   				p->pSendCmd = (char *)pCmdStr;
;;;3110   				p->nCmdLength = strlen(pCmdStr);
;;;3111   				GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
;;;3112   			}
;;;3113   			break;
;;;3114   			
;;;3115   		case eGPRSATData:
;;;3116   			if(strstr(pGPRSProcessPtr,"AT+CIPHEAD=1\r\r\nOK\r\n"))
00000e  a119              ADR      r1,|L2.116|
000010  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000012  f7fffffe          BL       strstr
000016  2800              CMP      r0,#0
000018  d021              BEQ      |L2.94|
;;;3117   			{
;;;3118   				p->bInvalidBuffer = false;
00001a  6b21              LDR      r1,[r4,#0x30]  ; p
00001c  2000              MOVS     r0,#0
00001e  7448              STRB     r0,[r1,#0x11]
000020  f1040164          ADD      r1,r4,#0x64
;;;3119   				GprsHal_Switch_State(eGSM_GET_CSQ);
000024  200b              MOVS     r0,#0xb
000026  7048              STRB     r0,[r1,#1]
;;;3120   				TRACE_PRINTF("GPRS-->Add server message header is Ok.\r\n");
000028  e8bd4070          POP      {r4-r6,lr}
00002c  a016              ADR      r0,|L2.136|
00002e  f7ffbffe          B.W      User_Debug_Printf
                  |L2.50|
000032  f7fffffe          BL       Get_Free_SendCmdQ
000036  6320              STR      r0,[r4,#0x30]         ;3106  ; p
000038  2800              CMP      r0,#0                 ;3106
00003a  d010              BEQ      |L2.94|
00003c  2117              MOVS     r1,#0x17              ;3108
00003e  7001              STRB     r1,[r0,#0]            ;3108
000040  f8c05001          STR      r5,[r0,#1]            ;3109
000044  4628              MOV      r0,r5                 ;3110
000046  f7fffffe          BL       strlen
00004a  b281              UXTH     r1,r0                 ;3110
00004c  6b20              LDR      r0,[r4,#0x30]         ;3110  ; p
00004e  f8a01005          STRH     r1,[r0,#5]            ;3110
000052  f8d00001          LDR      r0,[r0,#1]            ;3111
000056  e8bd4070          POP      {r4-r6,lr}            ;3111
00005a  f7ffbffe          B.W      GPRS_Transmit_Data
                  |L2.94|
;;;3121   			}
;;;3122   			break;
;;;3123   	}
;;;3124   }
00005e  bd70              POP      {r4-r6,pc}
;;;3125   
                          ENDP

                  |L2.96|
000060  41542b43          DCB      "AT+CIPHEAD=1\r\n",0
000064  49504845
000068  41443d31
00006c  0d0a00  
00006f  00                DCB      0
                  |L2.112|
                          DCD      ||.data||
                  |L2.116|
000074  41542b43          DCB      "AT+CIPHEAD=1\r\r\nOK\r\n",0
000078  49504845
00007c  41443d31
000080  0d0d0a4f
000084  4b0d0a00
                  |L2.136|
000088  47505253          DCB      "GPRS-->Add server message header is Ok.\r\n",0
00008c  2d2d3e41
000090  64642073
000094  65727665
000098  72206d65
00009c  73736167
0000a0  65206865
0000a4  61646572
0000a8  20697320
0000ac  4f6b2e0d
0000b0  0a00    
0000b2  00                DCB      0
0000b3  00                DCB      0

                          AREA ||i.GPRS_Cmd_CheckCOPS||, CODE, READONLY, ALIGN=2

                  GPRS_Cmd_CheckCOPS PROC
;;;3199   
;;;3200   static void GPRS_Cmd_CheckCOPS(eGPRSMessage eMessageType)
000000  b570              PUSH     {r4-r6,lr}
;;;3201   {
;;;3202   	char *pStr = NULL;
;;;3203   	const char *pCmdStr = "AT+COPS?\r\n";
;;;3204   	static sGPRSSendCmdQ *p = NULL;
;;;3205   
;;;3206   	switch(eMessageType)
;;;3207   	{
;;;3208   		case eGPRSChangeState:
;;;3209   			p = Get_Free_SendCmdQ();
000002  4c1d              LDR      r4,|L3.120|
000004  a519              ADR      r5,|L3.108|
000006  2801              CMP      r0,#1                 ;3206
000008  d019              BEQ      |L3.62|
00000a  2802              CMP      r0,#2                 ;3206
00000c  d12d              BNE      |L3.106|
;;;3210   			if(p)
;;;3211   			{
;;;3212   				p->nNowState = eGSM_CheckCOPS;
;;;3213   				p->pSendCmd = (char *)pCmdStr;
;;;3214   				p->nCmdLength = strlen(pCmdStr);
;;;3215   				GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
;;;3216   			}
;;;3217   			break;
;;;3218   			
;;;3219   		case eGPRSATData:
;;;3220   			pStr = strstr(pGPRSProcessPtr,"+COPS:");
00000e  a11b              ADR      r1,|L3.124|
000010  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000012  f7fffffe          BL       strstr
000016  0005              MOVS     r5,r0
;;;3221   			if(pStr)
000018  d027              BEQ      |L3.106|
;;;3222   			{
;;;3223   				char *pStr1 = strstr(pStr,"\r");
00001a  a11a              ADR      r1,|L3.132|
00001c  f7fffffe          BL       strstr
000020  2100              MOVS     r1,#0
;;;3224   				if(pStr1) *pStr1 = 0;
000022  b100              CBZ      r0,|L3.38|
000024  7001              STRB     r1,[r0,#0]
                  |L3.38|
;;;3225   				p->bInvalidBuffer = false;
000026  6ba0              LDR      r0,[r4,#0x38]  ; p
000028  7441              STRB     r1,[r0,#0x11]
00002a  4913              LDR      r1,|L3.120|
;;;3226   				GprsHal_Switch_State(eGSM_Get_MCC_MNC);
00002c  200e              MOVS     r0,#0xe
00002e  3164              ADDS     r1,r1,#0x64
000030  7048              STRB     r0,[r1,#1]
;;;3227   				TRACE_PRINTF("GPRS-->%s.\r\n", pStr);
000032  4629              MOV      r1,r5
000034  e8bd4070          POP      {r4-r6,lr}
000038  a013              ADR      r0,|L3.136|
00003a  f7ffbffe          B.W      User_Debug_Printf
                  |L3.62|
00003e  f7fffffe          BL       Get_Free_SendCmdQ
000042  63a0              STR      r0,[r4,#0x38]         ;3210  ; p
000044  2800              CMP      r0,#0                 ;3210
000046  d010              BEQ      |L3.106|
000048  210c              MOVS     r1,#0xc               ;3212
00004a  7001              STRB     r1,[r0,#0]            ;3212
00004c  f8c05001          STR      r5,[r0,#1]            ;3213
000050  4628              MOV      r0,r5                 ;3214
000052  f7fffffe          BL       strlen
000056  b281              UXTH     r1,r0                 ;3214
000058  6ba0              LDR      r0,[r4,#0x38]         ;3214  ; p
00005a  f8a01005          STRH     r1,[r0,#5]            ;3214
00005e  f8d00001          LDR      r0,[r0,#1]            ;3215
000062  e8bd4070          POP      {r4-r6,lr}            ;3215
000066  f7ffbffe          B.W      GPRS_Transmit_Data
                  |L3.106|
;;;3228   			}
;;;3229   			break;
;;;3230   	}
;;;3231   }
00006a  bd70              POP      {r4-r6,pc}
;;;3232   
                          ENDP

                  |L3.108|
00006c  41542b43          DCB      "AT+COPS?\r\n",0
000070  4f50533f
000074  0d0a00  
000077  00                DCB      0
                  |L3.120|
                          DCD      ||.data||
                  |L3.124|
00007c  2b434f50          DCB      "+COPS:",0
000080  533a00  
000083  00                DCB      0
                  |L3.132|
000084  0d00              DCB      "\r",0
000086  00                DCB      0
000087  00                DCB      0
                  |L3.136|
000088  47505253          DCB      "GPRS-->%s.\r\n",0
00008c  2d2d3e25
000090  732e0d0a
000094  00      
000095  00                DCB      0
000096  00                DCB      0
000097  00                DCB      0

                          AREA ||i.GPRS_Cmd_CheckNetRegist_State||, CODE, READONLY, ALIGN=2

                  GPRS_Cmd_CheckNetRegist_State PROC
;;;3308   
;;;3309   static void GPRS_Cmd_CheckNetRegist_State(eGPRSMessage eMessageType)
000000  b570              PUSH     {r4-r6,lr}
;;;3310   {
;;;3311   	char *pStr = NULL;
;;;3312   	const char *pCmdStr = "AT+CGATT?\r\n";
;;;3313   	static sGPRSSendCmdQ *p = NULL;
;;;3314   
;;;3315   	switch(eMessageType)
;;;3316   	{
;;;3317   		case eGPRSChangeState:
;;;3318   			p = Get_Free_SendCmdQ();
000002  4c21              LDR      r4,|L4.136|
000004  a51d              ADR      r5,|L4.124|
000006  2801              CMP      r0,#1                 ;3315
000008  d01c              BEQ      |L4.68|
00000a  2802              CMP      r0,#2                 ;3315
00000c  d119              BNE      |L4.66|
;;;3319   			if(p)
;;;3320   			{
;;;3321   				p->nNowState = eGSM_NetRegist_Check;
;;;3322   				p->nRetryCnt = 80;
;;;3323   				p->nWaitAckTimeout = 1000;
;;;3324   				p->pSendCmd = (char *)pCmdStr;
;;;3325   				p->nCmdLength = strlen(pCmdStr);
;;;3326   				GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
;;;3327   			}
;;;3328   			break;
;;;3329   			
;;;3330   		case eGPRSATData:
;;;3331   			if(strstr(pGPRSProcessPtr,"AT+CGATT?"))
00000e  a11f              ADR      r1,|L4.140|
000010  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000012  f7fffffe          BL       strstr
000016  2800              CMP      r0,#0
000018  d013              BEQ      |L4.66|
;;;3332   			{
;;;3333   				pStr = strstr(pGPRSProcessPtr,"+CGATT:");
00001a  a11f              ADR      r1,|L4.152|
00001c  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
00001e  f7fffffe          BL       strstr
000022  0005              MOVS     r5,r0
;;;3334   				if(pStr)
000024  d00d              BEQ      |L4.66|
;;;3335   				{
;;;3336   					TRACE_PRINTF("GPRS-->NetRegist state(%c).\r\n", *(pStr + 8));
000026  7a29              LDRB     r1,[r5,#8]
000028  a01d              ADR      r0,|L4.160|
00002a  f7fffffe          BL       User_Debug_Printf
;;;3337   					if(*(pStr + 8) == '1')
00002e  7a28              LDRB     r0,[r5,#8]
000030  2831              CMP      r0,#0x31
000032  d106              BNE      |L4.66|
;;;3338   					{
;;;3339   						p->bInvalidBuffer = false;
000034  6c61              LDR      r1,[r4,#0x44]  ; p
000036  2000              MOVS     r0,#0
000038  7448              STRB     r0,[r1,#0x11]
00003a  f1040164          ADD      r1,r4,#0x64
;;;3340   						GprsHal_Switch_State(eGSM_Open_NET);
00003e  2010              MOVS     r0,#0x10
000040  7048              STRB     r0,[r1,#1]
                  |L4.66|
;;;3341   					}
;;;3342   				}
;;;3343   			}
;;;3344   			break;
;;;3345   	}
;;;3346   }
000042  bd70              POP      {r4-r6,pc}
                  |L4.68|
000044  f7fffffe          BL       Get_Free_SendCmdQ
000048  6460              STR      r0,[r4,#0x44]         ;3319  ; p
00004a  2800              CMP      r0,#0                 ;3319
00004c  d0f9              BEQ      |L4.66|
00004e  210d              MOVS     r1,#0xd               ;3321
000050  7001              STRB     r1,[r0,#0]            ;3321
000052  2150              MOVS     r1,#0x50              ;3322
000054  7201              STRB     r1,[r0,#8]            ;3322
000056  f44f717a          MOV      r1,#0x3e8             ;3323
00005a  f8a0100d          STRH     r1,[r0,#0xd]          ;3323
00005e  f8c05001          STR      r5,[r0,#1]            ;3324
000062  4628              MOV      r0,r5                 ;3325
000064  f7fffffe          BL       strlen
000068  b281              UXTH     r1,r0                 ;3325
00006a  6c60              LDR      r0,[r4,#0x44]         ;3325  ; p
00006c  f8a01005          STRH     r1,[r0,#5]            ;3325
000070  f8d00001          LDR      r0,[r0,#1]            ;3326
000074  e8bd4070          POP      {r4-r6,lr}            ;3326
000078  f7ffbffe          B.W      GPRS_Transmit_Data
;;;3347   
                          ENDP

                  |L4.124|
00007c  41542b43          DCB      "AT+CGATT?\r\n",0
000080  47415454
000084  3f0d0a00
                  |L4.136|
                          DCD      ||.data||
                  |L4.140|
00008c  41542b43          DCB      "AT+CGATT?",0
000090  47415454
000094  3f00    
000096  00                DCB      0
000097  00                DCB      0
                  |L4.152|
000098  2b434741          DCB      "+CGATT:",0
00009c  54543a00
                  |L4.160|
0000a0  47505253          DCB      "GPRS-->NetRegist state(%c).\r\n",0
0000a4  2d2d3e4e
0000a8  65745265
0000ac  67697374
0000b0  20737461
0000b4  74652825
0000b8  63292e0d
0000bc  0a00    
0000be  00                DCB      0
0000bf  00                DCB      0

                          AREA ||i.GPRS_Cmd_CheckSimcard||, CODE, READONLY, ALIGN=2

                  GPRS_Cmd_CheckSimcard PROC
;;;3049   
;;;3050   static void GPRS_Cmd_CheckSimcard(eGPRSMessage eMessageType)
000000  b570              PUSH     {r4-r6,lr}
;;;3051   {
;;;3052   	char *pStr;
;;;3053   	const char *pCmdStr = "AT+CPIN?\r\n";
000002  2600              MOVS     r6,#0
;;;3054   	static sGPRSSendCmdQ *p = NULL;
;;;3055   	static char nResultErrorCnt;
;;;3056   
;;;3057   	switch(eMessageType)
;;;3058   	{
;;;3059   		case eGPRSChangeState:
;;;3060   			p = Get_Free_SendCmdQ();
000004  4c2a              LDR      r4,|L5.176|
000006  a527              ADR      r5,|L5.164|
000008  2801              CMP      r0,#1                 ;3057
00000a  d016              BEQ      |L5.58|
00000c  2802              CMP      r0,#2                 ;3057
00000e  d12f              BNE      |L5.112|
;;;3061   			if(p)
;;;3062   			{
;;;3063   				p->nNowState = eGSM_SimCard_Check;
;;;3064   				p->nRetryCnt = 20;
;;;3065   				p->nWaitAckTimeout = 500;
;;;3066   				p->pSendCmd = (char *)pCmdStr;
;;;3067   				p->nCmdLength = strlen(pCmdStr);
;;;3068   				GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
;;;3069   				nResultErrorCnt = 0;
;;;3070   			}
;;;3071   			break;
;;;3072   			
;;;3073   		case eGPRSATData:
;;;3074   			pStr = strstr(pGPRSProcessPtr,"AT+CPIN?\r");
000010  a128              ADR      r1,|L5.180|
000012  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000014  f7fffffe          BL       strstr
000018  0005              MOVS     r5,r0
;;;3075   			if(pStr)
00001a  d029              BEQ      |L5.112|
;;;3076   			{
;;;3077   				if(strstr(pStr,"+CPIN: READY"))
00001c  a128              ADR      r1,|L5.192|
00001e  f7fffffe          BL       strstr
000022  b330              CBZ      r0,|L5.114|
;;;3078   				{
;;;3079   					p->bInvalidBuffer = false;
000024  6ae0              LDR      r0,[r4,#0x2c]  ; p
000026  f1040164          ADD      r1,r4,#0x64
00002a  7446              STRB     r6,[r0,#0x11]
;;;3080   					GprsHal_Switch_State(eGSM_Add_MessageHead);
00002c  2017              MOVS     r0,#0x17
00002e  7048              STRB     r0,[r1,#1]
;;;3081   					TRACE_PRINTF("GPRS-->Sim Card Ready!\r\n");
000030  e8bd4070          POP      {r4-r6,lr}
000034  a026              ADR      r0,|L5.208|
000036  f7ffbffe          B.W      User_Debug_Printf
                  |L5.58|
00003a  f7fffffe          BL       Get_Free_SendCmdQ
00003e  62e0              STR      r0,[r4,#0x2c]         ;3061  ; p
000040  2800              CMP      r0,#0                 ;3061
000042  d015              BEQ      |L5.112|
000044  2109              MOVS     r1,#9                 ;3063
000046  7001              STRB     r1,[r0,#0]            ;3063
000048  2114              MOVS     r1,#0x14              ;3064
00004a  7201              STRB     r1,[r0,#8]            ;3064
00004c  f44f71fa          MOV      r1,#0x1f4             ;3065
000050  f8a0100d          STRH     r1,[r0,#0xd]          ;3065
000054  f8c05001          STR      r5,[r0,#1]            ;3066
000058  4628              MOV      r0,r5                 ;3067
00005a  f7fffffe          BL       strlen
00005e  b281              UXTH     r1,r0                 ;3067
000060  6ae0              LDR      r0,[r4,#0x2c]         ;3067  ; p
000062  f8a01005          STRH     r1,[r0,#5]            ;3067
000066  f8d00001          LDR      r0,[r0,#1]            ;3068
00006a  f7fffffe          BL       GPRS_Transmit_Data
00006e  70e6              STRB     r6,[r4,#3]            ;3069
                  |L5.112|
;;;3082   				}
;;;3083   				else if(strstr(pStr,"ERROR"))
;;;3084   				{
;;;3085   					TRACE_PRINTF("GPRS-->SIMCard not inserted(Can't detected the valid Simcard)!\r\n");
;;;3086   					if(++nResultErrorCnt > 15)
;;;3087   					{
;;;3088   						GPRS_Power_Control(eGPRSPowerDownAlways, __FILE__, __LINE__);
;;;3089   						Notify_User_Invalid_Simcard();
;;;3090   					}
;;;3091   				}
;;;3092   			}
;;;3093   			break;
;;;3094   	}
;;;3095   }
000070  bd70              POP      {r4-r6,pc}
                  |L5.114|
000072  a11e              ADR      r1,|L5.236|
000074  4628              MOV      r0,r5                 ;3083
000076  f7fffffe          BL       strstr
00007a  2800              CMP      r0,#0                 ;3083
00007c  d0f8              BEQ      |L5.112|
00007e  481d              LDR      r0,|L5.244|
000080  f7fffffe          BL       User_Debug_Printf
000084  78e0              LDRB     r0,[r4,#3]            ;3086  ; nResultErrorCnt
000086  1c40              ADDS     r0,r0,#1              ;3086
000088  b2c0              UXTB     r0,r0                 ;3086
00008a  70e0              STRB     r0,[r4,#3]            ;3086
00008c  280f              CMP      r0,#0xf               ;3086
00008e  d9ef              BLS      |L5.112|
000090  f44f6241          MOV      r2,#0xc10             ;3088
000094  a118              ADR      r1,|L5.248|
000096  2001              MOVS     r0,#1                 ;3088
000098  f7fffffe          BL       GPRS_Power_Control
00009c  e8bd4070          POP      {r4-r6,lr}            ;3089
0000a0  f7ffbffe          B.W      Notify_User_Invalid_Simcard
;;;3096   
                          ENDP

                  |L5.164|
0000a4  41542b43          DCB      "AT+CPIN?\r\n",0
0000a8  50494e3f
0000ac  0d0a00  
0000af  00                DCB      0
                  |L5.176|
                          DCD      ||.data||
                  |L5.180|
0000b4  41542b43          DCB      "AT+CPIN?\r",0
0000b8  50494e3f
0000bc  0d00    
0000be  00                DCB      0
0000bf  00                DCB      0
                  |L5.192|
0000c0  2b435049          DCB      "+CPIN: READY",0
0000c4  4e3a2052
0000c8  45414459
0000cc  00      
0000cd  00                DCB      0
0000ce  00                DCB      0
0000cf  00                DCB      0
                  |L5.208|
0000d0  47505253          DCB      "GPRS-->Sim Card Ready!\r\n",0
0000d4  2d2d3e53
0000d8  696d2043
0000dc  61726420
0000e0  52656164
0000e4  79210d0a
0000e8  00      
0000e9  00                DCB      0
0000ea  00                DCB      0
0000eb  00                DCB      0
                  |L5.236|
0000ec  4552524f          DCB      "ERROR",0
0000f0  5200    
0000f2  00                DCB      0
0000f3  00                DCB      0
                  |L5.244|
                          DCD      ||.conststring||+0x244
                  |L5.248|
0000f8  2e2e5c55          DCB      "..\\User\\gprs.c",0
0000fc  7365725c
000100  67707273
000104  2e6300  
000107  00                DCB      0

                          AREA ||i.GPRS_Cmd_Connect_Server||, CODE, READONLY, ALIGN=2

                          REQUIRE _printf_percent
                          REQUIRE _printf_d
                          REQUIRE _printf_s
                          REQUIRE _printf_int_dec
                          REQUIRE _printf_str
                  GPRS_Cmd_Connect_Server PROC
;;;3390   
;;;3391   static void GPRS_Cmd_Connect_Server(eGPRSMessage eMessageType)
000000  b570              PUSH     {r4-r6,lr}
;;;3392   {
;;;3393   	static char aCmdStr[80];
;;;3394   	static sGPRSSendCmdQ *p = NULL;
;;;3395   
;;;3396   	switch(eMessageType)
;;;3397   	{
;;;3398   		case eGPRSChangeState:
;;;3399   			p = Get_Free_SendCmdQ();
000002  4c2d              LDR      r4,|L6.184|
000004  2801              CMP      r0,#1                 ;3396
000006  d015              BEQ      |L6.52|
000008  2802              CMP      r0,#2                 ;3396
00000a  d154              BNE      |L6.182|
;;;3400   			if(p)
;;;3401   			{
;;;3402   				p->nNowState = eGSM_Connect_Server;
;;;3403   				p->nRetryCnt = 2;
;;;3404   				p->nWaitAckTimeout = 15000;
;;;3405   				sprintf(aCmdStr,"AT+CIPOPEN=0,\"TCP\",\"%s\",%d\r\n",
;;;3406   						Get_Net_AccessMode() ? Get_Net_RemoteURL() : Get_Net_RemoteIP(), Get_Net_RemotePort());
;;;3407   				p->pSendCmd = aCmdStr;
;;;3408   				p->nCmdLength = strlen(aCmdStr);
;;;3409   				GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
;;;3410   			}
;;;3411   			break;
;;;3412   			
;;;3413   		case eGPRSATData:
;;;3414   			if(strstr(pGPRSProcessPtr,"+CIPOPEN: 0,0"))
00000c  a12b              ADR      r1,|L6.188|
00000e  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000010  f7fffffe          BL       strstr
000014  2800              CMP      r0,#0
000016  d03b              BEQ      |L6.144|
;;;3415   			{
;;;3416   				p->bInvalidBuffer = false;
000018  6ce1              LDR      r1,[r4,#0x4c]  ; p
00001a  2000              MOVS     r0,#0
00001c  7448              STRB     r0,[r1,#0x11]
00001e  f1040164          ADD      r1,r4,#0x64
;;;3417   				GprsHal_Switch_State(eGSM_Disable_Echo);
000022  2008              MOVS     r0,#8
000024  7048              STRB     r0,[r1,#1]
;;;3418   				g_sGPRS.bTcpConnectState = true;
000026  2001              MOVS     r0,#1
000028  7108              STRB     r0,[r1,#4]
;;;3419   				TRACE_PRINTF("GPRS-->Connect server successful!\r\n");
00002a  e8bd4070          POP      {r4-r6,lr}
00002e  a027              ADR      r0,|L6.204|
000030  f7ffbffe          B.W      User_Debug_Printf
                  |L6.52|
000034  f7fffffe          BL       Get_Free_SendCmdQ
000038  64e0              STR      r0,[r4,#0x4c]         ;3400  ; p
00003a  2800              CMP      r0,#0                 ;3400
00003c  d03b              BEQ      |L6.182|
00003e  2113              MOVS     r1,#0x13              ;3402
000040  7001              STRB     r1,[r0,#0]            ;3402
000042  2102              MOVS     r1,#2                 ;3403
000044  7201              STRB     r1,[r0,#8]            ;3403
000046  f6432198          MOV      r1,#0x3a98            ;3404
00004a  f8a0100d          STRH     r1,[r0,#0xd]          ;3404
00004e  f7fffffe          BL       Get_Net_RemotePort
000052  4605              MOV      r5,r0                 ;3405
000054  f7fffffe          BL       Get_Net_AccessMode
000058  b110              CBZ      r0,|L6.96|
00005a  f7fffffe          BL       Get_Net_RemoteURL
00005e  e001              B        |L6.100|
                  |L6.96|
000060  f7fffffe          BL       Get_Net_RemoteIP
                  |L6.100|
000064  4602              MOV      r2,r0                 ;3406
000066  462b              MOV      r3,r5                 ;3406
000068  a121              ADR      r1,|L6.240|
00006a  4829              LDR      r0,|L6.272|
00006c  f7fffffe          BL       __2sprintf
000070  6ce1              LDR      r1,[r4,#0x4c]         ;3407  ; p
000072  4827              LDR      r0,|L6.272|
000074  f8c10001          STR      r0,[r1,#1]            ;3407
000078  f7fffffe          BL       strlen
00007c  b281              UXTH     r1,r0                 ;3408
00007e  6ce0              LDR      r0,[r4,#0x4c]         ;3408  ; p
000080  f8a01005          STRH     r1,[r0,#5]            ;3408
000084  f8d00001          LDR      r0,[r0,#1]            ;3409
000088  e8bd4070          POP      {r4-r6,lr}            ;3409
00008c  f7ffbffe          B.W      GPRS_Transmit_Data
                  |L6.144|
;;;3420   			}
;;;3421   			else if(strstr(pGPRSProcessPtr,"+CIPOPEN: 0") || strstr(pGPRSProcessPtr,"ERROR") )
000090  a120              ADR      r1,|L6.276|
000092  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000094  f7fffffe          BL       strstr
000098  b928              CBNZ     r0,|L6.166|
00009a  a121              ADR      r1,|L6.288|
00009c  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
00009e  f7fffffe          BL       strstr
0000a2  2800              CMP      r0,#0
0000a4  d007              BEQ      |L6.182|
                  |L6.166|
;;;3422   			{
;;;3423   				GPRS_Power_Control(eGPRSPowerRestart, __FILE__, __LINE__);
0000a6  e8bd4070          POP      {r4-r6,lr}
0000aa  f640525f          MOV      r2,#0xd5f
0000ae  a11e              ADR      r1,|L6.296|
0000b0  2002              MOVS     r0,#2
0000b2  f7ffbffe          B.W      GPRS_Power_Control
                  |L6.182|
;;;3424   			}
;;;3425   			break;
;;;3426   	}
;;;3427   }
0000b6  bd70              POP      {r4-r6,pc}
;;;3428   
                          ENDP

                  |L6.184|
                          DCD      ||.data||
                  |L6.188|
0000bc  2b434950          DCB      "+CIPOPEN: 0,0",0
0000c0  4f50454e
0000c4  3a20302c
0000c8  3000    
0000ca  00                DCB      0
0000cb  00                DCB      0
                  |L6.204|
0000cc  47505253          DCB      "GPRS-->Connect server successful!\r\n",0
0000d0  2d2d3e43
0000d4  6f6e6e65
0000d8  63742073
0000dc  65727665
0000e0  72207375
0000e4  63636573
0000e8  7366756c
0000ec  210d0a00
                  |L6.240|
0000f0  41542b43          DCB      "AT+CIPOPEN=0,""TCP"",""%s"",%d\r\n",0
0000f4  49504f50
0000f8  454e3d30
0000fc  2c225443
000100  50222c22
000104  2573222c
000108  25640d0a
00010c  00      
00010d  00                DCB      0
00010e  00                DCB      0
00010f  00                DCB      0
                  |L6.272|
                          DCD      ||.bss||+0x3c
                  |L6.276|
000114  2b434950          DCB      "+CIPOPEN: 0",0
000118  4f50454e
00011c  3a203000
                  |L6.288|
000120  4552524f          DCB      "ERROR",0
000124  5200    
000126  00                DCB      0
000127  00                DCB      0
                  |L6.296|
000128  2e2e5c55          DCB      "..\\User\\gprs.c",0
00012c  7365725c
000130  67707273
000134  2e6300  
000137  00                DCB      0

                          AREA ||i.GPRS_Cmd_GET_MCC_MNC||, CODE, READONLY, ALIGN=2

                  GPRS_Cmd_GET_MCC_MNC PROC
;;;3233   
;;;3234   void GPRS_Cmd_GET_MCC_MNC(eGPRSMessage eMessageType)
000000  b570              PUSH     {r4-r6,lr}
;;;3235   {
;;;3236   	char *pStr = NULL;
;;;3237   	const char *pCmdStr = "AT+CPSI?\r\n";
;;;3238   	static sGPRSSendCmdQ *p = NULL;
;;;3239   
;;;3240   	switch(eMessageType)
;;;3241   	{
;;;3242   		case eGPRSChangeState:
;;;3243   			p = Get_Free_SendCmdQ();
000002  4c29              LDR      r4,|L7.168|
000004  a525              ADR      r5,|L7.156|
000006  2801              CMP      r0,#1                 ;3240
000008  d02a              BEQ      |L7.96|
00000a  2802              CMP      r0,#2                 ;3240
00000c  d144              BNE      |L7.152|
;;;3244   			if(p)
;;;3245   			{
;;;3246   				p->nNowState = eGSM_Get_MCC_MNC;
;;;3247   				#if SERVER_USE_XING_JIKONG_GU //物联网卡不能正常连接而添加
;;;3248   				p->nRetryCnt=20;
;;;3249   				p->nWaitAckTimeout=1000;
;;;3250   				#endif
;;;3251   				p->pSendCmd = (char *)pCmdStr;
;;;3252   				p->nCmdLength = strlen(pCmdStr);
;;;3253   				GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
;;;3254   			}
;;;3255   			break;
;;;3256   			
;;;3257   		case eGPRSATData:
;;;3258   			pStr = strstr(pGPRSProcessPtr,"+CPSI:");
00000e  a127              ADR      r1,|L7.172|
000010  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000012  f7fffffe          BL       strstr
;;;3259   			if(pStr)
000016  2800              CMP      r0,#0
000018  d03e              BEQ      |L7.152|
;;;3260   			{
;;;3261   				s_MCC = s_MNC = 0;
00001a  2600              MOVS     r6,#0
00001c  8226              STRH     r6,[r4,#0x10]
00001e  81e6              STRH     r6,[r4,#0xe]
;;;3262   				pStr = strstr(pStr,",");
000020  a124              ADR      r1,|L7.180|
000022  f7fffffe          BL       strstr
;;;3263   				pStr = strstr(pStr + 1,",");
000026  a123              ADR      r1,|L7.180|
000028  1c40              ADDS     r0,r0,#1
00002a  f7fffffe          BL       strstr
00002e  4605              MOV      r5,r0
;;;3264   				s_MCC=atoi(pStr + 1);
000030  1c40              ADDS     r0,r0,#1
000032  f7fffffe          BL       atoi
000036  81e0              STRH     r0,[r4,#0xe]
;;;3265   				s_MNC=atoi(pStr + 1 + 4);
000038  1d68              ADDS     r0,r5,#5
00003a  f7fffffe          BL       atoi
00003e  b282              UXTH     r2,r0
000040  8222              STRH     r2,[r4,#0x10]
;;;3266   				if(s_MCC != 0 || s_MNC != 0)
000042  89e1              LDRH     r1,[r4,#0xe]  ; s_MCC
000044  ea510002          ORRS     r0,r1,r2
000048  d026              BEQ      |L7.152|
;;;3267   				{
;;;3268   					p->bInvalidBuffer = false;
00004a  6be0              LDR      r0,[r4,#0x3c]  ; p
00004c  f1040364          ADD      r3,r4,#0x64
000050  7446              STRB     r6,[r0,#0x11]
;;;3269   					GprsHal_Switch_State(eGSM_Set_APN);
000052  200f              MOVS     r0,#0xf
000054  7058              STRB     r0,[r3,#1]
;;;3270   					TRACE_PRINTF("GPRS-->MCC = %d, MNC = %d!\r\n",s_MCC, s_MNC);
000056  e8bd4070          POP      {r4-r6,lr}
00005a  a017              ADR      r0,|L7.184|
00005c  f7ffbffe          B.W      User_Debug_Printf
                  |L7.96|
000060  f7fffffe          BL       Get_Free_SendCmdQ
000064  63e0              STR      r0,[r4,#0x3c]         ;3244  ; p
000066  2800              CMP      r0,#0                 ;3244
000068  d016              BEQ      |L7.152|
00006a  210e              MOVS     r1,#0xe               ;3246
00006c  7001              STRB     r1,[r0,#0]            ;3246
00006e  2114              MOVS     r1,#0x14              ;3248
000070  7201              STRB     r1,[r0,#8]            ;3248
000072  f44f717a          MOV      r1,#0x3e8             ;3249
000076  f8a0100d          STRH     r1,[r0,#0xd]          ;3249
00007a  f8c05001          STR      r5,[r0,#1]            ;3251
00007e  4628              MOV      r0,r5                 ;3252
000080  f7fffffe          BL       strlen
000084  b281              UXTH     r1,r0                 ;3252
000086  6be0              LDR      r0,[r4,#0x3c]         ;3252  ; p
000088  f8a01005          STRH     r1,[r0,#5]            ;3252
00008c  f8d00001          LDR      r0,[r0,#1]            ;3253
000090  e8bd4070          POP      {r4-r6,lr}            ;3253
000094  f7ffbffe          B.W      GPRS_Transmit_Data
                  |L7.152|
;;;3271   				}
;;;3272   			}
;;;3273   			break;
;;;3274   	}
;;;3275   }
000098  bd70              POP      {r4-r6,pc}
;;;3276   
                          ENDP

00009a  0000              DCW      0x0000
                  |L7.156|
00009c  41542b43          DCB      "AT+CPSI?\r\n",0
0000a0  5053493f
0000a4  0d0a00  
0000a7  00                DCB      0
                  |L7.168|
                          DCD      ||.data||
                  |L7.172|
0000ac  2b435053          DCB      "+CPSI:",0
0000b0  493a00  
0000b3  00                DCB      0
                  |L7.180|
0000b4  2c00              DCB      ",",0
0000b6  00                DCB      0
0000b7  00                DCB      0
                  |L7.184|
0000b8  47505253          DCB      "GPRS-->MCC = %d, MNC = %d!\r\n",0
0000bc  2d2d3e4d
0000c0  4343203d
0000c4  2025642c
0000c8  204d4e43
0000cc  203d2025
0000d0  64210d0a
0000d4  00      
0000d5  00                DCB      0
0000d6  00                DCB      0
0000d7  00                DCB      0

                          AREA ||i.GPRS_Cmd_Get_CSQ||, CODE, READONLY, ALIGN=2

                  GPRS_Cmd_Get_CSQ PROC
;;;3125   
;;;3126   static void GPRS_Cmd_Get_CSQ(eGPRSMessage eMessageType)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;3127   {
;;;3128   	char *pStr;
;;;3129   	const char *pCmdStr = "AT+CSQ\r\n";
;;;3130   	static sGPRSSendCmdQ *p = NULL;
;;;3131   
;;;3132   	switch(eMessageType)
;;;3133   	{
;;;3134   		case eGPRSChangeState:
;;;3135   			p = Get_Free_SendCmdQ();
000004  4c33              LDR      r4,|L8.212|
000006  a630              ADR      r6,|L8.200|
;;;3136   			if(p)
;;;3137   			{
;;;3138   				p->nNowState = eGSM_GET_CSQ;
;;;3139   				p->nRetryCnt = 20;
;;;3140   				p->nWaitAckTimeout = 1000;
;;;3141   				if(g_sGPRS.bTcpConnectState)
000008  f1040564          ADD      r5,r4,#0x64
00000c  2800              CMP      r0,#0                 ;3132
00000e  d04e              BEQ      |L8.174|
000010  2714              MOVS     r7,#0x14              ;3139
000012  2801              CMP      r0,#1                 ;3132
000014  d01c              BEQ      |L8.80|
000016  2802              CMP      r0,#2                 ;3132
000018  d144              BNE      |L8.164|
;;;3142   				{
;;;3143   					p->nWaitAckTimeout = 2000;
;;;3144   				}
;;;3145   				p->pSendCmd = (char *)pCmdStr;
;;;3146   				p->nCmdLength = strlen(pCmdStr);
;;;3147   				GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
;;;3148   			}
;;;3149   			break;
;;;3150   			
;;;3151   		case eGPRSATData:
;;;3152   			pStr = strstr(pGPRSProcessPtr,"+CSQ:");
00001a  a12f              ADR      r1,|L8.216|
00001c  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
00001e  f7fffffe          BL       strstr
;;;3153   			if(pStr)
000022  2800              CMP      r0,#0
000024  d03e              BEQ      |L8.164|
000026  1d80              ADDS     r0,r0,#6
;;;3154   			{
;;;3155   				int nValue;
;;;3156   				nValue = atoi(pStr + 6);
000028  f7fffffe          BL       atoi
00002c  0002              MOVS     r2,r0
;;;3157   				if(nValue && nValue != 99)
00002e  d039              BEQ      |L8.164|
000030  2a63              CMP      r2,#0x63
000032  d037              BEQ      |L8.164|
;;;3158   				{
;;;3159   					p->bIsCmdBusy = false;
000034  6b60              LDR      r0,[r4,#0x34]  ; p
000036  2600              MOVS     r6,#0
000038  71c6              STRB     r6,[r0,#7]
;;;3160   					g_nGprsSingalQuality = GPRS_Get_Signal_Quality(nValue);
00003a  b2d0              UXTB     r0,r2
00003c  f7fffffe          BL       GPRS_Get_Signal_Quality
000040  b241              SXTB     r1,r0
;;;3161   					
;;;3162   					#if SERVER_USE_XING_JIKONG_GU
;;;3163   					if(g_nGprsSingalQuality>0)//分析当前信号强度added by lxl 20180816
;;;3164   					{
;;;3165   						g_sXingJiKongGU.bSingal_Strength=true;//g_Singal_Strength=true;
000042  4827              LDR      r0,|L8.224|
000044  7021              STRB     r1,[r4,#0]            ;3160
000046  2900              CMP      r1,#0                 ;3163
000048  dd23              BLE      |L8.146|
00004a  2301              MOVS     r3,#1
00004c  7083              STRB     r3,[r0,#2]
00004e  e021              B        |L8.148|
                  |L8.80|
000050  f7fffffe          BL       Get_Free_SendCmdQ
000054  6360              STR      r0,[r4,#0x34]         ;3136  ; p
000056  2800              CMP      r0,#0                 ;3136
000058  d024              BEQ      |L8.164|
00005a  210b              MOVS     r1,#0xb               ;3138
00005c  7001              STRB     r1,[r0,#0]            ;3138
00005e  7207              STRB     r7,[r0,#8]            ;3139
000060  f44f717a          MOV      r1,#0x3e8             ;3140
000064  f8a0100d          STRH     r1,[r0,#0xd]          ;3140
000068  7929              LDRB     r1,[r5,#4]            ;3141  ; g_sGPRS
00006a  b119              CBZ      r1,|L8.116|
00006c  f44f61fa          MOV      r1,#0x7d0             ;3143
000070  f8a0100d          STRH     r1,[r0,#0xd]          ;3143
                  |L8.116|
000074  f8c06001          STR      r6,[r0,#1]            ;3145
000078  4630              MOV      r0,r6                 ;3146
00007a  f7fffffe          BL       strlen
00007e  b281              UXTH     r1,r0                 ;3146
000080  6b60              LDR      r0,[r4,#0x34]         ;3146  ; p
000082  f8a01005          STRH     r1,[r0,#5]            ;3146
000086  f8d00001          LDR      r0,[r0,#1]            ;3147
00008a  e8bd41f0          POP      {r4-r8,lr}            ;3147
00008e  f7ffbffe          B.W      GPRS_Transmit_Data
                  |L8.146|
;;;3166   					}
;;;3167   					else
;;;3168   					{
;;;3169   						g_sXingJiKongGU.bSingal_Strength=false;//g_Singal_Strength=false;
000092  7086              STRB     r6,[r0,#2]
                  |L8.148|
;;;3170   					}
;;;3171   					#endif
;;;3172   					TRACE_PRINTF("GPRS-->g_nGprsSingalQuality = %d (+CSQ:%d).\r\n",g_nGprsSingalQuality, nValue);
000094  a013              ADR      r0,|L8.228|
000096  f7fffffe          BL       User_Debug_Printf
;;;3173   					if(g_sGPRS.bTcpConnectState)
00009a  7928              LDRB     r0,[r5,#4]  ; g_sGPRS
00009c  2800              CMP      r0,#0
00009e  6b60              LDR      r0,[r4,#0x34]  ; p
0000a0  d002              BEQ      |L8.168|
;;;3174   					{
;;;3175   						p->nRetryCnt = 20;
0000a2  7207              STRB     r7,[r0,#8]
                  |L8.164|
;;;3176   					}
;;;3177   					else
;;;3178   					{
;;;3179   						p->bInvalidBuffer = false;
;;;3180   						GprsHal_Switch_State(eGSM_CheckCOPS);
;;;3181   					}
;;;3182   				}
;;;3183   			}
;;;3184   			break;
;;;3185   
;;;3186   		case eGPRSNormalRoll:
;;;3187   			if(p->bIsCmdBusy) return;
;;;3188   
;;;3189   			if(g_sGPRS.bTcpConnectState)
;;;3190   			{
;;;3191   				if(g_nGprs_Tx_Cnt)
;;;3192   				{
;;;3193   					GprsHal_Switch_State(eGSM_Write_Socket_Phase1);
;;;3194   				}
;;;3195   			}
;;;3196   			break;
;;;3197   	}
;;;3198   }
0000a4  e8bd81f0          POP      {r4-r8,pc}
                  |L8.168|
0000a8  7446              STRB     r6,[r0,#0x11]         ;3179
0000aa  200c              MOVS     r0,#0xc               ;3180
0000ac  e00a              B        |L8.196|
                  |L8.174|
0000ae  6b60              LDR      r0,[r4,#0x34]         ;3187  ; p
0000b0  79c0              LDRB     r0,[r0,#7]            ;3187
0000b2  2800              CMP      r0,#0                 ;3187
0000b4  d1f6              BNE      |L8.164|
0000b6  7928              LDRB     r0,[r5,#4]            ;3189  ; g_sGPRS
0000b8  2800              CMP      r0,#0                 ;3189
0000ba  d0f3              BEQ      |L8.164|
0000bc  89a0              LDRH     r0,[r4,#0xc]          ;3191  ; g_nGprs_Tx_Cnt
0000be  2800              CMP      r0,#0                 ;3191
0000c0  d0f0              BEQ      |L8.164|
0000c2  2014              MOVS     r0,#0x14              ;3193
                  |L8.196|
0000c4  7068              STRB     r0,[r5,#1]            ;3193
0000c6  e7ed              B        |L8.164|
;;;3199   
                          ENDP

                  |L8.200|
0000c8  41542b43          DCB      "AT+CSQ\r\n",0
0000cc  53510d0a
0000d0  00      
0000d1  00                DCB      0
0000d2  00                DCB      0
0000d3  00                DCB      0
                  |L8.212|
                          DCD      ||.data||
                  |L8.216|
0000d8  2b435351          DCB      "+CSQ:",0
0000dc  3a00    
0000de  00                DCB      0
0000df  00                DCB      0
                  |L8.224|
                          DCD      g_sXingJiKongGU
                  |L8.228|
0000e4  47505253          DCB      "GPRS-->g_nGprsSingalQuality = %d (+CSQ:%d).\r\n",0
0000e8  2d2d3e67
0000ec  5f6e4770
0000f0  72735369
0000f4  6e67616c
0000f8  5175616c
0000fc  69747920
000100  3d202564
000104  20282b43
000108  53513a25
00010c  64292e0d
000110  0a00    
000112  00                DCB      0
000113  00                DCB      0

                          AREA ||i.GPRS_Cmd_Get_IMEI||, CODE, READONLY, ALIGN=2

                  GPRS_Cmd_Get_IMEI PROC
;;;2982   
;;;2983   static void GPRS_Cmd_Get_IMEI(eGPRSMessage eMessageType)
000000  b570              PUSH     {r4-r6,lr}
;;;2984   {
;;;2985   	char *pStr;
;;;2986   	const char *pCmdStr = "AT+CGSN\r\n";
;;;2987   	static sGPRSSendCmdQ *p = NULL;
;;;2988   
;;;2989   	switch(eMessageType)
;;;2990   	{
;;;2991   		case eGPRSChangeState:
;;;2992   			p = Get_Free_SendCmdQ();
000002  4c22              LDR      r4,|L9.140|
000004  a51e              ADR      r5,|L9.128|
000006  2801              CMP      r0,#1                 ;2989
000008  d022              BEQ      |L9.80|
00000a  2802              CMP      r0,#2                 ;2989
00000c  d136              BNE      |L9.124|
;;;2993   			if(p)
;;;2994   			{
;;;2995   				p->nNowState = eGSM_Get_IMEI;
;;;2996   				p->pSendCmd = (char *)pCmdStr;
;;;2997   				p->nCmdLength = strlen(pCmdStr);
;;;2998   				GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
;;;2999   			}
;;;3000   			break;
;;;3001   			
;;;3002   		case eGPRSATData:
;;;3003   			pStr = strstr(pGPRSProcessPtr,"AT+CGSN\r\r\n");//开机获取IMEI
00000e  a120              ADR      r1,|L9.144|
000010  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000012  f7fffffe          BL       strstr
000016  0005              MOVS     r5,r0
;;;3004   			if(pStr)
000018  d030              BEQ      |L9.124|
;;;3005   			{
;;;3006   				if(strlen(pGPRSProcessPtr) > 20)
00001a  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
00001c  f7fffffe          BL       strlen
000020  2814              CMP      r0,#0x14
000022  d92b              BLS      |L9.124|
;;;3007   				{
;;;3008   					pStr = strstr(pStr,"\r\n");
000024  a11c              ADR      r1,|L9.152|
000026  4628              MOV      r0,r5
000028  f7fffffe          BL       strstr
00002c  1c80              ADDS     r0,r0,#2
;;;3009   					Save_Hardware_IMEI(pStr + 2);
00002e  f7fffffe          BL       Save_Hardware_IMEI
;;;3010   					p->bInvalidBuffer = false;
000032  6aa1              LDR      r1,[r4,#0x28]  ; p
000034  2000              MOVS     r0,#0
000036  7448              STRB     r0,[r1,#0x11]
000038  f1040164          ADD      r1,r4,#0x64
;;;3011   					GprsHal_Switch_State(eGSM_SimCard_Check);
00003c  2009              MOVS     r0,#9
00003e  7048              STRB     r0,[r1,#1]
;;;3012   					TRACE_PRINTF("GPRS-->IMEI = %s.\r\n",Get_Hardware_IMEI());
000040  f7fffffe          BL       Get_Hardware_IMEI
000044  e8bd4070          POP      {r4-r6,lr}
000048  4601              MOV      r1,r0
00004a  a014              ADR      r0,|L9.156|
00004c  f7ffbffe          B.W      User_Debug_Printf
                  |L9.80|
000050  f7fffffe          BL       Get_Free_SendCmdQ
000054  62a0              STR      r0,[r4,#0x28]         ;2993  ; p
000056  2800              CMP      r0,#0                 ;2993
000058  d010              BEQ      |L9.124|
00005a  210a              MOVS     r1,#0xa               ;2995
00005c  7001              STRB     r1,[r0,#0]            ;2995
00005e  f8c05001          STR      r5,[r0,#1]            ;2996
000062  4628              MOV      r0,r5                 ;2997
000064  f7fffffe          BL       strlen
000068  b281              UXTH     r1,r0                 ;2997
00006a  6aa0              LDR      r0,[r4,#0x28]         ;2997  ; p
00006c  f8a01005          STRH     r1,[r0,#5]            ;2997
000070  f8d00001          LDR      r0,[r0,#1]            ;2998
000074  e8bd4070          POP      {r4-r6,lr}            ;2998
000078  f7ffbffe          B.W      GPRS_Transmit_Data
                  |L9.124|
;;;3013   				}
;;;3014   			}
;;;3015   			break;
;;;3016   	}
;;;3017   }
00007c  bd70              POP      {r4-r6,pc}
;;;3018   
                          ENDP

00007e  0000              DCW      0x0000
                  |L9.128|
000080  41542b43          DCB      "AT+CGSN\r\n",0
000084  47534e0d
000088  0a00    
00008a  00                DCB      0
00008b  00                DCB      0
                  |L9.140|
                          DCD      ||.data||
                  |L9.144|
000090  41542b43          DCB      "AT+CGSN\r"
000094  47534e0d
                  |L9.152|
000098  0d0a00            DCB      "\r\n",0
00009b  00                DCB      0
                  |L9.156|
00009c  47505253          DCB      "GPRS-->IMEI = %s.\r\n",0
0000a0  2d2d3e49
0000a4  4d454920
0000a8  3d202573
0000ac  2e0d0a00

                          AREA ||i.GPRS_Cmd_Open_Net||, CODE, READONLY, ALIGN=2

                  GPRS_Cmd_Open_Net PROC
;;;3347   
;;;3348   static void GPRS_Cmd_Open_Net(eGPRSMessage eMessageType)
000000  b570              PUSH     {r4-r6,lr}
;;;3349   {
;;;3350   	char *pStr;
;;;3351   	const char *pCmdStr = "AT+NETOPEN\r\n";
;;;3352   	static sGPRSSendCmdQ *p = NULL;
;;;3353   
;;;3354   	switch(eMessageType)
;;;3355   	{
;;;3356   		case eGPRSChangeState:
;;;3357   			p = Get_Free_SendCmdQ();
000002  4c21              LDR      r4,|L10.136|
000004  a51c              ADR      r5,|L10.120|
000006  2801              CMP      r0,#1                 ;3354
000008  d010              BEQ      |L10.44|
00000a  2802              CMP      r0,#2                 ;3354
00000c  d133              BNE      |L10.118|
;;;3358   			if(p)
;;;3359   			{
;;;3360   				p->nNowState = eGSM_Open_NET;
;;;3361   				p->nRetryCnt = 1;
;;;3362   				p->nWaitAckTimeout = 15000;
;;;3363   				p->pSendCmd = (char *)pCmdStr;
;;;3364   				p->nCmdLength = strlen(pCmdStr);
;;;3365   				GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
;;;3366   			}
;;;3367   			break;
;;;3368   			
;;;3369   		case eGPRSATData:
;;;3370   			pStr = strstr(pGPRSProcessPtr,"+NETOPEN:");
00000e  a11f              ADR      r1,|L10.140|
000010  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000012  f7fffffe          BL       strstr
;;;3371   			if(pStr)
000016  2800              CMP      r0,#0
000018  d02d              BEQ      |L10.118|
00001a  3009              ADDS     r0,r0,#9
;;;3372   			{
;;;3373   				int nValue;
;;;3374   				nValue = atoi(pStr + 9);
00001c  f7fffffe          BL       atoi
;;;3375   				if(nValue == 0)
000020  b300              CBZ      r0,|L10.100|
;;;3376   				{
;;;3377   					p->bInvalidBuffer = false;
;;;3378   					GprsHal_Switch_State(eGSM_Connect_Server);
;;;3379   					TRACE_PRINTF("GPRS-->Open Net successful!\r\n");
;;;3380   				}
;;;3381   				else
;;;3382   				{
;;;3383   					TRACE_PRINTF("GPRS-->Open Net failed!\r\n");
000022  a01d              ADR      r0,|L10.152|
                  |L10.36|
000024  e8bd4070          POP      {r4-r6,lr}
000028  f7ffbffe          B.W      User_Debug_Printf
                  |L10.44|
00002c  f7fffffe          BL       Get_Free_SendCmdQ
000030  64a0              STR      r0,[r4,#0x48]         ;3358  ; p
000032  2800              CMP      r0,#0                 ;3358
000034  d01f              BEQ      |L10.118|
000036  2110              MOVS     r1,#0x10              ;3360
000038  7001              STRB     r1,[r0,#0]            ;3360
00003a  2101              MOVS     r1,#1                 ;3361
00003c  7201              STRB     r1,[r0,#8]            ;3361
00003e  f6432198          MOV      r1,#0x3a98            ;3362
000042  f8a0100d          STRH     r1,[r0,#0xd]          ;3362
000046  f8c05001          STR      r5,[r0,#1]            ;3363
00004a  4628              MOV      r0,r5                 ;3364
00004c  f7fffffe          BL       strlen
000050  b281              UXTH     r1,r0                 ;3364
000052  6ca0              LDR      r0,[r4,#0x48]         ;3364  ; p
000054  f8a01005          STRH     r1,[r0,#5]            ;3364
000058  f8d00001          LDR      r0,[r0,#1]            ;3365
00005c  e8bd4070          POP      {r4-r6,lr}            ;3365
000060  f7ffbffe          B.W      GPRS_Transmit_Data
                  |L10.100|
000064  6ca1              LDR      r1,[r4,#0x48]         ;3377  ; p
000066  2000              MOVS     r0,#0                 ;3377
000068  7448              STRB     r0,[r1,#0x11]         ;3377
00006a  4907              LDR      r1,|L10.136|
00006c  2013              MOVS     r0,#0x13              ;3378
00006e  3164              ADDS     r1,r1,#0x64           ;3378
000070  7048              STRB     r0,[r1,#1]            ;3378
000072  a010              ADR      r0,|L10.180|
000074  e7d6              B        |L10.36|
                  |L10.118|
;;;3384   				}
;;;3385   			}
;;;3386   			break;
;;;3387   	}
;;;3388   }
000076  bd70              POP      {r4-r6,pc}
;;;3389   
                          ENDP

                  |L10.120|
000078  41542b4e          DCB      "AT+NETOPEN\r\n",0
00007c  45544f50
000080  454e0d0a
000084  00      
000085  00                DCB      0
000086  00                DCB      0
000087  00                DCB      0
                  |L10.136|
                          DCD      ||.data||
                  |L10.140|
00008c  2b4e4554          DCB      "+NETOPEN:",0
000090  4f50454e
000094  3a00    
000096  00                DCB      0
000097  00                DCB      0
                  |L10.152|
000098  47505253          DCB      "GPRS-->Open Net failed!\r\n",0
00009c  2d2d3e4f
0000a0  70656e20
0000a4  4e657420
0000a8  6661696c
0000ac  6564210d
0000b0  0a00    
0000b2  00                DCB      0
0000b3  00                DCB      0
                  |L10.180|
0000b4  47505253          DCB      "GPRS-->Open Net successful!\r\n",0
0000b8  2d2d3e4f
0000bc  70656e20
0000c0  4e657420
0000c4  73756363
0000c8  65737366
0000cc  756c210d
0000d0  0a00    
0000d2  00                DCB      0
0000d3  00                DCB      0

                          AREA ||i.GPRS_Cmd_Set_APN||, CODE, READONLY, ALIGN=2

                          REQUIRE _printf_percent
                          REQUIRE _printf_s
                          REQUIRE _printf_str
                  GPRS_Cmd_Set_APN PROC
;;;3276   
;;;3277   void GPRS_Cmd_Set_APN(eGPRSMessage eMessageType)
000000  b570              PUSH     {r4-r6,lr}
;;;3278   {
;;;3279   	char *pStr = NULL;
;;;3280   	static char aCmdStr[60];
;;;3281   	static sGPRSSendCmdQ *p = NULL;
;;;3282   	sprintf(aCmdStr,"AT+CGDCONT=1,\"IP\",\"%s\"\r\n",Get_APN_String(s_MCC,s_MNC));
000002  4c1f              LDR      r4,|L11.128|
000004  4605              MOV      r5,r0                 ;3278
000006  8a21              LDRH     r1,[r4,#0x10]  ; s_MNC
000008  89e0              LDRH     r0,[r4,#0xe]  ; s_MCC
00000a  f7fffffe          BL       Get_APN_String
00000e  4602              MOV      r2,r0
000010  a11c              ADR      r1,|L11.132|
000012  4823              LDR      r0,|L11.160|
000014  f7fffffe          BL       __2sprintf
;;;3283   
;;;3284   	switch(eMessageType)
000018  2d01              CMP      r5,#1
00001a  d018              BEQ      |L11.78|
00001c  2d02              CMP      r5,#2
00001e  d12d              BNE      |L11.124|
;;;3285   	{
;;;3286   		case eGPRSChangeState:
;;;3287   			p = Get_Free_SendCmdQ();
;;;3288   			if(p)
;;;3289   			{
;;;3290   				p->nNowState = eGSM_Set_APN;
;;;3291   				p->pSendCmd = (char *)aCmdStr;
;;;3292   				p->nCmdLength = strlen(aCmdStr);
;;;3293   				GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
;;;3294   			}
;;;3295   			break;
;;;3296   			
;;;3297   		case eGPRSATData:
;;;3298   			pStr = strstr(pGPRSProcessPtr,"OK");
000020  a120              ADR      r1,|L11.164|
000022  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000024  f7fffffe          BL       strstr
;;;3299   			if(pStr)
000028  2800              CMP      r0,#0
00002a  d027              BEQ      |L11.124|
;;;3300   			{
;;;3301   				p->bInvalidBuffer = false;
00002c  6c21              LDR      r1,[r4,#0x40]  ; p
00002e  2000              MOVS     r0,#0
000030  7448              STRB     r0,[r1,#0x11]
000032  f1040164          ADD      r1,r4,#0x64
;;;3302   				GprsHal_Switch_State(eGSM_NetRegist_Check);
000036  200d              MOVS     r0,#0xd
000038  7048              STRB     r0,[r1,#1]
;;;3303   				TRACE_PRINTF("GPRS-->Set APN string = %s\r\n",Get_APN_String(s_MCC,s_MNC));
00003a  8a21              LDRH     r1,[r4,#0x10]  ; s_MNC
00003c  89e0              LDRH     r0,[r4,#0xe]  ; s_MCC
00003e  f7fffffe          BL       Get_APN_String
000042  e8bd4070          POP      {r4-r6,lr}
000046  4601              MOV      r1,r0
000048  a017              ADR      r0,|L11.168|
00004a  f7ffbffe          B.W      User_Debug_Printf
                  |L11.78|
00004e  f7fffffe          BL       Get_Free_SendCmdQ
000052  6420              STR      r0,[r4,#0x40]         ;3288  ; p
000054  2800              CMP      r0,#0                 ;3288
000056  d011              BEQ      |L11.124|
000058  210f              MOVS     r1,#0xf               ;3290
00005a  7001              STRB     r1,[r0,#0]            ;3290
00005c  4910              LDR      r1,|L11.160|
00005e  f8c01001          STR      r1,[r0,#1]            ;3291
000062  4608              MOV      r0,r1                 ;3292
000064  f7fffffe          BL       strlen
000068  b281              UXTH     r1,r0                 ;3292
00006a  6c20              LDR      r0,[r4,#0x40]         ;3292  ; p
00006c  f8a01005          STRH     r1,[r0,#5]            ;3292
000070  f8d00001          LDR      r0,[r0,#1]            ;3293
000074  e8bd4070          POP      {r4-r6,lr}            ;3293
000078  f7ffbffe          B.W      GPRS_Transmit_Data
                  |L11.124|
;;;3304   			}
;;;3305   			break;
;;;3306   	}
;;;3307   }
00007c  bd70              POP      {r4-r6,pc}
;;;3308   
                          ENDP

00007e  0000              DCW      0x0000
                  |L11.128|
                          DCD      ||.data||
                  |L11.132|
000084  41542b43          DCB      "AT+CGDCONT=1,""IP"",""%s""\r\n",0
000088  4744434f
00008c  4e543d31
000090  2c224950
000094  222c2225
000098  73220d0a
00009c  00      
00009d  00                DCB      0
00009e  00                DCB      0
00009f  00                DCB      0
                  |L11.160|
                          DCD      ||.bss||
                  |L11.164|
0000a4  4f4b00            DCB      "OK",0
0000a7  00                DCB      0
                  |L11.168|
0000a8  47505253          DCB      "GPRS-->Set APN string = %s\r\n",0
0000ac  2d2d3e53
0000b0  65742041
0000b4  504e2073
0000b8  7472696e
0000bc  67203d20
0000c0  25730d0a
0000c4  00      
0000c5  00                DCB      0
0000c6  00                DCB      0
0000c7  00                DCB      0

                          AREA ||i.GPRS_Cmd_Write_Socket_Phase1||, CODE, READONLY, ALIGN=2

                          REQUIRE _printf_percent
                          REQUIRE _printf_d
                          REQUIRE _printf_int_dec
                  GPRS_Cmd_Write_Socket_Phase1 PROC
;;;3496   
;;;3497   static void GPRS_Cmd_Write_Socket_Phase1(eGPRSMessage eMessageType)
000000  b510              PUSH     {r4,lr}
;;;3498   {
;;;3499   	char *pStr;
;;;3500   	static char aCmdStr[50];
;;;3501   	static sGPRSSendCmdQ *p = NULL;
;;;3502   
;;;3503   	switch(eMessageType)
;;;3504   	{
;;;3505   		case eGPRSChangeState:
;;;3506   			p = Get_Free_SendCmdQ();
000002  4c1c              LDR      r4,|L12.116|
000004  2801              CMP      r0,#1                 ;3503
000006  d00f              BEQ      |L12.40|
000008  2802              CMP      r0,#2                 ;3503
00000a  d10c              BNE      |L12.38|
;;;3507   			if(p)
;;;3508   			{
;;;3509   				p->nNowState = eGSM_Write_Socket_Phase1;
;;;3510   				p->nRetryCnt = 2;
;;;3511   				sprintf(aCmdStr,"AT+CIPSEND=%d,%d\r\n", g_bGprsUseNewImagePort ? 1 : 0, g_nGprs_Tx_Cnt);
;;;3512   				p->pSendCmd = aCmdStr;
;;;3513   				p->nCmdLength = strlen(aCmdStr);
;;;3514   				GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
;;;3515   				TRACE_PRINTF("Start write socket data.\r\n");
;;;3516   			}
;;;3517   			break;
;;;3518   			
;;;3519   		case eGPRSATData:
;;;3520   			pStr = strstr(pGPRSProcessPtr,">");
00000c  a11a              ADR      r1,|L12.120|
00000e  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000010  f7fffffe          BL       strstr
;;;3521   			if(pStr)
000014  2800              CMP      r0,#0
000016  d006              BEQ      |L12.38|
;;;3522   			{
;;;3523   				p->bInvalidBuffer = false;
000018  6da1              LDR      r1,[r4,#0x58]  ; p
00001a  2000              MOVS     r0,#0
00001c  7448              STRB     r0,[r1,#0x11]
00001e  f1040164          ADD      r1,r4,#0x64
;;;3524   				GprsHal_Switch_State(eGSM_Write_Socket_Phase2);
000022  2015              MOVS     r0,#0x15
000024  7048              STRB     r0,[r1,#1]
                  |L12.38|
;;;3525   			}
;;;3526   			break;
;;;3527   	}
;;;3528   }
000026  bd10              POP      {r4,pc}
                  |L12.40|
000028  f7fffffe          BL       Get_Free_SendCmdQ
00002c  65a0              STR      r0,[r4,#0x58]         ;3507  ; p
00002e  2800              CMP      r0,#0                 ;3507
000030  d0f9              BEQ      |L12.38|
000032  2114              MOVS     r1,#0x14              ;3509
000034  7001              STRB     r1,[r0,#0]            ;3509
000036  2102              MOVS     r1,#2                 ;3510
000038  7201              STRB     r1,[r0,#8]            ;3510
00003a  78a0              LDRB     r0,[r4,#2]            ;3511  ; g_bGprsUseNewImagePort
00003c  b108              CBZ      r0,|L12.66|
00003e  2201              MOVS     r2,#1                 ;3511
000040  e000              B        |L12.68|
                  |L12.66|
000042  2200              MOVS     r2,#0                 ;3511
                  |L12.68|
000044  89a3              LDRH     r3,[r4,#0xc]          ;3511  ; g_nGprs_Tx_Cnt
000046  a10d              ADR      r1,|L12.124|
000048  4811              LDR      r0,|L12.144|
00004a  f7fffffe          BL       __2sprintf
00004e  6da1              LDR      r1,[r4,#0x58]         ;3512  ; p
000050  480f              LDR      r0,|L12.144|
000052  f8c10001          STR      r0,[r1,#1]            ;3512
000056  f7fffffe          BL       strlen
00005a  b281              UXTH     r1,r0                 ;3513
00005c  6da0              LDR      r0,[r4,#0x58]         ;3513  ; p
00005e  f8a01005          STRH     r1,[r0,#5]            ;3513
000062  f8d00001          LDR      r0,[r0,#1]            ;3514
000066  f7fffffe          BL       GPRS_Transmit_Data
00006a  e8bd4010          POP      {r4,lr}               ;3515
00006e  a009              ADR      r0,|L12.148|
000070  f7ffbffe          B.W      User_Debug_Printf
;;;3529   
                          ENDP

                  |L12.116|
                          DCD      ||.data||
                  |L12.120|
000078  3e00              DCB      ">",0
00007a  00                DCB      0
00007b  00                DCB      0
                  |L12.124|
00007c  41542b43          DCB      "AT+CIPSEND=%d,%d\r\n",0
000080  49505345
000084  4e443d25
000088  642c2564
00008c  0d0a00  
00008f  00                DCB      0
                  |L12.144|
                          DCD      ||.bss||+0x8c
                  |L12.148|
000094  53746172          DCB      "Start write socket data.\r\n",0
000098  74207772
00009c  69746520
0000a0  736f636b
0000a4  65742064
0000a8  6174612e
0000ac  0d0a00  
0000af  00                DCB      0

                          AREA ||i.GPRS_Cmd_Write_Socket_Phase2||, CODE, READONLY, ALIGN=2

                  GPRS_Cmd_Write_Socket_Phase2 PROC
;;;3460   
;;;3461   static void GPRS_Cmd_Write_Socket_Phase2(eGPRSMessage eMessageType)
000000  b510              PUSH     {r4,lr}
;;;3462   {
;;;3463   	static sGPRSSendCmdQ *p = NULL;
;;;3464   
;;;3465   	switch(eMessageType)
;;;3466   	{
;;;3467   		case eGPRSChangeState:
;;;3468   			p = Get_Free_SendCmdQ();
000002  4c1e              LDR      r4,|L13.124|
000004  2801              CMP      r0,#1                 ;3465
000006  d014              BEQ      |L13.50|
000008  2802              CMP      r0,#2                 ;3465
00000a  d136              BNE      |L13.122|
;;;3469   			if(p)
;;;3470   			{
;;;3471   				p->nNowState = eGSM_Write_Socket_Phase2;
;;;3472   				p->nRetryCnt = 2;
;;;3473   				p->nWaitAckTimeout = 1000;
;;;3474   				p->pSendCmd = GPRS_Tx_Buffer;
;;;3475   				p->nCmdLength = g_nGprs_Tx_Cnt;
;;;3476   				GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
;;;3477   			}
;;;3478   			break;
;;;3479   			
;;;3480   		case eGPRSATData:
;;;3481   			if(strstr(pGPRSProcessPtr,"+CIPSEND:"))
00000c  a11c              ADR      r1,|L13.128|
00000e  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000010  f7fffffe          BL       strstr
000014  b318              CBZ      r0,|L13.94|
;;;3482   			{
;;;3483   				g_nGprs_Tx_Cnt = 0;
000016  2000              MOVS     r0,#0
000018  81a0              STRH     r0,[r4,#0xc]
;;;3484   				g_bGprsUseNewImagePort = false;
00001a  70a0              STRB     r0,[r4,#2]
;;;3485   				p->bInvalidBuffer = false;
00001c  6d61              LDR      r1,[r4,#0x54]  ; p
00001e  7448              STRB     r0,[r1,#0x11]
;;;3486   				g_sGPRS.nNowState = eGSM_GET_CSQ;
000020  f1040164          ADD      r1,r4,#0x64
000024  200b              MOVS     r0,#0xb
000026  7008              STRB     r0,[r1,#0]
;;;3487   				TRACE_PRINTF("Write socket data result-->OK\r\n");
000028  e8bd4010          POP      {r4,lr}
00002c  a017              ADR      r0,|L13.140|
00002e  f7ffbffe          B.W      User_Debug_Printf
                  |L13.50|
000032  f7fffffe          BL       Get_Free_SendCmdQ
000036  6560              STR      r0,[r4,#0x54]         ;3469  ; p
000038  2800              CMP      r0,#0                 ;3469
00003a  d01e              BEQ      |L13.122|
00003c  2115              MOVS     r1,#0x15              ;3471
00003e  f8001b01          STRB     r1,[r0],#1            ;3471
000042  2102              MOVS     r1,#2                 ;3472
000044  71c1              STRB     r1,[r0,#7]            ;3472
000046  f44f717a          MOV      r1,#0x3e8             ;3473
00004a  8181              STRH     r1,[r0,#0xc]          ;3473
00004c  4a17              LDR      r2,|L13.172|
00004e  6002              STR      r2,[r0,#0]            ;3474
000050  89a1              LDRH     r1,[r4,#0xc]          ;3475  ; g_nGprs_Tx_Cnt
000052  8081              STRH     r1,[r0,#4]            ;3475
000054  e8bd4010          POP      {r4,lr}               ;3476
000058  4610              MOV      r0,r2                 ;3475
00005a  f7ffbffe          B.W      GPRS_Transmit_Data
                  |L13.94|
;;;3488   			}
;;;3489   			else if(strstr(pGPRSProcessPtr,"+CIPERROR:"))
00005e  a114              ADR      r1,|L13.176|
000060  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000062  f7fffffe          BL       strstr
000066  2800              CMP      r0,#0
000068  d007              BEQ      |L13.122|
;;;3490   			{
;;;3491   				GPRS_Power_Control(eGPRSPowerRestart, __FILE__, __LINE__);
00006a  e8bd4010          POP      {r4,lr}
00006e  f64052a3          MOV      r2,#0xda3
000072  a112              ADR      r1,|L13.188|
000074  2002              MOVS     r0,#2
000076  f7ffbffe          B.W      GPRS_Power_Control
                  |L13.122|
;;;3492   			}
;;;3493   			break;
;;;3494   	}
;;;3495   }
00007a  bd10              POP      {r4,pc}
;;;3496   
                          ENDP

                  |L13.124|
                          DCD      ||.data||
                  |L13.128|
000080  2b434950          DCB      "+CIPSEND:",0
000084  53454e44
000088  3a00    
00008a  00                DCB      0
00008b  00                DCB      0
                  |L13.140|
00008c  57726974          DCB      "Write socket data result-->OK\r\n",0
000090  6520736f
000094  636b6574
000098  20646174
00009c  61207265
0000a0  73756c74
0000a4  2d2d3e4f
0000a8  4b0d0a00
                  |L13.172|
                          DCD      ||.bss||+0xbe
                  |L13.176|
0000b0  2b434950          DCB      "+CIPERROR:",0
0000b4  4552524f
0000b8  523a00  
0000bb  00                DCB      0
                  |L13.188|
0000bc  2e2e5c55          DCB      "..\\User\\gprs.c",0
0000c0  7365725c
0000c4  67707273
0000c8  2e6300  
0000cb  00                DCB      0

                          AREA ||i.GPRS_Disable_Echo||, CODE, READONLY, ALIGN=2

                  GPRS_Disable_Echo PROC
;;;3430   
;;;3431   static void GPRS_Disable_Echo(eGPRSMessage eMessageType)
000000  b570              PUSH     {r4-r6,lr}
;;;3432   {
;;;3433   	const char *pCmdStr = "ATE0\r\n";
;;;3434   	static sGPRSSendCmdQ *p = NULL;
;;;3435   
;;;3436   	switch(eMessageType)
;;;3437   	{
;;;3438   		case eGPRSChangeState:
;;;3439   			p = Get_Free_SendCmdQ();
000002  4c19              LDR      r4,|L14.104|
000004  a516              ADR      r5,|L14.96|
000006  2801              CMP      r0,#1                 ;3436
000008  d013              BEQ      |L14.50|
00000a  2802              CMP      r0,#2                 ;3436
00000c  d127              BNE      |L14.94|
;;;3440   			if(p)
;;;3441   			{
;;;3442   				p->nNowState = eGSM_Disable_Echo;
;;;3443   				p->pSendCmd = (char *)pCmdStr;
;;;3444   				p->nCmdLength = strlen(pCmdStr);
;;;3445   				GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
;;;3446   			}
;;;3447   			break;
;;;3448   			
;;;3449   		case eGPRSATData:
;;;3450   			if(strstr(pGPRSProcessPtr,"ATE0\r\r\nOK\r\n"))
00000e  a117              ADR      r1,|L14.108|
000010  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000012  f7fffffe          BL       strstr
000016  2800              CMP      r0,#0
000018  d021              BEQ      |L14.94|
;;;3451   			{
;;;3452   				p->bInvalidBuffer = false;
00001a  6d21              LDR      r1,[r4,#0x50]  ; p
00001c  2000              MOVS     r0,#0
00001e  7448              STRB     r0,[r1,#0x11]
000020  f1040164          ADD      r1,r4,#0x64
;;;3453   				GprsHal_Switch_State(eGSM_GET_CSQ);
000024  200b              MOVS     r0,#0xb
000026  7048              STRB     r0,[r1,#1]
;;;3454   				TRACE_PRINTF("GPRS-->Disable Echo!\r\n");
000028  e8bd4070          POP      {r4-r6,lr}
00002c  a012              ADR      r0,|L14.120|
00002e  f7ffbffe          B.W      User_Debug_Printf
                  |L14.50|
000032  f7fffffe          BL       Get_Free_SendCmdQ
000036  6520              STR      r0,[r4,#0x50]         ;3440  ; p
000038  2800              CMP      r0,#0                 ;3440
00003a  d010              BEQ      |L14.94|
00003c  2108              MOVS     r1,#8                 ;3442
00003e  7001              STRB     r1,[r0,#0]            ;3442
000040  f8c05001          STR      r5,[r0,#1]            ;3443
000044  4628              MOV      r0,r5                 ;3444
000046  f7fffffe          BL       strlen
00004a  b281              UXTH     r1,r0                 ;3444
00004c  6d20              LDR      r0,[r4,#0x50]         ;3444  ; p
00004e  f8a01005          STRH     r1,[r0,#5]            ;3444
000052  f8d00001          LDR      r0,[r0,#1]            ;3445
000056  e8bd4070          POP      {r4-r6,lr}            ;3445
00005a  f7ffbffe          B.W      GPRS_Transmit_Data
                  |L14.94|
;;;3455   			}
;;;3456   			break;
;;;3457   	}
;;;3458   }
00005e  bd70              POP      {r4-r6,pc}
;;;3459   
                          ENDP

                  |L14.96|
000060  41544530          DCB      "ATE0\r\n",0
000064  0d0a00  
000067  00                DCB      0
                  |L14.104|
                          DCD      ||.data||
                  |L14.108|
00006c  41544530          DCB      "ATE0\r\r\nOK\r\n",0
000070  0d0d0a4f
000074  4b0d0a00
                  |L14.120|
000078  47505253          DCB      "GPRS-->Disable Echo!\r\n",0
00007c  2d2d3e44
000080  69736162
000084  6c652045
000088  63686f21
00008c  0d0a00  
00008f  00                DCB      0

                          AREA ||i.GPRS_Enable_Echo||, CODE, READONLY, ALIGN=2

                  GPRS_Enable_Echo PROC
;;;2950   
;;;2951   static void GPRS_Enable_Echo(eGPRSMessage eMessageType)
000000  b570              PUSH     {r4-r6,lr}
;;;2952   {
;;;2953   	char *pStr;
;;;2954   	const char *pCmdStr = "ATE1\r\n";
;;;2955   	static sGPRSSendCmdQ *p = NULL;
;;;2956   
;;;2957   	switch(eMessageType)
;;;2958   	{
;;;2959   		case eGPRSChangeState:
;;;2960   			p = Get_Free_SendCmdQ();
000002  4c19              LDR      r4,|L15.104|
000004  a516              ADR      r5,|L15.96|
000006  2801              CMP      r0,#1                 ;2957
000008  d013              BEQ      |L15.50|
00000a  2802              CMP      r0,#2                 ;2957
00000c  d127              BNE      |L15.94|
;;;2961   			if(p)
;;;2962   			{
;;;2963   				p->nNowState = eGSM_Enable_Echo;
;;;2964   				p->pSendCmd = (char *)pCmdStr;
;;;2965   				p->nCmdLength = strlen(pCmdStr);
;;;2966   				GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
;;;2967   			}
;;;2968   			break;
;;;2969   			
;;;2970   		case eGPRSATData:
;;;2971   			pStr = strstr(pGPRSProcessPtr,"ATE1\r\r\nOK\r\n");
00000e  a117              ADR      r1,|L15.108|
000010  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000012  f7fffffe          BL       strstr
;;;2972   			if(pStr)
000016  2800              CMP      r0,#0
000018  d021              BEQ      |L15.94|
;;;2973   			{
;;;2974   				p->bInvalidBuffer = false;
00001a  6a61              LDR      r1,[r4,#0x24]  ; p
00001c  2000              MOVS     r0,#0
00001e  7448              STRB     r0,[r1,#0x11]
000020  f1040164          ADD      r1,r4,#0x64
;;;2975   				GprsHal_Switch_State(eGSM_Get_IMEI);
000024  200a              MOVS     r0,#0xa
000026  7048              STRB     r0,[r1,#1]
;;;2976   				TRACE_PRINTF("GPRS-->Enable Echo.\r\n");
000028  e8bd4070          POP      {r4-r6,lr}
00002c  a012              ADR      r0,|L15.120|
00002e  f7ffbffe          B.W      User_Debug_Printf
                  |L15.50|
000032  f7fffffe          BL       Get_Free_SendCmdQ
000036  6260              STR      r0,[r4,#0x24]         ;2961  ; p
000038  2800              CMP      r0,#0                 ;2961
00003a  d010              BEQ      |L15.94|
00003c  2107              MOVS     r1,#7                 ;2963
00003e  7001              STRB     r1,[r0,#0]            ;2963
000040  f8c05001          STR      r5,[r0,#1]            ;2964
000044  4628              MOV      r0,r5                 ;2965
000046  f7fffffe          BL       strlen
00004a  b281              UXTH     r1,r0                 ;2965
00004c  6a60              LDR      r0,[r4,#0x24]         ;2965  ; p
00004e  f8a01005          STRH     r1,[r0,#5]            ;2965
000052  f8d00001          LDR      r0,[r0,#1]            ;2966
000056  e8bd4070          POP      {r4-r6,lr}            ;2966
00005a  f7ffbffe          B.W      GPRS_Transmit_Data
                  |L15.94|
;;;2977   			}
;;;2978   			break;
;;;2979   	}
;;;2980   }
00005e  bd70              POP      {r4-r6,pc}
;;;2981   
                          ENDP

                  |L15.96|
000060  41544531          DCB      "ATE1\r\n",0
000064  0d0a00  
000067  00                DCB      0
                  |L15.104|
                          DCD      ||.data||
                  |L15.108|
00006c  41544531          DCB      "ATE1\r\r\nOK\r\n",0
000070  0d0d0a4f
000074  4b0d0a00
                  |L15.120|
000078  47505253          DCB      "GPRS-->Enable Echo.\r\n",0
00007c  2d2d3e45
000080  6e61626c
000084  65204563
000088  686f2e0d
00008c  0a00    
00008e  00                DCB      0
00008f  00                DCB      0

                          AREA ||i.GPRS_Exce||, CODE, READONLY, ALIGN=2

                  GPRS_Exce PROC
;;;3767   
;;;3768   void GPRS_Exce(void)
000000  b570              PUSH     {r4-r6,lr}
;;;3769   {
;;;3770          //TRACE_PRINTF("nNowState:%d\r\n",g_sGPRS.nNowState);
;;;3771   	if(g_sGPRS.nNowState != eGSM_Idle)
000002  4d2b              LDR      r5,|L16.176|
000004  7828              LDRB     r0,[r5,#0]  ; g_sGPRS
000006  2801              CMP      r0,#1
000008  d050              BEQ      |L16.172|
00000a  2400              MOVS     r4,#0                 ;3769
00000c  4929              LDR      r1,|L16.180|
00000e  4620              MOV      r0,r4                 ;3769
                  |L16.16|
000010  eb0002c0          ADD      r2,r0,r0,LSL #3       ;3769
000014  eb010242          ADD      r2,r1,r2,LSL #1       ;3769
000018  7c53              LDRB     r3,[r2,#0x11]         ;3769
00001a  b11b              CBZ      r3,|L16.36|
00001c  1c40              ADDS     r0,r0,#1              ;3769
00001e  4614              MOV      r4,r2                 ;3769
000020  2803              CMP      r0,#3                 ;3769
000022  dbf5              BLT      |L16.16|
                  |L16.36|
;;;3772   	{
;;;3773   		sGPRSSendCmdQ *p;
;;;3774   		p = Get_Last_Valid_SendCmdQ();
;;;3775   		if(p)
000024  b304              CBZ      r4,|L16.104|
;;;3776   		{
;;;3777   			g_sGPRS.nNowState = p->nNowState;
000026  7820              LDRB     r0,[r4,#0]
000028  7028              STRB     r0,[r5,#0]
;;;3778   			if(Get_System_Time() > p->nStartWaitTime + p->nWaitAckTimeout)
00002a  f7fffffe          BL       Get_System_Time
00002e  f8d41009          LDR      r1,[r4,#9]
000032  f8b4200d          LDRH     r2,[r4,#0xd]
000036  4411              ADD      r1,r1,r2
000038  4288              CMP      r0,r1
00003a  d935              BLS      |L16.168|
;;;3779   			{
;;;3780   				if(p->nRetryCnt)
00003c  7a20              LDRB     r0,[r4,#8]
00003e  b1a0              CBZ      r0,|L16.106|
000040  1e40              SUBS     r0,r0,#1
;;;3781   				{
;;;3782   					p->nRetryCnt--;
000042  7220              STRB     r0,[r4,#8]
;;;3783   					p->nStartWaitTime = Get_System_Time();
000044  f7fffffe          BL       Get_System_Time
000048  f8c40009          STR      r0,[r4,#9]
;;;3784   					if(p->bDefaultProcessTimeout)
00004c  7be0              LDRB     r0,[r4,#0xf]
00004e  b140              CBZ      r0,|L16.98|
;;;3785   					{
;;;3786   						p->bIsCmdBusy = true;
000050  2001              MOVS     r0,#1
000052  71e0              STRB     r0,[r4,#7]
;;;3787   						GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
000054  f8b41005          LDRH     r1,[r4,#5]
000058  f8d40001          LDR      r0,[r4,#1]
00005c  f7fffffe          BL       GPRS_Transmit_Data
000060  e013              B        |L16.138|
                  |L16.98|
;;;3788   					}
;;;3789   					else
;;;3790   					{
;;;3791   						GPRS_FSM_Sub(eGPRSCmdTimeout);
000062  2003              MOVS     r0,#3
                  |L16.100|
;;;3792   					}
;;;3793   				}
;;;3794   				else
;;;3795   				{
;;;3796   					if(p->bDefaultProcessExceedMaxRetryCnt)
;;;3797   					{
;;;3798   						TRACE_PRINTF("AT Cmd timeout, cmd state = %s.\r\n", GPRS_Cmd_StateString[g_sGPRS.nNowState]);
;;;3799   						GPRS_Power_Control(eGPRSPowerRestart, __FILE__, __LINE__);
;;;3800   					}
;;;3801   					else
;;;3802   					{
;;;3803   						GPRS_FSM_Sub(eGPRSExceedMaxRetryCnt);
;;;3804   					}
;;;3805   				}
;;;3806   			}
;;;3807   			else
;;;3808   			{
;;;3809   				GPRS_FSM_Sub(eGPRSNormalRoll);
000064  f7fffffe          BL       GPRS_FSM_Sub
                  |L16.104|
000068  e00f              B        |L16.138|
                  |L16.106|
00006a  7c20              LDRB     r0,[r4,#0x10]         ;3796
00006c  b1d0              CBZ      r0,|L16.164|
00006e  4910              LDR      r1,|L16.176|
000070  7828              LDRB     r0,[r5,#0]            ;3798  ; g_sGPRS
000072  3108              ADDS     r1,r1,#8              ;3798
000074  f8511020          LDR      r1,[r1,r0,LSL #2]     ;3798
000078  a00f              ADR      r0,|L16.184|
00007a  f7fffffe          BL       User_Debug_Printf
00007e  f64062d7          MOV      r2,#0xed7             ;3799
000082  a116              ADR      r1,|L16.220|
000084  2002              MOVS     r0,#2                 ;3799
000086  f7fffffe          BL       GPRS_Power_Control
                  |L16.138|
;;;3810   			}
;;;3811   		}
;;;3812   
;;;3813   		GPRS_Processed_Receive_Data();
00008a  f7fffffe          BL       GPRS_Processed_Receive_Data
;;;3814   
;;;3815   		if(g_sGPRS.nNewState != eGSM_None)
00008e  7868              LDRB     r0,[r5,#1]  ; g_sGPRS
000090  2800              CMP      r0,#0
000092  d00b              BEQ      |L16.172|
;;;3816   		{
;;;3817   			g_sGPRS.nNowState = g_sGPRS.nNewState;
000094  7028              STRB     r0,[r5,#0]
;;;3818   			g_sGPRS.nNewState = eGSM_None;
000096  2000              MOVS     r0,#0
000098  7068              STRB     r0,[r5,#1]
;;;3819   			GPRS_FSM_Sub(eGPRSChangeState);
00009a  e8bd4070          POP      {r4-r6,lr}
00009e  2001              MOVS     r0,#1
0000a0  f7ffbffe          B.W      GPRS_FSM_Sub
                  |L16.164|
0000a4  2004              MOVS     r0,#4                 ;3803
0000a6  e7dd              B        |L16.100|
                  |L16.168|
0000a8  2000              MOVS     r0,#0                 ;3809
0000aa  e7db              B        |L16.100|
                  |L16.172|
;;;3820   		}
;;;3821   	}
;;;3822   }
0000ac  bd70              POP      {r4-r6,pc}
;;;3823   
                          ENDP

0000ae  0000              DCW      0x0000
                  |L16.176|
                          DCD      ||.data||+0x64
                  |L16.180|
                          DCD      ||.bss||+0x6d6
                  |L16.184|
0000b8  41542043          DCB      "AT Cmd timeout, cmd state = %s.\r\n",0
0000bc  6d642074
0000c0  696d656f
0000c4  75742c20
0000c8  636d6420
0000cc  73746174
0000d0  65203d20
0000d4  25732e0d
0000d8  0a00    
0000da  00                DCB      0
0000db  00                DCB      0
                  |L16.220|
0000dc  2e2e5c55          DCB      "..\\User\\gprs.c",0
0000e0  7365725c
0000e4  67707273
0000e8  2e6300  
0000eb  00                DCB      0

                          AREA ||i.GPRS_FSM_Sub||, CODE, READONLY, ALIGN=2

                  GPRS_FSM_Sub PROC
;;;3661   
;;;3662   void GPRS_FSM_Sub(eGPRSMessage eMessageType)
000000  491a              LDR      r1,|L17.108|
;;;3663   {
;;;3664   	switch(g_sGPRS.nNowState)
000002  7809              LDRB     r1,[r1,#0]  ; g_sGPRS
000004  2918              CMP      r1,#0x18
000006  d22f              BCS      |L17.104|
000008  e8dff001          TBB      [pc,r1]
00000c  2e2e2e2e          DCB      0x2e,0x2e,0x2e,0x2e
000010  0c0e1012          DCB      0x0c,0x0e,0x10,0x12
000014  2816141a          DCB      0x28,0x16,0x14,0x1a
000018  1c221e20          DCB      0x1c,0x22,0x1e,0x20
00001c  242e2e26          DCB      0x24,0x2e,0x2e,0x26
000020  2a2c2e18          DCB      0x2a,0x2c,0x2e,0x18
;;;3665   	{
;;;3666   		case eGSM_Idle:
;;;3667   			break;
;;;3668   			
;;;3669   		case eGSM_PowerUp:
;;;3670   			GPRS_Power_Up(eMessageType);
000024  f7ffbffe          B.W      GPRS_Power_Up
;;;3671   			break;
;;;3672   
;;;3673   		case eGSM_UartSync:
;;;3674   			GPRS_UartSync(eMessageType);
000028  f7ffbffe          B.W      GPRS_UartSync
;;;3675   			break;
;;;3676   
;;;3677   		case eGSM_ChangeBaudRate:
;;;3678   			GPRS_Change_Baudrate(eMessageType);
00002c  f7ffbffe          B.W      GPRS_Change_Baudrate
;;;3679   			break;
;;;3680   
;;;3681   		case eGSM_Enable_Echo:
;;;3682   			GPRS_Enable_Echo(eMessageType);
000030  f7ffbffe          B.W      GPRS_Enable_Echo
;;;3683   			break;
;;;3684   
;;;3685   		case eGSM_Get_IMEI:
;;;3686   			GPRS_Cmd_Get_IMEI(eMessageType);
000034  f7ffbffe          B.W      GPRS_Cmd_Get_IMEI
;;;3687   			break;
;;;3688   			
;;;3689   		case eGSM_SimCard_Check:
;;;3690   			GPRS_Cmd_CheckSimcard(eMessageType);
000038  f7ffbffe          B.W      GPRS_Cmd_CheckSimcard
;;;3691   			break;
;;;3692   
;;;3693   		case eGSM_Add_MessageHead:
;;;3694   			GPRS_Cmd_Add_MessageHead(eMessageType);
00003c  f7ffbffe          B.W      GPRS_Cmd_Add_MessageHead
;;;3695   			break;
;;;3696   
;;;3697   		case eGSM_GET_CSQ:
;;;3698   			GPRS_Cmd_Get_CSQ(eMessageType);
000040  f7ffbffe          B.W      GPRS_Cmd_Get_CSQ
;;;3699   			break;
;;;3700   
;;;3701   		case eGSM_CheckCOPS:
;;;3702   			GPRS_Cmd_CheckCOPS(eMessageType);
000044  f7ffbffe          B.W      GPRS_Cmd_CheckCOPS
;;;3703   			break;
;;;3704   
;;;3705   		case eGSM_Get_MCC_MNC:
;;;3706   			GPRS_Cmd_GET_MCC_MNC(eMessageType);
000048  f7ffbffe          B.W      GPRS_Cmd_GET_MCC_MNC
;;;3707   			break;
;;;3708   
;;;3709   		case eGSM_Set_APN:
;;;3710   			GPRS_Cmd_Set_APN(eMessageType);
00004c  f7ffbffe          B.W      GPRS_Cmd_Set_APN
;;;3711   			break;
;;;3712   
;;;3713   		case eGSM_NetRegist_Check:
;;;3714   			GPRS_Cmd_CheckNetRegist_State(eMessageType);
000050  f7ffbffe          B.W      GPRS_Cmd_CheckNetRegist_State
;;;3715   			break;
;;;3716   
;;;3717   		case eGSM_Open_NET:
;;;3718   			GPRS_Cmd_Open_Net(eMessageType);
000054  f7ffbffe          B.W      GPRS_Cmd_Open_Net
;;;3719   			break;
;;;3720   			
;;;3721   		case eGSM_Connect_Server:
;;;3722   			GPRS_Cmd_Connect_Server(eMessageType);
000058  f7ffbffe          B.W      GPRS_Cmd_Connect_Server
;;;3723   			break;
;;;3724   
;;;3725   		case eGSM_Disable_Echo:
;;;3726   			GPRS_Disable_Echo(eMessageType);
00005c  f7ffbffe          B.W      GPRS_Disable_Echo
;;;3727   			break;
;;;3728   
;;;3729   		case eGSM_Write_Socket_Phase1:
;;;3730   			GPRS_Cmd_Write_Socket_Phase1(eMessageType);
000060  f7ffbffe          B.W      GPRS_Cmd_Write_Socket_Phase1
;;;3731   			break;
;;;3732   
;;;3733   		case eGSM_Write_Socket_Phase2:
;;;3734   			GPRS_Cmd_Write_Socket_Phase2(eMessageType);
000064  f7ffbffe          B.W      GPRS_Cmd_Write_Socket_Phase2
                  |L17.104|
;;;3735   			break;
;;;3736   	}
;;;3737   }
000068  4770              BX       lr
;;;3738   
                          ENDP

00006a  0000              DCW      0x0000
                  |L17.108|
                          DCD      ||.data||+0x64

                          AREA ||i.GPRS_Get_Signal_Quality||, CODE, READONLY, ALIGN=1

                  GPRS_Get_Signal_Quality PROC
;;;3019   
;;;3020   unsigned char GPRS_Get_Signal_Quality(unsigned char nValue)
000000  2804              CMP      r0,#4
;;;3021   {
000002  d31c              BCC      |L18.62|
;;;3022   	if(nValue < 4 || nValue == 99)
000004  2863              CMP      r0,#0x63
000006  d01a              BEQ      |L18.62|
;;;3023   	{
;;;3024   		return 0;
;;;3025   	}
;;;3026   	else if(nValue >= 4 &&  nValue < 10)
000008  1f01              SUBS     r1,r0,#4
00000a  2906              CMP      r1,#6
00000c  d201              BCS      |L18.18|
;;;3027   	{
;;;3028   		return 1;
00000e  2001              MOVS     r0,#1
;;;3029   	}
;;;3030   	else if(nValue >= 10 &&  nValue < 16)
;;;3031   	{
;;;3032   		return 2;
;;;3033   	}
;;;3034   	else if(nValue >= 16 &&  nValue < 22)
;;;3035   	{
;;;3036   		return 3;
;;;3037   	}
;;;3038   	else if(nValue >= 22 &&  nValue < 28)
;;;3039   	{
;;;3040   		return 4;
;;;3041   	}
;;;3042   	else if(nValue >= 28)
;;;3043   	{
;;;3044   		return 5;
;;;3045   	}
;;;3046   
;;;3047   	return 0;
;;;3048   }
000010  4770              BX       lr
                  |L18.18|
000012  f1a0010a          SUB      r1,r0,#0xa            ;3030
000016  2906              CMP      r1,#6                 ;3030
000018  d201              BCS      |L18.30|
00001a  2002              MOVS     r0,#2                 ;3032
00001c  4770              BX       lr
                  |L18.30|
00001e  f1a00110          SUB      r1,r0,#0x10           ;3034
000022  2906              CMP      r1,#6                 ;3034
000024  d201              BCS      |L18.42|
000026  2003              MOVS     r0,#3                 ;3036
000028  4770              BX       lr
                  |L18.42|
00002a  f1a00116          SUB      r1,r0,#0x16           ;3038
00002e  2906              CMP      r1,#6                 ;3038
000030  d201              BCS      |L18.54|
000032  2004              MOVS     r0,#4                 ;3040
000034  4770              BX       lr
                  |L18.54|
000036  281c              CMP      r0,#0x1c              ;3042
000038  d301              BCC      |L18.62|
00003a  2005              MOVS     r0,#5                 ;3044
00003c  4770              BX       lr
                  |L18.62|
00003e  2000              MOVS     r0,#0                 ;3047
000040  4770              BX       lr
;;;3049   
                          ENDP


                          AREA ||i.GPRS_Hal_Var_Init||, CODE, READONLY, ALIGN=2

                  GPRS_Hal_Var_Init PROC
;;;2806   
;;;2807   static void GPRS_Hal_Var_Init(void)
000000  b570              PUSH     {r4-r6,lr}
000002  4d16              LDR      r5,|L19.92|
000004  2400              MOVS     r4,#0
000006  bf00              NOP      
                  |L19.8|
000008  eb0400c4          ADD      r0,r4,r4,LSL #3
00000c  eb050040          ADD      r0,r5,r0,LSL #1
000010  2112              MOVS     r1,#0x12
000012  f7fffffe          BL       __aeabi_memclr
000016  1c64              ADDS     r4,r4,#1
000018  2c03              CMP      r4,#3
00001a  dbf5              BLT      |L19.8|
00001c  2000              MOVS     r0,#0
00001e  4910              LDR      r1,|L19.96|
000020  4b0e              LDR      r3,|L19.92|
000022  4602              MOV      r2,r0
000024  3b3c              SUBS     r3,r3,#0x3c
000026  6608              STR      r0,[r1,#0x60]  ; pCurrGPRSRevQ
                  |L19.40|
000028  eb020442          ADD      r4,r2,r2,LSL #1
00002c  eb030444          ADD      r4,r3,r4,LSL #1
000030  1c52              ADDS     r2,r2,#1
000032  6020              STR      r0,[r4,#0]
000034  80a0              STRH     r0,[r4,#4]
000036  2a0a              CMP      r2,#0xa
000038  dbf6              BLT      |L19.40|
;;;2808   {
;;;2809   	Init_SendCmdQ();
;;;2810   	Init_ReceiveQ();
;;;2811   	s_nUartInCnt = 0;
00003a  80c8              STRH     r0,[r1,#6]
;;;2812   	s_nUartOutCnt = 0;
00003c  8108              STRH     r0,[r1,#8]
;;;2813   	memset(&g_sGPRS, 0, sizeof(g_sGPRS));
00003e  4a08              LDR      r2,|L19.96|
000040  3264              ADDS     r2,r2,#0x64
000042  6010              STR      r0,[r2,#0]
000044  8090              STRH     r0,[r2,#4]
;;;2814   	g_nGprsSingalQuality = -1;
000046  20ff              MOVS     r0,#0xff
000048  7008              STRB     r0,[r1,#0]
;;;2815   	g_bGprsPowerOnState = true;
00004a  2001              MOVS     r0,#1
00004c  7048              STRB     r0,[r1,#1]
;;;2816   	GprsHal_Switch_State(eGSM_PowerUp);
00004e  2004              MOVS     r0,#4
000050  7050              STRB     r0,[r2,#1]
;;;2817   	TRACE_PRINTF("GPRS_Hal_Var_Init\r\n");
000052  e8bd4070          POP      {r4-r6,lr}
000056  a003              ADR      r0,|L19.100|
000058  f7ffbffe          B.W      User_Debug_Printf
;;;2818   }
;;;2819   
                          ENDP

                  |L19.92|
                          DCD      ||.bss||+0x6d6
                  |L19.96|
                          DCD      ||.data||
                  |L19.100|
000064  47505253          DCB      "GPRS_Hal_Var_Init\r\n",0
000068  5f48616c
00006c  5f566172
000070  5f496e69
000074  740d0a00

                          AREA ||i.GPRS_Power_Control||, CODE, READONLY, ALIGN=2

                  GPRS_Power_Control PROC
;;;2692   
;;;2693   bool GPRS_Power_Control(ePowerCtrlParameter eArgument, const char *FileName, int nLineNumber)
000000  b570              PUSH     {r4-r6,lr}
;;;2694   {
;;;2695   	TRACE_PRINTF("GPRS module  is power down.(Argument = %d (0:Normal, 1:Always, 2:Restart), Call by \" %s \" ,Line = %d)\r\n",eArgument, FileName ,nLineNumber);
000002  4613              MOV      r3,r2
000004  460a              MOV      r2,r1
000006  4605              MOV      r5,r0                 ;2694
000008  4601              MOV      r1,r0
00000a  4816              LDR      r0,|L20.100|
00000c  f7fffffe          BL       User_Debug_Printf
;;;2696   	
;;;2697   	GPRS_MODULE_POWER_OFF();
000010  4915              LDR      r1,|L20.104|
000012  f44f5080          MOV      r0,#0x1000
000016  6148              STR      r0,[r1,#0x14]
;;;2698   	g_nGprsSingalQuality = -1;
000018  4c14              LDR      r4,|L20.108|
00001a  20ff              MOVS     r0,#0xff
;;;2699   	g_bGprsPowerOnState = false;
00001c  2600              MOVS     r6,#0
00001e  7020              STRB     r0,[r4,#0]            ;2698
000020  7066              STRB     r6,[r4,#1]
;;;2700   	Gprs_Set_UserLogin_State(false);
000022  4630              MOV      r0,r6
000024  f7fffffe          BL       Gprs_Set_UserLogin_State
000028  f1040164          ADD      r1,r4,#0x64
;;;2701   	GprsHal_Switch_State(eGSM_Idle);
00002c  2001              MOVS     r0,#1
00002e  7048              STRB     r0,[r1,#1]
;;;2702   
;;;2703   	switch(eArgument)
000030  b125              CBZ      r5,|L20.60|
000032  2d01              CMP      r5,#1
000034  d004              BEQ      |L20.64|
000036  2d02              CMP      r5,#2
000038  d107              BNE      |L20.74|
00003a  e008              B        |L20.78|
                  |L20.60|
;;;2704   	{
;;;2705   		case eGPRSPowerDownNormal:
;;;2706   			s_nGprsRestartCnt = 0;
00003c  80a6              STRH     r6,[r4,#4]
;;;2707   			GprsUser_Switch_State(eGprsUserGetIMEI);
;;;2708   			return true;
00003e  e00c              B        |L20.90|
                  |L20.64|
;;;2709   
;;;2710   		case eGPRSPowerDownAlways:
;;;2711   			s_nGprsRestartCnt = GPRS_MAX_RESTART_TIME;
000040  200a              MOVS     r0,#0xa
000042  80a0              STRH     r0,[r4,#4]
;;;2712   			GprsUser_Switch_State(eGprsUserNothing);
000044  2000              MOVS     r0,#0
000046  f7fffffe          BL       GprsUser_Switch_State
                  |L20.74|
;;;2713   			return false;
;;;2714   
;;;2715   		case eGPRSPowerRestart:
;;;2716   		#if SERVER_USE_XING_JIKONG_GU
;;;2717   		if(1)//if(++s_nGprsRestartCnt < GPRS_MAX_RESTART_TIME) //Modified bylxl 
;;;2718   		#else
;;;2719   		if(++s_nGprsRestartCnt < GPRS_MAX_RESTART_TIME)
;;;2720   		#endif
;;;2721   			{
;;;2722   				GPRS_Hal_Var_Init();
;;;2723   				TRACE_PRINTF("s_nGprsRestartCnt = %d!\r\n",s_nGprsRestartCnt);
;;;2724   				GprsUser_Switch_State(eGprsUserGetIMEI);
;;;2725   				return true;
;;;2726   			}
;;;2727   			GprsUser_Switch_State(eGprsUserNothing);
;;;2728   			return false;
;;;2729   	}
;;;2730   	
;;;2731   	return false;
00004a  2000              MOVS     r0,#0
;;;2732   }
00004c  bd70              POP      {r4-r6,pc}
                  |L20.78|
00004e  f7fffffe          BL       GPRS_Hal_Var_Init
000052  88a1              LDRH     r1,[r4,#4]            ;2723  ; s_nGprsRestartCnt
000054  a006              ADR      r0,|L20.112|
000056  f7fffffe          BL       User_Debug_Printf
                  |L20.90|
00005a  2001              MOVS     r0,#1                 ;2724
00005c  f7fffffe          BL       GprsUser_Switch_State
000060  2001              MOVS     r0,#1                 ;2725
000062  bd70              POP      {r4-r6,pc}
;;;2733   
                          ENDP

                  |L20.100|
                          DCD      ||.conststring||+0x1dc
                  |L20.104|
                          DCD      0x40011000
                  |L20.108|
                          DCD      ||.data||
                  |L20.112|
000070  735f6e47          DCB      "s_nGprsRestartCnt = %d!\r\n",0
000074  70727352
000078  65737461
00007c  7274436e
000080  74203d20
000084  2564210d
000088  0a00    
00008a  00                DCB      0
00008b  00                DCB      0

                          AREA ||i.GPRS_Power_Up||, CODE, READONLY, ALIGN=2

                  GPRS_Power_Up PROC
;;;2851   
;;;2852   static void  GPRS_Power_Up(eGPRSMessage eMessageType)
000000  b5f8              PUSH     {r3-r7,lr}
;;;2853   {
000002  2600              MOVS     r6,#0
000004  4f25              LDR      r7,|L21.156|
;;;2854   	static sGPRSSendCmdQ *p = NULL;
;;;2855   	
;;;2856   	switch(eMessageType)
;;;2857   	{
;;;2858   		case eGPRSChangeState:
;;;2859   			p = Get_Free_SendCmdQ();
000006  4c26              LDR      r4,|L21.160|
000008  f44f4500          MOV      r5,#0x8000
00000c  2801              CMP      r0,#1                 ;2856
00000e  d009              BEQ      |L21.36|
000010  2803              CMP      r0,#3                 ;2856
000012  d106              BNE      |L21.34|
;;;2860   			if(p)
;;;2861   			{
;;;2862   				p->nNowState = eGSM_PowerUp;
;;;2863   				p->nWaitAckTimeout = 12000;
;;;2864   				p->bDefaultProcessTimeout = false;
;;;2865   				
;;;2866   				GPRS_Gpio_Init();
;;;2867   				GPRS_Uart_Init(115200);
;;;2868   				GPRS_MODULE_POWER_ON();
;;;2869   				GPRS_RESET_HIGH();
;;;2870   				delay_ms(10);
;;;2871   				GPRS_RESET_LOW();
;;;2872   				GPRS_POWER_KEY_PIN_HIGH();
;;;2873   				TRACE_PRINTF("GPRS module is booting....\r\n");
;;;2874   			}
;;;2875   			break;
;;;2876   			
;;;2877   		case eGPRSCmdTimeout:
;;;2878   			p->bInvalidBuffer = false;
000014  69a0              LDR      r0,[r4,#0x18]  ; p
000016  7446              STRB     r6,[r0,#0x11]
;;;2879   			GPRS_POWER_KEY_PIN_LOW();
000018  617d              STR      r5,[r7,#0x14]
00001a  f1040164          ADD      r1,r4,#0x64
;;;2880   			GprsHal_Switch_State(eGSM_UartSync);
00001e  2005              MOVS     r0,#5
000020  7048              STRB     r0,[r1,#1]
                  |L21.34|
;;;2881   			break;
;;;2882   	}
;;;2883   }
000022  bdf8              POP      {r3-r7,pc}
                  |L21.36|
000024  f7fffffe          BL       Get_Free_SendCmdQ
000028  61a0              STR      r0,[r4,#0x18]         ;2860  ; p
00002a  2800              CMP      r0,#0                 ;2860
00002c  d0f9              BEQ      |L21.34|
00002e  2104              MOVS     r1,#4                 ;2862
000030  7001              STRB     r1,[r0,#0]            ;2862
000032  f64261e0          MOV      r1,#0x2ee0            ;2863
000036  f8a0100d          STRH     r1,[r0,#0xd]          ;2863
00003a  73c6              STRB     r6,[r0,#0xf]          ;2864
00003c  f44f5680          MOV      r6,#0x1000            ;2864
000040  f8ad6000          STRH     r6,[sp,#0]            ;2864
000044  2002              MOVS     r0,#2                 ;2864
000046  f88d0002          STRB     r0,[sp,#2]            ;2864
00004a  2010              MOVS     r0,#0x10              ;2864
00004c  f88d0003          STRB     r0,[sp,#3]            ;2864
000050  4669              MOV      r1,sp                 ;2864
000052  463c              MOV      r4,r7                 ;2864
000054  4638              MOV      r0,r7                 ;2864
000056  f7fffffe          BL       GPIO_Init
00005a  6166              STR      r6,[r4,#0x14]         ;2864
00005c  f8ad5000          STRH     r5,[sp,#0]            ;2864
000060  4669              MOV      r1,sp                 ;2864
000062  4620              MOV      r0,r4                 ;2864
000064  f7fffffe          BL       GPIO_Init
000068  6165              STR      r5,[r4,#0x14]         ;2864
00006a  00b7              LSLS     r7,r6,#2              ;2864
00006c  f8ad7000          STRH     r7,[sp,#0]            ;2864
000070  4669              MOV      r1,sp                 ;2864
000072  4620              MOV      r0,r4                 ;2864
000074  f7fffffe          BL       GPIO_Init
000078  6127              STR      r7,[r4,#0x10]         ;2864
00007a  f44f30e1          MOV      r0,#0x1c200           ;2867
00007e  f7fffffe          BL       GPRS_Uart_Init
000082  6126              STR      r6,[r4,#0x10]         ;2868
000084  6127              STR      r7,[r4,#0x10]         ;2869
000086  200a              MOVS     r0,#0xa               ;2870
000088  f7fffffe          BL       delay_ms
00008c  6167              STR      r7,[r4,#0x14]         ;2871
00008e  6125              STR      r5,[r4,#0x10]         ;2872
000090  e8bd40f8          POP      {r3-r7,lr}            ;2873
000094  a003              ADR      r0,|L21.164|
000096  f7ffbffe          B.W      User_Debug_Printf
;;;2884   
                          ENDP

00009a  0000              DCW      0x0000
                  |L21.156|
                          DCD      0x40011000
                  |L21.160|
                          DCD      ||.data||
                  |L21.164|
0000a4  47505253          DCB      "GPRS module is booting....\r\n",0
0000a8  206d6f64
0000ac  756c6520
0000b0  69732062
0000b4  6f6f7469
0000b8  6e672e2e
0000bc  2e2e0d0a
0000c0  00      
0000c1  00                DCB      0
0000c2  00                DCB      0
0000c3  00                DCB      0

                          AREA ||i.GPRS_Processed_Receive_Data||, CODE, READONLY, ALIGN=2

                  GPRS_Processed_Receive_Data PROC
;;;3532   /************************************************************************************************************************/
;;;3533   bool GPRS_Processed_Receive_Data(void)
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;3534   {
;;;3535   	int i;
;;;3536   	char * pStr;
;;;3537   	sGPRSReceiveQ *pPrcoQ;
;;;3538   	static unsigned short nLen = 0;
;;;3539   	for(i = 0; i < GPRS_RECEIVE_Q_SIZE; i++)
;;;3540   	{
;;;3541   		if(g_sGPRSReceiveQ[i].bFinishReceive)
000004  4964              LDR      r1,|L22.408|
000006  2000              MOVS     r0,#0                 ;3539
                  |L22.8|
000008  eb000240          ADD      r2,r0,r0,LSL #1
00000c  eb010242          ADD      r2,r1,r2,LSL #1
000010  7912              LDRB     r2,[r2,#4]
000012  b1d2              CBZ      r2,|L22.74|
;;;3542   		{
;;;3543   			pPrcoQ = &g_sGPRSReceiveQ[i];
000014  eb000040          ADD      r0,r0,r0,LSL #1
000018  eb010640          ADD      r6,r1,r0,LSL #1
;;;3544   			g_sGPRSReceiveQ[i].bFinishReceive = false;
00001c  f04f0800          MOV      r8,#0
000020  f8868004          STRB     r8,[r6,#4]
;;;3545   			goto _Next;
;;;3546   		}
;;;3547   	}
;;;3548   	return false;
;;;3549   	
;;;3550   _Next:
;;;3551   	/*求当前包的长度*/
;;;3552   	if(pPrcoQ->nEndPosition >= pPrcoQ->nStartPosition)
000024  8871              LDRH     r1,[r6,#2]
000026  8830              LDRH     r0,[r6,#0]
;;;3553   	{
;;;3554   		nLen = pPrcoQ->nEndPosition - pPrcoQ->nStartPosition;
000028  4c5c              LDR      r4,|L22.412|
00002a  4281              CMP      r1,r0                 ;3552
;;;3555   	}
;;;3556   	else
;;;3557   	{
;;;3558   		nLen = pPrcoQ->nEndPosition + GPRS_REV_BUFFER_SIZE - pPrcoQ->nStartPosition;
00002c  eba10100          SUB      r1,r1,r0
000030  d201              BCS      |L22.54|
000032  f501717a          ADD      r1,r1,#0x3e8          ;3545
                  |L22.54|
000036  8161              STRH     r1,[r4,#0xa]
;;;3559   	}
;;;3560   	
;;;3561   	if(nLen > GPRS_PROCESS_BUFFER_SIZE)
000038  b28f              UXTH     r7,r1
00003a  f44f717a          MOV      r1,#0x3e8
00003e  428f              CMP      r7,r1
000040  d909              BLS      |L22.86|
;;;3562   	{
;;;3563   		TRACE_PRINTF("GPRS-->Not enough buffer to process this message!\r\n");
000042  a057              ADR      r0,|L22.416|
000044  f7fffffe          BL       User_Debug_Printf
;;;3564   		return false;
000048  e002              B        |L22.80|
                  |L22.74|
00004a  1c40              ADDS     r0,r0,#1
00004c  280a              CMP      r0,#0xa               ;3539
00004e  dbdb              BLT      |L22.8|
                  |L22.80|
000050  2000              MOVS     r0,#0                 ;3548
                  |L22.82|
;;;3565   	}
;;;3566   
;;;3567   	/*复制数据到处理的内存.*/
;;;3568   	s_nUartOutCnt = pPrcoQ->nStartPosition;
;;;3569   	memset(GPRS_Process_Buffer,0,sizeof(GPRS_Process_Buffer));
;;;3570   	for(i = 0;i < nLen; i++)
;;;3571   	{
;;;3572   		if(i >= GPRS_PROCESS_BUFFER_SIZE)
;;;3573   		{	
;;;3574   			break;
;;;3575   		}
;;;3576   		GPRS_Process_Buffer[i] = GPRS_Get_Uart_Data();
;;;3577   	}
;;;3578   	pPrcoQ->bInvalidBuffer = false;
;;;3579   
;;;3580   	pGPRSProcessPtr = GPRS_Process_Buffer;
;;;3581   #if GPRS_FULL_ECHO_MESSAGE
;;;3582   	TRACE_PRINTF("++Gprs_Receive(Bytes=%02d)>\r\n%s\r\n",nLen,pGPRSProcessPtr);
;;;3583   #endif
;;;3584   
;;;3585   	do
;;;3586   	{
;;;3587   		pStr = strstr(pGPRSProcessPtr,"\r\n");
;;;3588   		if(pStr)
;;;3589   		{
;;;3590   			unsigned short nLineLen;
;;;3591   			nLineLen =  pStr - pGPRSProcessPtr + 2;
;;;3592   			if(nLineLen == 2)
;;;3593   			{
;;;3594   				pGPRSProcessPtr += nLineLen;
;;;3595   			}
;;;3596   			else if(strstr(pGPRSProcessPtr,"+IPD") && (strstr(pGPRSProcessPtr,"+IPD") < pStr))
;;;3597   			{
;;;3598   				char *pStrTemp;
;;;3599   				int nServerDataLen;
;;;3600   				pStrTemp = strstr(pGPRSProcessPtr,"+IPD");
;;;3601   				nServerDataLen = atoi(pStrTemp + 4);
;;;3602   				pStrTemp = strstr(pStrTemp,"\r\n");
;;;3603   				Gprs_Analyse_Server_Package_Data(pStrTemp + 2, nServerDataLen);
;;;3604   				pGPRSProcessPtr = pStrTemp + 2 + nServerDataLen;
;;;3605   			}
;;;3606   			else if(strstr(pGPRSProcessPtr,"RDY") && g_sGPRS.nNewState < eGSM_UartSync)
;;;3607   			{
;;;3608   				GprsHal_Switch_State(eGSM_UartSync);
;;;3609   				pGPRSProcessPtr += nLineLen;
;;;3610   			}
;;;3611   			else if(strstr(pGPRSProcessPtr,"+IPCLOSE:"))
;;;3612   			{
;;;3613   				s_nGprsRestartCnt++;
;;;3614   			#if SERVER_USE_XING_JIKONG_GU
;;;3615   				if(1)//if(s_nGprsRestartCnt < GPRS_MAX_RESTART_TIME)//Modified by lxll 20180814
;;;3616   			#else
;;;3617   				if(s_nGprsRestartCnt < GPRS_MAX_RESTART_TIME)
;;;3618   			#endif
;;;3619   				{
;;;3620   					GprsHal_Switch_State(eGSM_Connect_Server);
;;;3621   				}
;;;3622   				else
;;;3623   				{
;;;3624   					GPRS_Power_Control(eGPRSPowerDownAlways, __FILE__, __LINE__);
;;;3625   				}
;;;3626   				g_sGPRS.bTcpConnectState = false;
;;;3627   				Gprs_Set_UserLogin_State(false);
;;;3628   				TRACE_PRINTF("GPRS-->Tcp ConnectState is closed by remote server!\r\n");
;;;3629   				pGPRSProcessPtr += nLineLen;
;;;3630   			}
;;;3631   			else if(strstr(pGPRSProcessPtr,"RING"))
;;;3632   			{
;;;3633   				/*直接挂电话,拒接任何电话*/
;;;3634   				GPRS_Transmit_Data("ATH\r\n",9);
;;;3635   				TRACE_PRINTF("GPRS-->Someone call in, auto hung up!\r\n");
;;;3636   				pGPRSProcessPtr += nLineLen;
;;;3637   			}
;;;3638   			else if(strstr(pGPRSProcessPtr,"+CMTI: \"SM\""))
;;;3639   			{
;;;3640   				GPRS_Transmit_Data("AT+CMGD=1,4\r\n",9);
;;;3641   				TRACE_PRINTF("GPRS-->Receice  SMS message, auto delete!\r\n");
;;;3642   				pGPRSProcessPtr += nLineLen;
;;;3643   			}
;;;3644   			else
;;;3645   			{
;;;3646   				GPRS_FSM_Sub(eGPRSATData);
;;;3647   				pGPRSProcessPtr += nLineLen;
;;;3648   			}
;;;3649   		}
;;;3650   		else
;;;3651   		{
;;;3652   			GPRS_FSM_Sub(eGPRSATData);
;;;3653   			pGPRSProcessPtr += nLen;
;;;3654   		}
;;;3655   	}while((pGPRSProcessPtr - GPRS_Process_Buffer) <  nLen);
;;;3656   	
;;;3657   	return true;
;;;3658   }
000052  e8bd87f0          POP      {r4-r10,pc}
                  |L22.86|
000056  8120              STRH     r0,[r4,#8]            ;3568
000058  4689              MOV      r9,r1                 ;3569
00005a  485e              LDR      r0,|L22.468|
00005c  f7fffffe          BL       __aeabi_memclr
000060  4d5c              LDR      r5,|L22.468|
000062  2000              MOVS     r0,#0                 ;3570
000064  4649              MOV      r1,r9                 ;3561
000066  f5a5727a          SUB      r2,r5,#0x3e8          ;3561
00006a  e00f              B        |L22.140|
                  |L22.108|
00006c  4288              CMP      r0,r1                 ;3572
00006e  da10              BGE      |L22.146|
000070  8923              LDRH     r3,[r4,#8]            ;3572  ; s_nUartOutCnt
000072  f812c003          LDRB     r12,[r2,r3]           ;3572
000076  8923              LDRH     r3,[r4,#8]            ;3572  ; s_nUartOutCnt
000078  1c5b              ADDS     r3,r3,#1              ;3572
00007a  b29b              UXTH     r3,r3                 ;3572
00007c  8123              STRH     r3,[r4,#8]            ;3572
00007e  428b              CMP      r3,r1                 ;3572
000080  d301              BCC      |L22.134|
000082  f8a48008          STRH     r8,[r4,#8]            ;3572
                  |L22.134|
000086  f805c000          STRB     r12,[r5,r0]           ;3576
00008a  1c40              ADDS     r0,r0,#1              ;3576
                  |L22.140|
00008c  463b              MOV      r3,r7                 ;3576
00008e  42b8              CMP      r0,r7                 ;3570
000090  dbec              BLT      |L22.108|
                  |L22.146|
000092  f8868005          STRB     r8,[r6,#5]            ;3578
000096  462a              MOV      r2,r5                 ;3580
000098  4619              MOV      r1,r3                 ;3580
00009a  a04f              ADR      r0,|L22.472|
00009c  6165              STR      r5,[r4,#0x14]         ;3582  ; pGPRSProcessPtr
00009e  f7fffffe          BL       User_Debug_Printf
0000a2  f8df90f8          LDR      r9,|L22.412|
0000a6  f1090964          ADD      r9,r9,#0x64           ;3606
                  |L22.170|
0000aa  a154              ADR      r1,|L22.508|
0000ac  6960              LDR      r0,[r4,#0x14]         ;3587  ; pGPRSProcessPtr
0000ae  f7fffffe          BL       strstr
0000b2  0007              MOVS     r7,r0                 ;3587
0000b4  d068              BEQ      |L22.392|
0000b6  6960              LDR      r0,[r4,#0x14]         ;3591  ; pGPRSProcessPtr
0000b8  1a39              SUBS     r1,r7,r0              ;3591
0000ba  1c89              ADDS     r1,r1,#2              ;3591
0000bc  b28e              UXTH     r6,r1                 ;3591
0000be  2e02              CMP      r6,#2                 ;3592
0000c0  d01c              BEQ      |L22.252|
0000c2  a14f              ADR      r1,|L22.512|
0000c4  f7fffffe          BL       strstr
0000c8  b1d0              CBZ      r0,|L22.256|
0000ca  a14d              ADR      r1,|L22.512|
0000cc  6960              LDR      r0,[r4,#0x14]         ;3596  ; pGPRSProcessPtr
0000ce  f7fffffe          BL       strstr
0000d2  42b8              CMP      r0,r7                 ;3596
0000d4  d214              BCS      |L22.256|
0000d6  a14a              ADR      r1,|L22.512|
0000d8  6960              LDR      r0,[r4,#0x14]         ;3600  ; pGPRSProcessPtr
0000da  f7fffffe          BL       strstr
0000de  4606              MOV      r6,r0                 ;3600
0000e0  1d00              ADDS     r0,r0,#4              ;3601
0000e2  f7fffffe          BL       atoi
0000e6  4607              MOV      r7,r0                 ;3601
0000e8  a144              ADR      r1,|L22.508|
0000ea  4630              MOV      r0,r6                 ;3602
0000ec  f7fffffe          BL       strstr
0000f0  4606              MOV      r6,r0                 ;3602
0000f2  b2b9              UXTH     r1,r7                 ;3603
0000f4  1c80              ADDS     r0,r0,#2              ;3603
0000f6  f7fffffe          BL       Gprs_Analyse_Server_Package_Data
0000fa  19f0              ADDS     r0,r6,r7              ;3604
                  |L22.252|
0000fc  1c80              ADDS     r0,r0,#2              ;3604
0000fe  e00c              B        |L22.282|
                  |L22.256|
000100  a141              ADR      r1,|L22.520|
000102  6960              LDR      r0,[r4,#0x14]         ;3606  ; pGPRSProcessPtr
000104  f7fffffe          BL       strstr
000108  b170              CBZ      r0,|L22.296|
00010a  f8990001          LDRB     r0,[r9,#1]            ;3606  ; g_sGPRS
00010e  2805              CMP      r0,#5                 ;3606
000110  d20a              BCS      |L22.296|
000112  2005              MOVS     r0,#5                 ;3608
000114  f8890001          STRB     r0,[r9,#1]            ;3608
000118  e033              B        |L22.386|
                  |L22.282|
00011a  6160              STR      r0,[r4,#0x14]         ;3655  ; pGPRSProcessPtr
00011c  8961              LDRH     r1,[r4,#0xa]          ;3655  ; nLen
00011e  1b40              SUBS     r0,r0,r5              ;3655
000120  4288              CMP      r0,r1                 ;3655
000122  dbc2              BLT      |L22.170|
000124  2001              MOVS     r0,#1                 ;3657
000126  e794              B        |L22.82|
                  |L22.296|
000128  a138              ADR      r1,|L22.524|
00012a  6960              LDR      r0,[r4,#0x14]         ;3611  ; pGPRSProcessPtr
00012c  f7fffffe          BL       strstr
000130  b160              CBZ      r0,|L22.332|
000132  88a0              LDRH     r0,[r4,#4]            ;3613  ; s_nGprsRestartCnt
000134  1c40              ADDS     r0,r0,#1              ;3613
000136  80a0              STRH     r0,[r4,#4]            ;3613
000138  2013              MOVS     r0,#0x13              ;3620
00013a  f8890001          STRB     r0,[r9,#1]            ;3620
00013e  f8898004          STRB     r8,[r9,#4]            ;3626
000142  2000              MOVS     r0,#0                 ;3627
000144  f7fffffe          BL       Gprs_Set_UserLogin_State
000148  a033              ADR      r0,|L22.536|
00014a  e009              B        |L22.352|
                  |L22.332|
00014c  a140              ADR      r1,|L22.592|
00014e  6960              LDR      r0,[r4,#0x14]         ;3631  ; pGPRSProcessPtr
000150  f7fffffe          BL       strstr
000154  b138              CBZ      r0,|L22.358|
000156  2109              MOVS     r1,#9                 ;3634
000158  a03f              ADR      r0,|L22.600|
00015a  f7fffffe          BL       GPRS_Transmit_Data
00015e  a040              ADR      r0,|L22.608|
                  |L22.352|
000160  f7fffffe          BL       User_Debug_Printf
000164  e00d              B        |L22.386|
                  |L22.358|
000166  a148              ADR      r1,|L22.648|
000168  6960              LDR      r0,[r4,#0x14]         ;3638  ; pGPRSProcessPtr
00016a  f7fffffe          BL       strstr
00016e  b128              CBZ      r0,|L22.380|
000170  2109              MOVS     r1,#9                 ;3640
000172  a048              ADR      r0,|L22.660|
000174  f7fffffe          BL       GPRS_Transmit_Data
000178  a04a              ADR      r0,|L22.676|
00017a  e7f1              B        |L22.352|
                  |L22.380|
00017c  2002              MOVS     r0,#2                 ;3646
00017e  f7fffffe          BL       GPRS_FSM_Sub
                  |L22.386|
000182  6960              LDR      r0,[r4,#0x14]         ;3647  ; pGPRSProcessPtr
000184  4430              ADD      r0,r0,r6              ;3647
000186  e7c8              B        |L22.282|
                  |L22.392|
000188  2002              MOVS     r0,#2                 ;3652
00018a  f7fffffe          BL       GPRS_FSM_Sub
00018e  8961              LDRH     r1,[r4,#0xa]          ;3653  ; nLen
000190  6960              LDR      r0,[r4,#0x14]         ;3653  ; pGPRSProcessPtr
000192  4408              ADD      r0,r0,r1              ;3653
000194  e7c1              B        |L22.282|
;;;3659   
                          ENDP

000196  0000              DCW      0x0000
                  |L22.408|
                          DCD      ||.bss||+0x69a
                  |L22.412|
                          DCD      ||.data||
                  |L22.416|
0001a0  47505253          DCB      "GPRS-->Not enough buffer to process this message!\r\n",0
0001a4  2d2d3e4e
0001a8  6f742065
0001ac  6e6f7567
0001b0  68206275
0001b4  66666572
0001b8  20746f20
0001bc  70726f63
0001c0  65737320
0001c4  74686973
0001c8  206d6573
0001cc  73616765
0001d0  210d0a00
                  |L22.468|
                          DCD      ||.bss||+0xaf4
                  |L22.472|
0001d8  2b2b4770          DCB      "++Gprs_Receive(Bytes=%02d)>\r\n%s\r\n",0
0001dc  72735f52
0001e0  65636569
0001e4  76652842
0001e8  79746573
0001ec  3d253032
0001f0  64293e0d
0001f4  0a25730d
0001f8  0a00    
0001fa  00                DCB      0
0001fb  00                DCB      0
                  |L22.508|
0001fc  0d0a00            DCB      "\r\n",0
0001ff  00                DCB      0
                  |L22.512|
000200  2b495044          DCB      "+IPD",0
000204  00      
000205  00                DCB      0
000206  00                DCB      0
000207  00                DCB      0
                  |L22.520|
000208  52445900          DCB      "RDY",0
                  |L22.524|
00020c  2b495043          DCB      "+IPCLOSE:",0
000210  4c4f5345
000214  3a00    
000216  00                DCB      0
000217  00                DCB      0
                  |L22.536|
000218  47505253          DCB      "GPRS-->Tcp ConnectState is closed by remote server!\r\n"
00021c  2d2d3e54
000220  63702043
000224  6f6e6e65
000228  63745374
00022c  61746520
000230  69732063
000234  6c6f7365
000238  64206279
00023c  2072656d
000240  6f746520
000244  73657276
000248  6572210d
00024c  0a      
00024d  00                DCB      0
00024e  00                DCB      0
00024f  00                DCB      0
                  |L22.592|
000250  52494e47          DCB      "RING",0
000254  00      
000255  00                DCB      0
000256  00                DCB      0
000257  00                DCB      0
                  |L22.600|
000258  4154480d          DCB      "ATH\r\n",0
00025c  0a00    
00025e  00                DCB      0
00025f  00                DCB      0
                  |L22.608|
000260  47505253          DCB      "GPRS-->Someone call in, auto hung up!\r\n",0
000264  2d2d3e53
000268  6f6d656f
00026c  6e652063
000270  616c6c20
000274  696e2c20
000278  6175746f
00027c  2068756e
000280  67207570
000284  210d0a00
                  |L22.648|
000288  2b434d54          DCB      "+CMTI: ""SM""",0
00028c  493a2022
000290  534d2200
                  |L22.660|
000294  41542b43          DCB      "AT+CMGD=1,4\r\n",0
000298  4d47443d
00029c  312c340d
0002a0  0a00    
0002a2  00                DCB      0
0002a3  00                DCB      0
                  |L22.676|
0002a4  47505253          DCB      "GPRS-->Receice  SMS message, auto delete!\r\n",0
0002a8  2d2d3e52
0002ac  65636569
0002b0  63652020
0002b4  534d5320
0002b8  6d657373
0002bc  6167652c
0002c0  20617574
0002c4  6f206465
0002c8  6c657465
0002cc  210d0a00

                          AREA ||i.GPRS_Receive_Data||, CODE, READONLY, ALIGN=2

                  GPRS_Receive_Data PROC
;;;2819   
;;;2820   void GPRS_Receive_Data(unsigned char nData)
000000  b570              PUSH     {r4-r6,lr}
;;;2821   {
;;;2822   	if(!g_sGPRS.bStartReceiveData)
000002  4917              LDR      r1,|L23.96|
000004  2500              MOVS     r5,#0
000006  f1a10464          SUB      r4,r1,#0x64
00000a  794a              LDRB     r2,[r1,#5]  ; g_sGPRS
00000c  b97a              CBNZ     r2,|L23.46|
;;;2823   	{
;;;2824   		g_sGPRS.bStartReceiveData = true;
00000e  2301              MOVS     r3,#1
000010  714b              STRB     r3,[r1,#5]
000012  4a14              LDR      r2,|L23.100|
000014  2100              MOVS     r1,#0
000016  bf00              NOP      
                  |L23.24|
000018  eb010641          ADD      r6,r1,r1,LSL #1
00001c  eb020646          ADD      r6,r2,r6,LSL #1
000020  7976              LDRB     r6,[r6,#5]
000022  b1a6              CBZ      r6,|L23.78|
000024  1c49              ADDS     r1,r1,#1
000026  290a              CMP      r1,#0xa
000028  dbf6              BLT      |L23.24|
00002a  4629              MOV      r1,r5
                  |L23.44|
;;;2825   		pCurrGPRSRevQ = Get_Free_ReceiveQ();
00002c  6621              STR      r1,[r4,#0x60]  ; pCurrGPRSRevQ
                  |L23.46|
;;;2826   	}
;;;2827   	
;;;2828   	GPRS_Rx_Buffer[s_nUartInCnt] = nData;
00002e  490d              LDR      r1,|L23.100|
000030  88e2              LDRH     r2,[r4,#6]  ; s_nUartInCnt
000032  3172              ADDS     r1,r1,#0x72
000034  5488              STRB     r0,[r1,r2]
;;;2829   	s_nStartReceiveTime = Get_System_Time();
000036  f7fffffe          BL       Get_System_Time
00003a  65e0              STR      r0,[r4,#0x5c]  ; s_nStartReceiveTime
;;;2830   	if(++s_nUartInCnt >= GPRS_REV_BUFFER_SIZE)
00003c  88e0              LDRH     r0,[r4,#6]  ; s_nUartInCnt
00003e  1c40              ADDS     r0,r0,#1
000040  b280              UXTH     r0,r0
000042  80e0              STRH     r0,[r4,#6]
000044  f5b07f7a          CMP      r0,#0x3e8
000048  d300              BCC      |L23.76|
;;;2831   	{
;;;2832   		s_nUartInCnt = 0;
00004a  80e5              STRH     r5,[r4,#6]
                  |L23.76|
;;;2833   	}
;;;2834   }
00004c  bd70              POP      {r4-r6,pc}
                  |L23.78|
00004e  eb010141          ADD      r1,r1,r1,LSL #1
000052  eb020141          ADD      r1,r2,r1,LSL #1
000056  714b              STRB     r3,[r1,#5]
000058  710d              STRB     r5,[r1,#4]
00005a  88e2              LDRH     r2,[r4,#6]  ; s_nUartInCnt
00005c  800a              STRH     r2,[r1,#0]
00005e  e7e5              B        |L23.44|
;;;2835   
                          ENDP

                  |L23.96|
                          DCD      ||.data||+0x64
                  |L23.100|
                          DCD      ||.bss||+0x69a

                          AREA ||i.GPRS_Transmit_Data||, CODE, READONLY, ALIGN=2

                  GPRS_Transmit_Data PROC
;;;2565   
;;;2566   void GPRS_Transmit_Data(char  *pData, unsigned short nLen)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;2567   {
000004  000e              MOVS     r6,r1
000006  4607              MOV      r7,r0
000008  d00f              BEQ      |L24.42|
;;;2568   	int i;
;;;2569   	if (nLen)
;;;2570   	{
;;;2571   		for(i = 0; i < nLen; i++)
00000a  2400              MOVS     r4,#0
;;;2572   		{
;;;2573   			USART_SendData(UART4, (unsigned char)pData[i]);
00000c  4d08              LDR      r5,|L24.48|
00000e  e00a              B        |L24.38|
                  |L24.16|
000010  5d39              LDRB     r1,[r7,r4]
000012  4628              MOV      r0,r5
000014  f7fffffe          BL       USART_SendData
                  |L24.24|
;;;2574   			while(USART_GetFlagStatus(UART4, USART_FLAG_TC) == RESET);
000018  2140              MOVS     r1,#0x40
00001a  4628              MOV      r0,r5
00001c  f7fffffe          BL       USART_GetFlagStatus
000020  2800              CMP      r0,#0
000022  d0f9              BEQ      |L24.24|
000024  1c64              ADDS     r4,r4,#1
                  |L24.38|
000026  42b4              CMP      r4,r6                 ;2571
000028  dbf2              BLT      |L24.16|
                  |L24.42|
;;;2575   		}
;;;2576   	}
;;;2577   }
00002a  e8bd81f0          POP      {r4-r8,pc}
;;;2578   
                          ENDP

00002e  0000              DCW      0x0000
                  |L24.48|
                          DCD      0x40004c00

                          AREA ||i.GPRS_UartSync||, CODE, READONLY, ALIGN=2

                  GPRS_UartSync PROC
;;;2884   
;;;2885   static void GPRS_UartSync(eGPRSMessage eMessageType)
000000  b570              PUSH     {r4-r6,lr}
;;;2886   {
;;;2887   	char *pStr;
;;;2888   	const char *pCmdStr = "AT\r\n";
;;;2889   	static sGPRSSendCmdQ *p = NULL;
;;;2890   
;;;2891   	switch(eMessageType)
;;;2892   	{
;;;2893   		case eGPRSChangeState:
;;;2894   			p = Get_Free_SendCmdQ();
000002  4c1b              LDR      r4,|L25.112|
000004  a518              ADR      r5,|L25.104|
000006  2801              CMP      r0,#1                 ;2891
000008  d013              BEQ      |L25.50|
00000a  2802              CMP      r0,#2                 ;2891
00000c  d12b              BNE      |L25.102|
;;;2895   			if(p)
;;;2896   			{	
;;;2897   				p->nWaitAckTimeout = 500;
;;;2898   				p->nNowState = eGSM_UartSync;
;;;2899   				p->pSendCmd = (char *)pCmdStr;
;;;2900   				p->nCmdLength = strlen(pCmdStr);
;;;2901   				GPRS_Transmit_Data(p->pSendCmd,p->nCmdLength);
;;;2902   			}
;;;2903   			break;
;;;2904   			
;;;2905   		case eGPRSATData:
;;;2906   			pStr = strstr(pGPRSProcessPtr,"AT\r\r\nOK\r\n");
00000e  a119              ADR      r1,|L25.116|
000010  6960              LDR      r0,[r4,#0x14]  ; pGPRSProcessPtr
000012  f7fffffe          BL       strstr
;;;2907   			if(pStr)
000016  2800              CMP      r0,#0
000018  d025              BEQ      |L25.102|
;;;2908   			{
;;;2909   				p->bInvalidBuffer = false;
00001a  69e1              LDR      r1,[r4,#0x1c]  ; p
00001c  2000              MOVS     r0,#0
00001e  7448              STRB     r0,[r1,#0x11]
000020  f1040164          ADD      r1,r4,#0x64
;;;2910   				GprsHal_Switch_State(eGSM_ChangeBaudRate);
000024  2006              MOVS     r0,#6
000026  7048              STRB     r0,[r1,#1]
;;;2911   				TRACE_PRINTF("GPRS-->Hardware is Ok.\r\n");
000028  e8bd4070          POP      {r4-r6,lr}
00002c  a014              ADR      r0,|L25.128|
00002e  f7ffbffe          B.W      User_Debug_Printf
                  |L25.50|
000032  f7fffffe          BL       Get_Free_SendCmdQ
000036  61e0              STR      r0,[r4,#0x1c]         ;2895  ; p
000038  2800              CMP      r0,#0                 ;2895
00003a  d014              BEQ      |L25.102|
00003c  f44f71fa          MOV      r1,#0x1f4             ;2897
000040  f8a0100d          STRH     r1,[r0,#0xd]          ;2897
000044  2105              MOVS     r1,#5                 ;2898
000046  7001              STRB     r1,[r0,#0]            ;2898
000048  f8c05001          STR      r5,[r0,#1]            ;2899
00004c  4628              MOV      r0,r5                 ;2900
00004e  f7fffffe          BL       strlen
000052  b281              UXTH     r1,r0                 ;2900
000054  69e0              LDR      r0,[r4,#0x1c]         ;2900  ; p
000056  f8a01005          STRH     r1,[r0,#5]            ;2900
00005a  f8d00001          LDR      r0,[r0,#1]            ;2901
00005e  e8bd4070          POP      {r4-r6,lr}            ;2901
000062  f7ffbffe          B.W      GPRS_Transmit_Data
                  |L25.102|
;;;2912   			}
;;;2913   			break;
;;;2914   	}
;;;2915   }
000066  bd70              POP      {r4-r6,pc}
;;;2916   
                          ENDP

                  |L25.104|
000068  41540d0a          DCB      "AT\r\n",0
00006c  00      
00006d  00                DCB      0
00006e  00                DCB      0
00006f  00                DCB      0
                  |L25.112|
                          DCD      ||.data||
                  |L25.116|
000074  41540d0d          DCB      "AT\r\r\nOK\r\n",0
000078  0a4f4b0d
00007c  0a00    
00007e  00                DCB      0
00007f  00                DCB      0
                  |L25.128|
000080  47505253          DCB      "GPRS-->Hardware is Ok.\r\n",0
000084  2d2d3e48
000088  61726477
00008c  61726520
000090  6973204f
000094  6b2e0d0a
000098  00      
000099  00                DCB      0
00009a  00                DCB      0
00009b  00                DCB      0

                          AREA ||i.GPRS_Uart_Init||, CODE, READONLY, ALIGN=2

                  GPRS_Uart_Init PROC
;;;2519   
;;;2520   static void GPRS_Uart_Init(unsigned long nBaudrate)
000000  b510              PUSH     {r4,lr}
;;;2521   {
;;;2522   	GPIO_InitTypeDef GPIO_InitStructure;
;;;2523   	USART_InitTypeDef USART_InitStructure;
;;;2524   	RCC_APB1PeriphClockCmd(RCC_APB1Periph_UART4, ENABLE);
000002  2101              MOVS     r1,#1
000004  b086              SUB      sp,sp,#0x18           ;2521
000006  04c8              LSLS     r0,r1,#19
000008  f7fffffe          BL       RCC_APB1PeriphClockCmd
;;;2525   
;;;2526   	/* Configure USARTx_Tx as alternate function push-pull */
;;;2527   	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_10;
00000c  f44f6080          MOV      r0,#0x400
000010  f8ad0010          STRH     r0,[sp,#0x10]
;;;2528   	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
000014  2003              MOVS     r0,#3
000016  f88d0012          STRB     r0,[sp,#0x12]
;;;2529   	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;
00001a  2018              MOVS     r0,#0x18
;;;2530   	GPIO_Init(GPIOC, &GPIO_InitStructure);
00001c  4c1a              LDR      r4,|L26.136|
00001e  f88d0013          STRB     r0,[sp,#0x13]         ;2529
000022  a904              ADD      r1,sp,#0x10
000024  4620              MOV      r0,r4
000026  f7fffffe          BL       GPIO_Init
;;;2531   
;;;2532   	/* Configure USARTx_Rx as input floating */
;;;2533   	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_11;
00002a  14e0              ASRS     r0,r4,#19
00002c  f8ad0010          STRH     r0,[sp,#0x10]
;;;2534   	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING;
000030  2004              MOVS     r0,#4
000032  f88d0013          STRB     r0,[sp,#0x13]
;;;2535   	GPIO_Init(GPIOC, &GPIO_InitStructure);
000036  a904              ADD      r1,sp,#0x10
000038  4620              MOV      r0,r4
00003a  f7fffffe          BL       GPIO_Init
;;;2536   
;;;2537   	USART_InitStructure.USART_BaudRate = 115200;
00003e  f44f30e1          MOV      r0,#0x1c200
;;;2538   	USART_InitStructure.USART_WordLength = USART_WordLength_8b;
000042  9000              STR      r0,[sp,#0]
000044  2000              MOVS     r0,#0
000046  f8ad0004          STRH     r0,[sp,#4]
;;;2539   	USART_InitStructure.USART_StopBits = USART_StopBits_1;
00004a  f8ad0006          STRH     r0,[sp,#6]
;;;2540   	USART_InitStructure.USART_Parity = USART_Parity_No ;
00004e  f8ad0008          STRH     r0,[sp,#8]
;;;2541   	USART_InitStructure.USART_HardwareFlowControl = USART_HardwareFlowControl_None;
000052  f8ad000c          STRH     r0,[sp,#0xc]
;;;2542   	USART_InitStructure.USART_Mode = USART_Mode_Rx | USART_Mode_Tx;
000056  200c              MOVS     r0,#0xc
;;;2543   
;;;2544   	/* Configure the USARTx */ 
;;;2545   	USART_Init(UART4, &USART_InitStructure);
000058  4c0c              LDR      r4,|L26.140|
00005a  f8ad000a          STRH     r0,[sp,#0xa]          ;2542
00005e  4669              MOV      r1,sp
000060  4620              MOV      r0,r4
000062  f7fffffe          BL       USART_Init
;;;2546   
;;;2547   	//串口接收中断开启
;;;2548   	USART_ITConfig(UART4, USART_IT_RXNE, ENABLE); 
000066  2201              MOVS     r2,#1
000068  f2405125          MOV      r1,#0x525
00006c  4620              MOV      r0,r4
00006e  f7fffffe          BL       USART_ITConfig
;;;2549   
;;;2550   	/* Enable the USARTx */
;;;2551   	USART_Cmd(UART4, ENABLE);
000072  2101              MOVS     r1,#1
000074  4620              MOV      r0,r4
000076  f7fffffe          BL       USART_Cmd
;;;2552   
;;;2553   	USART_ClearFlag(UART4, USART_FLAG_TC);
00007a  2140              MOVS     r1,#0x40
00007c  4620              MOV      r0,r4
00007e  f7fffffe          BL       USART_ClearFlag
;;;2554   
;;;2555   }
000082  b006              ADD      sp,sp,#0x18
000084  bd10              POP      {r4,pc}
;;;2556   
                          ENDP

000086  0000              DCW      0x0000
                  |L26.136|
                          DCD      0x40011000
                  |L26.140|
                          DCD      0x40004c00

                          AREA ||i.Get_APN_String||, CODE, READONLY, ALIGN=2

                  Get_APN_String PROC
;;;2766   #if SERVER_USE_XING_JIKONG_GU
;;;2767   char* Get_APN_String(unsigned short nMCC, unsigned short nMNC)
000000  b570              PUSH     {r4-r6,lr}
;;;2768   {
000002  4605              MOV      r5,r0
;;;2769   	if(strlen(g_sServerParam.aAPNString) == 0)
000004  4808              LDR      r0,|L27.40|
000006  460c              MOV      r4,r1                 ;2768
000008  4606              MOV      r6,r0
00000a  f7fffffe          BL       strlen
00000e  b928              CBNZ     r0,|L27.28|
;;;2770   	{
;;;2771   		if(nMCC == 460 && nMNC == 0)
000010  f5b57fe6          CMP      r5,#0x1cc
000014  d102              BNE      |L27.28|
000016  b11c              CBZ      r4,|L27.32|
;;;2772   		{
;;;2773   			return "CMNET";
;;;2774   		}
;;;2775   		else if(nMCC == 460 && nMNC == 1)
000018  2c01              CMP      r4,#1
00001a  d003              BEQ      |L27.36|
                  |L27.28|
00001c  4630              MOV      r0,r6
;;;2776   		{
;;;2777   			return "3GNET";
;;;2778   		}
;;;2779   	}
;;;2780   			
;;;2781   	return g_sServerParam.aAPNString;
;;;2782   }
00001e  bd70              POP      {r4-r6,pc}
                  |L27.32|
000020  a002              ADR      r0,|L27.44|
000022  bd70              POP      {r4-r6,pc}
                  |L27.36|
000024  a003              ADR      r0,|L27.52|
000026  bd70              POP      {r4-r6,pc}
;;;2783   #else
                          ENDP

                  |L27.40|
                          DCD      g_sServerParam+0x3f
                  |L27.44|
00002c  434d4e45          DCB      "CMNET",0
000030  5400    
000032  00                DCB      0
000033  00                DCB      0
                  |L27.52|
000034  33474e45          DCB      "3GNET",0
000038  5400    
00003a  00                DCB      0
00003b  00                DCB      0

                          AREA ||i.Get_Free_SendCmdQ||, CODE, READONLY, ALIGN=2

                  Get_Free_SendCmdQ PROC
;;;2628   
;;;2629   static sGPRSSendCmdQ * Get_Free_SendCmdQ(void)
000000  b570              PUSH     {r4-r6,lr}
;;;2630   {
;;;2631   	int i;
;;;2632   	for(i = 0;i < GPRS_SEND_Q_SIZE; i++)
;;;2633   	{
;;;2634   		if(g_sGPRSSendCmdQ[i].bInvalidBuffer == false)
000002  4912              LDR      r1,|L28.76|
000004  2000              MOVS     r0,#0                 ;2632
000006  bf00              NOP      
                  |L28.8|
000008  eb0002c0          ADD      r2,r0,r0,LSL #3
00000c  eb010242          ADD      r2,r1,r2,LSL #1
000010  7c52              LDRB     r2,[r2,#0x11]
000012  b122              CBZ      r2,|L28.30|
000014  1c40              ADDS     r0,r0,#1
000016  2803              CMP      r0,#3                 ;2632
000018  dbf6              BLT      |L28.8|
;;;2635   		{
;;;2636   			g_sGPRSSendCmdQ[i].nRetryCnt = 10;
;;;2637   			g_sGPRSSendCmdQ[i].pSendCmd = NULL;
;;;2638   			g_sGPRSSendCmdQ[i].bIsCmdBusy = true;
;;;2639   			g_sGPRSSendCmdQ[i].nCmdLength = 0;
;;;2640   			g_sGPRSSendCmdQ[i].nStartWaitTime = Get_System_Time();
;;;2641   			g_sGPRSSendCmdQ[i].nWaitAckTimeout = 200;
;;;2642   			g_sGPRSSendCmdQ[i].bDefaultProcessTimeout = true;
;;;2643   			g_sGPRSSendCmdQ[i].bDefaultProcessExceedMaxRetryCnt = true;
;;;2644   			g_sGPRSSendCmdQ[i].bInvalidBuffer = true;
;;;2645   			return &g_sGPRSSendCmdQ[i];
;;;2646   		}
;;;2647   	}
;;;2648   	return NULL;
00001a  2000              MOVS     r0,#0
;;;2649   }
00001c  bd70              POP      {r4-r6,pc}
                  |L28.30|
00001e  eb0000c0          ADD      r0,r0,r0,LSL #3       ;2636
000022  eb010440          ADD      r4,r1,r0,LSL #1       ;2636
000026  220a              MOVS     r2,#0xa               ;2636
000028  7222              STRB     r2,[r4,#8]            ;2636
00002a  2000              MOVS     r0,#0                 ;2637
00002c  f8440f01          STR      r0,[r4,#1]!           ;2637
000030  2501              MOVS     r5,#1                 ;2638
000032  71a5              STRB     r5,[r4,#6]            ;2638
000034  80a0              STRH     r0,[r4,#4]            ;2639
000036  f7fffffe          BL       Get_System_Time
00003a  60a0              STR      r0,[r4,#8]            ;2640
00003c  20c8              MOVS     r0,#0xc8              ;2641
00003e  81a0              STRH     r0,[r4,#0xc]          ;2641
000040  73a5              STRB     r5,[r4,#0xe]          ;2642
000042  73e5              STRB     r5,[r4,#0xf]          ;2643
000044  7425              STRB     r5,[r4,#0x10]         ;2644
000046  1e60              SUBS     r0,r4,#1              ;2644
000048  bd70              POP      {r4-r6,pc}
;;;2650   
                          ENDP

00004a  0000              DCW      0x0000
                  |L28.76|
                          DCD      ||.bss||+0x6d6

                          AREA ||i.Get_Gprs_Tcp_Connect_State||, CODE, READONLY, ALIGN=2

                  Get_Gprs_Tcp_Connect_State PROC
;;;2687   
;;;2688   bool Get_Gprs_Tcp_Connect_State(void)
000000  4801              LDR      r0,|L29.8|
;;;2689   {
;;;2690   	return g_sGPRS.bTcpConnectState;
000002  7900              LDRB     r0,[r0,#4]  ; g_sGPRS
;;;2691   }
000004  4770              BX       lr
;;;2692   
                          ENDP

000006  0000              DCW      0x0000
                  |L29.8|
                          DCD      ||.data||+0x64

                          AREA ||i.GprsHal_Switch_State||, CODE, READONLY, ALIGN=2

                  GprsHal_Switch_State PROC
;;;2846   
;;;2847   void GprsHal_Switch_State(eGSM_State eNewState)
000000  4901              LDR      r1,|L30.8|
;;;2848   {
;;;2849   	g_sGPRS.nNewState = eNewState;
000002  7048              STRB     r0,[r1,#1]
;;;2850   }
000004  4770              BX       lr
;;;2851   
                          ENDP

000006  0000              DCW      0x0000
                  |L30.8|
                          DCD      ||.data||+0x64

                          AREA ||i.Mark_Valid_Package_Via_Timeout||, CODE, READONLY, ALIGN=2

                  Mark_Valid_Package_Via_Timeout PROC
;;;2671   /*此函数要被定时器中断函数调用*/
;;;2672   void Mark_Valid_Package_Via_Timeout(void)
000000  b510              PUSH     {r4,lr}
;;;2673   {
;;;2674   	if(g_sGPRS.bStartReceiveData)
000002  4c0b              LDR      r4,|L31.48|
000004  7960              LDRB     r0,[r4,#5]  ; g_sGPRS
000006  2800              CMP      r0,#0                 ;2673
000008  d010              BEQ      |L31.44|
;;;2675   	{
;;;2676   		if(Get_System_Time() > s_nStartReceiveTime + 4)
00000a  f7fffffe          BL       Get_System_Time
00000e  f1a40164          SUB      r1,r4,#0x64
000012  6dca              LDR      r2,[r1,#0x5c]  ; s_nStartReceiveTime
000014  1d12              ADDS     r2,r2,#4
000016  4290              CMP      r0,r2
000018  d908              BLS      |L31.44|
;;;2677   		{	
;;;2678   			g_sGPRS.bStartReceiveData = false;
00001a  2000              MOVS     r0,#0
00001c  7160              STRB     r0,[r4,#5]
;;;2679   			if(pCurrGPRSRevQ)
00001e  6e08              LDR      r0,[r1,#0x60]  ; pCurrGPRSRevQ
000020  2800              CMP      r0,#0
000022  d003              BEQ      |L31.44|
;;;2680   			{
;;;2681   				pCurrGPRSRevQ->bFinishReceive = true;
000024  2201              MOVS     r2,#1
000026  7102              STRB     r2,[r0,#4]
;;;2682   				pCurrGPRSRevQ->nEndPosition = s_nUartInCnt;
000028  88c9              LDRH     r1,[r1,#6]  ; s_nUartInCnt
00002a  8041              STRH     r1,[r0,#2]
                  |L31.44|
;;;2683   			}
;;;2684   		}
;;;2685   	}
;;;2686   }
00002c  bd10              POP      {r4,pc}
;;;2687   
                          ENDP

00002e  0000              DCW      0x0000
                  |L31.48|
                          DCD      ||.data||+0x64

                          AREA ||i.UART4_IRQHandler||, CODE, READONLY, ALIGN=2

                  UART4_IRQHandler PROC
;;;2557   
;;;2558   void UART4_IRQHandler(void)
000000  b510              PUSH     {r4,lr}
;;;2559   {
;;;2560   	if(USART_GetITStatus(UART4, USART_IT_RXNE) == SET)
000002  4c08              LDR      r4,|L32.36|
000004  f2405125          MOV      r1,#0x525
000008  4620              MOV      r0,r4
00000a  f7fffffe          BL       USART_GetITStatus
00000e  2801              CMP      r0,#1
000010  d107              BNE      |L32.34|
;;;2561   	{
;;;2562   		GPRS_Receive_Data(USART_ReceiveData(UART4));
000012  4620              MOV      r0,r4
000014  f7fffffe          BL       USART_ReceiveData
000018  e8bd4010          POP      {r4,lr}
00001c  b2c0              UXTB     r0,r0
00001e  f7ffbffe          B.W      GPRS_Receive_Data
                  |L32.34|
;;;2563   	}
;;;2564   }
000022  bd10              POP      {r4,pc}
;;;2565   
                          ENDP

                  |L32.36|
                          DCD      0x40004c00

                          AREA ||.bss||, DATA, NOINIT, ALIGN=0

                  aCmdStr
                          %        60
                  |symbol_number.106|
                          %        80
                  |symbol_number.107|
                          %        50
                  GPRS_Tx_Buffer
                          %        1500
                  g_sGPRSReceiveQ
                          %        60
                  g_sGPRSSendCmdQ
                          %        54
                  GPRS_Rx_Buffer
                          %        1000
                  GPRS_Process_Buffer
                          %        1000

                          AREA ||.constdata||, DATA, READONLY, ALIGN=1

                  ARRAY_APN_Lookup_Table
000000  01cc0000          DCW      0x01cc,0x0000
000004  434d4e45          DCB      0x43,0x4d,0x4e,0x45
000008  54000000          DCB      0x54,0x00,0x00,0x00
                          %        40
000034  0000              DCB      0x00,0x00
000036  01cc              DCW      0x01cc
000038  0001              DCW      0x0001
00003a  3347              DCB      0x33,0x47
00003c  4e455400          DCB      0x4e,0x45,0x54,0x00
                          %        44
00006c  01cc0003          DCW      0x01cc,0x0003
000070  43544e45          DCB      0x43,0x54,0x4e,0x45
000074  54000000          DCB      0x54,0x00,0x00,0x00
                          %        40
0000a0  0000              DCB      0x00,0x00
0000a2  01cc              DCW      0x01cc
0000a4  000b              DCW      0x000b
0000a6  4354              DCB      0x43,0x54
0000a8  4e455400          DCB      0x4e,0x45,0x54,0x00
                          %        44
0000d8  00fa0001          DCW      0x00fa,0x0001
0000dc  696e7465          DCB      0x69,0x6e,0x74,0x65
0000e0  726e6574          DCB      0x72,0x6e,0x65,0x74
0000e4  2e6d7473          DCB      0x2e,0x6d,0x74,0x73
0000e8  2e72752c          DCB      0x2e,0x72,0x75,0x2c
0000ec  6d74732c          DCB      0x6d,0x74,0x73,0x2c
0000f0  6d747300          DCB      0x6d,0x74,0x73,0x00
                          %        24
00010c  0000              DCB      0x00,0x00
00010e  00fa              DCW      0x00fa
000110  0002              DCW      0x0002
000112  696e              DCB      0x69,0x6e
000114  7465726e          DCB      0x74,0x65,0x72,0x6e
000118  65740000          DCB      0x65,0x74,0x00,0x00
                          %        40
000144  00fa0063          DCW      0x00fa,0x0063
000148  696e7465          DCB      0x69,0x6e,0x74,0x65
00014c  726e6574          DCB      0x72,0x6e,0x65,0x74
000150  2e626565          DCB      0x2e,0x62,0x65,0x65
000154  6c696e65          DCB      0x6c,0x69,0x6e,0x65
000158  2e72752c          DCB      0x2e,0x72,0x75,0x2c
00015c  6265656c          DCB      0x62,0x65,0x65,0x6c
000160  696e652c          DCB      0x69,0x6e,0x65,0x2c
000164  6265656c          DCB      0x62,0x65,0x65,0x6c
000168  696e6500          DCB      0x69,0x6e,0x65,0x00
                          %        12
000178  0000              DCB      0x00,0x00
00017a  00fa              DCW      0x00fa
00017c  0014              DCW      0x0014
00017e  696e              DCB      0x69,0x6e
000180  7465726e          DCB      0x74,0x65,0x72,0x6e
000184  65742e74          DCB      0x65,0x74,0x2e,0x74
000188  656c6532          DCB      0x65,0x6c,0x65,0x32
00018c  2e727500          DCB      0x2e,0x72,0x75,0x00
                          %        32
0001b0  027f0002          DCW      0x027f,0x0002
0001b4  73616661          DCB      0x73,0x61,0x66,0x61
0001b8  7269636f          DCB      0x72,0x69,0x63,0x6f
0001bc  6d2c7361          DCB      0x6d,0x2c,0x73,0x61
0001c0  662c6461          DCB      0x66,0x2c,0x64,0x61
0001c4  74610000          DCB      0x74,0x61,0x00,0x00
                          %        28
0001e4  0000              DCB      0x00,0x00
0001e6  0194              DCW      0x0194
0001e8  001d              DCW      0x001d
0001ea  6169              DCB      0x61,0x69
0001ec  7263656c          DCB      0x72,0x63,0x65,0x6c
0001f0  67707273          DCB      0x67,0x70,0x72,0x73
0001f4  00000000          DCB      0x00,0x00,0x00,0x00
                          %        36
00021c  01f90001          DCW      0x01f9,0x0001
000220  74656c73          DCB      0x74,0x65,0x6c,0x73
000224  7472612e          DCB      0x74,0x72,0x61,0x2e
000228  696e7465          DCB      0x69,0x6e,0x74,0x65
00022c  726e6574          DCB      0x72,0x6e,0x65,0x74
000230  00000000          DCB      0x00,0x00,0x00,0x00
                          %        28
000250  0000              DCB      0x00,0x00

                          AREA ||.conststring||, DATA, READONLY, MERGE=1, STRINGS, ALIGN=2

000000  6547534d          DCB      "eGSM_None",0
000004  5f4e6f6e
000008  6500    
00000a  00                DCB      0
00000b  00                DCB      0
00000c  6547534d          DCB      "eGSM_Idle",0
000010  5f49646c
000014  6500    
000016  00                DCB      0
000017  00                DCB      0
000018  6547534d          DCB      "eGSM_PowerOff",0
00001c  5f506f77
000020  65724f66
000024  6600    
000026  00                DCB      0
000027  00                DCB      0
000028  6547534d          DCB      "eGSM_PowerOffDelay",0
00002c  5f506f77
000030  65724f66
000034  6644656c
000038  617900  
00003b  00                DCB      0
00003c  6547534d          DCB      "eGSM_PowerUp",0
000040  5f506f77
000044  65725570
000048  00      
000049  00                DCB      0
00004a  00                DCB      0
00004b  00                DCB      0
00004c  6547534d          DCB      "eGSM_UartSync",0
000050  5f556172
000054  7453796e
000058  6300    
00005a  00                DCB      0
00005b  00                DCB      0
00005c  6547534d          DCB      "eGSM_ChangeBaudRate",0
000060  5f436861
000064  6e676542
000068  61756452
00006c  61746500
000070  6547534d          DCB      "eGSM_Enable_Echo",0
000074  5f456e61
000078  626c655f
00007c  4563686f
000080  00      
000081  00                DCB      0
000082  00                DCB      0
000083  00                DCB      0
000084  6547534d          DCB      "eGSM_Disable_Echo",0
000088  5f446973
00008c  61626c65
000090  5f456368
000094  6f00    
000096  00                DCB      0
000097  00                DCB      0
000098  6547534d          DCB      "eGSM_SimCard_Check",0
00009c  5f53696d
0000a0  43617264
0000a4  5f436865
0000a8  636b00  
0000ab  00                DCB      0
0000ac  6547534d          DCB      "eGSM_Get_IMEI",0
0000b0  5f476574
0000b4  5f494d45
0000b8  4900    
0000ba  00                DCB      0
0000bb  00                DCB      0
0000bc  6547534d          DCB      "eGSM_GET_CSQ",0
0000c0  5f474554
0000c4  5f435351
0000c8  00      
0000c9  00                DCB      0
0000ca  00                DCB      0
0000cb  00                DCB      0
0000cc  6547534d          DCB      "eGSM_CheckCOPS",0
0000d0  5f436865
0000d4  636b434f
0000d8  505300  
0000db  00                DCB      0
0000dc  6547534d          DCB      "eGSM_NetRegist_Check",0
0000e0  5f4e6574
0000e4  52656769
0000e8  73745f43
0000ec  6865636b
0000f0  00      
0000f1  00                DCB      0
0000f2  00                DCB      0
0000f3  00                DCB      0
0000f4  6547534d          DCB      "eGSM_Get_MCC_MNC",0
0000f8  5f476574
0000fc  5f4d4343
000100  5f4d4e43
000104  00      
000105  00                DCB      0
000106  00                DCB      0
000107  00                DCB      0
000108  6547534d          DCB      "eGSM_Set_APN",0
00010c  5f536574
000110  5f41504e
000114  00      
000115  00                DCB      0
000116  00                DCB      0
000117  00                DCB      0
000118  6547534d          DCB      "eGSM_Socket_SET",0
00011c  5f536f63
000120  6b65745f
000124  53455400
000128  6547534d          DCB      "eGSM_Open_NET",0
00012c  5f4f7065
000130  6e5f4e45
000134  5400    
000136  00                DCB      0
000137  00                DCB      0
000138  6547534d          DCB      "eGSM_Domain_Name_Resolve",0
00013c  5f446f6d
000140  61696e5f
000144  4e616d65
000148  5f526573
00014c  6f6c7665
000150  00      
000151  00                DCB      0
000152  00                DCB      0
000153  00                DCB      0
000154  6547534d          DCB      "eGSM_Connect_Server",0
000158  5f436f6e
00015c  6e656374
000160  5f536572
000164  76657200
000168  6547534d          DCB      "eGSM_Write_Socket_Phase1",0
00016c  5f577269
000170  74655f53
000174  6f636b65
000178  745f5068
00017c  61736531
000180  00      
000181  00                DCB      0
000182  00                DCB      0
000183  00                DCB      0
000184  6547534d          DCB      "eGSM_Write_Socket_Phase2",0
000188  5f577269
00018c  74655f53
000190  6f636b65
000194  745f5068
000198  61736532
00019c  00      
00019d  00                DCB      0
00019e  00                DCB      0
00019f  00                DCB      0
0001a0  6547534d          DCB      "eGSM_Read_Socket",0
0001a4  5f526561
0001a8  645f536f
0001ac  636b6574
0001b0  00      
0001b1  00                DCB      0
0001b2  00                DCB      0
0001b3  00                DCB      0
0001b4  6547534d          DCB      "eGSM_Add_MessageHead",0
0001b8  5f416464
0001bc  5f4d6573
0001c0  73616765
0001c4  48656164
0001c8  00      
0001c9  00                DCB      0
0001ca  00                DCB      0
0001cb  00                DCB      0
0001cc  6547534d          DCB      "eGSM_Boot_Delay",0
0001d0  5f426f6f
0001d4  745f4465
0001d8  6c617900
0001dc  47505253          DCB      "GPRS module  is power down.(Argument = %d (0:Normal, 1:"
0001e0  206d6f64
0001e4  756c6520
0001e8  20697320
0001ec  706f7765
0001f0  7220646f
0001f4  776e2e28
0001f8  41726775
0001fc  6d656e74
000200  203d2025
000204  64202830
000208  3a4e6f72
00020c  6d616c2c
000210  20313a  
000213  416c7761          DCB      "Always, 2:Restart), Call by "" %s "" ,Line = %d)\r\n",0
000217  79732c20
00021b  323a5265
00021f  73746172
000223  74292c20
000227  43616c6c
00022b  20627920
00022f  22202573
000233  2022202c
000237  4c696e65
00023b  203d2025
00023f  64290d0a
000243  00      
000244  47505253          DCB      "GPRS-->SIMCard not inserted(Can't detected the valid Si"
000248  2d2d3e53
00024c  494d4361
000250  7264206e
000254  6f742069
000258  6e736572
00025c  74656428
000260  43616e27
000264  74206465
000268  74656374
00026c  65642074
000270  68652076
000274  616c6964
000278  205369  
00027b  6d636172          DCB      "mcard)!\r\n",0
00027f  6429210d
000283  0a00    

                          AREA ||.data||, DATA, ALIGN=2

                  g_nGprsSingalQuality
000000  ff                DCB      0xff
                  g_bGprsPowerOnState
000001  00                DCB      0x00
                  g_bGprsUseNewImagePort
000002  00                DCB      0x00
                  nResultErrorCnt
000003  00                DCB      0x00
                  s_nGprsRestartCnt
000004  0000              DCW      0x0000
                  s_nUartInCnt
000006  0000              DCW      0x0000
                  s_nUartOutCnt
000008  0000              DCW      0x0000
                  nLen
00000a  0000              DCW      0x0000
                  g_nGprs_Tx_Cnt
00000c  0000              DCB      0x00,0x00
                  s_MCC
00000e  0000              DCB      0x00,0x00
                  s_MNC
000010  00000000          DCB      0x00,0x00,0x00,0x00
                  pGPRSProcessPtr
                          DCD      0x00000000
                  p
                          DCD      0x00000000
                  |symbol_number.117|
                          DCD      0x00000000
                  |symbol_number.118|
                          DCD      0x00000000
                  |symbol_number.119|
                          DCD      0x00000000
                  |symbol_number.120|
                          DCD      0x00000000
                  |symbol_number.121|
                          DCD      0x00000000
                  |symbol_number.122|
                          DCD      0x00000000
                  |symbol_number.123|
                          DCD      0x00000000
                  |symbol_number.124|
                          DCD      0x00000000
                  |symbol_number.125|
                          DCD      0x00000000
                  |symbol_number.126|
                          DCD      0x00000000
                  |symbol_number.127|
                          DCD      0x00000000
                  |symbol_number.128|
                          DCD      0x00000000
                  |symbol_number.129|
                          DCD      0x00000000
                  |symbol_number.130|
                          DCD      0x00000000
                  |symbol_number.131|
                          DCD      0x00000000
                  |symbol_number.132|
                          DCD      0x00000000
                  s_nStartReceiveTime
                          DCD      0x00000000
                  pCurrGPRSRevQ
                          DCD      0x00000000
                  g_sGPRS
                          DCD      0x00000000
000068  00000000          DCB      0x00,0x00,0x00,0x00
                  GPRS_Cmd_StateString
                          DCD      ||.conststring||
                          DCD      ||.conststring||+0xc
                          DCD      ||.conststring||+0x18
                          DCD      ||.conststring||+0x28
                          DCD      ||.conststring||+0x3c
                          DCD      ||.conststring||+0x4c
                          DCD      ||.conststring||+0x5c
                          DCD      ||.conststring||+0x70
                          DCD      ||.conststring||+0x84
                          DCD      ||.conststring||+0x98
                          DCD      ||.conststring||+0xac
                          DCD      ||.conststring||+0xbc
                          DCD      ||.conststring||+0xcc
                          DCD      ||.conststring||+0xdc
                          DCD      ||.conststring||+0xf4
                          DCD      ||.conststring||+0x108
                          DCD      ||.conststring||+0x118
                          DCD      ||.conststring||+0x128
                          DCD      ||.conststring||+0x138
                          DCD      ||.conststring||+0x154
                          DCD      ||.conststring||+0x168
                          DCD      ||.conststring||+0x184
                          DCD      ||.conststring||+0x1a0
                          DCD      ||.conststring||+0x1b4
                          DCD      ||.conststring||+0x1cc

                          AREA ||area_number.39||, DATA, ALIGN=0

                          EXPORTAS ||area_number.39||, ||.data||
                  g_ePowerCtrlParameter
000000  00                DCB      0x00
