; generated by Component: ARM Compiler 5.05 (build 41) Tool: ArmCC [4d0eb9]
; commandline ArmCC [--list --split_sections -c --asm --interleave -o.\obj\menu.o --asm_dir=.\list\ --list_dir=.\list\ --depend=.\obj\menu.d --cpu=Cortex-M3 --apcs=interwork -O3 -I..\Board_Support_Package -I..\Config -I..\GUI\Core -I..\GUI\JPEG -I..\GUI\LCDDriver -I..\GUI\MultiLayer -I..\GUI\Widget -I..\GUI\WM -I..\Libraries\CMSIS\CM3\CoreSupport -I..\Libraries\CMSIS\CM3\DeviceSupport\ST\STM32F10x -I..\Libraries\CMSIS\Include -I..\Libraries\STM32F10x_StdPeriph_Driver\inc -I..\User\Res -I..\User\UserWindow -I..\User -I..\USB\inc -IC:\Keil_v5\ARM\RV31\INC -IC:\Keil_v5\ARM\CMSIS\Include -IC:\Keil_v5\ARM\Inc\ST\STM32F10x -D__MICROLIB -DSTM32F10X_HD -DVECT_TAB_FLASH -DUSE_STDPERIPH_DRIVER --no_multibyte_chars ..\GUI\Widget\MENU.c]
                          THUMB

                          AREA ||i.MENU_AddItem||, CODE, READONLY, ALIGN=1

                  MENU_AddItem PROC
;;;1366   */
;;;1367   void MENU_AddItem(MENU_Handle hObj, const MENU_ITEM_DATA* pItemData) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  460e              MOV      r6,r1
000006  0007              MOVS     r7,r0
000008  d026              BEQ      |L1.88|
;;;1368     if (hObj && pItemData) {
00000a  2e00              CMP      r6,#0
00000c  d024              BEQ      |L1.88|
;;;1369       MENU_Obj* pObj;
;;;1370       WM_LOCK();
;;;1371       pObj = MENU_H2P(hObj);
00000e  f7fffffe          BL       GUI_ALLOC_h2p
000012  0004              MOVS     r4,r0
;;;1372       if (pObj) {
000014  d020              BEQ      |L1.88|
;;;1373         if (GUI_ARRAY_AddItem(&pObj->ItemArray, NULL, 0) == 0) {
000016  2200              MOVS     r2,#0
000018  f1040058          ADD      r0,r4,#0x58
00001c  4611              MOV      r1,r2
00001e  4680              MOV      r8,r0
000020  f7fffffe          BL       GUI_ARRAY_AddItem
000024  2800              CMP      r0,#0
000026  d117              BNE      |L1.88|
;;;1374           unsigned Index;
;;;1375           Index = MENU__GetNumItems(pObj) - 1;
000028  4620              MOV      r0,r4
00002a  f7fffffe          BL       MENU__GetNumItems
00002e  1e40              SUBS     r0,r0,#1
000030  4605              MOV      r5,r0
;;;1376           if (MENU__SetItem(hObj, pObj, Index, pItemData) == 0) {
000032  4602              MOV      r2,r0
000034  4633              MOV      r3,r6
000036  4621              MOV      r1,r4
000038  4638              MOV      r0,r7
00003a  f7fffffe          BL       MENU__SetItem
00003e  b128              CBZ      r0,|L1.76|
;;;1377             GUI_ARRAY_DeleteItem(&pObj->ItemArray, Index);
;;;1378           } else {
;;;1379             MENU__ResizeMenu(hObj, pObj);
000040  4621              MOV      r1,r4
000042  4638              MOV      r0,r7
000044  e8bd41f0          POP      {r4-r8,lr}
000048  f7ffbffe          B.W      MENU__ResizeMenu
                  |L1.76|
00004c  4629              MOV      r1,r5                 ;1377
00004e  4640              MOV      r0,r8                 ;1377
000050  e8bd41f0          POP      {r4-r8,lr}            ;1377
000054  f7ffbffe          B.W      GUI_ARRAY_DeleteItem
                  |L1.88|
;;;1380           }
;;;1381         }
;;;1382       }
;;;1383       WM_UNLOCK();
;;;1384     }
;;;1385   }
000058  e8bd81f0          POP      {r4-r8,pc}
;;;1386   
                          ENDP


                          AREA ||i.MENU_Callback||, CODE, READONLY, ALIGN=1

                  MENU_Callback PROC
;;;1134   */
;;;1135   void MENU_Callback(WM_MESSAGE* pMsg) {
000000  e92d43f8          PUSH     {r3-r9,lr}
;;;1136     MENU_Handle hObj;
;;;1137     MENU_Obj* pObj;
;;;1138     int OldWidgetState, Result, HasFocus;
;;;1139     hObj = pMsg->hWin;
000004  f9b06004          LDRSH    r6,[r0,#4]
000008  4605              MOV      r5,r0                 ;1135
;;;1140     pObj = (MENU_Obj*) GUI_ALLOC_h2p(hObj); /* Don't use use WIDGET_H2P because WIDGET_INIT_ID() has not be called at this point */
00000a  4630              MOV      r0,r6
00000c  f7fffffe          BL       GUI_ALLOC_h2p
000010  4604              MOV      r4,r0
;;;1141     OldWidgetState = pObj->Widget.State;
000012  f8b08026          LDRH     r8,[r0,#0x26]
;;;1142     Result = 1;
;;;1143     if (pMsg->MsgId != WM_PID_STATE_CHANGED) {
000016  6828              LDR      r0,[r5,#0]
000018  2701              MOVS     r7,#1                 ;1142
00001a  2811              CMP      r0,#0x11
00001c  d004              BEQ      |L2.40|
;;;1144       /* Let widget handle the standard messages */
;;;1145       Result = WIDGET_HandleActive(hObj, pMsg);
00001e  4629              MOV      r1,r5
000020  4630              MOV      r0,r6
000022  f7fffffe          BL       WIDGET_HandleActive
000026  4607              MOV      r7,r0
                  |L2.40|
;;;1146     }
;;;1147     HasFocus = pObj->Widget.State & WIDGET_STATE_FOCUS;
000028  f8940026          LDRB     r0,[r4,#0x26]
;;;1148     /* React on focus change */
;;;1149     if ((OldWidgetState & WIDGET_STATE_FOCUS) != HasFocus) {
00002c  f0080101          AND      r1,r8,#1
000030  f0000001          AND      r0,r0,#1              ;1147
;;;1150       if (HasFocus) {
;;;1151         _CloseSubmenu(hObj, pObj);
;;;1152         pObj->Flags &= ~MENU_SF_ACTIVE;
;;;1153         if (pObj->Sel <= 0) {
;;;1154           _SetSelection(hObj, pObj, 0);
;;;1155           _SetCapture(hObj, pObj);
;;;1156         }
;;;1157       } else {
;;;1158         _SetSelection(hObj, pObj, -1);
000034  f04f38ff          MOV      r8,#0xffffffff
000038  4281              CMP      r1,r0                 ;1149
00003a  d020              BEQ      |L2.126|
00003c  b1b0              CBZ      r0,|L2.108|
00003e  4621              MOV      r1,r4                 ;1151
000040  4630              MOV      r0,r6                 ;1151
000042  f7fffffe          BL       _CloseSubmenu
000046  f8b4005e          LDRH     r0,[r4,#0x5e]         ;1152
00004a  f0200040          BIC      r0,r0,#0x40           ;1152
00004e  f8a4005e          STRH     r0,[r4,#0x5e]         ;1152
000052  6ee0              LDR      r0,[r4,#0x6c]         ;1153
000054  2800              CMP      r0,#0                 ;1153
000056  dc12              BGT      |L2.126|
000058  2200              MOVS     r2,#0                 ;1154
00005a  4621              MOV      r1,r4                 ;1154
00005c  4630              MOV      r0,r6                 ;1154
00005e  f7fffffe          BL       _SetSelection
000062  4621              MOV      r1,r4                 ;1155
000064  4630              MOV      r0,r6                 ;1155
000066  f7fffffe          BL       _SetCapture
00006a  e008              B        |L2.126|
                  |L2.108|
00006c  4642              MOV      r2,r8
00006e  4621              MOV      r1,r4
000070  4630              MOV      r0,r6
000072  f7fffffe          BL       _SetSelection
;;;1159         _ReleaseCapture(hObj, pObj);
000076  4621              MOV      r1,r4
000078  4630              MOV      r0,r6
00007a  f7fffffe          BL       _ReleaseCapture
                  |L2.126|
;;;1160       }
;;;1161     }
;;;1162     /* Return if message already has been processed */
;;;1163     if (!Result) {
00007e  2f00              CMP      r7,#0
000080  d043              BEQ      |L2.266|
;;;1164       return;
;;;1165     }
;;;1166     switch (pMsg->MsgId) {
000082  6828              LDR      r0,[r5,#0]
000084  280e              CMP      r0,#0xe
000086  d026              BEQ      |L2.214|
000088  dc04              BGT      |L2.148|
00008a  280b              CMP      r0,#0xb
00008c  d034              BEQ      |L2.248|
00008e  280c              CMP      r0,#0xc
000090  d136              BNE      |L2.256|
000092  e00a              B        |L2.170|
                  |L2.148|
000094  280f              CMP      r0,#0xf
000096  d02a              BEQ      |L2.238|
000098  282c              CMP      r0,#0x2c
00009a  d131              BNE      |L2.256|
;;;1167     case WM_MENU:
;;;1168       _OnMenu(hObj, pObj, pMsg);
00009c  462a              MOV      r2,r5
00009e  4621              MOV      r1,r4
0000a0  4630              MOV      r0,r6
0000a2  e8bd43f8          POP      {r3-r9,lr}
0000a6  f7ffbffe          B.W      _OnMenu
                  |L2.170|
0000aa  68a8              LDR      r0,[r5,#8]
;;;1169       return;     /* Message handled, do not call WM_DefaultProc() here. */
;;;1170     case WM_TOUCH:
;;;1171       if (_OnTouch(hObj, pObj, pMsg)) {
0000ac  4621              MOV      r1,r4
0000ae  b120              CBZ      r0,|L2.186|
0000b0  7a02              LDRB     r2,[r0,#8]
0000b2  9200              STR      r2,[sp,#0]
0000b4  e9d02300          LDRD     r2,r3,[r0,#0]
0000b8  e003              B        |L2.194|
                  |L2.186|
0000ba  4642              MOV      r2,r8
0000bc  4613              MOV      r3,r2
0000be  f8cd8000          STR      r8,[sp,#0]
                  |L2.194|
0000c2  4630              MOV      r0,r6
0000c4  f7fffffe          BL       _HandlePID
0000c8  b1d0              CBZ      r0,|L2.256|
;;;1172         _ForwardPIDMsgToOwner(hObj, pObj, pMsg);
0000ca  462a              MOV      r2,r5
0000cc  4621              MOV      r1,r4
0000ce  4630              MOV      r0,r6
0000d0  f7fffffe          BL       _ForwardPIDMsgToOwner
0000d4  e014              B        |L2.256|
                  |L2.214|
;;;1173       }
;;;1174       break;
;;;1175   #if (GUI_SUPPORT_MOUSE)
;;;1176     case WM_MOUSEOVER:
;;;1177       if (_OnMouseOver(hObj, pObj, pMsg)) {
;;;1178         _ForwardPIDMsgToOwner(hObj, pObj, pMsg);
;;;1179       }
;;;1180       break;
;;;1181   #endif
;;;1182     case WM_KEY:
;;;1183       if (((const WM_KEY_INFO*)(pMsg->Data.p))->PressedCnt > 0) {
0000d6  68a8              LDR      r0,[r5,#8]
0000d8  6841              LDR      r1,[r0,#4]
0000da  2900              CMP      r1,#0
0000dc  dd10              BLE      |L2.256|
;;;1184         if (!_OnKey(hObj, pObj, ((const WM_KEY_INFO*)(pMsg->Data.p))->Key)) {
0000de  6802              LDR      r2,[r0,#0]
0000e0  4621              MOV      r1,r4
0000e2  4630              MOV      r0,r6
0000e4  f7fffffe          BL       _OnKey
0000e8  2800              CMP      r0,#0
0000ea  d00e              BEQ      |L2.266|
0000ec  e008              B        |L2.256|
                  |L2.238|
;;;1185           return;
;;;1186         }
;;;1187       }
;;;1188       break;
;;;1189     case WM_PAINT:
;;;1190       _OnPaint(hObj, pObj);
0000ee  4621              MOV      r1,r4
0000f0  4630              MOV      r0,r6
0000f2  f7fffffe          BL       _OnPaint
;;;1191       break;
0000f6  e003              B        |L2.256|
                  |L2.248|
;;;1192     case WM_DELETE:
;;;1193       GUI_ARRAY_Delete(&pObj->ItemArray);
0000f8  f1040058          ADD      r0,r4,#0x58
0000fc  f7fffffe          BL       GUI_ARRAY_Delete
                  |L2.256|
;;;1194       break;      /* No return here ... WM_DefaultProc needs to be called */
;;;1195     }
;;;1196     WM_DefaultProc(pMsg);
000100  4628              MOV      r0,r5
000102  e8bd43f8          POP      {r3-r9,lr}
000106  f7ffbffe          B.W      WM_DefaultProc
                  |L2.266|
;;;1197   }
00010a  e8bd83f8          POP      {r3-r9,pc}
;;;1198   
                          ENDP


                          AREA ||i.MENU_CreateEx||, CODE, READONLY, ALIGN=2

                  MENU_CreateEx PROC
;;;1208   */
;;;1209   MENU_Handle MENU_CreateEx(int x0, int y0, int xSize, int ySize, WM_HWIN hParent, int WinFlags, int ExFlags, int Id) {
000000  e92d47ff          PUSH     {r0-r10,lr}
000004  ac0c              ADD      r4,sp,#0x30
000006  461f              MOV      r7,r3
000008  4690              MOV      r8,r2
00000a  e894022c          LDM      r4,{r2,r3,r5,r9}
;;;1210     MENU_Handle hObj;
;;;1211     /* Create the window */
;;;1212     WM_LOCK();
;;;1213     hObj = WM_CreateWindowAsChild(x0, y0, xSize, ySize, hParent, WM_CF_SHOW | WM_CF_STAYONTOP | WinFlags, &MENU_Callback,
00000e  2450              MOVS     r4,#0x50
000010  b29b              UXTH     r3,r3
000012  4e1e              LDR      r6,|L3.140|
000014  f043030a          ORR      r3,r3,#0xa
000018  9403              STR      r4,[sp,#0xc]
00001a  e88d004c          STM      sp,{r2,r3,r6}
00001e  463b              MOV      r3,r7
000020  4642              MOV      r2,r8
000022  f7fffffe          BL       WM_CreateWindowAsChild
000026  0006              MOVS     r6,r0
;;;1214                                   sizeof(MENU_Obj) - sizeof(WM_Obj));
;;;1215     if (hObj) {
000028  d02b              BEQ      |L3.130|
;;;1216       MENU_Obj* pObj;
;;;1217       pObj = (MENU_Obj*)GUI_ALLOC_h2p(hObj); /* Don't use use WIDGET_H2P because WIDGET_INIT_ID() has not be called at this point */
00002a  f7fffffe          BL       GUI_ALLOC_h2p
00002e  4604              MOV      r4,r0
;;;1218        /* Init sub-classes */
;;;1219       GUI_ARRAY_CREATE(&pObj->ItemArray);
;;;1220       /* init widget specific variables */
;;;1221       WIDGET__Init(&pObj->Widget, Id, WIDGET_STATE_FOCUSSABLE);
000030  2210              MOVS     r2,#0x10
000032  4649              MOV      r1,r9
000034  f7fffffe          BL       WIDGET__Init
;;;1222       /* init member variables */
;;;1223       MENU_INIT_ID(pObj);
;;;1224       if (ExFlags & MENU_SF_OPEN_ON_POINTEROVER) {
000038  07a8              LSLS     r0,r5,#30
00003a  d502              BPL      |L3.66|
;;;1225         ExFlags |= MENU_SF_ACTIVE;
00003c  f0450540          ORR      r5,r5,#0x40
000040  e001              B        |L3.70|
                  |L3.66|
;;;1226       } else {
;;;1227         ExFlags &= ~(MENU_SF_ACTIVE);
000042  f0250540          BIC      r5,r5,#0x40
                  |L3.70|
;;;1228       }
;;;1229       pObj->Props           = MENU__DefaultProps;
000046  2230              MOVS     r2,#0x30
000048  4911              LDR      r1,|L3.144|
00004a  f1040028          ADD      r0,r4,#0x28
00004e  f7fffffe          BL       __aeabi_memcpy4
;;;1230       pObj->Flags           = ExFlags;
000052  f8a4505e          STRH     r5,[r4,#0x5e]
;;;1231       pObj->Width           = ((xSize > 0) ? xSize : 0);
000056  f1b80000          SUBS     r0,r8,#0
00005a  dc00              BGT      |L3.94|
00005c  2000              MOVS     r0,#0
                  |L3.94|
;;;1232       pObj->Height          = ((ySize > 0) ? ySize : 0);
00005e  6660              STR      r0,[r4,#0x64]
000060  2f00              CMP      r7,#0
000062  dc00              BGT      |L3.102|
000064  2700              MOVS     r7,#0
                  |L3.102|
;;;1233       pObj->Sel             = -1;
000066  f04f30ff          MOV      r0,#0xffffffff
00006a  e9c4701a          STRD     r7,r0,[r4,#0x68]
;;;1234       pObj->hOwner          = 0;
00006e  2000              MOVS     r0,#0
000070  f8240f5c          STRH     r0,[r4,#0x5c]!
;;;1235       pObj->IsSubmenuActive = 0;
000074  7120              STRB     r0,[r4,#4]
;;;1236       WIDGET_SetEffect(hObj, MENU__pDefaultEffect);
000076  4806              LDR      r0,|L3.144|
000078  1f00              SUBS     r0,r0,#4
00007a  6801              LDR      r1,[r0,#0]  ; MENU__pDefaultEffect
00007c  4630              MOV      r0,r6
00007e  f7fffffe          BL       WIDGET_SetEffect
                  |L3.130|
;;;1237     } else {
;;;1238       GUI_DEBUG_ERROROUT_IF(hObj==0, "MENU_CreateEx failed")
;;;1239     }
;;;1240     WM_UNLOCK();
;;;1241     return hObj;
;;;1242   }
000082  b004              ADD      sp,sp,#0x10
000084  4630              MOV      r0,r6                 ;1241
000086  e8bd87f0          POP      {r4-r10,pc}
;;;1243   
                          ENDP

00008a  0000              DCW      0x0000
                  |L3.140|
                          DCD      MENU_Callback
                  |L3.144|
                          DCD      ||.data||+0x4

                          AREA ||i.MENU_SetOwner||, CODE, READONLY, ALIGN=1

                  MENU_SetOwner PROC
;;;1390   */
;;;1391   void MENU_SetOwner(MENU_Handle hObj, WM_HWIN hOwner) {
000000  b510              PUSH     {r4,lr}
000002  460c              MOV      r4,r1
000004  2800              CMP      r0,#0
000006  d005              BEQ      |L4.20|
;;;1392     if (hObj) {
;;;1393       MENU_Obj* pObj;
;;;1394       WM_LOCK();
;;;1395       pObj = MENU_H2P(hObj);
000008  f7fffffe          BL       GUI_ALLOC_h2p
;;;1396       if (pObj) {
00000c  2800              CMP      r0,#0
00000e  d001              BEQ      |L4.20|
;;;1397         pObj->hOwner = hOwner;
000010  f8a0405c          STRH     r4,[r0,#0x5c]
                  |L4.20|
;;;1398       }
;;;1399       WM_UNLOCK();
;;;1400     }
;;;1401   }
000014  bd10              POP      {r4,pc}
;;;1402   
                          ENDP


                          AREA ||i.MENU__GetNumItems||, CODE, READONLY, ALIGN=1

                  MENU__GetNumItems PROC
;;;1253   */
;;;1254   unsigned MENU__GetNumItems(MENU_Obj* pObj) {
000000  3058              ADDS     r0,r0,#0x58
;;;1255     return GUI_ARRAY_GetNumItems(&pObj->ItemArray);
000002  f7ffbffe          B.W      GUI_ARRAY_GetNumItems
;;;1256   }
;;;1257   
                          ENDP


                          AREA ||i.MENU__InvalidateItem||, CODE, READONLY, ALIGN=1

                  MENU__InvalidateItem PROC
;;;1261   */
;;;1262   void MENU__InvalidateItem(MENU_Handle hObj, const MENU_Obj* pObj, unsigned Index) {
000000  f7ffbffe          B.W      WM_InvalidateWindow
;;;1263     GUI_USE_PARA(pObj);
;;;1264     GUI_USE_PARA(Index);
;;;1265     WM_InvalidateWindow(hObj);  /* Can be optimized, no need to invalidate all items */
;;;1266   }
;;;1267   
                          ENDP


                          AREA ||i.MENU__RecalcTextWidthOfItems||, CODE, READONLY, ALIGN=1

                  MENU__RecalcTextWidthOfItems PROC
;;;1271   */
;;;1272   void MENU__RecalcTextWidthOfItems(MENU_Obj* pObj) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4605              MOV      r5,r0
;;;1273     const GUI_FONT GUI_UNI_PTR* pOldFont;
;;;1274     MENU_ITEM* pItem;
;;;1275     unsigned i, NumItems;
;;;1276     NumItems = MENU__GetNumItems(pObj);
000006  f7fffffe          BL       MENU__GetNumItems
00000a  4606              MOV      r6,r0
;;;1277     pOldFont  = GUI_SetFont(pObj->Props.pFont);
00000c  6d68              LDR      r0,[r5,#0x54]
00000e  f7fffffe          BL       GUI_SetFont
;;;1278     for (i = 0; i < NumItems; i++) {
000012  2400              MOVS     r4,#0
000014  4680              MOV      r8,r0                 ;1277
000016  3558              ADDS     r5,r5,#0x58
000018  e009              B        |L7.46|
                  |L7.26|
;;;1279       pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, i);
00001a  4621              MOV      r1,r4
00001c  4628              MOV      r0,r5
00001e  f7fffffe          BL       GUI_ARRAY_GetpItem
000022  4607              MOV      r7,r0
;;;1280       pItem->TextWidth = GUI_GetStringDistX(pItem->acText);
000024  300c              ADDS     r0,r0,#0xc
000026  f7fffffe          BL       GUI_GetStringDistX
00002a  1c64              ADDS     r4,r4,#1
00002c  60b8              STR      r0,[r7,#8]
                  |L7.46|
00002e  42b4              CMP      r4,r6                 ;1278
000030  d3f3              BCC      |L7.26|
;;;1281     }
;;;1282     GUI_SetFont(pOldFont);
000032  4640              MOV      r0,r8
000034  e8bd41f0          POP      {r4-r8,lr}
000038  f7ffbffe          B.W      GUI_SetFont
;;;1283   }
;;;1284   
                          ENDP


                          AREA ||i.MENU__ResizeMenu||, CODE, READONLY, ALIGN=1

                  MENU__ResizeMenu PROC
;;;1288   */
;;;1289   void MENU__ResizeMenu(MENU_Handle hObj, MENU_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
000002  4605              MOV      r5,r0
000004  6e48              LDR      r0,[r1,#0x64]
000006  460c              MOV      r4,r1
000008  b910              CBNZ     r0,|L8.16|
00000a  4628              MOV      r0,r5
00000c  f7fffffe          BL       _CalcMenuSizeX
                  |L8.16|
;;;1290     int xSize, ySize;
;;;1291     xSize = _CalcWindowSizeX(hObj, pObj);
000010  4606              MOV      r6,r0
000012  6ea0              LDR      r0,[r4,#0x68]
;;;1292     ySize = _CalcWindowSizeY(hObj, pObj);
000014  4621              MOV      r1,r4
000016  b910              CBNZ     r0,|L8.30|
000018  4628              MOV      r0,r5
00001a  f7fffffe          BL       _CalcMenuSizeY
                  |L8.30|
00001e  4602              MOV      r2,r0
;;;1293     WM_SetSize(hObj, xSize, ySize);
000020  4631              MOV      r1,r6
000022  4628              MOV      r0,r5
000024  f7fffffe          BL       WM_SetSize
;;;1294     WM_InvalidateWindow(hObj);
000028  4628              MOV      r0,r5
00002a  e8bd4070          POP      {r4-r6,lr}
00002e  f7ffbffe          B.W      WM_InvalidateWindow
;;;1295   }
;;;1296   
                          ENDP


                          AREA ||i.MENU__SendMenuMessage||, CODE, READONLY, ALIGN=1

                  MENU__SendMenuMessage PROC
;;;1338   */
;;;1339   int MENU__SendMenuMessage(MENU_Handle hObj, WM_HWIN hDestWin, U16 MsgType, U16 ItemId) {
000000  b51f              PUSH     {r0-r4,lr}
000002  000c              MOVS     r4,r1
;;;1340     MENU_MSG_DATA MsgData;
;;;1341     WM_MESSAGE    Msg = {0};
000004  f04f0100          MOV      r1,#0
;;;1342     MsgData.MsgType   = MsgType;
000008  9101              STR      r1,[sp,#4]
;;;1343     MsgData.ItemId    = ItemId;
;;;1344     Msg.MsgId         = WM_MENU;
00000a  f04f012c          MOV      r1,#0x2c
;;;1345     Msg.Data.p        = &MsgData;
00000e  9100              STR      r1,[sp,#0]
000010  f8ad200c          STRH     r2,[sp,#0xc]          ;1342
000014  a903              ADD      r1,sp,#0xc
000016  f8ad300e          STRH     r3,[sp,#0xe]          ;1343
;;;1346     Msg.hWinSrc       = hObj;
00001a  9102              STR      r1,[sp,#8]
00001c  f8ad0006          STRH     r0,[sp,#6]
000020  d103              BNE      |L9.42|
;;;1347     if (!hDestWin) {
;;;1348       hDestWin = WM_GetParent(hObj);
000022  f7fffffe          BL       WM_GetParent
000026  0004              MOVS     r4,r0
000028  d006              BEQ      |L9.56|
                  |L9.42|
;;;1349     }
;;;1350     if (hDestWin) {
;;;1351       WM__SendMessage(hDestWin, &Msg);
00002a  4669              MOV      r1,sp
00002c  4620              MOV      r0,r4
00002e  f7fffffe          BL       WM__SendMessage
;;;1352       return Msg.Data.v;
000032  9802              LDR      r0,[sp,#8]
                  |L9.52|
;;;1353     }
;;;1354     return 0;
;;;1355   }
000034  b004              ADD      sp,sp,#0x10
000036  bd10              POP      {r4,pc}
                  |L9.56|
000038  2000              MOVS     r0,#0                 ;1354
00003a  e7fb              B        |L9.52|
;;;1356   
                          ENDP


                          AREA ||i.MENU__SetItem||, CODE, READONLY, ALIGN=2

                  MENU__SetItem PROC
;;;1300   */
;;;1301   char MENU__SetItem(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index, const MENU_ITEM_DATA* pItemData) {
000000  e92d47ff          PUSH     {r0-r10,lr}
;;;1302     MENU_ITEM Item = {0};
000004  2600              MOVS     r6,#0
000006  9600              STR      r6,[sp,#0]
000008  9601              STR      r6,[sp,#4]
00000a  9602              STR      r6,[sp,#8]
;;;1303     const char* pText;
;;;1304     pText = pItemData->pText;
00000c  9603              STR      r6,[sp,#0xc]
00000e  681c              LDR      r4,[r3,#0]            ;1301
000010  4691              MOV      r9,r2                 ;1301
000012  460d              MOV      r5,r1                 ;1301
000014  4682              MOV      r10,r0                ;1301
000016  b904              CBNZ     r4,|L10.26|
;;;1305     if (!pText) {
;;;1306       pText = "";
000018  a420              ADR      r4,|L10.156|
                  |L10.26|
;;;1307     }
;;;1308     Item.Id        = pItemData->Id;
00001a  8898              LDRH     r0,[r3,#4]
00001c  f8ad0002          STRH     r0,[sp,#2]
;;;1309     Item.Flags     = pItemData->Flags;
000020  88d8              LDRH     r0,[r3,#6]
000022  f8ad0004          STRH     r0,[sp,#4]
;;;1310     Item.hSubmenu  = pItemData->hSubmenu;
000026  8918              LDRH     r0,[r3,#8]
000028  f8ad0000          STRH     r0,[sp,#0]
00002c  2700              MOVS     r7,#0
00002e  b154              CBZ      r4,|L10.70|
000030  6d68              LDR      r0,[r5,#0x54]
000032  f7fffffe          BL       GUI_SetFont
000036  4680              MOV      r8,r0
000038  4620              MOV      r0,r4
00003a  f7fffffe          BL       GUI_GetStringDistX
00003e  4607              MOV      r7,r0
000040  4640              MOV      r0,r8
000042  f7fffffe          BL       GUI_SetFont
                  |L10.70|
;;;1311     Item.TextWidth = _CalcTextWidth(pObj, pText);
;;;1312     if (Item.Flags & MENU_IF_SEPARATOR) {
000046  f8bd0004          LDRH     r0,[sp,#4]
00004a  9702              STR      r7,[sp,#8]
00004c  0780              LSLS     r0,r0,#30
00004e  d501              BPL      |L10.84|
;;;1313       Item.hSubmenu = 0;   /* Ensures that no separator is a submenu */
000050  f8ad6000          STRH     r6,[sp,#0]
                  |L10.84|
;;;1314     }
;;;1315     if (GUI_ARRAY_SetItem(&pObj->ItemArray, Index, &Item, sizeof(MENU_ITEM) + strlen(pText)) != 0) {
000054  4620              MOV      r0,r4
000056  f7fffffe          BL       strlen
00005a  f1000310          ADD      r3,r0,#0x10
00005e  f1050058          ADD      r0,r5,#0x58
000062  466a              MOV      r2,sp
000064  4649              MOV      r1,r9
000066  4605              MOV      r5,r0
000068  f7fffffe          BL       GUI_ARRAY_SetItem
00006c  2800              CMP      r0,#0
00006e  d011              BEQ      |L10.148|
;;;1316       MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000070  4649              MOV      r1,r9
000072  4628              MOV      r0,r5
000074  f7fffffe          BL       GUI_ARRAY_GetpItem
;;;1317       strcpy(pItem->acText, pText);
000078  4621              MOV      r1,r4
00007a  300c              ADDS     r0,r0,#0xc
00007c  f7fffffe          BL       strcpy
;;;1318       MENU_SetOwner(Item.hSubmenu, hObj);
000080  f9bd0000          LDRSH    r0,[sp,#0]
000084  4651              MOV      r1,r10
000086  f7fffffe          BL       MENU_SetOwner
;;;1319       WM_DetachWindow(Item.hSubmenu);   /* Ensures all submenus are initially closed */
00008a  f9bd0000          LDRSH    r0,[sp,#0]
00008e  f7fffffe          BL       WM_DetachWindow
;;;1320       return 1;
000092  2001              MOVS     r0,#1
                  |L10.148|
;;;1321     }
;;;1322     return 0;
;;;1323   }
000094  b004              ADD      sp,sp,#0x10
000096  e8bd87f0          POP      {r4-r10,pc}
;;;1324   
                          ENDP

00009a  0000              DCW      0x0000
                  |L10.156|
00009c  00                DCB      0
00009d  00                DCB      0
00009e  00                DCB      0
00009f  00                DCB      0

                          AREA ||i.MENU__SetItemFlags||, CODE, READONLY, ALIGN=1

                  MENU__SetItemFlags PROC
;;;1328   */
;;;1329   void MENU__SetItemFlags(MENU_Obj* pObj, unsigned Index, U16 Mask, U16 Flags) {
000000  b570              PUSH     {r4-r6,lr}
000002  461c              MOV      r4,r3
000004  4615              MOV      r5,r2
000006  3058              ADDS     r0,r0,#0x58
;;;1330     MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000008  f7fffffe          BL       GUI_ARRAY_GetpItem
;;;1331     pItem->Flags &= ~Mask;
00000c  8881              LDRH     r1,[r0,#4]
00000e  43a9              BICS     r1,r1,r5
;;;1332     pItem->Flags |= Flags;
000010  4321              ORRS     r1,r1,r4
000012  8081              STRH     r1,[r0,#4]
;;;1333   }
000014  bd70              POP      {r4-r6,pc}
;;;1334   
                          ENDP


                          AREA ||i._ActivateItem||, CODE, READONLY, ALIGN=1

                  _ActivateItem PROC
;;;575    */
;;;576    static void _ActivateItem(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000000  b570              PUSH     {r4-r6,lr}
000002  460d              MOV      r5,r1
000004  4606              MOV      r6,r0
;;;577      MENU_ITEM* pItem;
;;;578      pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000006  4611              MOV      r1,r2
000008  f1050058          ADD      r0,r5,#0x58
00000c  f7fffffe          BL       GUI_ARRAY_GetpItem
000010  4604              MOV      r4,r0
;;;579      if (pItem->hSubmenu == 0) {
000012  8800              LDRH     r0,[r0,#0]
000014  2800              CMP      r0,#0
000016  d10f              BNE      |L12.56|
;;;580        if ((pItem->Flags & (MENU_IF_DISABLED | MENU_IF_SEPARATOR)) == 0) {
000018  7920              LDRB     r0,[r4,#4]
00001a  0780              LSLS     r0,r0,#30
00001c  d10c              BNE      |L12.56|
;;;581          _ClosePopup(hObj, pObj);
00001e  4629              MOV      r1,r5
000020  4630              MOV      r0,r6
000022  f7fffffe          BL       _ClosePopup
;;;582          /* Send item select message to owner. */
;;;583          MENU__SendMenuMessage(hObj, pObj->hOwner, MENU_ON_ITEMSELECT, pItem->Id);
000026  8863              LDRH     r3,[r4,#2]
000028  f9b5105c          LDRSH    r1,[r5,#0x5c]
00002c  4630              MOV      r0,r6
00002e  e8bd4070          POP      {r4-r6,lr}
000032  2200              MOVS     r2,#0
000034  f7ffbffe          B.W      MENU__SendMenuMessage
                  |L12.56|
;;;584        }
;;;585      }
;;;586    }
000038  bd70              POP      {r4-r6,pc}
;;;587    
                          ENDP


                          AREA ||i._CalcMenuSizeX||, CODE, READONLY, ALIGN=1

                  _CalcMenuSizeX PROC
;;;282    */
;;;283    static int _CalcMenuSizeX(MENU_Handle hObj, MENU_Obj* pObj) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4680              MOV      r8,r0
000006  460f              MOV      r7,r1
;;;284      unsigned i, NumItems = MENU__GetNumItems(pObj);
000008  4608              MOV      r0,r1
00000a  f7fffffe          BL       MENU__GetNumItems
00000e  4606              MOV      r6,r0
;;;285      int xSize = 0;
000010  2400              MOVS     r4,#0
;;;286      if (pObj->Flags & MENU_SF_VERTICAL) {
000012  f897005e          LDRB     r0,[r7,#0x5e]
;;;287        int ItemWidth;
;;;288        for (i = 0; i < NumItems; i++) {
;;;289          ItemWidth = _GetItemWidth(hObj, pObj, i);
;;;290          if (ItemWidth > xSize) {
;;;291            xSize = ItemWidth;
;;;292          }
;;;293        }
;;;294      } else {
;;;295        for (i = 0; i < NumItems; i++) {
000016  4625              MOV      r5,r4
000018  07c0              LSLS     r0,r0,#31             ;286
00001a  d109              BNE      |L13.48|
00001c  e012              B        |L13.68|
                  |L13.30|
00001e  462a              MOV      r2,r5                 ;289
000020  4639              MOV      r1,r7                 ;289
000022  4640              MOV      r0,r8                 ;289
000024  f7fffffe          BL       _GetItemWidth
000028  42a0              CMP      r0,r4                 ;290
00002a  dd00              BLE      |L13.46|
00002c  4604              MOV      r4,r0                 ;291
                  |L13.46|
00002e  1c6d              ADDS     r5,r5,#1              ;291
                  |L13.48|
000030  42b5              CMP      r5,r6                 ;288
000032  d3f4              BCC      |L13.30|
000034  e008              B        |L13.72|
                  |L13.54|
;;;296          xSize += _GetItemWidth(hObj, pObj, i);
000036  462a              MOV      r2,r5
000038  4639              MOV      r1,r7
00003a  4640              MOV      r0,r8
00003c  f7fffffe          BL       _GetItemWidth
000040  4404              ADD      r4,r4,r0
000042  1c6d              ADDS     r5,r5,#1
                  |L13.68|
000044  42b5              CMP      r5,r6                 ;295
000046  d3f6              BCC      |L13.54|
                  |L13.72|
;;;297        }
;;;298      }
;;;299      xSize += (_GetEffectSize(hObj, pObj) << 1);
000048  4639              MOV      r1,r7
00004a  4640              MOV      r0,r8
00004c  f7fffffe          BL       _GetEffectSize
000050  eb040040          ADD      r0,r4,r0,LSL #1
;;;300      return xSize;
;;;301    }
000054  e8bd81f0          POP      {r4-r8,pc}
;;;302    
                          ENDP


                          AREA ||i._CalcMenuSizeY||, CODE, READONLY, ALIGN=1

                  _CalcMenuSizeY PROC
;;;306    */
;;;307    static int _CalcMenuSizeY(MENU_Handle hObj, MENU_Obj* pObj) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4680              MOV      r8,r0
000006  460f              MOV      r7,r1
;;;308      unsigned i, NumItems = MENU__GetNumItems(pObj);
000008  4608              MOV      r0,r1
00000a  f7fffffe          BL       MENU__GetNumItems
00000e  4606              MOV      r6,r0
;;;309      int ySize = 0;
000010  2400              MOVS     r4,#0
;;;310      if (pObj->Flags & MENU_SF_VERTICAL) {
000012  f897005e          LDRB     r0,[r7,#0x5e]
;;;311        for (i = 0; i < NumItems; i++) {
;;;312          ySize += _GetItemHeight(hObj, pObj, i);
;;;313        }
;;;314      } else {
;;;315        int ItemHeight;
;;;316        for (i = 0; i < NumItems; i++) {
000016  4625              MOV      r5,r4
000018  07c0              LSLS     r0,r0,#31             ;310
00001a  d107              BNE      |L14.44|
00001c  e012              B        |L14.68|
                  |L14.30|
00001e  462a              MOV      r2,r5                 ;312
000020  4639              MOV      r1,r7                 ;312
000022  4640              MOV      r0,r8                 ;312
000024  f7fffffe          BL       _GetItemHeight
000028  4404              ADD      r4,r4,r0              ;312
00002a  1c6d              ADDS     r5,r5,#1              ;312
                  |L14.44|
00002c  42b5              CMP      r5,r6                 ;311
00002e  d3f6              BCC      |L14.30|
000030  e00a              B        |L14.72|
                  |L14.50|
;;;317          ItemHeight = _GetItemHeight(hObj, pObj, i);
000032  462a              MOV      r2,r5
000034  4639              MOV      r1,r7
000036  4640              MOV      r0,r8
000038  f7fffffe          BL       _GetItemHeight
;;;318          if (ItemHeight > ySize) {
00003c  42a0              CMP      r0,r4
00003e  dd00              BLE      |L14.66|
;;;319            ySize = ItemHeight;
000040  4604              MOV      r4,r0
                  |L14.66|
000042  1c6d              ADDS     r5,r5,#1
                  |L14.68|
000044  42b5              CMP      r5,r6                 ;316
000046  d3f4              BCC      |L14.50|
                  |L14.72|
;;;320          }
;;;321        }
;;;322      }
;;;323      ySize += (_GetEffectSize(hObj, pObj) << 1);
000048  4639              MOV      r1,r7
00004a  4640              MOV      r0,r8
00004c  f7fffffe          BL       _GetEffectSize
000050  eb040040          ADD      r0,r4,r0,LSL #1
;;;324      return ySize;
;;;325    }
000054  e8bd81f0          POP      {r4-r8,pc}
;;;326    
                          ENDP


                          AREA ||i._ClosePopup||, CODE, READONLY, ALIGN=1

                  _ClosePopup PROC
;;;528    */
;;;529    static void _ClosePopup(MENU_Handle hObj, MENU_Obj* pObj) {
000000  b510              PUSH     {r4,lr}
;;;530      if (pObj->Flags & MENU_SF_POPUP) {
000002  f8b1205e          LDRH     r2,[r1,#0x5e]
000006  0613              LSLS     r3,r2,#24
000008  d509              BPL      |L15.30|
;;;531        pObj->Flags &= ~(MENU_SF_POPUP);
00000a  f0220280          BIC      r2,r2,#0x80
00000e  f8a1205e          STRH     r2,[r1,#0x5e]
;;;532        WM_DetachWindow(hObj);
000012  f7fffffe          BL       WM_DetachWindow
;;;533        WM_ReleaseCapture();
000016  e8bd4010          POP      {r4,lr}
00001a  f7ffbffe          B.W      WM_ReleaseCapture
                  |L15.30|
;;;534      }
;;;535    }
00001e  bd10              POP      {r4,pc}
;;;536    
                          ENDP


                          AREA ||i._CloseSubmenu||, CODE, READONLY, ALIGN=1

                  _CloseSubmenu PROC
;;;453    */
;;;454    static void _CloseSubmenu(MENU_Handle hObj, MENU_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
000002  4605              MOV      r5,r0
;;;455      if (pObj->Flags & MENU_SF_ACTIVE) {
000004  f891005e          LDRB     r0,[r1,#0x5e]
000008  460c              MOV      r4,r1                 ;454
00000a  0640              LSLS     r0,r0,#25
00000c  d520              BPL      |L16.80|
;;;456        if (pObj->IsSubmenuActive) {
00000e  f8940060          LDRB     r0,[r4,#0x60]
000012  2800              CMP      r0,#0
000014  d01c              BEQ      |L16.80|
;;;457          MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, pObj->Sel);
000016  f1040058          ADD      r0,r4,#0x58
00001a  6ee1              LDR      r1,[r4,#0x6c]
00001c  f7fffffe          BL       GUI_ARRAY_GetpItem
000020  4606              MOV      r6,r0
;;;458          /* Inform submenu about its deactivation and detach it */
;;;459          MENU__SendMenuMessage(hObj, pItem->hSubmenu, MENU_ON_CLOSE, 0);
000022  f9b01000          LDRSH    r1,[r0,#0]
000026  2300              MOVS     r3,#0
000028  2204              MOVS     r2,#4
00002a  4628              MOV      r0,r5
00002c  f7fffffe          BL       MENU__SendMenuMessage
;;;460          WM_DetachWindow(pItem->hSubmenu);
000030  f9b60000          LDRSH    r0,[r6,#0]
000034  f7fffffe          BL       WM_DetachWindow
;;;461          pObj->IsSubmenuActive = 0;
000038  2000              MOVS     r0,#0
00003a  f8840060          STRB     r0,[r4,#0x60]
;;;462          /*
;;;463           * Keep capture in menu widget. The capture may only released
;;;464           * by clicking outside the menu or when mouse moved out.
;;;465           * And it may only released from a top level menu.
;;;466           */
;;;467          _SetCapture(hObj, pObj);
00003e  4621              MOV      r1,r4
000040  4628              MOV      r0,r5
000042  f7fffffe          BL       _SetCapture
;;;468          /* Invalidate menu item. This is needed because the appearance may have changed */
;;;469          MENU__InvalidateItem(hObj, pObj, pObj->Sel);
000046  4628              MOV      r0,r5
000048  e8bd4070          POP      {r4-r6,lr}
00004c  f7ffbffe          B.W      WM_InvalidateWindow
                  |L16.80|
;;;470        }
;;;471      }
;;;472    }
000050  bd70              POP      {r4-r6,pc}
;;;473    
                          ENDP


                          AREA ||i._DeactivateMenu||, CODE, READONLY, ALIGN=1

                  _DeactivateMenu PROC
;;;616    */
;;;617    static void _DeactivateMenu(MENU_Handle hObj, MENU_Obj* pObj) {
000000  b510              PUSH     {r4,lr}
000002  460c              MOV      r4,r1
;;;618      _CloseSubmenu(hObj, pObj);
000004  f7fffffe          BL       _CloseSubmenu
;;;619      if ((pObj->Flags & MENU_SF_OPEN_ON_POINTEROVER) == 0) {
000008  f8b4005e          LDRH     r0,[r4,#0x5e]
00000c  0781              LSLS     r1,r0,#30
00000e  d403              BMI      |L17.24|
;;;620        pObj->Flags &= ~MENU_SF_ACTIVE;
000010  f0200040          BIC      r0,r0,#0x40
000014  f8a4005e          STRH     r0,[r4,#0x5e]
                  |L17.24|
;;;621      }
;;;622    }
000018  bd10              POP      {r4,pc}
;;;623    
                          ENDP


                          AREA ||i._DeselectItem||, CODE, READONLY, ALIGN=1

                  _DeselectItem PROC
;;;564    */
;;;565    static void _DeselectItem(MENU_Handle hObj, MENU_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
000002  4605              MOV      r5,r0
;;;566      if (pObj->IsSubmenuActive == 0) {
000004  f8910060          LDRB     r0,[r1,#0x60]
000008  460c              MOV      r4,r1                 ;565
00000a  2800              CMP      r0,#0                 ;565
00000c  d109              BNE      |L18.34|
;;;567        _SetSelection(hObj, pObj, -1);
00000e  1e42              SUBS     r2,r0,#1
000010  4628              MOV      r0,r5
000012  f7fffffe          BL       _SetSelection
;;;568        _ReleaseCapture(hObj, pObj);
000016  4621              MOV      r1,r4
000018  4628              MOV      r0,r5
00001a  e8bd4070          POP      {r4-r6,lr}
00001e  f7ffbffe          B.W      _ReleaseCapture
                  |L18.34|
;;;569      }
;;;570    }
000022  bd70              POP      {r4-r6,pc}
;;;571    
                          ENDP


                          AREA ||i._ForwardPIDMsgToOwner||, CODE, READONLY, ALIGN=1

                  _ForwardPIDMsgToOwner PROC
;;;760    */
;;;761    static void _ForwardPIDMsgToOwner(MENU_Handle hObj, MENU_Obj* pObj, WM_MESSAGE* pMsg) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4615              MOV      r5,r2
000006  460c              MOV      r4,r1
000008  4680              MOV      r8,r0
;;;762      if (_IsTopLevelMenu(hObj, pObj) == 0) {
00000a  f7fffffe          BL       _IsTopLevelMenu
00000e  2800              CMP      r0,#0
000010  d125              BNE      |L19.94|
;;;763        WM_HWIN hOwner;
;;;764        hOwner = pObj->hOwner ? pObj->hOwner : WM_GetParent(hObj);
000012  f9b4005c          LDRSH    r0,[r4,#0x5c]
000016  b910              CBNZ     r0,|L19.30|
000018  4640              MOV      r0,r8
00001a  f7fffffe          BL       WM_GetParent
                  |L19.30|
00001e  0006              MOVS     r6,r0
;;;765        if (hOwner) {
000020  d01d              BEQ      |L19.94|
;;;766          if (pMsg->Data.p) {
000022  68ac              LDR      r4,[r5,#8]
000024  b1ac              CBZ      r4,|L19.82|
;;;767            GUI_PID_STATE* pState;
;;;768            pState = (GUI_PID_STATE*)pMsg->Data.p;
;;;769            pState->x += WM_GetWindowOrgX(hObj) - WM_GetWindowOrgX(hOwner);
000026  4640              MOV      r0,r8
000028  f7fffffe          BL       WM_GetWindowOrgX
00002c  4607              MOV      r7,r0
00002e  4630              MOV      r0,r6
000030  f7fffffe          BL       WM_GetWindowOrgX
000034  6821              LDR      r1,[r4,#0]
000036  1a38              SUBS     r0,r7,r0
000038  4408              ADD      r0,r0,r1
;;;770            pState->y += WM_GetWindowOrgY(hObj) - WM_GetWindowOrgY(hOwner);
00003a  6020              STR      r0,[r4,#0]
00003c  4640              MOV      r0,r8
00003e  f7fffffe          BL       WM_GetWindowOrgY
000042  4607              MOV      r7,r0
000044  4630              MOV      r0,r6
000046  f7fffffe          BL       WM_GetWindowOrgY
00004a  6861              LDR      r1,[r4,#4]
00004c  1a38              SUBS     r0,r7,r0
00004e  4408              ADD      r0,r0,r1
000050  6060              STR      r0,[r4,#4]
                  |L19.82|
;;;771          }
;;;772          WM__SendMessage(hOwner, pMsg);
000052  4629              MOV      r1,r5
000054  4630              MOV      r0,r6
000056  e8bd41f0          POP      {r4-r8,lr}
00005a  f7ffbffe          B.W      WM__SendMessage
                  |L19.94|
;;;773        }
;;;774      }
;;;775    }
00005e  e8bd81f0          POP      {r4-r8,pc}
;;;776    
                          ENDP


                          AREA ||i._GetEffectSize||, CODE, READONLY, ALIGN=1

                  _GetEffectSize PROC
;;;214    */
;;;215    static int _GetEffectSize(MENU_Handle hObj, MENU_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
000002  460d              MOV      r5,r1
;;;216      int r = 0;
000004  2400              MOVS     r4,#0
;;;217      if (_HasEffect(hObj, pObj)) { 
000006  f7fffffe          BL       _HasEffect
00000a  b108              CBZ      r0,|L20.16|
;;;218        r = pObj->Widget.pEffect->EffectSize;
00000c  6a28              LDR      r0,[r5,#0x20]
00000e  6944              LDR      r4,[r0,#0x14]
                  |L20.16|
;;;219      }
;;;220      return r;
000010  4620              MOV      r0,r4
;;;221    }
000012  bd70              POP      {r4-r6,pc}
;;;222    
                          ENDP


                          AREA ||i._GetItemFromPos||, CODE, READONLY, ALIGN=1

                  _GetItemFromPos PROC
;;;361    */
;;;362    static int _GetItemFromPos(MENU_Handle hObj, MENU_Obj* pObj, int x, int y) {
000000  e92d5ff0          PUSH     {r4-r12,lr}
000004  469a              MOV      r10,r3
000006  4616              MOV      r6,r2
000008  4683              MOV      r11,r0
00000a  4689              MOV      r9,r1
;;;363      int xSize, ySize, EffectSize, r = -1;
00000c  f04f38ff          MOV      r8,#0xffffffff
;;;364      ySize = _CalcMenuSizeY(hObj, pObj);
000010  f7fffffe          BL       _CalcMenuSizeY
000014  4604              MOV      r4,r0
;;;365      if ((pObj->Height) && (pObj->Height < ySize)) {
000016  f8d90068          LDR      r0,[r9,#0x68]
00001a  b110              CBZ      r0,|L21.34|
00001c  42a0              CMP      r0,r4
00001e  da00              BGE      |L21.34|
;;;366        ySize = pObj->Height;
000020  4604              MOV      r4,r0
                  |L21.34|
;;;367      }
;;;368      xSize = _CalcMenuSizeX(hObj, pObj);
000022  4649              MOV      r1,r9
000024  4658              MOV      r0,r11
000026  f7fffffe          BL       _CalcMenuSizeX
00002a  4605              MOV      r5,r0
;;;369      if ((pObj->Width) && (pObj->Width < xSize)) {
00002c  f8d90064          LDR      r0,[r9,#0x64]
000030  b110              CBZ      r0,|L21.56|
000032  42a8              CMP      r0,r5
000034  da00              BGE      |L21.56|
;;;370        xSize = pObj->Width;
000036  4605              MOV      r5,r0
                  |L21.56|
;;;371      }
;;;372      EffectSize = _GetEffectSize(hObj, pObj);
000038  4649              MOV      r1,r9
00003a  4658              MOV      r0,r11
00003c  f7fffffe          BL       _GetEffectSize
;;;373      x     -= EffectSize;
000040  1a37              SUBS     r7,r6,r0
;;;374      y     -= EffectSize;
000042  ebaa0600          SUB      r6,r10,r0
;;;375      xSize -= (EffectSize << 1);
000046  eba50140          SUB      r1,r5,r0,LSL #1
;;;376      ySize -= (EffectSize << 1);
00004a  eba40040          SUB      r0,r4,r0,LSL #1
;;;377      if ((x >= 0) && (y >= 0) && (x < xSize) && (y < ySize)) {
00004e  d42c              BMI      |L21.170|
000050  2e00              CMP      r6,#0
000052  db2a              BLT      |L21.170|
000054  428f              CMP      r7,r1
000056  da28              BGE      |L21.170|
000058  4286              CMP      r6,r0
00005a  da26              BGE      |L21.170|
;;;378        unsigned i, NumItems = MENU__GetNumItems(pObj);
00005c  4648              MOV      r0,r9
00005e  f7fffffe          BL       MENU__GetNumItems
000062  4605              MOV      r5,r0
;;;379        if (pObj->Flags & MENU_SF_VERTICAL) {
000064  f899005e          LDRB     r0,[r9,#0x5e]
000068  07c0              LSLS     r0,r0,#31
00006a  d010              BEQ      |L21.142|
;;;380          int yPos = 0;
00006c  2700              MOVS     r7,#0
;;;381          for (i = 0; i < NumItems; i++) {
00006e  463c              MOV      r4,r7
000070  e00a              B        |L21.136|
                  |L21.114|
;;;382            yPos += _GetItemHeight(hObj, pObj, i);
000072  4622              MOV      r2,r4
000074  4649              MOV      r1,r9
000076  4658              MOV      r0,r11
000078  f7fffffe          BL       _GetItemHeight
00007c  4407              ADD      r7,r7,r0
;;;383            if (y < yPos) {
00007e  42be              CMP      r6,r7
000080  da01              BGE      |L21.134|
                  |L21.130|
;;;384              r = i;
000082  46a0              MOV      r8,r4
;;;385              break;
000084  e011              B        |L21.170|
                  |L21.134|
000086  1c64              ADDS     r4,r4,#1
                  |L21.136|
000088  42ac              CMP      r4,r5                 ;381
00008a  d3f2              BCC      |L21.114|
00008c  e00d              B        |L21.170|
                  |L21.142|
;;;386            }
;;;387          }
;;;388        } else {
;;;389          int xPos = 0;
00008e  2600              MOVS     r6,#0
;;;390          for (i = 0; i < NumItems; i++) {
000090  4634              MOV      r4,r6
000092  e008              B        |L21.166|
                  |L21.148|
;;;391            xPos += _GetItemWidth(hObj, pObj, i);
000094  4622              MOV      r2,r4
000096  4649              MOV      r1,r9
000098  4658              MOV      r0,r11
00009a  f7fffffe          BL       _GetItemWidth
00009e  4406              ADD      r6,r6,r0
;;;392            if (x < xPos) {
0000a0  42b7              CMP      r7,r6
0000a2  dbee              BLT      |L21.130|
0000a4  1c64              ADDS     r4,r4,#1
                  |L21.166|
0000a6  42ac              CMP      r4,r5                 ;390
0000a8  d3f4              BCC      |L21.148|
                  |L21.170|
;;;393              r = i;
;;;394              break;
;;;395            }
;;;396          }
;;;397        }
;;;398      }
;;;399      return r;
0000aa  4640              MOV      r0,r8
;;;400    }
0000ac  e8bd9ff0          POP      {r4-r12,pc}
;;;401    
                          ENDP


                          AREA ||i._GetItemHeight||, CODE, READONLY, ALIGN=1

                  _GetItemHeight PROC
;;;261    */
;;;262    static int _GetItemHeight(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000000  b570              PUSH     {r4-r6,lr}
000002  460c              MOV      r4,r1
;;;263      int ItemHeight;
;;;264      if (pObj->Height && !(pObj->Flags & MENU_SF_VERTICAL)) {
000004  6e89              LDR      r1,[r1,#0x68]
000006  4616              MOV      r6,r2                 ;262
000008  b119              CBZ      r1,|L22.18|
00000a  f894105e          LDRB     r1,[r4,#0x5e]
00000e  07c9              LSLS     r1,r1,#31
000010  d016              BEQ      |L22.64|
                  |L22.18|
;;;265        ItemHeight = pObj->Height - (_GetEffectSize(hObj, pObj) << 1);
;;;266      } else {
;;;267        ItemHeight = GUI_GetYDistOfFont(pObj->Props.pFont);
000012  6d60              LDR      r0,[r4,#0x54]
000014  f7fffffe          BL       GUI_GetYDistOfFont
000018  4605              MOV      r5,r0
;;;268        if (pObj->Flags & MENU_SF_VERTICAL) {
00001a  f894005e          LDRB     r0,[r4,#0x5e]
00001e  07c0              LSLS     r0,r0,#31
000020  d008              BEQ      |L22.52|
;;;269          MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000022  4631              MOV      r1,r6
000024  f1040058          ADD      r0,r4,#0x58
000028  f7fffffe          BL       GUI_ARRAY_GetpItem
;;;270          if (pItem->Flags & MENU_IF_SEPARATOR) {
00002c  7900              LDRB     r0,[r0,#4]
00002e  0780              LSLS     r0,r0,#30
000030  d500              BPL      |L22.52|
;;;271            ItemHeight = 3;
000032  2503              MOVS     r5,#3
                  |L22.52|
;;;272          }
;;;273        }
;;;274        ItemHeight += pObj->Props.aBorder[MENU_BI_TOP] + pObj->Props.aBorder[MENU_BI_BOTTOM];
000034  f8140f52          LDRB     r0,[r4,#0x52]!
000038  7861              LDRB     r1,[r4,#1]
00003a  4408              ADD      r0,r0,r1
00003c  4428              ADD      r0,r0,r5
;;;275      }
;;;276      return ItemHeight;
;;;277    }
00003e  bd70              POP      {r4-r6,pc}
                  |L22.64|
000040  4621              MOV      r1,r4                 ;265
000042  f7fffffe          BL       _GetEffectSize
000046  6ea1              LDR      r1,[r4,#0x68]         ;265
000048  eba10040          SUB      r0,r1,r0,LSL #1       ;265
00004c  bd70              POP      {r4-r6,pc}
;;;278    
                          ENDP


                          AREA ||i._GetItemWidth||, CODE, READONLY, ALIGN=1

                  _GetItemWidth PROC
;;;241    */
;;;242    static int _GetItemWidth(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000000  b510              PUSH     {r4,lr}
000002  460c              MOV      r4,r1
;;;243      int ItemWidth;
;;;244      if (pObj->Width && (pObj->Flags & MENU_SF_VERTICAL)) {
000004  6e49              LDR      r1,[r1,#0x64]
000006  b151              CBZ      r1,|L23.30|
000008  f894105e          LDRB     r1,[r4,#0x5e]
00000c  07c9              LSLS     r1,r1,#31
00000e  d006              BEQ      |L23.30|
;;;245        ItemWidth = pObj->Width - (_GetEffectSize(hObj, pObj) << 1);
000010  4621              MOV      r1,r4
000012  f7fffffe          BL       _GetEffectSize
000016  6e61              LDR      r1,[r4,#0x64]
000018  eba10040          SUB      r0,r1,r0,LSL #1
;;;246      } else {
;;;247        MENU_ITEM* pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
;;;248        if ((pObj->Flags & MENU_SF_VERTICAL) || !(pItem->Flags & MENU_IF_SEPARATOR)) {
;;;249          ItemWidth = pItem->TextWidth;
;;;250        } else {
;;;251          ItemWidth = 3;
;;;252       }
;;;253        ItemWidth += pObj->Props.aBorder[MENU_BI_LEFT] + pObj->Props.aBorder[MENU_BI_RIGHT];
;;;254      }
;;;255      return ItemWidth;
;;;256    }
00001c  bd10              POP      {r4,pc}
                  |L23.30|
00001e  4611              MOV      r1,r2                 ;247
000020  f1040058          ADD      r0,r4,#0x58           ;247
000024  f7fffffe          BL       GUI_ARRAY_GetpItem
000028  f894105e          LDRB     r1,[r4,#0x5e]         ;248
00002c  07c9              LSLS     r1,r1,#31             ;248
00002e  d102              BNE      |L23.54|
000030  7901              LDRB     r1,[r0,#4]            ;248
000032  0789              LSLS     r1,r1,#30             ;248
000034  d401              BMI      |L23.58|
                  |L23.54|
000036  6880              LDR      r0,[r0,#8]            ;249
000038  e000              B        |L23.60|
                  |L23.58|
00003a  2003              MOVS     r0,#3                 ;251
                  |L23.60|
00003c  f8141f50          LDRB     r1,[r4,#0x50]!        ;253
000040  7862              LDRB     r2,[r4,#1]            ;253
000042  4411              ADD      r1,r1,r2              ;253
000044  4408              ADD      r0,r0,r1              ;253
000046  bd10              POP      {r4,pc}
;;;257    
                          ENDP


                          AREA ||i._GetTopLevelMenu||, CODE, READONLY, ALIGN=1

                  _GetTopLevelMenu PROC
;;;173    */
;;;174    static void _GetTopLevelMenu(MENU_Handle hObj, MENU_Obj * pObj, MENU_Handle * phObjTopLevel, MENU_Obj ** ppObjTopLevel, int * pSubSel) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4698              MOV      r8,r3
000006  4617              MOV      r7,r2
000008  4605              MOV      r5,r0
;;;175      MENU_Handle hObjTopLevel;
;;;176      MENU_Obj * pObjTopLevel;
;;;177      pObjTopLevel = pObj;
00000a  460c              MOV      r4,r1
;;;178      if (_IsTopLevelMenu(hObj, pObj)) {
00000c  9e06              LDR      r6,[sp,#0x18]
00000e  f7fffffe          BL       _IsTopLevelMenu
000012  b950              CBNZ     r0,|L24.42|
                  |L24.20|
;;;179        hObjTopLevel = hObj;
;;;180        pObjTopLevel = pObj;
;;;181      } else {
;;;182        do {
;;;183          hObjTopLevel = pObjTopLevel->hOwner;
000014  f9b4505c          LDRSH    r5,[r4,#0x5c]
;;;184          pObjTopLevel = (MENU_Obj *)GUI_ALLOC_h2p(hObjTopLevel);
000018  4628              MOV      r0,r5
00001a  f7fffffe          BL       GUI_ALLOC_h2p
00001e  4604              MOV      r4,r0
;;;185          if (_IsTopLevelMenu(hObjTopLevel, pObjTopLevel)) {
000020  4601              MOV      r1,r0
000022  4628              MOV      r0,r5
000024  f7fffffe          BL       _IsTopLevelMenu
000028  b120              CBZ      r0,|L24.52|
                  |L24.42|
;;;186            break;
;;;187          } else {
;;;188            if (pSubSel) {
;;;189              *pSubSel = pObjTopLevel->Sel;
;;;190            }
;;;191          }
;;;192        } while (1);
;;;193      }
;;;194      *phObjTopLevel = hObjTopLevel;
00002a  803d              STRH     r5,[r7,#0]
;;;195      *ppObjTopLevel = pObjTopLevel;
;;;196    }
00002c  f8c84000          STR      r4,[r8,#0]
000030  e8bd81f0          POP      {r4-r8,pc}
                  |L24.52|
000034  2e00              CMP      r6,#0                 ;188
000036  d0ed              BEQ      |L24.20|
000038  6ee0              LDR      r0,[r4,#0x6c]         ;189
00003a  6030              STR      r0,[r6,#0]            ;189
00003c  e7ea              B        |L24.20|
;;;197    
                          ENDP


                          AREA ||i._HandlePID||, CODE, READONLY, ALIGN=1

                  _HandlePID PROC
;;;662    */
;;;663    static char _HandlePID(MENU_Handle hObj, MENU_Obj* pObj, int x, int y, int Pressed) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  b086              SUB      sp,sp,#0x18
000006  4680              MOV      r8,r0
000008  461d              MOV      r5,r3
00000a  4617              MOV      r7,r2
00000c  460c              MOV      r4,r1
;;;664      GUI_PID_STATE PrevState;
;;;665      char XYInWidget = 0;
;;;666      WM_PID__GetPrevState(&PrevState);
00000e  a803              ADD      r0,sp,#0xc
000010  9e0c              LDR      r6,[sp,#0x30]
000012  f7fffffe          BL       WM_PID__GetPrevState
;;;667      /*
;;;668       * Check if coordinates are inside the widget.
;;;669       */
;;;670      if ((x >= 0) && (y >= 0)) {
000016  2f00              CMP      r7,#0
000018  db78              BLT      |L25.268|
00001a  2d00              CMP      r5,#0
00001c  db76              BLT      |L25.268|
;;;671        GUI_RECT r;
;;;672        WM__GetClientRectWin(&pObj->Widget.Win, &r);
00001e  4669              MOV      r1,sp
000020  4620              MOV      r0,r4
000022  f7fffffe          BL       WM__GetClientRectWin
;;;673        if ((x <= r.x1) && (y <= r.y1)) {
000026  f9bd0004          LDRSH    r0,[sp,#4]
00002a  42b8              CMP      r0,r7
00002c  db6e              BLT      |L25.268|
00002e  f9bd0006          LDRSH    r0,[sp,#6]
000032  42a8              CMP      r0,r5
000034  db6a              BLT      |L25.268|
;;;674          XYInWidget = 1;
;;;675        }
;;;676      }
;;;677    
;;;678      if (XYInWidget) {
;;;679        int ItemIndex;
;;;680        ItemIndex = _GetItemFromPos(hObj, pObj, x, y);
000036  462b              MOV      r3,r5
000038  463a              MOV      r2,r7
00003a  4621              MOV      r1,r4
00003c  4640              MOV      r0,r8
00003e  f7fffffe          BL       _GetItemFromPos
000042  0005              MOVS     r5,r0
000044  d44a              BMI      |L25.220|
;;;681        /* 
;;;682         * Handle PID when coordinates are inside the widget.
;;;683         */
;;;684        if (ItemIndex >= 0) {
;;;685          /* 
;;;686           * Coordinates are inside the menu.
;;;687           */
;;;688          if (Pressed > 0) {
000046  2e00              CMP      r6,#0
000048  dd37              BLE      |L25.186|
;;;689            if ((PrevState.Pressed == 0) && (Pressed == 1)) {  /* Clicked */
00004a  f89d0014          LDRB     r0,[sp,#0x14]
00004e  bb10              CBNZ     r0,|L25.150|
000050  2e01              CMP      r6,#1
000052  d130              BNE      |L25.182|
000054  f894005e          LDRB     r0,[r4,#0x5e]
;;;690              _ActivateMenu(hObj, pObj, ItemIndex);
000058  4646              MOV      r6,r8
00005a  0780              LSLS     r0,r0,#30
00005c  d42b              BMI      |L25.182|
00005e  4629              MOV      r1,r5
000060  f1040058          ADD      r0,r4,#0x58
000064  f7fffffe          BL       GUI_ARRAY_GetpItem
000068  8801              LDRH     r1,[r0,#0]
00006a  b1a1              CBZ      r1,|L25.150|
00006c  7900              LDRB     r0,[r0,#4]
00006e  07c0              LSLS     r0,r0,#31
000070  d121              BNE      |L25.182|
000072  f8b4005e          LDRH     r0,[r4,#0x5e]
000076  0641              LSLS     r1,r0,#25
000078  d40e              BMI      |L25.152|
00007a  f0400140          ORR      r1,r0,#0x40
00007e  f8a4105e          STRH     r1,[r4,#0x5e]
000082  462a              MOV      r2,r5
000084  4621              MOV      r1,r4
000086  4630              MOV      r0,r6
000088  f7fffffe          BL       _OpenSubmenu
00008c  462a              MOV      r2,r5
00008e  4621              MOV      r1,r4
000090  4630              MOV      r0,r6
000092  f7fffffe          BL       _SetSelection
                  |L25.150|
000096  e00e              B        |L25.182|
                  |L25.152|
000098  0740              LSLS     r0,r0,#29
00009a  d50c              BPL      |L25.182|
00009c  6ee1              LDR      r1,[r4,#0x6c]
00009e  42a9              CMP      r1,r5
0000a0  d109              BNE      |L25.182|
0000a2  4621              MOV      r1,r4
0000a4  4630              MOV      r0,r6
0000a6  f7fffffe          BL       _CloseSubmenu
0000aa  f8b4005e          LDRH     r0,[r4,#0x5e]
0000ae  f0200140          BIC      r1,r0,#0x40
0000b2  f8a4105e          STRH     r1,[r4,#0x5e]
                  |L25.182|
;;;691            }
;;;692            _SelectItem(hObj, pObj, ItemIndex);
0000b6  462a              MOV      r2,r5
0000b8  e00b              B        |L25.210|
                  |L25.186|
;;;693          } else if ((Pressed == 0) && (PrevState.Pressed == 1)) {  /* Released */
0000ba  d109              BNE      |L25.208|
0000bc  f89d0014          LDRB     r0,[sp,#0x14]
0000c0  2801              CMP      r0,#1
0000c2  d11e              BNE      |L25.258|
;;;694            _ActivateItem(hObj, pObj, ItemIndex);
0000c4  462a              MOV      r2,r5
0000c6  4621              MOV      r1,r4
0000c8  4640              MOV      r0,r8
0000ca  f7fffffe          BL       _ActivateItem
0000ce  e018              B        |L25.258|
                  |L25.208|
;;;695          } else if (Pressed < 0) {  /* Mouse moved */
;;;696            #if (GUI_SUPPORT_MOUSE)
;;;697              if (_ForwardMouseOverMsg(hObj, pObj, x, y) != 0) {
;;;698                _DeselectItem(hObj, pObj);
;;;699              } else
;;;700            #endif
;;;701            {
;;;702              _SelectItem(hObj, pObj, ItemIndex);
0000d0  4602              MOV      r2,r0
                  |L25.210|
0000d2  4621              MOV      r1,r4
0000d4  4640              MOV      r0,r8
0000d6  f7fffffe          BL       _SelectItem
0000da  e012              B        |L25.258|
                  |L25.220|
;;;703            }
;;;704          }
;;;705        } else {
;;;706          /* 
;;;707           * Coordinates are outside the menu but inside the widget.
;;;708           */
;;;709          if (Pressed > 0) {
0000dc  2e00              CMP      r6,#0
0000de  dd07              BLE      |L25.240|
;;;710            if (PrevState.Pressed == 0) {  /* Clicked */
0000e0  f89d0014          LDRB     r0,[sp,#0x14]
0000e4  b948              CBNZ     r0,|L25.250|
;;;711              /* 
;;;712               * User has clicked outside the menu. Close the active submenu.
;;;713               * The widget itself must be closed (if needed) by the owner.
;;;714               */
;;;715              _DeactivateMenu(hObj, pObj);
0000e6  4621              MOV      r1,r4
0000e8  4640              MOV      r0,r8
0000ea  f7fffffe          BL       _DeactivateMenu
0000ee  e004              B        |L25.250|
                  |L25.240|
;;;716            }
;;;717            _DeselectItem(hObj, pObj);
;;;718          } else if (Pressed < 0) {  /* Moved out or mouse moved */
0000f0  da07              BGE      |L25.258|
;;;719            if (!(pObj->Widget.State & WIDGET_STATE_FOCUS)) {
0000f2  f8940026          LDRB     r0,[r4,#0x26]
0000f6  07c0              LSLS     r0,r0,#31
0000f8  d103              BNE      |L25.258|
                  |L25.250|
;;;720              _DeselectItem(hObj, pObj);
0000fa  4621              MOV      r1,r4
0000fc  4640              MOV      r0,r8
0000fe  f7fffffe          BL       _DeselectItem
                  |L25.258|
;;;721            }
;;;722          }
;;;723        }
;;;724        return 0;
000102  2000              MOVS     r0,#0
                  |L25.260|
;;;725      } else {
;;;726        /* 
;;;727         * Handle PID when coordinates are outside the widget.
;;;728         */
;;;729        if ((Pressed > 0) && (PrevState.Pressed == 0)) {
;;;730          /* 
;;;731           * User has clicked outside the menu. Close the active submenu.
;;;732           * The widget itself must be closed (if needed) by the owner.
;;;733           */
;;;734          _DeselectItem(hObj, pObj);
;;;735          _DeactivateMenu(hObj, pObj);
;;;736          _ClosePopup(hObj, pObj);
;;;737          _SetSelection(hObj, pObj, -1);
;;;738          if (pObj->Widget.State & WIDGET_STATE_FOCUS) {
;;;739            MENU_Handle hObjTopLevel; 
;;;740            MENU_Obj *  pObjTopLevel;
;;;741            _GetTopLevelMenu(hObj, pObj, &hObjTopLevel, &pObjTopLevel, 0);
;;;742            WM_SetFocus(hObjTopLevel);
;;;743            _SetSelection(hObjTopLevel, pObjTopLevel, -1);
;;;744            _ReleaseCapture(hObjTopLevel, pObjTopLevel);
;;;745          }
;;;746        }
;;;747        if (!(pObj->Widget.State & WIDGET_STATE_FOCUS)) {
;;;748          _DeselectItem(hObj, pObj);
;;;749        }
;;;750        #if (GUI_SUPPORT_MOUSE)
;;;751          _ForwardMouseOverMsg(hObj, pObj, x, y);
;;;752        #endif
;;;753      }
;;;754      return 1;   /* Coordinates are not in widget, we need to forward PID message to owner */
;;;755    }
000104  b006              ADD      sp,sp,#0x18
000106  e8bd81f0          POP      {r4-r8,pc}
00010a  e7ff              B        |L25.268|
                  |L25.268|
00010c  2e00              CMP      r6,#0                 ;729
00010e  dd30              BLE      |L25.370|
000110  f89d0014          LDRB     r0,[sp,#0x14]         ;729
000114  bb68              CBNZ     r0,|L25.370|
000116  4621              MOV      r1,r4                 ;734
000118  4640              MOV      r0,r8                 ;734
00011a  f7fffffe          BL       _DeselectItem
00011e  4621              MOV      r1,r4                 ;735
000120  4640              MOV      r0,r8                 ;735
000122  f7fffffe          BL       _DeactivateMenu
000126  4621              MOV      r1,r4                 ;736
000128  4640              MOV      r0,r8                 ;736
00012a  f7fffffe          BL       _ClosePopup
00012e  f04f35ff          MOV      r5,#0xffffffff        ;737
000132  462a              MOV      r2,r5                 ;737
000134  4621              MOV      r1,r4                 ;737
000136  4640              MOV      r0,r8                 ;737
000138  f7fffffe          BL       _SetSelection
00013c  f8940026          LDRB     r0,[r4,#0x26]         ;738
000140  07c0              LSLS     r0,r0,#31             ;738
000142  d01a              BEQ      |L25.378|
000144  2000              MOVS     r0,#0                 ;741
000146  9000              STR      r0,[sp,#0]            ;741
000148  ab02              ADD      r3,sp,#8              ;741
00014a  aa01              ADD      r2,sp,#4              ;741
00014c  4621              MOV      r1,r4                 ;741
00014e  4640              MOV      r0,r8                 ;741
000150  f7fffffe          BL       _GetTopLevelMenu
000154  f9bd0004          LDRSH    r0,[sp,#4]            ;742
000158  f7fffffe          BL       WM_SetFocus
00015c  462a              MOV      r2,r5                 ;743
00015e  f9bd0004          LDRSH    r0,[sp,#4]            ;743
000162  9902              LDR      r1,[sp,#8]            ;743
000164  f7fffffe          BL       _SetSelection
000168  f9bd0004          LDRSH    r0,[sp,#4]            ;744
00016c  9902              LDR      r1,[sp,#8]            ;744
00016e  f7fffffe          BL       _ReleaseCapture
                  |L25.370|
000172  f8940026          LDRB     r0,[r4,#0x26]         ;747
000176  07c0              LSLS     r0,r0,#31             ;747
000178  d103              BNE      |L25.386|
                  |L25.378|
00017a  4621              MOV      r1,r4                 ;748
00017c  4640              MOV      r0,r8                 ;748
00017e  f7fffffe          BL       _DeselectItem
                  |L25.386|
000182  2001              MOVS     r0,#1                 ;754
000184  e7be              B        |L25.260|
;;;756    
                          ENDP


                          AREA ||i._HasEffect||, CODE, READONLY, ALIGN=1

                  _HasEffect PROC
;;;201    */
;;;202    static int _HasEffect(MENU_Handle hObj, MENU_Obj* pObj) {
000000  b510              PUSH     {r4,lr}
;;;203      if (!(pObj->Flags & MENU_SF_POPUP)) {
000002  f891205e          LDRB     r2,[r1,#0x5e]
000006  0612              LSLS     r2,r2,#24
000008  d404              BMI      |L26.20|
;;;204        if (_IsTopLevelMenu(hObj, pObj)) {
00000a  f7fffffe          BL       _IsTopLevelMenu
00000e  b108              CBZ      r0,|L26.20|
;;;205          return 0;
000010  2000              MOVS     r0,#0
;;;206        }
;;;207      }
;;;208      return 1;
;;;209    }
000012  bd10              POP      {r4,pc}
                  |L26.20|
000014  2001              MOVS     r0,#1                 ;208
000016  bd10              POP      {r4,pc}
;;;210    
                          ENDP


                          AREA ||i._IsTopLevelMenu||, CODE, READONLY, ALIGN=1

                  _IsTopLevelMenu PROC
;;;153    */
;;;154    static char _IsTopLevelMenu(MENU_Handle hObj, const MENU_Obj* pObj) {
000000  b510              PUSH     {r4,lr}
;;;155      if (MENU__SendMenuMessage(hObj, pObj->hOwner, MENU_IS_MENU, 0) == 0) {
000002  f9b1105c          LDRSH    r1,[r1,#0x5c]
000006  2300              MOVS     r3,#0
000008  2205              MOVS     r2,#5
00000a  f7fffffe          BL       MENU__SendMenuMessage
00000e  b108              CBZ      r0,|L27.20|
;;;156        return 1;
;;;157      }
;;;158      return 0;
000010  2000              MOVS     r0,#0
;;;159    }
000012  bd10              POP      {r4,pc}
                  |L27.20|
000014  2001              MOVS     r0,#1                 ;156
000016  bd10              POP      {r4,pc}
;;;160    
                          ENDP


                          AREA ||i._MoveSel||, CODE, READONLY, ALIGN=1

                  _MoveSel PROC
;;;962    */
;;;963    static void _MoveSel(MENU_Handle hObj, int Dir) {
000000  e92d5ff0          PUSH     {r4-r12,lr}
000004  4689              MOV      r9,r1
000006  4683              MOV      r11,r0
;;;964      MENU_Obj * pObj;
;;;965      int NewIndex, Index, NumItems, Cnt = 0;
000008  2600              MOVS     r6,#0
;;;966      pObj = (MENU_Obj*) GUI_ALLOC_h2p(hObj);
00000a  f7fffffe          BL       GUI_ALLOC_h2p
00000e  4605              MOV      r5,r0
;;;967      Index = pObj->Sel;
;;;968      NewIndex = -1;
;;;969      NumItems = pObj->ItemArray.NumItems;
000010  6ec4              LDR      r4,[r0,#0x6c]
000012  f8308f58          LDRH     r8,[r0,#0x58]!
000016  1e77              SUBS     r7,r6,#1              ;968
;;;970      do {
;;;971        MENU_ITEM * pItem;
;;;972        Index += Dir;
;;;973        if (Index >= NumItems) {
;;;974          Index = 0;
;;;975          Cnt++;
;;;976        } else if (Index < 0) {
;;;977          Index = NumItems - 1;
;;;978          Cnt++;
;;;979        }
;;;980        pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000018  4682              MOV      r10,r0
                  |L28.26|
00001a  444c              ADD      r4,r4,r9              ;972
00001c  4544              CMP      r4,r8                 ;973
00001e  db01              BLT      |L28.36|
000020  2400              MOVS     r4,#0                 ;974
000022  e003              B        |L28.44|
                  |L28.36|
000024  2c00              CMP      r4,#0                 ;976
000026  da02              BGE      |L28.46|
000028  f1a80401          SUB      r4,r8,#1              ;977
                  |L28.44|
00002c  1c76              ADDS     r6,r6,#1              ;977
                  |L28.46|
00002e  4621              MOV      r1,r4
000030  4650              MOV      r0,r10
000032  f7fffffe          BL       GUI_ARRAY_GetpItem
;;;981        if (!(pItem->Flags & MENU_IF_SEPARATOR)) {
000036  7900              LDRB     r0,[r0,#4]
000038  0780              LSLS     r0,r0,#30
00003a  d400              BMI      |L28.62|
;;;982          NewIndex = Index;
00003c  4627              MOV      r7,r4
                  |L28.62|
;;;983        }
;;;984      } while ((NewIndex < 0) && (Cnt < 2));
00003e  2f00              CMP      r7,#0
000040  da03              BGE      |L28.74|
000042  2e02              CMP      r6,#2
000044  dbe9              BLT      |L28.26|
;;;985      if (NewIndex >= 0) {
;;;986        _SetSelection(hObj, pObj, Index);
;;;987      }
;;;988    }
000046  e8bd9ff0          POP      {r4-r12,pc}
                  |L28.74|
00004a  4622              MOV      r2,r4                 ;986
00004c  4629              MOV      r1,r5                 ;986
00004e  4658              MOV      r0,r11                ;986
000050  e8bd5ff0          POP      {r4-r12,lr}           ;986
000054  f7ffbffe          B.W      _SetSelection
;;;989    
                          ENDP


                          AREA ||i._OnKey||, CODE, READONLY, ALIGN=1

                  _OnKey PROC
;;;1012   */
;;;1013   static int _OnKey(MENU_Handle hObj, MENU_Obj * pObj, int Key) {
000000  e92d5fff          PUSH     {r0-r12,lr}
000004  4680              MOV      r8,r0
;;;1014     int KeyOpen, KeyBack, KeyNext, KeyPrev, Index, SubSel = 0;
000006  2000              MOVS     r0,#0
;;;1015     MENU_ITEM * pItem;
;;;1016     MENU_Handle hObjTopLevel;
;;;1017     MENU_Obj * pObjTopLevel;
;;;1018     Index = pObj->Sel;
000008  9003              STR      r0,[sp,#0xc]
;;;1019     _GetTopLevelMenu(hObj, pObj, &hObjTopLevel, &pObjTopLevel, &SubSel);
00000a  a803              ADD      r0,sp,#0xc
00000c  f8d1b06c          LDR      r11,[r1,#0x6c]
000010  4614              MOV      r4,r2                 ;1013
000012  9000              STR      r0,[sp,#0]
000014  460d              MOV      r5,r1                 ;1013
000016  ab02              ADD      r3,sp,#8
000018  aa01              ADD      r2,sp,#4
00001a  4640              MOV      r0,r8
00001c  f7fffffe          BL       _GetTopLevelMenu
;;;1020     if (Index < 0) {
000020  f1bb0f00          CMP      r11,#0
000024  da0b              BGE      |L29.62|
;;;1021       if (Key != GUI_KEY_ESCAPE) {
000026  2c1b              CMP      r4,#0x1b
000028  d008              BEQ      |L29.60|
;;;1022         _SetSelection(hObj, pObj, 0);
00002a  2200              MOVS     r2,#0
00002c  4629              MOV      r1,r5
00002e  4640              MOV      r0,r8
000030  f7fffffe          BL       _SetSelection
;;;1023         _SetCapture(hObj, pObj);
000034  4629              MOV      r1,r5
000036  4640              MOV      r0,r8
000038  f7fffffe          BL       _SetCapture
                  |L29.60|
00003c  e09f              B        |L29.382|
                  |L29.62|
;;;1024       }
;;;1025       return 0;
;;;1026     }
;;;1027     if (pObj->Flags & MENU_CF_VERTICAL) {
00003e  f895005e          LDRB     r0,[r5,#0x5e]
000042  07c0              LSLS     r0,r0,#31
000044  d005              BEQ      |L29.82|
;;;1028       KeyOpen = GUI_KEY_RIGHT;
000046  2712              MOVS     r7,#0x12
;;;1029       KeyBack = GUI_KEY_LEFT;
000048  2610              MOVS     r6,#0x10
;;;1030       KeyNext = GUI_KEY_DOWN;
00004a  f04f0a13          MOV      r10,#0x13
;;;1031       KeyPrev = GUI_KEY_UP;
00004e  2011              MOVS     r0,#0x11
000050  e004              B        |L29.92|
                  |L29.82|
;;;1032     } else {
;;;1033       KeyOpen = GUI_KEY_DOWN;
000052  2713              MOVS     r7,#0x13
;;;1034       KeyBack = 0;
000054  2600              MOVS     r6,#0
;;;1035       KeyNext = GUI_KEY_RIGHT;
000056  f04f0a12          MOV      r10,#0x12
;;;1036       KeyPrev = GUI_KEY_LEFT;
00005a  2010              MOVS     r0,#0x10
                  |L29.92|
00005c  4681              MOV      r9,r0
;;;1037     }
;;;1038     pItem = (MENU_ITEM *)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
00005e  4659              MOV      r1,r11
000060  f1050058          ADD      r0,r5,#0x58
000064  f7fffffe          BL       GUI_ARRAY_GetpItem
;;;1039     if (pItem->hSubmenu && ((Key == KeyOpen) || (Key == GUI_KEY_ENTER))) {
000068  f9b01000          LDRSH    r1,[r0,#0]
00006c  b141              CBZ      r1,|L29.128|
00006e  42bc              CMP      r4,r7
000070  d001              BEQ      |L29.118|
000072  2c0d              CMP      r4,#0xd
000074  d106              BNE      |L29.132|
                  |L29.118|
;;;1040       /*
;;;1041        *  If the current menu item is a submenu and <ENTER> or KeyOpen has been pressed, open the submenu
;;;1042        */
;;;1043       _OpenMenu(hObj, pObj, Index, 0);
000076  2300              MOVS     r3,#0
000078  465a              MOV      r2,r11
00007a  4629              MOV      r1,r5
00007c  4640              MOV      r0,r8
00007e  e040              B        |L29.258|
                  |L29.128|
;;;1044     } else if (!pItem->hSubmenu && (Key == GUI_KEY_ENTER)) {
000080  2c0d              CMP      r4,#0xd
000082  d00b              BEQ      |L29.156|
                  |L29.132|
;;;1045       /*
;;;1046        *  If the current menu item is not a submenu and <ENTER> has been pressed,
;;;1047        *  set the focus to the top level menu, close the submenus and send an MENU_ON_ITEMSELECT message to the owner
;;;1048        */
;;;1049       WM_SetFocus(hObjTopLevel);
;;;1050       _ActivateItem(hObj, pObj, Index);
;;;1051     } else if (((hObjTopLevel != hObj) && !(pObjTopLevel->Flags & MENU_CF_VERTICAL) && (Key == KeyOpen) && (!pItem->hSubmenu)) ||
000084  f9bd0004          LDRSH    r0,[sp,#4]
;;;1052                ((hObjTopLevel != hObj) && !(pObjTopLevel->Flags & MENU_CF_VERTICAL) && (Key == KeyBack) && (hObjTopLevel == pObj->hOwner))) {
;;;1053       /*
;;;1054        *  If the current menu is not the top level menu and the top level menu is horizontal
;;;1055        *  and <GUI_KEY_RIGHT> or <GUI_KEY_LEFT> has been pressed close the current submenus,
;;;1056        *  move the selection of the top level menu to next/previous item and open it
;;;1057        */
;;;1058       pObj->Flags &= ~MENU_SF_ACTIVE;
;;;1059       /* Set focus to top level menu */
;;;1060       WM_SetFocus(hObjTopLevel);
;;;1061       /* Move selection of top level menu */
;;;1062       if (Key == KeyOpen) {
;;;1063         _MoveSel(hObjTopLevel, +1);
;;;1064       } else {
;;;1065         _MoveSel(hObjTopLevel, -1);
000088  f04f3bff          MOV      r11,#0xffffffff
00008c  4540              CMP      r0,r8                 ;1051
00008e  d012              BEQ      |L29.182|
000090  9a02              LDR      r2,[sp,#8]            ;1051
000092  f892205e          LDRB     r2,[r2,#0x5e]         ;1051
000096  07d2              LSLS     r2,r2,#31             ;1051
000098  d00a              BEQ      |L29.176|
00009a  e00c              B        |L29.182|
                  |L29.156|
00009c  f9bd0004          LDRSH    r0,[sp,#4]            ;1049
0000a0  f7fffffe          BL       WM_SetFocus
0000a4  465a              MOV      r2,r11                ;1050
0000a6  4629              MOV      r1,r5                 ;1050
0000a8  4640              MOV      r0,r8                 ;1050
0000aa  f7fffffe          BL       _ActivateItem
0000ae  e066              B        |L29.382|
                  |L29.176|
0000b0  42bc              CMP      r4,r7                 ;1051
0000b2  d100              BNE      |L29.182|
0000b4  b161              CBZ      r1,|L29.208|
                  |L29.182|
0000b6  4540              CMP      r0,r8                 ;1052
0000b8  d026              BEQ      |L29.264|
0000ba  9a02              LDR      r2,[sp,#8]            ;1052
0000bc  f892205e          LDRB     r2,[r2,#0x5e]         ;1052
0000c0  07d2              LSLS     r2,r2,#31             ;1052
0000c2  d121              BNE      |L29.264|
0000c4  42b4              CMP      r4,r6                 ;1052
0000c6  d11f              BNE      |L29.264|
0000c8  f9b5205c          LDRSH    r2,[r5,#0x5c]         ;1052
0000cc  4282              CMP      r2,r0                 ;1052
0000ce  d11b              BNE      |L29.264|
                  |L29.208|
0000d0  f8351f5e          LDRH     r1,[r5,#0x5e]!        ;1058
0000d4  f0210140          BIC      r1,r1,#0x40           ;1058
0000d8  8029              STRH     r1,[r5,#0]            ;1058
0000da  f7fffffe          BL       WM_SetFocus
0000de  42bc              CMP      r4,r7                 ;1062
0000e0  d101              BNE      |L29.230|
0000e2  2101              MOVS     r1,#1                 ;1063
0000e4  e000              B        |L29.232|
                  |L29.230|
0000e6  4659              MOV      r1,r11
                  |L29.232|
0000e8  f9bd0004          LDRSH    r0,[sp,#4]
0000ec  f7fffffe          BL       _MoveSel
;;;1066       }
;;;1067       /* Open top level menu */
;;;1068       _OpenMenu(hObjTopLevel, pObjTopLevel, pObjTopLevel->Sel, (Key == KeyBack) ? SubSel : 0);
0000f0  42b4              CMP      r4,r6
0000f2  d101              BNE      |L29.248|
0000f4  9b03              LDR      r3,[sp,#0xc]
0000f6  e000              B        |L29.250|
                  |L29.248|
0000f8  2300              MOVS     r3,#0
                  |L29.250|
0000fa  9902              LDR      r1,[sp,#8]
0000fc  f9bd0004          LDRSH    r0,[sp,#4]
000100  6eca              LDR      r2,[r1,#0x6c]
                  |L29.258|
000102  f7fffffe          BL       _OpenMenu
000106  e03a              B        |L29.382|
                  |L29.264|
;;;1069     } else if ((hObjTopLevel != hObj) && 
000108  4540              CMP      r0,r8
00010a  d018              BEQ      |L29.318|
;;;1070                ((Key == GUI_KEY_ESCAPE) || ((Key == KeyBack) && ((!(pObjTopLevel->Flags & MENU_CF_VERTICAL)) && (!pItem->hSubmenu) && (hObjTopLevel != pObj->hOwner)) || (pObjTopLevel->Flags & MENU_CF_VERTICAL)))) {
00010c  2c1b              CMP      r4,#0x1b
00010e  d011              BEQ      |L29.308|
000110  42b4              CMP      r4,r6
000112  d10a              BNE      |L29.298|
000114  9a02              LDR      r2,[sp,#8]
000116  f892205e          LDRB     r2,[r2,#0x5e]
00011a  07d2              LSLS     r2,r2,#31
00011c  d10a              BNE      |L29.308|
00011e  b971              CBNZ     r1,|L29.318|
000120  f9b5105c          LDRSH    r1,[r5,#0x5c]
000124  4281              CMP      r1,r0
000126  d105              BNE      |L29.308|
000128  e009              B        |L29.318|
                  |L29.298|
00012a  9902              LDR      r1,[sp,#8]
00012c  f891105e          LDRB     r1,[r1,#0x5e]
000130  07c9              LSLS     r1,r1,#31
000132  d004              BEQ      |L29.318|
                  |L29.308|
;;;1071       /*
;;;1072        *  If the current menu is not the top level menu and the top level menu is vertical and <GUI_KEY_LEFT> has been pressed
;;;1073        *  or the top level menu is vertical or horizontal and <GUI_KEY_ESCAPE> has been pressed,
;;;1074        *  close the current submenu
;;;1075        */
;;;1076       WM_SetFocus(pObj->hOwner);
000134  f9b5005c          LDRSH    r0,[r5,#0x5c]
000138  f7fffffe          BL       WM_SetFocus
00013c  e01f              B        |L29.382|
                  |L29.318|
;;;1077     } else if ((hObjTopLevel == hObj) && (Key == GUI_KEY_ESCAPE)) {
00013e  4540              CMP      r0,r8
000140  d101              BNE      |L29.326|
000142  2c1b              CMP      r4,#0x1b
000144  d007              BEQ      |L29.342|
                  |L29.326|
;;;1078       /*
;;;1079        *  If the current menu is the top level menu and <GUI_KEY_ESCAPE> has been pressed,
;;;1080        *  unselect the menu and release capture
;;;1081        */
;;;1082       _SetSelection(hObj, pObj, -1);
;;;1083       _ReleaseCapture(hObj, pObj);
;;;1084     } else if (Key == KeyNext) {
000146  4554              CMP      r4,r10
000148  d10f              BNE      |L29.362|
;;;1085       /*
;;;1086        *  If KeyNext has been pressed move the selection to the next menu item
;;;1087        */
;;;1088       _CloseSubmenu(hObj, pObj);
00014a  4629              MOV      r1,r5
00014c  4640              MOV      r0,r8
00014e  f7fffffe          BL       _CloseSubmenu
;;;1089       _MoveSel(hObj, +1);
000152  2101              MOVS     r1,#1
000154  e010              B        |L29.376|
                  |L29.342|
000156  465a              MOV      r2,r11                ;1082
000158  4629              MOV      r1,r5                 ;1082
00015a  4640              MOV      r0,r8                 ;1082
00015c  f7fffffe          BL       _SetSelection
000160  4629              MOV      r1,r5                 ;1083
000162  4640              MOV      r0,r8                 ;1083
000164  f7fffffe          BL       _ReleaseCapture
000168  e009              B        |L29.382|
                  |L29.362|
;;;1090     } else if (Key == KeyPrev) {
00016a  454c              CMP      r4,r9
00016c  d10b              BNE      |L29.390|
;;;1091       /*
;;;1092        *  If KeyPrev has been pressed move the selection to the previous menu item
;;;1093        */
;;;1094       _CloseSubmenu(hObj, pObj);
00016e  4629              MOV      r1,r5
000170  4640              MOV      r0,r8
000172  f7fffffe          BL       _CloseSubmenu
;;;1095       _MoveSel(hObj, -1);
000176  4659              MOV      r1,r11
                  |L29.376|
000178  4640              MOV      r0,r8
00017a  f7fffffe          BL       _MoveSel
                  |L29.382|
;;;1096     } else {
;;;1097       return 1;
;;;1098     }
;;;1099     return 0;
00017e  2000              MOVS     r0,#0
                  |L29.384|
;;;1100   }
000180  b004              ADD      sp,sp,#0x10
000182  e8bd9ff0          POP      {r4-r12,pc}
                  |L29.390|
000186  2001              MOVS     r0,#1                 ;1097
000188  e7fa              B        |L29.384|
;;;1101   
                          ENDP


                          AREA ||i._OnMenu||, CODE, READONLY, ALIGN=1

                  _OnMenu PROC
;;;786    */
;;;787    static void _OnMenu(MENU_Handle hObj, MENU_Obj* pObj, WM_MESSAGE* pMsg) {
000000  b570              PUSH     {r4-r6,lr}
000002  4606              MOV      r6,r0
000004  6890              LDR      r0,[r2,#8]
000006  460c              MOV      r4,r1
000008  4615              MOV      r5,r2
00000a  2800              CMP      r0,#0
00000c  d03f              BEQ      |L30.142|
;;;788      const MENU_MSG_DATA* pData = (const MENU_MSG_DATA*)pMsg->Data.p;
;;;789      if (pData) {
;;;790        switch (pData->MsgType) {
00000e  8800              LDRH     r0,[r0,#0]
000010  2806              CMP      r0,#6
000012  d23c              BCS      |L30.142|
000014  e8dff000          TBB      [pc,r0]
000018  030f0f1d          DCB      0x03,0x0f,0x0f,0x1d
00001c  3339              DCB      0x33,0x39
;;;791        case MENU_ON_ITEMSELECT:
;;;792          _DeactivateMenu(hObj, pObj);
00001e  4621              MOV      r1,r4
000020  4630              MOV      r0,r6
000022  f7fffffe          BL       _DeactivateMenu
;;;793          _DeselectItem(hObj, pObj);
000026  4621              MOV      r1,r4
000028  4630              MOV      r0,r6
00002a  f7fffffe          BL       _DeselectItem
;;;794          _ClosePopup(hObj, pObj);
00002e  4621              MOV      r1,r4
000030  4630              MOV      r0,r6
000032  f7fffffe          BL       _ClosePopup
;;;795          /* No break here. We need to forward message to owner. */
;;;796        case MENU_ON_INITMENU:
;;;797        case MENU_ON_INITSUBMENU:
;;;798          /* Forward message to owner. */
;;;799          {
;;;800            WM_HWIN hOwner;
;;;801            hOwner = pObj->hOwner ? pObj->hOwner : WM_GetParent(hObj);
000036  f9b4005c          LDRSH    r0,[r4,#0x5c]
00003a  b910              CBNZ     r0,|L30.66|
00003c  4630              MOV      r0,r6
00003e  f7fffffe          BL       WM_GetParent
                  |L30.66|
;;;802            if (hOwner) {
000042  2800              CMP      r0,#0
000044  d023              BEQ      |L30.142|
;;;803              pMsg->hWinSrc = hObj;
000046  80ee              STRH     r6,[r5,#6]
;;;804              WM__SendMessage(hOwner, pMsg);
000048  4629              MOV      r1,r5
00004a  e8bd4070          POP      {r4-r6,lr}
00004e  f7ffbffe          B.W      WM__SendMessage
;;;805            }
;;;806          }
;;;807          break;
;;;808        case MENU_ON_OPEN:
;;;809          pObj->Sel = -1;
000052  f04f30ff          MOV      r0,#0xffffffff
;;;810          pObj->IsSubmenuActive = 0;
000056  66e0              STR      r0,[r4,#0x6c]
000058  2000              MOVS     r0,#0
00005a  f8840060          STRB     r0,[r4,#0x60]
;;;811          pObj->Flags |= MENU_SF_ACTIVE | MENU_SF_OPEN_ON_POINTEROVER;
00005e  f8b4005e          LDRH     r0,[r4,#0x5e]
;;;812          _SetCapture(hObj, pObj);
000062  4621              MOV      r1,r4
000064  f0400042          ORR      r0,r0,#0x42           ;811
000068  f8a4005e          STRH     r0,[r4,#0x5e]         ;811
00006c  4630              MOV      r0,r6
00006e  f7fffffe          BL       _SetCapture
;;;813          MENU__ResizeMenu(hObj, pObj);
000072  4621              MOV      r1,r4
000074  4630              MOV      r0,r6
000076  e8bd4070          POP      {r4-r6,lr}
00007a  f7ffbffe          B.W      MENU__ResizeMenu
;;;814          break;
;;;815        case MENU_ON_CLOSE:
;;;816          _CloseSubmenu(hObj, pObj);
00007e  4621              MOV      r1,r4
000080  4630              MOV      r0,r6
000082  e8bd4070          POP      {r4-r6,lr}
000086  f7ffbffe          B.W      _CloseSubmenu
;;;817          break;
;;;818        case MENU_IS_MENU:
;;;819          pMsg->Data.v = 1;
00008a  2001              MOVS     r0,#1
00008c  6090              STR      r0,[r2,#8]
                  |L30.142|
;;;820          break;
;;;821        }
;;;822      }
;;;823    }
00008e  bd70              POP      {r4-r6,pc}
;;;824    
                          ENDP


                          AREA ||i._OnPaint||, CODE, READONLY, ALIGN=2

                  _OnPaint PROC
;;;880    */
;;;881    static void _OnPaint(MENU_Handle hObj, MENU_Obj* pObj) {
000000  e92d4ff3          PUSH     {r0,r1,r4-r11,lr}
000004  b08f              SUB      sp,sp,#0x3c
000006  460c              MOV      r4,r1
;;;882      GUI_RECT FillRect, TextRect;
;;;883      MENU_ITEM* pItem;
;;;884      unsigned TextWidth, NumItems, i;
;;;885      U8 BorderLeft   = pObj->Props.aBorder[MENU_BI_LEFT];
000008  f8915050          LDRB     r5,[r1,#0x50]
;;;886      U8 BorderTop    = pObj->Props.aBorder[MENU_BI_TOP];
00000c  f8916052          LDRB     r6,[r1,#0x52]
;;;887      int FontHeight  = GUI_GetYDistOfFont(pObj->Props.pFont);
000010  6d48              LDR      r0,[r1,#0x54]
000012  f7fffffe          BL       GUI_GetYDistOfFont
000016  4683              MOV      r11,r0
;;;888      int EffectSize  = _GetEffectSize(hObj, pObj);
000018  4621              MOV      r1,r4
00001a  980f              LDR      r0,[sp,#0x3c]
00001c  f7fffffe          BL       _GetEffectSize
000020  4681              MOV      r9,r0
;;;889      NumItems = MENU__GetNumItems(pObj);
000022  4620              MOV      r0,r4
000024  f7fffffe          BL       MENU__GetNumItems
000028  4607              MOV      r7,r0
;;;890      WM__GetClientRectWin(&pObj->Widget.Win, &FillRect);
00002a  4669              MOV      r1,sp
00002c  4620              MOV      r0,r4
00002e  f7fffffe          BL       WM__GetClientRectWin
;;;891      GUI__ReduceRect(&FillRect, &FillRect, EffectSize);
000032  4669              MOV      r1,sp
000034  464a              MOV      r2,r9
000036  4608              MOV      r0,r1
000038  f7fffffe          BL       GUI__ReduceRect
;;;892      GUI_SetFont(pObj->Props.pFont);
00003c  6d60              LDR      r0,[r4,#0x54]
00003e  f7fffffe          BL       GUI_SetFont
;;;893      if (pObj->Flags & MENU_SF_VERTICAL) {
000042  f894005e          LDRB     r0,[r4,#0x5e]
000046  07c1              LSLS     r1,r0,#31
;;;894        int ItemHeight, xSize;
;;;895        xSize = _CalcMenuSizeX(hObj, pObj);
;;;896        FillRect.x1 = xSize - EffectSize - 1;
;;;897        TextRect.x0 = FillRect.x0 + BorderLeft;
;;;898        for (i = 0; i < NumItems; i++) {
;;;899          pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, i);
000048  f1040058          ADD      r0,r4,#0x58
;;;900          ItemHeight = _GetItemHeight(hObj, pObj, i);
;;;901          _SetPaintColors(pObj, pItem, i);
;;;902          FillRect.y1 = FillRect.y0 + ItemHeight - 1;
;;;903          if (pItem->Flags & MENU_IF_SEPARATOR) {
;;;904            GUI_ClearRectEx(&FillRect);
;;;905            GUI_SetColor(0x7C7C7C);
;;;906            GUI_DrawHLine(FillRect.y0 + BorderTop + 1, FillRect.x0 + 2, FillRect.x1 - 2);
;;;907          } else {
;;;908            TextWidth = pItem->TextWidth;
;;;909            TextRect.x1 = TextRect.x0 + TextWidth - 1;
;;;910            TextRect.y0 = FillRect.y0 + BorderTop;
;;;911            TextRect.y1 = TextRect.y0 + FontHeight - 1;
;;;912            WIDGET__FillStringInRect(pItem->acText, &FillRect, &TextRect, &TextRect);
;;;913          }
;;;914          FillRect.y0 += ItemHeight;
;;;915        }
;;;916      } else {
;;;917        int ItemWidth, ySize;
;;;918        ySize = _CalcMenuSizeY(hObj, pObj);
00004c  9009              STR      r0,[sp,#0x24]
00004e  980f              LDR      r0,[sp,#0x3c]         ;893
000050  4621              MOV      r1,r4
000052  d05c              BEQ      |L31.270|
000054  f7fffffe          BL       _CalcMenuSizeX
000058  eba00009          SUB      r0,r0,r9              ;896
00005c  1e40              SUBS     r0,r0,#1              ;896
00005e  f8ad0004          STRH     r0,[sp,#4]            ;896
000062  f8bd0000          LDRH     r0,[sp,#0]            ;897
000066  4428              ADD      r0,r0,r5              ;897
000068  f8ad0008          STRH     r0,[sp,#8]            ;897
00006c  2500              MOVS     r5,#0                 ;898
00006e  e04b              B        |L31.264|
                  |L31.112|
000070  4629              MOV      r1,r5                 ;899
000072  9809              LDR      r0,[sp,#0x24]         ;899
000074  f7fffffe          BL       GUI_ARRAY_GetpItem
000078  4680              MOV      r8,r0                 ;899
00007a  462a              MOV      r2,r5                 ;900
00007c  4621              MOV      r1,r4                 ;900
00007e  980f              LDR      r0,[sp,#0x3c]         ;900
000080  f7fffffe          BL       _GetItemHeight
000084  4682              MOV      r10,r0                ;900
000086  462a              MOV      r2,r5                 ;901
000088  4641              MOV      r1,r8                 ;901
00008a  4620              MOV      r0,r4                 ;901
00008c  f7fffffe          BL       _SetPaintColors
000090  f9bd1002          LDRSH    r1,[sp,#2]            ;902
000094  f1aa0001          SUB      r0,r10,#1             ;902
000098  4408              ADD      r0,r0,r1              ;902
00009a  f8ad0006          STRH     r0,[sp,#6]            ;902
00009e  f8980004          LDRB     r0,[r8,#4]            ;903
0000a2  0780              LSLS     r0,r0,#30             ;903
0000a4  d512              BPL      |L31.204|
0000a6  4668              MOV      r0,sp                 ;904
0000a8  f7fffffe          BL       GUI_ClearRectEx
0000ac  485d              LDR      r0,|L31.548|
0000ae  f7fffffe          BL       GUI_SetColor
0000b2  f9bd2004          LDRSH    r2,[sp,#4]            ;906
0000b6  f9bd1000          LDRSH    r1,[sp,#0]            ;906
0000ba  f9bd3002          LDRSH    r3,[sp,#2]            ;906
0000be  1c70              ADDS     r0,r6,#1              ;906
0000c0  4418              ADD      r0,r0,r3              ;906
0000c2  1c89              ADDS     r1,r1,#2              ;906
0000c4  1e92              SUBS     r2,r2,#2              ;906
0000c6  f7fffffe          BL       GUI_DrawHLine
0000ca  e016              B        |L31.250|
                  |L31.204|
0000cc  f8b80008          LDRH     r0,[r8,#8]            ;908
0000d0  f8bd2008          LDRH     r2,[sp,#8]            ;909
0000d4  1e40              SUBS     r0,r0,#1              ;909
0000d6  4410              ADD      r0,r0,r2              ;909
0000d8  f8ad000c          STRH     r0,[sp,#0xc]          ;909
0000dc  1988              ADDS     r0,r1,r6              ;910
0000de  f8ad000a          STRH     r0,[sp,#0xa]          ;910
0000e2  f1ab0101          SUB      r1,r11,#1             ;911
0000e6  4408              ADD      r0,r0,r1              ;911
0000e8  f8ad000e          STRH     r0,[sp,#0xe]          ;911
0000ec  ab02              ADD      r3,sp,#8              ;912
0000ee  461a              MOV      r2,r3                 ;912
0000f0  4669              MOV      r1,sp                 ;912
0000f2  f108000c          ADD      r0,r8,#0xc            ;912
0000f6  f7fffffe          BL       WIDGET__FillStringInRect
                  |L31.250|
0000fa  f8bd1002          LDRH     r1,[sp,#2]            ;914
0000fe  1c6d              ADDS     r5,r5,#1              ;914
000100  eb01000a          ADD      r0,r1,r10             ;914
000104  f8ad0002          STRH     r0,[sp,#2]            ;914
                  |L31.264|
000108  42bd              CMP      r5,r7                 ;898
00010a  d3b1              BCC      |L31.112|
00010c  e059              B        |L31.450|
                  |L31.270|
00010e  f7fffffe          BL       _CalcMenuSizeY
;;;919        FillRect.y1 = ySize - EffectSize - 1;
000112  eba00009          SUB      r0,r0,r9
000116  1e40              SUBS     r0,r0,#1
000118  f8ad0006          STRH     r0,[sp,#6]
;;;920        TextRect.y0 = FillRect.y0 + BorderTop;
00011c  f8bd0002          LDRH     r0,[sp,#2]
;;;921        TextRect.y1 = TextRect.y0 + FontHeight - 1;
000120  f1ab0101          SUB      r1,r11,#1
000124  4430              ADD      r0,r0,r6              ;920
000126  f8ad000a          STRH     r0,[sp,#0xa]          ;920
00012a  4408              ADD      r0,r0,r1
00012c  f8ad000e          STRH     r0,[sp,#0xe]
;;;922        for (i = 0; i < NumItems; i++) {
000130  2600              MOVS     r6,#0
000132  e044              B        |L31.446|
                  |L31.308|
;;;923          pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, i);
000134  4631              MOV      r1,r6
000136  9809              LDR      r0,[sp,#0x24]
000138  f7fffffe          BL       GUI_ARRAY_GetpItem
00013c  4680              MOV      r8,r0
;;;924          ItemWidth = _GetItemWidth(hObj, pObj, i);
00013e  4632              MOV      r2,r6
000140  4621              MOV      r1,r4
000142  980f              LDR      r0,[sp,#0x3c]
000144  f7fffffe          BL       _GetItemWidth
000148  4682              MOV      r10,r0
;;;925          _SetPaintColors(pObj, pItem, i);
00014a  4632              MOV      r2,r6
00014c  4641              MOV      r1,r8
00014e  4620              MOV      r0,r4
000150  f7fffffe          BL       _SetPaintColors
;;;926          FillRect.x1 = FillRect.x0 + ItemWidth - 1;
000154  f9bd2000          LDRSH    r2,[sp,#0]
000158  f1aa0001          SUB      r0,r10,#1
00015c  4410              ADD      r0,r0,r2
00015e  f8ad0004          STRH     r0,[sp,#4]
;;;927          if (pItem->Flags & MENU_IF_SEPARATOR) {
000162  f8980004          LDRB     r0,[r8,#4]
000166  0780              LSLS     r0,r0,#30
000168  d512              BPL      |L31.400|
;;;928            GUI_ClearRectEx(&FillRect);
00016a  4668              MOV      r0,sp
00016c  f7fffffe          BL       GUI_ClearRectEx
;;;929            GUI_SetColor(0x7C7C7C);
000170  482c              LDR      r0,|L31.548|
000172  f7fffffe          BL       GUI_SetColor
;;;930            GUI_DrawVLine(FillRect.x0 + BorderLeft + 1, FillRect.y0 + 2, FillRect.y1 - 2);
000176  f9bd2006          LDRSH    r2,[sp,#6]
00017a  f9bd1002          LDRSH    r1,[sp,#2]
00017e  f9bd3000          LDRSH    r3,[sp,#0]
000182  1c68              ADDS     r0,r5,#1
000184  4418              ADD      r0,r0,r3
000186  1c89              ADDS     r1,r1,#2
000188  1e92              SUBS     r2,r2,#2
00018a  f7fffffe          BL       GUI_DrawVLine
00018e  e00f              B        |L31.432|
                  |L31.400|
;;;931          } else {
;;;932            TextWidth = pItem->TextWidth;
000190  f8b81008          LDRH     r1,[r8,#8]
;;;933            TextRect.x0 = FillRect.x0 + BorderLeft;
000194  1950              ADDS     r0,r2,r5
000196  f8ad0008          STRH     r0,[sp,#8]
00019a  1e49              SUBS     r1,r1,#1
;;;934            TextRect.x1 = TextRect.x0 + TextWidth - 1;
00019c  4408              ADD      r0,r0,r1
00019e  f8ad000c          STRH     r0,[sp,#0xc]
;;;935            WIDGET__FillStringInRect(pItem->acText, &FillRect, &TextRect, &TextRect);
0001a2  ab02              ADD      r3,sp,#8
0001a4  461a              MOV      r2,r3
0001a6  4669              MOV      r1,sp
0001a8  f108000c          ADD      r0,r8,#0xc
0001ac  f7fffffe          BL       WIDGET__FillStringInRect
                  |L31.432|
;;;936          }
;;;937          FillRect.x0 += ItemWidth;
0001b0  f8bd1000          LDRH     r1,[sp,#0]
0001b4  1c76              ADDS     r6,r6,#1
0001b6  eb01000a          ADD      r0,r1,r10
0001ba  f8ad0000          STRH     r0,[sp,#0]
                  |L31.446|
0001be  42be              CMP      r6,r7                 ;922
0001c0  d3b8              BCC      |L31.308|
                  |L31.450|
;;;938        }
;;;939      }
;;;940      if (pObj->Width || pObj->Height) {
0001c2  6e60              LDR      r0,[r4,#0x64]
0001c4  b908              CBNZ     r0,|L31.458|
0001c6  6ea0              LDR      r0,[r4,#0x68]
0001c8  b1f8              CBZ      r0,|L31.522|
                  |L31.458|
;;;941        GUI_RECT r;
;;;942        WM__GetClientRectWin(&pObj->Widget.Win, &r);
0001ca  a905              ADD      r1,sp,#0x14
0001cc  4620              MOV      r0,r4
0001ce  f7fffffe          BL       WM__GetClientRectWin
;;;943        GUI__ReduceRect(&r, &r, EffectSize);
0001d2  a905              ADD      r1,sp,#0x14
0001d4  464a              MOV      r2,r9
0001d6  4608              MOV      r0,r1
0001d8  f7fffffe          BL       GUI__ReduceRect
;;;944        GUI_SetBkColor(pObj->Props.aBkColor[MENU_CI_ENABLED]);
0001dc  6be0              LDR      r0,[r4,#0x3c]
0001de  f7fffffe          BL       GUI_SetBkColor
;;;945        GUI_ClearRect(FillRect.x1 + 1, EffectSize, r.x1, FillRect.y1);
0001e2  f9bd0004          LDRSH    r0,[sp,#4]
0001e6  f9bd3006          LDRSH    r3,[sp,#6]
0001ea  f9bd2018          LDRSH    r2,[sp,#0x18]
0001ee  4649              MOV      r1,r9
0001f0  1c40              ADDS     r0,r0,#1
0001f2  f7fffffe          BL       GUI_ClearRect
;;;946        GUI_ClearRect(EffectSize, FillRect.y1 + 1, r.x1, r.y1);
0001f6  f9bd1006          LDRSH    r1,[sp,#6]
0001fa  f9bd301a          LDRSH    r3,[sp,#0x1a]
0001fe  f9bd2018          LDRSH    r2,[sp,#0x18]
000202  4648              MOV      r0,r9
000204  1c49              ADDS     r1,r1,#1
000206  f7fffffe          BL       GUI_ClearRect
                  |L31.522|
;;;947      }
;;;948      /* Draw 3D effect (if configured) */
;;;949      if (_HasEffect(hObj, pObj)) {
00020a  4621              MOV      r1,r4
00020c  980f              LDR      r0,[sp,#0x3c]
00020e  f7fffffe          BL       _HasEffect
000212  2800              CMP      r0,#0
000214  d002              BEQ      |L31.540|
;;;950        pObj->Widget.pEffect->pfDrawUp();
000216  6a20              LDR      r0,[r4,#0x20]
000218  6800              LDR      r0,[r0,#0]
00021a  4780              BLX      r0
                  |L31.540|
;;;951      }
;;;952    }
00021c  b011              ADD      sp,sp,#0x44
00021e  e8bd8ff0          POP      {r4-r11,pc}
;;;953    
                          ENDP

000222  0000              DCW      0x0000
                  |L31.548|
                          DCD      0x007c7c7c

                          AREA ||i._OpenMenu||, CODE, READONLY, ALIGN=1

                  _OpenMenu PROC
;;;993    */
;;;994    static void _OpenMenu(MENU_Handle hObj, MENU_Obj * pObj, int Index, int SubSel) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  460e              MOV      r6,r1
000006  4680              MOV      r8,r0
000008  461c              MOV      r4,r3
00000a  4617              MOV      r7,r2
;;;995      MENU_ITEM * pItem;
;;;996      MENU_Obj  * pSubObj;
;;;997      pItem = (MENU_ITEM *)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
00000c  4611              MOV      r1,r2
00000e  f1060058          ADD      r0,r6,#0x58
000012  f7fffffe          BL       GUI_ARRAY_GetpItem
000016  4605              MOV      r5,r0
;;;998      pObj->Flags |= MENU_SF_ACTIVE;
000018  f8b6005e          LDRH     r0,[r6,#0x5e]
;;;999      _OpenSubmenu(hObj, pObj, Index);
00001c  463a              MOV      r2,r7
00001e  f0400040          ORR      r0,r0,#0x40           ;998
000022  f8a6005e          STRH     r0,[r6,#0x5e]         ;998
000026  4631              MOV      r1,r6
000028  4640              MOV      r0,r8
00002a  f7fffffe          BL       _OpenSubmenu
;;;1000     pSubObj = (MENU_Obj *) GUI_ALLOC_h2p(pItem->hSubmenu);
00002e  f9b50000          LDRSH    r0,[r5,#0]
000032  f7fffffe          BL       GUI_ALLOC_h2p
000036  4601              MOV      r1,r0
;;;1001     if (SubSel >= pSubObj->ItemArray.NumItems) {
000038  f8b00058          LDRH     r0,[r0,#0x58]
00003c  42a0              CMP      r0,r4
00003e  dc00              BGT      |L32.66|
000040  1e44              SUBS     r4,r0,#1
                  |L32.66|
;;;1002       SubSel = pSubObj->ItemArray.NumItems - 1;
;;;1003     }
;;;1004     _SetSelection(pItem->hSubmenu, pSubObj, SubSel);
000042  f9b50000          LDRSH    r0,[r5,#0]
000046  4622              MOV      r2,r4
000048  f7fffffe          BL       _SetSelection
;;;1005     WM_SetFocus(pItem->hSubmenu);
00004c  f9b50000          LDRSH    r0,[r5,#0]
000050  f7fffffe          BL       WM_SetFocus
;;;1006     _SetSelection(hObj, pObj, Index);
000054  463a              MOV      r2,r7
000056  4631              MOV      r1,r6
000058  4640              MOV      r0,r8
00005a  e8bd41f0          POP      {r4-r8,lr}
00005e  f7ffbffe          B.W      _SetSelection
;;;1007   }
;;;1008   
                          ENDP


                          AREA ||i._OpenSubmenu||, CODE, READONLY, ALIGN=1

                  _OpenSubmenu PROC
;;;477    */
;;;478    static void _OpenSubmenu(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000000  e92d4ff8          PUSH     {r3-r11,lr}
000004  4682              MOV      r10,r0
;;;479      if (pObj->Flags & MENU_SF_ACTIVE) {
000006  f891005e          LDRB     r0,[r1,#0x5e]
00000a  4617              MOV      r7,r2                 ;478
00000c  460c              MOV      r4,r1                 ;478
00000e  0640              LSLS     r0,r0,#25
000010  d57e              BPL      |L33.272|
;;;480        MENU_ITEM* pItem;
;;;481        char PrevActiveSubmenu;
;;;482        PrevActiveSubmenu = pObj->IsSubmenuActive;
000012  f8940060          LDRB     r0,[r4,#0x60]
;;;483        /* Close previous submenu (if needed) */
;;;484        _CloseSubmenu(hObj, pObj);
000016  9000              STR      r0,[sp,#0]
000018  4650              MOV      r0,r10
00001a  f7fffffe          BL       _CloseSubmenu
;;;485        pItem = (MENU_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
00001e  4639              MOV      r1,r7
000020  f1040058          ADD      r0,r4,#0x58
000024  f7fffffe          BL       GUI_ARRAY_GetpItem
000028  4606              MOV      r6,r0
;;;486        if (pItem->hSubmenu) {
00002a  8800              LDRH     r0,[r0,#0]
00002c  2800              CMP      r0,#0
00002e  d06f              BEQ      |L33.272|
;;;487          if ((pItem->Flags & MENU_IF_DISABLED) == 0) {
000030  7930              LDRB     r0,[r6,#4]
000032  07c0              LSLS     r0,r0,#31
000034  d16c              BNE      |L33.272|
;;;488            int x, y, EffectSize;
;;;489            /* Calculate position of submenu */
;;;490            EffectSize = _GetEffectSize(hObj, pObj);
000036  4621              MOV      r1,r4
000038  4650              MOV      r0,r10
00003a  f7fffffe          BL       _GetEffectSize
00003e  4683              MOV      r11,r0
;;;491            _GetItemPos(hObj, pObj, Index, &x, &y);
000040  4650              MOV      r0,r10
000042  4621              MOV      r1,r4
000044  f7fffffe          BL       _GetEffectSize
000048  4605              MOV      r5,r0
00004a  f894005e          LDRB     r0,[r4,#0x5e]
00004e  f04f0900          MOV      r9,#0
000052  07c0              LSLS     r0,r0,#31
000054  4648              MOV      r0,r9
000056  d108              BNE      |L33.106|
000058  e016              B        |L33.136|
                  |L33.90|
00005a  4602              MOV      r2,r0
00005c  4621              MOV      r1,r4
00005e  4650              MOV      r0,r10
000060  f7fffffe          BL       _GetItemHeight
000064  4481              ADD      r9,r9,r0
000066  f1080001          ADD      r0,r8,#1
                  |L33.106|
00006a  4680              MOV      r8,r0
00006c  42b8              CMP      r0,r7
00006e  dbf4              BLT      |L33.90|
000070  462f              MOV      r7,r5
000072  eb050809          ADD      r8,r5,r9
000076  e00d              B        |L33.148|
                  |L33.120|
000078  4602              MOV      r2,r0
00007a  4621              MOV      r1,r4
00007c  4650              MOV      r0,r10
00007e  f7fffffe          BL       _GetItemWidth
000082  4481              ADD      r9,r9,r0
000084  f1080001          ADD      r0,r8,#1
                  |L33.136|
000088  4680              MOV      r8,r0
00008a  42b8              CMP      r0,r7
00008c  dbf4              BLT      |L33.120|
00008e  eb050709          ADD      r7,r5,r9
000092  46a8              MOV      r8,r5
                  |L33.148|
;;;492            if (pObj->Flags & MENU_SF_VERTICAL) {
000094  f894005e          LDRB     r0,[r4,#0x5e]
;;;493              x += _CalcMenuSizeX(hObj, pObj) - (_GetEffectSize(hObj, pObj) << 1);
;;;494              y -= EffectSize;
;;;495            } else {
;;;496              y += _CalcMenuSizeY(hObj, pObj) - (_GetEffectSize(hObj, pObj) << 1);
000098  4621              MOV      r1,r4
00009a  07c0              LSLS     r0,r0,#31             ;492
00009c  4650              MOV      r0,r10
00009e  d00c              BEQ      |L33.186|
0000a0  f7fffffe          BL       _CalcMenuSizeX
0000a4  4605              MOV      r5,r0                 ;493
0000a6  4621              MOV      r1,r4                 ;493
0000a8  4650              MOV      r0,r10                ;493
0000aa  f7fffffe          BL       _GetEffectSize
0000ae  eba50040          SUB      r0,r5,r0,LSL #1       ;493
0000b2  19c5              ADDS     r5,r0,r7              ;493
0000b4  eba8080b          SUB      r8,r8,r11             ;494
0000b8  e00b              B        |L33.210|
                  |L33.186|
0000ba  f7fffffe          BL       _CalcMenuSizeY
0000be  4605              MOV      r5,r0
0000c0  4621              MOV      r1,r4
0000c2  4650              MOV      r0,r10
0000c4  f7fffffe          BL       _GetEffectSize
0000c8  eba50140          SUB      r1,r5,r0,LSL #1
0000cc  4488              ADD      r8,r8,r1
;;;497              x -= EffectSize;
0000ce  eba7050b          SUB      r5,r7,r11
                  |L33.210|
;;;498            }
;;;499            x += WM_GetWindowOrgX(hObj);
0000d2  4650              MOV      r0,r10
0000d4  f7fffffe          BL       WM_GetWindowOrgX
0000d8  4405              ADD      r5,r5,r0
;;;500            y += WM_GetWindowOrgY(hObj);
0000da  4650              MOV      r0,r10
0000dc  f7fffffe          BL       WM_GetWindowOrgY
0000e0  eb000708          ADD      r7,r0,r8
;;;501            /*
;;;502             * Notify owner window when for the first time open a menu (when no
;;;503             * other submenu was open), so it can initialize the menu items.
;;;504             */
;;;505            if (PrevActiveSubmenu == 0) {
0000e4  9800              LDR      r0,[sp,#0]
0000e6  b958              CBNZ     r0,|L33.256|
;;;506              if (_IsTopLevelMenu(hObj, pObj)) {
0000e8  4621              MOV      r1,r4
0000ea  4650              MOV      r0,r10
0000ec  f7fffffe          BL       _IsTopLevelMenu
0000f0  b130              CBZ      r0,|L33.256|
;;;507                MENU__SendMenuMessage(hObj, pObj->hOwner, MENU_ON_INITMENU, 0);
0000f2  f9b4105c          LDRSH    r1,[r4,#0x5c]
0000f6  2300              MOVS     r3,#0
0000f8  2201              MOVS     r2,#1
0000fa  4650              MOV      r0,r10
0000fc  f7fffffe          BL       MENU__SendMenuMessage
                  |L33.256|
;;;508              }
;;;509            }
;;;510            /* Notify owner window when a submenu opens, so it can initialize the menu items. */
;;;511            MENU__SendMenuMessage(hObj, pObj->hOwner, MENU_ON_INITSUBMENU, pItem->Id);
000100  8873              LDRH     r3,[r6,#2]
000102  f9341f5c          LDRSH    r1,[r4,#0x5c]!
000106  2202              MOVS     r2,#2
000108  4650              MOV      r0,r10
00010a  f7fffffe          BL       MENU__SendMenuMessage
;;;512            /* Set active menu as owner of submenu. */
;;;513            MENU_SetOwner(pItem->hSubmenu, hObj);
00010e  e000              B        |L33.274|
                  |L33.272|
000110  e01b              B        |L33.330|
                  |L33.274|
000112  f9b60000          LDRSH    r0,[r6,#0]
000116  4651              MOV      r1,r10
000118  f7fffffe          BL       MENU_SetOwner
;;;514            /* Attach submenu and inform it about its activation. */
;;;515            WM_AttachWindowAt(pItem->hSubmenu, WM_HBKWIN, x, y);
00011c  f7fffffe          BL       WM_GetDesktopWindow
000120  4601              MOV      r1,r0
000122  f9b60000          LDRSH    r0,[r6,#0]
000126  463b              MOV      r3,r7
000128  462a              MOV      r2,r5
00012a  f7fffffe          BL       WM_AttachWindowAt
;;;516            MENU__SendMenuMessage(hObj, pItem->hSubmenu, MENU_ON_OPEN, 0);
00012e  f9b61000          LDRSH    r1,[r6,#0]
000132  2300              MOVS     r3,#0
000134  2203              MOVS     r2,#3
000136  4650              MOV      r0,r10
000138  f7fffffe          BL       MENU__SendMenuMessage
;;;517            pObj->IsSubmenuActive = 1;
00013c  2001              MOVS     r0,#1
00013e  7120              STRB     r0,[r4,#4]
;;;518            /* Invalidate menu item. This is needed because the appearance may have changed. */
;;;519            MENU__InvalidateItem(hObj, pObj, Index);
000140  4650              MOV      r0,r10
000142  e8bd4ff8          POP      {r3-r11,lr}
000146  f7ffbffe          B.W      WM_InvalidateWindow
                  |L33.330|
;;;520          }
;;;521        }
;;;522      }
;;;523    }
00014a  e8bd8ff8          POP      {r3-r11,pc}
;;;524    
                          ENDP


                          AREA ||i._ReleaseCapture||, CODE, READONLY, ALIGN=1

                  _ReleaseCapture PROC
;;;441    */
;;;442    static void _ReleaseCapture(MENU_Handle hObj, const MENU_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
000002  460c              MOV      r4,r1
000004  4605              MOV      r5,r0
;;;443      if (WM_HasCaptured(hObj)) {
000006  f7fffffe          BL       WM_HasCaptured
00000a  2800              CMP      r0,#0
00000c  d00d              BEQ      |L34.42|
;;;444        if (_IsTopLevelMenu(hObj, pObj) && !(pObj->Flags & MENU_SF_POPUP)) {
00000e  4621              MOV      r1,r4
000010  4628              MOV      r0,r5
000012  f7fffffe          BL       _IsTopLevelMenu
000016  2800              CMP      r0,#0
000018  d007              BEQ      |L34.42|
00001a  f894005e          LDRB     r0,[r4,#0x5e]
00001e  0600              LSLS     r0,r0,#24
000020  d403              BMI      |L34.42|
;;;445          WM_ReleaseCapture();
000022  e8bd4070          POP      {r4-r6,lr}
000026  f7ffbffe          B.W      WM_ReleaseCapture
                  |L34.42|
;;;446        }
;;;447      }
;;;448    }
00002a  bd70              POP      {r4-r6,pc}
;;;449    
                          ENDP


                          AREA ||i._SelectItem||, CODE, READONLY, ALIGN=1

                  _SelectItem PROC
;;;552    */
;;;553    static void _SelectItem(MENU_Handle hObj, MENU_Obj* pObj, unsigned Index) {
000000  b570              PUSH     {r4-r6,lr}
000002  4606              MOV      r6,r0
;;;554      if (pObj->Sel != (int)Index) {
000004  6ec8              LDR      r0,[r1,#0x6c]
000006  4614              MOV      r4,r2                 ;553
000008  460d              MOV      r5,r1                 ;553
00000a  42a0              CMP      r0,r4
00000c  d00e              BEQ      |L35.44|
;;;555        _SetCapture(hObj, pObj);
00000e  4630              MOV      r0,r6
000010  f7fffffe          BL       _SetCapture
;;;556        _OpenSubmenu(hObj, pObj, Index);
000014  4622              MOV      r2,r4
000016  4629              MOV      r1,r5
000018  4630              MOV      r0,r6
00001a  f7fffffe          BL       _OpenSubmenu
;;;557        _SetSelection(hObj, pObj, Index);
00001e  4622              MOV      r2,r4
000020  4629              MOV      r1,r5
000022  4630              MOV      r0,r6
000024  e8bd4070          POP      {r4-r6,lr}
000028  f7ffbffe          B.W      _SetSelection
                  |L35.44|
;;;558      }
;;;559    }
00002c  bd70              POP      {r4-r6,pc}
;;;560    
                          ENDP


                          AREA ||i._SetCapture||, CODE, READONLY, ALIGN=1

                  _SetCapture PROC
;;;429    */
;;;430    static void _SetCapture(MENU_Handle hObj, const MENU_Obj* pObj) {
000000  b510              PUSH     {r4,lr}
000002  4604              MOV      r4,r0
;;;431      if (pObj->IsSubmenuActive == 0) {
000004  f8910060          LDRB     r0,[r1,#0x60]
000008  2800              CMP      r0,#0                 ;430
00000a  d10a              BNE      |L36.34|
;;;432        if (WM_HasCaptured(hObj) == 0) {
00000c  4620              MOV      r0,r4
00000e  f7fffffe          BL       WM_HasCaptured
000012  2800              CMP      r0,#0
000014  d105              BNE      |L36.34|
;;;433          WM_SetCapture(hObj, 0);
000016  4620              MOV      r0,r4
000018  e8bd4010          POP      {r4,lr}
00001c  2100              MOVS     r1,#0
00001e  f7ffbffe          B.W      WM_SetCapture
                  |L36.34|
;;;434        }
;;;435      }
;;;436    }
000022  bd10              POP      {r4,pc}
;;;437    
                          ENDP


                          AREA ||i._SetPaintColors||, CODE, READONLY, ALIGN=1

                  _SetPaintColors PROC
;;;854    */
;;;855    static void _SetPaintColors(const MENU_Obj* pObj, const MENU_ITEM* pItem, int ItemIndex) {
000000  b510              PUSH     {r4,lr}
;;;856      char Selected;
;;;857      unsigned ColorIndex;
;;;858      Selected = (ItemIndex == pObj->Sel) ? 1 : 0;
000002  6ec3              LDR      r3,[r0,#0x6c]
000004  4293              CMP      r3,r2
000006  d101              BNE      |L37.12|
000008  2201              MOVS     r2,#1
00000a  e000              B        |L37.14|
                  |L37.12|
00000c  2200              MOVS     r2,#0
                  |L37.14|
;;;859      if (pObj->IsSubmenuActive && Selected) {
00000e  f8903060          LDRB     r3,[r0,#0x60]
000012  b113              CBZ      r3,|L37.26|
000014  b10a              CBZ      r2,|L37.26|
;;;860        ColorIndex = MENU_CI_ACTIVE_SUBMENU;
000016  2104              MOVS     r1,#4
000018  e011              B        |L37.62|
                  |L37.26|
;;;861      } else if (pItem->Flags & MENU_IF_SEPARATOR) {
00001a  888b              LDRH     r3,[r1,#4]
00001c  0799              LSLS     r1,r3,#30
00001e  d501              BPL      |L37.36|
;;;862        ColorIndex = MENU_CI_ENABLED;
000020  2100              MOVS     r1,#0
000022  e00c              B        |L37.62|
                  |L37.36|
;;;863      } else {
;;;864        ColorIndex = (Selected) ? MENU_CI_SELECTED : MENU_CI_ENABLED;
000024  b10a              CBZ      r2,|L37.42|
000026  2101              MOVS     r1,#1
000028  e000              B        |L37.44|
                  |L37.42|
00002a  2100              MOVS     r1,#0
                  |L37.44|
;;;865        if (pItem->Flags & MENU_IF_DISABLED) {
00002c  07da              LSLS     r2,r3,#31
00002e  d006              BEQ      |L37.62|
;;;866          if (pObj->Flags & MENU_CF_HIDE_DISABLED_SEL) {
000030  f890205e          LDRB     r2,[r0,#0x5e]
000034  0712              LSLS     r2,r2,#28
000036  d501              BPL      |L37.60|
;;;867            ColorIndex = MENU_CI_DISABLED;
000038  2102              MOVS     r1,#2
00003a  e000              B        |L37.62|
                  |L37.60|
00003c  1c89              ADDS     r1,r1,#2
                  |L37.62|
;;;868          } else {
;;;869            ColorIndex += MENU_CI_DISABLED;
;;;870          }
;;;871        }
;;;872      }
;;;873      GUI_SetBkColor(pObj->Props.aBkColor[ColorIndex]);
00003e  eb000481          ADD      r4,r0,r1,LSL #2
000042  6be0              LDR      r0,[r4,#0x3c]
000044  f7fffffe          BL       GUI_SetBkColor
;;;874      GUI_SetColor(pObj->Props.aTextColor[ColorIndex]);
000048  6aa0              LDR      r0,[r4,#0x28]
00004a  e8bd4010          POP      {r4,lr}
00004e  f7ffbffe          B.W      GUI_SetColor
;;;875    }
;;;876    
                          ENDP


                          AREA ||i._SetSelection||, CODE, READONLY, ALIGN=1

                  _SetSelection PROC
;;;540    */
;;;541    static void _SetSelection(MENU_Handle hObj, MENU_Obj* pObj, int Index) {
000000  b510              PUSH     {r4,lr}
000002  4604              MOV      r4,r0
;;;542      if (Index != pObj->Sel) {
000004  6ec8              LDR      r0,[r1,#0x6c]
000006  4290              CMP      r0,r2
000008  d008              BEQ      |L38.28|
;;;543        pObj->Sel = Index;
;;;544        MENU__InvalidateItem(hObj, pObj, pObj->Sel); /* Invalidate previous selection */
00000a  4620              MOV      r0,r4
00000c  66ca              STR      r2,[r1,#0x6c]
00000e  f7fffffe          BL       WM_InvalidateWindow
;;;545        MENU__InvalidateItem(hObj, pObj, Index);     /* Invalidate new selection */
000012  4620              MOV      r0,r4
000014  e8bd4010          POP      {r4,lr}
000018  f7ffbffe          B.W      WM_InvalidateWindow
                  |L38.28|
;;;546      }
;;;547    }
00001c  bd10              POP      {r4,pc}
;;;548    
                          ENDP


                          AREA ||.data||, DATA, ALIGN=2

                  MENU__pDefaultEffect
                          DCD      WIDGET_Effect_3D1L
                  MENU__DefaultProps
                          DCD      0x00000000
                          DCD      0x00ffffff
                          DCD      0x007c7c7c
                          DCD      0x00d3d3d3
                          DCD      0x00ffffff
                          DCD      0x00d3d3d3
                          DCD      0x00980000
                          DCD      0x00d3d3d3
                          DCD      0x00980000
                          DCD      0x007c7c7c
00002c  04040202          DCB      0x04,0x04,0x02,0x02
                          DCD      GUI_Font13_1
