; generated by Component: ARM Compiler 5.05 (build 41) Tool: ArmCC [4d0eb9]
; commandline ArmCC [--list --split_sections -c --asm --interleave -o.\obj\listbox.o --asm_dir=.\list\ --list_dir=.\list\ --depend=.\obj\listbox.d --cpu=Cortex-M3 --apcs=interwork -O3 -I..\Board_Support_Package -I..\Config -I..\GUI\Core -I..\GUI\JPEG -I..\GUI\LCDDriver -I..\GUI\MultiLayer -I..\GUI\Widget -I..\GUI\WM -I..\Libraries\CMSIS\CM3\CoreSupport -I..\Libraries\CMSIS\CM3\DeviceSupport\ST\STM32F10x -I..\Libraries\CMSIS\Include -I..\Libraries\STM32F10x_StdPeriph_Driver\inc -I..\User\Res -I..\User\UserWindow -I..\User -I..\USB\inc -IC:\Keil_v5\ARM\RV31\INC -IC:\Keil_v5\ARM\CMSIS\Include -IC:\Keil_v5\ARM\Inc\ST\STM32F10x -D__MICROLIB -DSTM32F10X_HD -DVECT_TAB_FLASH -DUSE_STDPERIPH_DRIVER --no_multibyte_chars ..\GUI\Widget\LISTBOX.c]
                          THUMB

                          AREA ||i.LISTBOX_AddKey||, CODE, READONLY, ALIGN=1

                  LISTBOX_AddKey PROC
;;;1160   */
;;;1161   int LISTBOX_AddKey(LISTBOX_Handle hObj, int Key) {
000000  0002              MOVS     r2,r0
;;;1162     int r = 0;
000002  f04f0000          MOV      r0,#0
000006  d002              BEQ      |L1.14|
;;;1163     if (hObj) {
;;;1164       WM_LOCK();
;;;1165       r = _AddKey(hObj, Key);
000008  4610              MOV      r0,r2
00000a  f7ffbffe          B.W      _AddKey
                  |L1.14|
;;;1166       WM_UNLOCK();
;;;1167     }
;;;1168     return r;
;;;1169   }
00000e  4770              BX       lr
;;;1170   
                          ENDP


                          AREA ||i.LISTBOX_AddString||, CODE, READONLY, ALIGN=1

                  LISTBOX_AddString PROC
;;;1174   */
;;;1175   void LISTBOX_AddString(LISTBOX_Handle hObj, const char* s) {
000000  e92d41fc          PUSH     {r2-r8,lr}
000004  460e              MOV      r6,r1
000006  0007              MOVS     r7,r0
000008  d02c              BEQ      |L2.100|
;;;1176     if (hObj && s) {
00000a  2e00              CMP      r6,#0
00000c  d02a              BEQ      |L2.100|
;;;1177       LISTBOX_Obj* pObj;
;;;1178       LISTBOX_ITEM Item = {0, 0};
00000e  2000              MOVS     r0,#0
000010  9000              STR      r0,[sp,#0]
;;;1179       WM_LOCK();
;;;1180       pObj = LISTBOX_H2P(hObj);
000012  9001              STR      r0,[sp,#4]
000014  4638              MOV      r0,r7
000016  f7fffffe          BL       GUI_ALLOC_h2p
00001a  4605              MOV      r5,r0
;;;1181       if (GUI_ARRAY_AddItem(&pObj->ItemArray, &Item, sizeof(LISTBOX_ITEM) + strlen(s)) == 0) {
00001c  4630              MOV      r0,r6
00001e  f7fffffe          BL       strlen
000022  1d82              ADDS     r2,r0,#6
000024  f1050028          ADD      r0,r5,#0x28
000028  4669              MOV      r1,sp
00002a  4680              MOV      r8,r0
00002c  f7fffffe          BL       GUI_ARRAY_AddItem
000030  2800              CMP      r0,#0
000032  d117              BNE      |L2.100|
000034  4640              MOV      r0,r8
;;;1182         unsigned ItemIndex = GUI_ARRAY_GetNumItems(&pObj->ItemArray) - 1;
000036  f7fffffe          BL       GUI_ARRAY_GetNumItems
00003a  1e44              SUBS     r4,r0,#1
;;;1183         LISTBOX_ITEM* pItem= (LISTBOX_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, ItemIndex);
00003c  4621              MOV      r1,r4
00003e  4640              MOV      r0,r8
000040  f7fffffe          BL       GUI_ARRAY_GetpItem
;;;1184         strcpy(pItem->acText, s);
000044  4631              MOV      r1,r6
000046  1d40              ADDS     r0,r0,#5
000048  f7fffffe          BL       strcpy
;;;1185         LISTBOX__InvalidateItemSize(pObj, ItemIndex);
00004c  4621              MOV      r1,r4
00004e  4628              MOV      r0,r5
000050  f7fffffe          BL       LISTBOX__InvalidateItemSize
;;;1186         LISTBOX_UpdateScrollers(hObj);
000054  4638              MOV      r0,r7
000056  f7fffffe          BL       LISTBOX_UpdateScrollers
;;;1187         LISTBOX__InvalidateItem(hObj, pObj, ItemIndex);
00005a  4622              MOV      r2,r4
00005c  4629              MOV      r1,r5
00005e  4638              MOV      r0,r7
000060  f7fffffe          BL       LISTBOX__InvalidateItem
                  |L2.100|
;;;1188       }
;;;1189       WM_UNLOCK();
;;;1190     }
;;;1191   }
000064  e8bd81fc          POP      {r2-r8,pc}
;;;1192   
                          ENDP


                          AREA ||i.LISTBOX_Callback||, CODE, READONLY, ALIGN=1

                  LISTBOX_Callback PROC
;;;985    */
;;;986    void LISTBOX_Callback(WM_MESSAGE * pMsg) {
000000  e92d47f0          PUSH     {r4-r10,lr}
000004  4604              MOV      r4,r0
;;;987      LISTBOX_Handle hObj;
;;;988      LISTBOX_Obj * pObj;
;;;989      WM_SCROLL_STATE ScrollState;
;;;990      WM_MESSAGE Msg;
;;;991      hObj = pMsg->hWin;
000006  f9b00004          LDRSH    r0,[r0,#4]
00000a  b088              SUB      sp,sp,#0x20           ;986
00000c  4680              MOV      r8,r0
;;;992      pObj = (LISTBOX_Obj *)GUI_ALLOC_h2p(hObj); /* Don't use use WIDGET_H2P because WIDGET_INIT_ID() has not be called at this point */
00000e  f7fffffe          BL       GUI_ALLOC_h2p
000012  4605              MOV      r5,r0
;;;993      /* Let widget handle the standard messages */
;;;994      if (WIDGET_HandleActive(hObj, pMsg) == 0) {
000014  4621              MOV      r1,r4
000016  4640              MOV      r0,r8
000018  f7fffffe          BL       WIDGET_HandleActive
00001c  2800              CMP      r0,#0
00001e  6820              LDR      r0,[r4,#0]
000020  d009              BEQ      |L3.54|
;;;995        /* Owner needs to be informed about focus change */
;;;996        if (pMsg->MsgId == WM_SET_FOCUS) {
;;;997          if (pMsg->Data.v == 0) {            /* Lost focus ? */
;;;998            _NotifyOwner(hObj, LISTBOX_NOTIFICATION_LOST_FOCUS);
;;;999          }
;;;1000       }
;;;1001       return;
;;;1002     }
;;;1003     switch (pMsg->MsgId) {
000022  280e              CMP      r0,#0xe
000024  d07e              BEQ      |L3.292|
000026  dc0d              BGT      |L3.68|
000028  2805              CMP      r0,#5
00002a  d07c              BEQ      |L3.294|
00002c  280b              CMP      r0,#0xb
00002e  d07b              BEQ      |L3.296|
000030  280c              CMP      r0,#0xc
000032  d135              BNE      |L3.160|
000034  e087              B        |L3.326|
                  |L3.54|
000036  281e              CMP      r0,#0x1e              ;996
000038  d177              BNE      |L3.298|
00003a  68a0              LDR      r0,[r4,#8]            ;997
00003c  2800              CMP      r0,#0                 ;997
00003e  d17f              BNE      |L3.320|
000040  210b              MOVS     r1,#0xb               ;998
000042  e07a              B        |L3.314|
                  |L3.68|
000044  280f              CMP      r0,#0xf
000046  d030              BEQ      |L3.170|
000048  2811              CMP      r0,#0x11
00004a  d034              BEQ      |L3.182|
00004c  2826              CMP      r0,#0x26
00004e  d127              BNE      |L3.160|
;;;1004     case WM_NOTIFY_PARENT:
;;;1005       switch (pMsg->Data.v) {
000050  68a0              LDR      r0,[r4,#8]
000052  2805              CMP      r0,#5
000054  d002              BEQ      |L3.92|
000056  2806              CMP      r0,#6
000058  d122              BNE      |L3.160|
00005a  e022              B        |L3.162|
                  |L3.92|
;;;1006       case WM_NOTIFICATION_VALUE_CHANGED:
;;;1007         if (pMsg->hWinSrc  == WM_GetScrollbarV(hObj)) {
00005c  4640              MOV      r0,r8
00005e  f7fffffe          BL       WM_GetScrollbarV
000062  4601              MOV      r1,r0
000064  f9b40006          LDRSH    r0,[r4,#6]
000068  4281              CMP      r1,r0
00006a  d105              BNE      |L3.120|
;;;1008           WM_GetScrollState(pMsg->hWinSrc, &ScrollState);
00006c  a902              ADD      r1,sp,#8
00006e  f7fffffe          BL       WM_GetScrollState
;;;1009           pObj->ScrollStateV.v = ScrollState.v;
000072  9803              LDR      r0,[sp,#0xc]
;;;1010           LISTBOX__InvalidateInsideArea(hObj);
;;;1011           _NotifyOwner(hObj, WM_NOTIFICATION_SCROLL_CHANGED);
000074  6368              STR      r0,[r5,#0x34]
000076  e00c              B        |L3.146|
                  |L3.120|
;;;1012         } else if (pMsg->hWinSrc == WM_GetScrollbarH(hObj)) {
000078  4640              MOV      r0,r8
00007a  f7fffffe          BL       WM_GetScrollbarH
00007e  4601              MOV      r1,r0
000080  f9b40006          LDRSH    r0,[r4,#6]
000084  4281              CMP      r1,r0
000086  d10b              BNE      |L3.160|
;;;1013           WM_GetScrollState(pMsg->hWinSrc, &ScrollState);
000088  a902              ADD      r1,sp,#8
00008a  f7fffffe          BL       WM_GetScrollState
;;;1014           pObj->ScrollStateH.v = ScrollState.v;
00008e  9803              LDR      r0,[sp,#0xc]
000090  6428              STR      r0,[r5,#0x40]
                  |L3.146|
000092  4640              MOV      r0,r8                 ;1010
000094  f7fffffe          BL       LISTBOX__InvalidateInsideArea
000098  210a              MOVS     r1,#0xa               ;1011
00009a  4640              MOV      r0,r8                 ;1011
00009c  f7fffffe          BL       _NotifyOwner
                  |L3.160|
0000a0  e087              B        |L3.434|
                  |L3.162|
;;;1015           LISTBOX__InvalidateInsideArea(hObj);
;;;1016           _NotifyOwner(hObj, WM_NOTIFICATION_SCROLL_CHANGED);
;;;1017         }
;;;1018         break;
;;;1019       case WM_NOTIFICATION_SCROLLBAR_ADDED:
;;;1020         #if WIDGET_USE_PARENT_EFFECT
;;;1021           WIDGET_SetEffect(pMsg->hWinSrc, pObj->Widget.pEffect);
;;;1022         #endif
;;;1023         LISTBOX_UpdateScrollers(hObj);
0000a2  4640              MOV      r0,r8
0000a4  f7fffffe          BL       LISTBOX_UpdateScrollers
;;;1024         break;
0000a8  e083              B        |L3.434|
                  |L3.170|
;;;1025       }
;;;1026       break;
;;;1027     case WM_PAINT:
;;;1028       _OnPaint(hObj, pObj, pMsg);
0000aa  4622              MOV      r2,r4
0000ac  4629              MOV      r1,r5
0000ae  4640              MOV      r0,r8
0000b0  f7fffffe          BL       _OnPaint
;;;1029       break;
0000b4  e07d              B        |L3.434|
                  |L3.182|
;;;1030     case WM_PID_STATE_CHANGED:
;;;1031       {
;;;1032         const WM_PID_STATE_CHANGED_INFO* pInfo = (const WM_PID_STATE_CHANGED_INFO*)pMsg->Data.p;
;;;1033         if (pInfo->State) {
0000b6  68a0              LDR      r0,[r4,#8]
0000b8  7a01              LDRB     r1,[r0,#8]
0000ba  2900              CMP      r1,#0
0000bc  d079              BEQ      |L3.434|
0000be  e9d04700          LDRD     r4,r7,[r0,#0]
0000c2  f04f3aff          MOV      r10,#0xffffffff
0000c6  4669              MOV      r1,sp
0000c8  4640              MOV      r0,r8
0000ca  f7fffffe          BL       WM_GetInsideRectExScrollbar
0000ce  f9bd0000          LDRSH    r0,[sp,#0]
0000d2  42a0              CMP      r0,r4
0000d4  dc30              BGT      |L3.312|
0000d6  f9bd0002          LDRSH    r0,[sp,#2]
0000da  42b8              CMP      r0,r7
0000dc  dc2c              BGT      |L3.312|
0000de  f9bd0004          LDRSH    r0,[sp,#4]
0000e2  42a0              CMP      r0,r4
0000e4  db28              BLT      |L3.312|
0000e6  f9bd0006          LDRSH    r0,[sp,#6]
0000ea  42b8              CMP      r0,r7
0000ec  db24              BLT      |L3.312|
0000ee  4628              MOV      r0,r5
0000f0  f7fffffe          BL       LISTBOX__GetNumItems
0000f4  4681              MOV      r9,r0
0000f6  f9bd6002          LDRSH    r6,[sp,#2]
0000fa  6b6c              LDR      r4,[r5,#0x34]
0000fc  e009              B        |L3.274|
                  |L3.254|
0000fe  42b7              CMP      r7,r6
000100  db00              BLT      |L3.260|
000102  46a2              MOV      r10,r4
                  |L3.260|
000104  4622              MOV      r2,r4
000106  4629              MOV      r1,r5
000108  4640              MOV      r0,r8
00010a  f7fffffe          BL       _GetItemSizeY
00010e  4406              ADD      r6,r6,r0
000110  1c64              ADDS     r4,r4,#1
                  |L3.274|
000112  454c              CMP      r4,r9
000114  dbf3              BLT      |L3.254|
000116  ea5f040a          MOVS     r4,r10
00011a  d40d              BMI      |L3.312|
;;;1034           int Sel;
;;;1035           Sel = _GetItemFromPos(hObj, pObj, pInfo->x, pInfo->y);
;;;1036           if (Sel >= 0) {
;;;1037             _ToggleMultiSel(hObj, pObj, Sel);
00011c  4652              MOV      r2,r10
00011e  4629              MOV      r1,r5
000120  4640              MOV      r0,r8
000122  e003              B        |L3.300|
                  |L3.292|
000124  e019              B        |L3.346|
                  |L3.294|
000126  e03e              B        |L3.422|
                  |L3.296|
000128  e012              B        |L3.336|
                  |L3.298|
00012a  e009              B        |L3.320|
                  |L3.300|
00012c  f7fffffe          BL       _ToggleMultiSel
;;;1038             LISTBOX_SetSel(hObj, Sel);
000130  4621              MOV      r1,r4
000132  4640              MOV      r0,r8
000134  f7fffffe          BL       LISTBOX_SetSel
                  |L3.312|
;;;1039           }
;;;1040           _NotifyOwner(hObj, WM_NOTIFICATION_CLICKED);
000138  2101              MOVS     r1,#1
                  |L3.314|
00013a  4640              MOV      r0,r8                 ;998
00013c  f7fffffe          BL       _NotifyOwner
                  |L3.320|
;;;1041           return;
;;;1042         }
;;;1043       }
;;;1044       break;
;;;1045     case WM_TOUCH:
;;;1046       _OnTouch(hObj, pMsg);
;;;1047       return;
;;;1048   #if GUI_SUPPORT_MOUSE
;;;1049     case WM_MOUSEOVER:
;;;1050       if (_OnMouseOver(hObj, pObj, pMsg) == 0)
;;;1051         return;
;;;1052       break;
;;;1053   #endif
;;;1054     case WM_DELETE:
;;;1055       _FreeAttached(pObj);
;;;1056       break;       /* No return here ... WM_DefaultProc needs to be called */
;;;1057     case WM_KEY:
;;;1058       if (((const WM_KEY_INFO*)(pMsg->Data.p))->PressedCnt > 0) {
;;;1059         int Key;
;;;1060         Key = ((const WM_KEY_INFO*)(pMsg->Data.p))->Key;
;;;1061         if (LISTBOX_AddKey(hObj, Key)) {
;;;1062           return;
;;;1063         }
;;;1064       }
;;;1065       /* Send a WM_NOTIFY_OWNER_KEY message with the key information to the owner window */
;;;1066       Msg = *pMsg;
;;;1067       Msg.MsgId = WM_NOTIFY_OWNER_KEY;
;;;1068       _SendToOwner(hObj, &Msg);
;;;1069       if (!WM_IsWindow(hObj)) {
;;;1070         return;
;;;1071       }
;;;1072       break;
;;;1073     case WM_SIZE:
;;;1074       LISTBOX_UpdateScrollers(hObj);
;;;1075       WM_InvalidateWindow(hObj);
;;;1076       break;
;;;1077     }
;;;1078     WM_DefaultProc(pMsg);
;;;1079   }
000140  b008              ADD      sp,sp,#0x20
000142  e8bd87f0          POP      {r4-r10,pc}
                  |L3.326|
000146  4621              MOV      r1,r4                 ;1046
000148  4640              MOV      r0,r8                 ;1046
00014a  f7fffffe          BL       _OnTouch
00014e  e7f7              B        |L3.320|
                  |L3.336|
000150  f1050028          ADD      r0,r5,#0x28
000154  f7fffffe          BL       GUI_ARRAY_Delete
000158  e02b              B        |L3.434|
                  |L3.346|
00015a  68a0              LDR      r0,[r4,#8]            ;1058
00015c  6841              LDR      r1,[r0,#4]            ;1058
00015e  2900              CMP      r1,#0                 ;1058
000160  dd05              BLE      |L3.366|
000162  6801              LDR      r1,[r0,#0]            ;1061
000164  4640              MOV      r0,r8                 ;1061
000166  f7fffffe          BL       LISTBOX_AddKey
00016a  2800              CMP      r0,#0                 ;1061
00016c  d1e8              BNE      |L3.320|
                  |L3.366|
00016e  e9d40101          LDRD     r0,r1,[r4,#4]         ;1061
000172  e9cd0106          STRD     r0,r1,[sp,#0x18]      ;1061
000176  2021              MOVS     r0,#0x21              ;1067
000178  9005              STR      r0,[sp,#0x14]         ;1067
00017a  4645              MOV      r5,r8                 ;1068
00017c  ae05              ADD      r6,sp,#0x14           ;1068
00017e  4640              MOV      r0,r8                 ;1068
000180  f7fffffe          BL       GUI_ALLOC_h2p
000184  f9b00080          LDRSH    r0,[r0,#0x80]         ;1068
000188  b910              CBNZ     r0,|L3.400|
00018a  4628              MOV      r0,r5                 ;1068
00018c  f7fffffe          BL       WM_GetParent
                  |L3.400|
000190  f8ad501a          STRH     r5,[sp,#0x1a]         ;1068
000194  4631              MOV      r1,r6                 ;1068
000196  f7fffffe          BL       WM__SendMessage
00019a  4640              MOV      r0,r8                 ;1069
00019c  f7fffffe          BL       WM_IsWindow
0001a0  2800              CMP      r0,#0                 ;1069
0001a2  d0cd              BEQ      |L3.320|
0001a4  e005              B        |L3.434|
                  |L3.422|
0001a6  4640              MOV      r0,r8                 ;1074
0001a8  f7fffffe          BL       LISTBOX_UpdateScrollers
0001ac  4640              MOV      r0,r8                 ;1075
0001ae  f7fffffe          BL       WM_InvalidateWindow
                  |L3.434|
0001b2  4620              MOV      r0,r4                 ;1078
0001b4  f7fffffe          BL       WM_DefaultProc
0001b8  e7c2              B        |L3.320|
;;;1080   
                          ENDP


                          AREA ||i.LISTBOX_CreateEx||, CODE, READONLY, ALIGN=2

                  LISTBOX_CreateEx PROC
;;;1090   */
;;;1091   LISTBOX_Handle LISTBOX_CreateEx(int x0, int y0, int xsize, int ysize, WM_HWIN hParent,
000000  e92d41ff          PUSH     {r0-r8,lr}
;;;1092                                   int WinFlags, int ExFlags, int Id, const GUI_ConstString* ppText)
;;;1093   {
;;;1094     LISTBOX_Handle hObj;
;;;1095     GUI_USE_PARA(ExFlags);
;;;1096     WM_LOCK();
;;;1097     hObj = WM_CreateWindowAsChild(x0, y0, xsize, ysize, hParent, WinFlags, LISTBOX_Callback,
000004  f04f0c68          MOV      r12,#0x68
000008  e9dd760d          LDRD     r7,r6,[sp,#0x34]      ;1093
00000c  e9dd540a          LDRD     r5,r4,[sp,#0x28]      ;1093
000010  f8dfe044          LDR      lr,|L4.88|
000014  b2a4              UXTH     r4,r4
000016  e9cdec02          STRD     lr,r12,[sp,#8]
00001a  e9cd5400          STRD     r5,r4,[sp,#0]
00001e  f7fffffe          BL       WM_CreateWindowAsChild
000022  0004              MOVS     r4,r0
;;;1098                                   sizeof(LISTBOX_Obj) - sizeof(WM_Obj));
;;;1099     if (hObj) {
000024  d014              BEQ      |L4.80|
;;;1100       LISTBOX_Obj* pObj;
;;;1101       pObj = (LISTBOX_Obj *)GUI_ALLOC_h2p(hObj); /* Don't use use WIDGET_H2P because WIDGET_INIT_ID() has not be called at this point */
000026  f7fffffe          BL       GUI_ALLOC_h2p
00002a  4605              MOV      r5,r0
;;;1102        /* Init sub-classes */
;;;1103       GUI_ARRAY_CREATE(&pObj->ItemArray);
;;;1104      /* init widget specific variables */
;;;1105       WIDGET__Init(&pObj->Widget, Id, WIDGET_STATE_FOCUSSABLE);
00002c  2210              MOVS     r2,#0x10
00002e  4639              MOV      r1,r7
000030  f7fffffe          BL       WIDGET__Init
;;;1106       LISTBOX_INIT_ID(pObj);
;;;1107       pObj->Props = LISTBOX_DefaultProps;
000034  2238              MOVS     r2,#0x38
000036  4909              LDR      r1,|L4.92|
000038  f1050048          ADD      r0,r5,#0x48
00003c  f7fffffe          BL       __aeabi_memcpy4
;;;1108       if (ppText) {
000040  b11e              CBZ      r6,|L4.74|
;;;1109         /* init member variables */
;;;1110         /* Set non-zero attributes */
;;;1111         LISTBOX_SetText(hObj, ppText);
000042  4631              MOV      r1,r6
000044  4620              MOV      r0,r4
000046  f7fffffe          BL       LISTBOX_SetText
                  |L4.74|
;;;1112       }
;;;1113       LISTBOX_UpdateScrollers(hObj);
00004a  4620              MOV      r0,r4
00004c  f7fffffe          BL       LISTBOX_UpdateScrollers
                  |L4.80|
;;;1114     }
;;;1115     WM_UNLOCK();
;;;1116     return hObj;
;;;1117   }
000050  b004              ADD      sp,sp,#0x10
000052  4620              MOV      r0,r4                 ;1116
000054  e8bd81f0          POP      {r4-r8,pc}
;;;1118   
                          ENDP

                  |L4.88|
                          DCD      LISTBOX_Callback
                  |L4.92|
                          DCD      ||.data||+0x8

                          AREA ||i.LISTBOX_DecSel||, CODE, READONLY, ALIGN=1

                  LISTBOX_DecSel PROC
;;;1285   */
;;;1286   void LISTBOX_DecSel      (LISTBOX_Handle hObj) {
000000  2800              CMP      r0,#0
000002  d003              BEQ      |L5.12|
;;;1287     if (hObj) {
;;;1288       WM_LOCK();
;;;1289       _MoveSel(hObj, -1);
000004  f04f31ff          MOV      r1,#0xffffffff
000008  f7ffbffe          B.W      _MoveSel
                  |L5.12|
;;;1290       WM_UNLOCK();
;;;1291     }
;;;1292   }
00000c  4770              BX       lr
;;;1293   
                          ENDP


                          AREA ||i.LISTBOX_GetSel||, CODE, READONLY, ALIGN=1

                  LISTBOX_GetSel PROC
;;;1257   */
;;;1258   int  LISTBOX_GetSel (LISTBOX_Handle hObj) {
000000  b510              PUSH     {r4,lr}
000002  0001              MOVS     r1,r0
;;;1259     int r = -1;
000004  f04f30ff          MOV      r0,#0xffffffff
000008  d004              BEQ      |L6.20|
;;;1260     LISTBOX_Obj* pObj;
;;;1261     if (hObj) {
;;;1262       WM_LOCK();
;;;1263       pObj = LISTBOX_H2P(hObj);
00000a  4608              MOV      r0,r1
00000c  f7fffffe          BL       GUI_ALLOC_h2p
;;;1264       r = pObj->Sel;
000010  f9b00082          LDRSH    r0,[r0,#0x82]
                  |L6.20|
;;;1265       WM_UNLOCK();
;;;1266     }
;;;1267     return r;
;;;1268   }
000014  bd10              POP      {r4,pc}
;;;1269   
                          ENDP


                          AREA ||i.LISTBOX_IncSel||, CODE, READONLY, ALIGN=1

                  LISTBOX_IncSel PROC
;;;1273   */
;;;1274   void LISTBOX_IncSel      (LISTBOX_Handle hObj) {
000000  2800              CMP      r0,#0
000002  d002              BEQ      |L7.10|
;;;1275     if (hObj) {
;;;1276       WM_LOCK();
;;;1277       _MoveSel(hObj, 1);
000004  2101              MOVS     r1,#1
000006  f7ffbffe          B.W      _MoveSel
                  |L7.10|
;;;1278       WM_UNLOCK();
;;;1279     }
;;;1280   }
00000a  4770              BX       lr
;;;1281   
                          ENDP


                          AREA ||i.LISTBOX_InvalidateItem||, CODE, READONLY, ALIGN=1

                  LISTBOX_InvalidateItem PROC
;;;1128   */
;;;1129   void LISTBOX_InvalidateItem(LISTBOX_Handle hObj, int Index) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  460c              MOV      r4,r1
000006  0006              MOVS     r6,r0
000008  d028              BEQ      |L8.92|
;;;1130     if (hObj) {
;;;1131       LISTBOX_Obj* pObj;
;;;1132       int NumItems;
;;;1133       WM_LOCK();
;;;1134       pObj = LISTBOX_H2P(hObj);
00000a  f7fffffe          BL       GUI_ALLOC_h2p
00000e  4607              MOV      r7,r0
;;;1135       NumItems = LISTBOX__GetNumItems(pObj);
000010  f7fffffe          BL       LISTBOX__GetNumItems
000014  4605              MOV      r5,r0
;;;1136       if (Index < NumItems) {
000016  42ac              CMP      r4,r5
000018  da20              BGE      |L8.92|
;;;1137         if (Index < 0) {
00001a  2c00              CMP      r4,#0
00001c  da10              BGE      |L8.64|
;;;1138           int i;
;;;1139           for (i = 0; i < NumItems; i++) {
00001e  2400              MOVS     r4,#0
000020  e004              B        |L8.44|
                  |L8.34|
;;;1140             LISTBOX__InvalidateItemSize(pObj, i);
000022  4621              MOV      r1,r4
000024  4638              MOV      r0,r7
000026  f7fffffe          BL       LISTBOX__InvalidateItemSize
00002a  1c64              ADDS     r4,r4,#1
                  |L8.44|
00002c  42ac              CMP      r4,r5                 ;1139
00002e  dbf8              BLT      |L8.34|
;;;1141           }
;;;1142           LISTBOX_UpdateScrollers(hObj);
000030  4630              MOV      r0,r6
000032  f7fffffe          BL       LISTBOX_UpdateScrollers
;;;1143           LISTBOX__InvalidateInsideArea(hObj);
000036  4630              MOV      r0,r6
000038  e8bd41f0          POP      {r4-r8,lr}
00003c  f7ffbffe          B.W      LISTBOX__InvalidateInsideArea
                  |L8.64|
;;;1144         } else {
;;;1145           LISTBOX__InvalidateItemSize(pObj, Index);
000040  4621              MOV      r1,r4
000042  4638              MOV      r0,r7
000044  f7fffffe          BL       LISTBOX__InvalidateItemSize
;;;1146           LISTBOX_UpdateScrollers(hObj);
000048  4630              MOV      r0,r6
00004a  f7fffffe          BL       LISTBOX_UpdateScrollers
;;;1147           LISTBOX__InvalidateItemAndBelow(hObj, pObj, Index);
00004e  4622              MOV      r2,r4
000050  4639              MOV      r1,r7
000052  4630              MOV      r0,r6
000054  e8bd41f0          POP      {r4-r8,lr}
000058  f7ffbffe          B.W      LISTBOX__InvalidateItemAndBelow
                  |L8.92|
;;;1148         }
;;;1149       }
;;;1150       WM_UNLOCK();
;;;1151     }
;;;1152   }
00005c  e8bd81f0          POP      {r4-r8,pc}
;;;1153   
                          ENDP


                          AREA ||i.LISTBOX_OwnerDraw||, CODE, READONLY, ALIGN=2

                  LISTBOX_OwnerDraw PROC
;;;320    */
;;;321    int LISTBOX_OwnerDraw(const WIDGET_ITEM_DRAW_INFO* pDrawItemInfo) {
000000  e92d47f0          PUSH     {r4-r10,lr}
000004  4604              MOV      r4,r0
;;;322      switch (pDrawItemInfo->Cmd) {
000006  6840              LDR      r0,[r0,#4]
000008  b086              SUB      sp,sp,#0x18           ;321
00000a  b338              CBZ      r0,|L9.92|
00000c  2801              CMP      r0,#1
00000e  d002              BEQ      |L9.22|
000010  2802              CMP      r0,#2
000012  d17d              BNE      |L9.272|
000014  e016              B        |L9.68|
                  |L9.22|
;;;323        case WIDGET_ITEM_GET_XSIZE: {
;;;324          LISTBOX_Obj* pObj;
;;;325          const GUI_FONT GUI_UNI_PTR* pOldFont;
;;;326          const char* s;
;;;327          int DistX;
;;;328          pObj = LISTBOX_H2P(pDrawItemInfo->hWin);
000016  f9b40000          LDRSH    r0,[r4,#0]
00001a  f7fffffe          BL       GUI_ALLOC_h2p
00001e  4605              MOV      r5,r0
;;;329          pOldFont = GUI_SetFont(pObj->Props.pFont);
000020  6c80              LDR      r0,[r0,#0x48]
000022  f7fffffe          BL       GUI_SetFont
000026  4606              MOV      r6,r0
;;;330          s = LISTBOX__GetpString(pObj, pDrawItemInfo->ItemIndex);
000028  4628              MOV      r0,r5
00002a  68a1              LDR      r1,[r4,#8]
00002c  f7fffffe          BL       LISTBOX__GetpString
;;;331          DistX = GUI_GetStringDistX(s);
000030  f7fffffe          BL       GUI_GetStringDistX
000034  4604              MOV      r4,r0
;;;332          GUI_SetFont(pOldFont);
000036  4630              MOV      r0,r6
000038  f7fffffe          BL       GUI_SetFont
;;;333          return DistX;
00003c  4620              MOV      r0,r4
                  |L9.62|
;;;334        }
;;;335        case WIDGET_ITEM_GET_YSIZE: {
;;;336          LISTBOX_Obj* pObj;
;;;337          pObj = LISTBOX_H2P(pDrawItemInfo->hWin);
;;;338          return GUI_GetYDistOfFont(pObj->Props.pFont) + pObj->ItemSpacing;
;;;339        }
;;;340        case WIDGET_ITEM_DRAW: {
;;;341          LISTBOX_Obj* pObj;
;;;342          LISTBOX_ITEM* pItem;
;;;343          WM_HMEM hItem;
;;;344          GUI_RECT r, rText;
;;;345          int FontDistY;
;;;346          int ItemIndex = pDrawItemInfo->ItemIndex;
;;;347          const char* s;
;;;348          int ColorIndex;
;;;349          char IsDisabled;
;;;350          char IsSelected;
;;;351          pObj = LISTBOX_H2P(pDrawItemInfo->hWin);
;;;352          hItem = GUI_ARRAY_GethItem(&pObj->ItemArray, ItemIndex);
;;;353          pItem = (LISTBOX_ITEM *)GUI_ALLOC_h2p(hItem);
;;;354          WM_GetInsideRect(&r);
;;;355          FontDistY = GUI_GetFontDistY();
;;;356          /* Calculate color index */
;;;357          IsDisabled = (pItem->Status & LISTBOX_ITEM_DISABLED) ? 1 : 0;
;;;358          IsSelected = (pItem->Status & LISTBOX_ITEM_SELECTED) ? 1 : 0;
;;;359          if (pObj->Flags & LISTBOX_SF_MULTISEL) {
;;;360            if (IsDisabled) {
;;;361              ColorIndex = LISTBOX_CI_DISABLED;
;;;362            } else {
;;;363              ColorIndex = (IsSelected) ? LISTBOX_CI_SELFOCUS : LISTBOX_CI_UNSEL;
;;;364            }
;;;365          } else {
;;;366            if (IsDisabled) {
;;;367              ColorIndex = LISTBOX_CI_DISABLED;
;;;368            } else {
;;;369              if (ItemIndex == pObj->Sel) {
;;;370                ColorIndex = (pObj->Widget.State & WIDGET_STATE_FOCUS) ? LISTBOX_CI_SELFOCUS : LISTBOX_CI_SEL;
;;;371              } else {
;;;372                ColorIndex = LISTBOX_CI_UNSEL;
;;;373              }
;;;374            }
;;;375          }
;;;376          /* Display item */
;;;377          LCD_SetBkColor(pObj->Props.aBackColor[ColorIndex]);
;;;378          LCD_SetColor  (pObj->Props.aTextColor[ColorIndex]);
;;;379          s = LISTBOX__GetpString(pObj, ItemIndex);
;;;380          GUI_SetTextMode(GUI_TM_TRANS);
;;;381          GUI_Clear();
;;;382          rText.y0 = pDrawItemInfo->y0;
;;;383          rText.x0 = pDrawItemInfo->x0 + 5;		//modify by elvin
;;;384          rText.y1 = rText.y0 + pItem->ySize - 1;
;;;385          if (pObj->Props.Align & (GUI_TA_RIGHT | GUI_TA_CENTER)) {
;;;386            GUI_RECT Rect;
;;;387            WM_GetInsideRectExScrollbar(pDrawItemInfo->hWin, &Rect);
;;;388            rText.x0 -= 4;	//add by elvin
;;;389            rText.x1 = rText.x0 + Rect.x1 - Rect.x0 - pObj->Widget.pEffect->EffectSize;
;;;390          } else {
;;;391            rText.x1 = rText.x0 + pItem->xSize - 1;		
;;;392          }
;;;393          GUI_DispStringInRect(s, &rText, pObj->Props.Align);
;;;394    
;;;395    	/*添加项目分隔横线,add by elvin*/
;;;396    	GUI_SetColor(GUI_LIGHTGRAY);
;;;397    	GUI_DrawHLine(pDrawItemInfo->y0 + pItem->ySize - 1,pDrawItemInfo->x0,r.x1);
;;;398    
;;;399          /* Display focus rectangle */
;;;400          if ((pObj->Flags & LISTBOX_SF_MULTISEL) && (ItemIndex == pObj->Sel)) {
;;;401            GUI_RECT rFocus;
;;;402            rFocus.x0 = pDrawItemInfo->x0;
;;;403            rFocus.x1 = r.x1;
;;;404            switch (pObj->Props.Align & GUI_TA_VERTICAL) {
;;;405            case GUI_TA_TOP:
;;;406              rFocus.y0 = pDrawItemInfo->y0;
;;;407              rFocus.y1 = pDrawItemInfo->y0 + FontDistY - 1;
;;;408              break;
;;;409            case GUI_TA_VCENTER:
;;;410              rFocus.y0 = pDrawItemInfo->y0 + (GUI_Context.WM__pUserClipRect->y1 - GUI_Context.WM__pUserClipRect->y0 - FontDistY) / 2;
;;;411              rFocus.y1 = rFocus.y0 + FontDistY - 1;
;;;412              break;
;;;413            case GUI_TA_BOTTOM:
;;;414              rFocus.y1 = pDrawItemInfo->y0 + (GUI_Context.WM__pUserClipRect->y1 - GUI_Context.WM__pUserClipRect->y0);
;;;415              rFocus.y0 = rFocus.y1 - FontDistY + 1;
;;;416              break;
;;;417            }
;;;418            LCD_SetColor(GUI_WHITE - pObj->Props.aBackColor[ColorIndex]);
;;;419            GUI_DrawFocusRect(&rFocus, 0);
;;;420          }
;;;421          return 0;
;;;422        }
;;;423      }
;;;424      return 0;
;;;425    }
00003e  b006              ADD      sp,sp,#0x18
000040  e8bd87f0          POP      {r4-r10,pc}
                  |L9.68|
000044  f9b40000          LDRSH    r0,[r4,#0]            ;337
000048  f7fffffe          BL       GUI_ALLOC_h2p
00004c  4604              MOV      r4,r0                 ;337
00004e  6c80              LDR      r0,[r0,#0x48]         ;338
000050  f7fffffe          BL       GUI_GetYDistOfFont
000054  f8b41086          LDRH     r1,[r4,#0x86]         ;338
000058  4408              ADD      r0,r0,r1              ;338
00005a  e7f0              B        |L9.62|
                  |L9.92|
00005c  f9b40000          LDRSH    r0,[r4,#0]            ;351
000060  f8d48008          LDR      r8,[r4,#8]            ;351
000064  f7fffffe          BL       GUI_ALLOC_h2p
000068  4605              MOV      r5,r0                 ;351
00006a  4641              MOV      r1,r8                 ;352
00006c  3028              ADDS     r0,r0,#0x28           ;352
00006e  f7fffffe          BL       GUI_ARRAY_GethItem
000072  f7fffffe          BL       GUI_ALLOC_h2p
000076  4607              MOV      r7,r0                 ;353
000078  a802              ADD      r0,sp,#8              ;354
00007a  f7fffffe          BL       WM_GetInsideRect
00007e  f7fffffe          BL       GUI_GetFontDistY
000082  4606              MOV      r6,r0                 ;355
000084  7938              LDRB     r0,[r7,#4]            ;357
000086  f3c00140          UBFX     r1,r0,#1,#1           ;357
00008a  f0000201          AND      r2,r0,#1              ;358
00008e  f8950084          LDRB     r0,[r5,#0x84]         ;359
000092  0740              LSLS     r0,r0,#29             ;359
000094  d503              BPL      |L9.158|
000096  b919              CBNZ     r1,|L9.160|
000098  b962              CBNZ     r2,|L9.180|
                  |L9.154|
00009a  2000              MOVS     r0,#0                 ;363
00009c  e00d              B        |L9.186|
                  |L9.158|
00009e  b109              CBZ      r1,|L9.164|
                  |L9.160|
0000a0  2003              MOVS     r0,#3                 ;367
0000a2  e00a              B        |L9.186|
                  |L9.164|
0000a4  f9b51082          LDRSH    r1,[r5,#0x82]         ;369
0000a8  4541              CMP      r1,r8                 ;369
0000aa  d1f6              BNE      |L9.154|
0000ac  f8950026          LDRB     r0,[r5,#0x26]         ;370
0000b0  07c0              LSLS     r0,r0,#31             ;370
0000b2  d001              BEQ      |L9.184|
                  |L9.180|
0000b4  2002              MOVS     r0,#2                 ;370
0000b6  e000              B        |L9.186|
                  |L9.184|
0000b8  2001              MOVS     r0,#1                 ;370
                  |L9.186|
0000ba  eb050980          ADD      r9,r5,r0,LSL #2       ;377
0000be  f8d90050          LDR      r0,[r9,#0x50]         ;377
0000c2  f7fffffe          BL       LCD_SetBkColor
0000c6  f8d90060          LDR      r0,[r9,#0x60]         ;378
0000ca  f7fffffe          BL       LCD_SetColor
0000ce  4641              MOV      r1,r8                 ;379
0000d0  4628              MOV      r0,r5                 ;379
0000d2  f7fffffe          BL       LISTBOX__GetpString
0000d6  4682              MOV      r10,r0                ;379
0000d8  2002              MOVS     r0,#2                 ;380
0000da  f7fffffe          BL       GUI_SetTextMode
0000de  f7fffffe          BL       GUI_Clear
0000e2  8a20              LDRH     r0,[r4,#0x10]         ;382
0000e4  f8ad0002          STRH     r0,[sp,#2]            ;382
0000e8  89a1              LDRH     r1,[r4,#0xc]          ;383
0000ea  1d49              ADDS     r1,r1,#5              ;383
0000ec  b209              SXTH     r1,r1                 ;383
0000ee  f8ad1000          STRH     r1,[sp,#0]            ;383
0000f2  887a              LDRH     r2,[r7,#2]            ;384
0000f4  4410              ADD      r0,r0,r2              ;384
0000f6  1e40              SUBS     r0,r0,#1              ;384
0000f8  f8ad0006          STRH     r0,[sp,#6]            ;384
0000fc  f895007c          LDRB     r0,[r5,#0x7c]         ;385
000100  0780              LSLS     r0,r0,#30             ;385
000102  d015              BEQ      |L9.304|
000104  f9b40000          LDRSH    r0,[r4,#0]            ;387
000108  a904              ADD      r1,sp,#0x10           ;387
00010a  f7fffffe          BL       WM_GetInsideRectExScrollbar
00010e  e000              B        |L9.274|
                  |L9.272|
000110  e06e              B        |L9.496|
                  |L9.274|
000112  f8bd0000          LDRH     r0,[sp,#0]            ;388
000116  1f00              SUBS     r0,r0,#4              ;388
000118  f8ad0000          STRH     r0,[sp,#0]            ;388
00011c  f8bd1014          LDRH     r1,[sp,#0x14]         ;389
000120  4408              ADD      r0,r0,r1              ;389
000122  f8bd1010          LDRH     r1,[sp,#0x10]         ;389
000126  1a40              SUBS     r0,r0,r1              ;389
000128  6a29              LDR      r1,[r5,#0x20]         ;389
00012a  8a89              LDRH     r1,[r1,#0x14]         ;389
00012c  1a40              SUBS     r0,r0,r1              ;389
00012e  e002              B        |L9.310|
                  |L9.304|
000130  8838              LDRH     r0,[r7,#0]            ;391
000132  4408              ADD      r0,r0,r1              ;391
000134  1e40              SUBS     r0,r0,#1              ;391
                  |L9.310|
000136  f8ad0004          STRH     r0,[sp,#4]            ;391
00013a  f9b5207c          LDRSH    r2,[r5,#0x7c]         ;393
00013e  4669              MOV      r1,sp                 ;393
000140  4650              MOV      r0,r10                ;393
000142  f7fffffe          BL       GUI_DispStringInRect
000146  482b              LDR      r0,|L9.500|
000148  f7fffffe          BL       GUI_SetColor
00014c  8879              LDRH     r1,[r7,#2]            ;397
00014e  6920              LDR      r0,[r4,#0x10]         ;397
000150  f9bd200c          LDRSH    r2,[sp,#0xc]          ;397
000154  4408              ADD      r0,r0,r1              ;397
000156  1e40              SUBS     r0,r0,#1              ;397
000158  68e1              LDR      r1,[r4,#0xc]          ;397
00015a  f7fffffe          BL       GUI_DrawHLine
00015e  f8950084          LDRB     r0,[r5,#0x84]         ;400
000162  0740              LSLS     r0,r0,#29             ;400
000164  d544              BPL      |L9.496|
000166  f9b51082          LDRSH    r1,[r5,#0x82]         ;400
00016a  4541              CMP      r1,r8                 ;400
00016c  d140              BNE      |L9.496|
00016e  89a0              LDRH     r0,[r4,#0xc]          ;402
000170  f8ad0010          STRH     r0,[sp,#0x10]         ;402
000174  f8bd000c          LDRH     r0,[sp,#0xc]          ;403
000178  f8ad0014          STRH     r0,[sp,#0x14]         ;403
00017c  f895007c          LDRB     r0,[r5,#0x7c]         ;404
000180  f010010c          ANDS     r1,r0,#0xc            ;404
000184  d005              BEQ      |L9.402|
000186  481c              LDR      r0,|L9.504|
000188  2904              CMP      r1,#4                 ;404
00018a  d01a              BEQ      |L9.450|
00018c  290c              CMP      r1,#0xc               ;404
00018e  d124              BNE      |L9.474|
000190  e004              B        |L9.412|
                  |L9.402|
000192  8a20              LDRH     r0,[r4,#0x10]         ;406
000194  f8ad0012          STRH     r0,[sp,#0x12]         ;406
000198  8a20              LDRH     r0,[r4,#0x10]         ;407
00019a  e00d              B        |L9.440|
                  |L9.412|
00019c  6bc0              LDR      r0,[r0,#0x3c]         ;410  ; GUI_Context
00019e  f9b01006          LDRSH    r1,[r0,#6]            ;410
0001a2  f9b00002          LDRSH    r0,[r0,#2]            ;410
0001a6  1a08              SUBS     r0,r1,r0              ;410
0001a8  1b80              SUBS     r0,r0,r6              ;410
0001aa  8a21              LDRH     r1,[r4,#0x10]         ;410
0001ac  eb0070d0          ADD      r0,r0,r0,LSR #31      ;410
0001b0  eb010060          ADD      r0,r1,r0,ASR #1       ;410
0001b4  f8ad0012          STRH     r0,[sp,#0x12]         ;410
                  |L9.440|
0001b8  1e76              SUBS     r6,r6,#1              ;410
0001ba  4430              ADD      r0,r0,r6              ;407
0001bc  f8ad0016          STRH     r0,[sp,#0x16]         ;407
0001c0  e00b              B        |L9.474|
                  |L9.450|
0001c2  6bc0              LDR      r0,[r0,#0x3c]         ;414  ; GUI_Context
0001c4  88c1              LDRH     r1,[r0,#6]            ;414
0001c6  8840              LDRH     r0,[r0,#2]            ;414
0001c8  1a08              SUBS     r0,r1,r0              ;414
0001ca  8a21              LDRH     r1,[r4,#0x10]         ;414
0001cc  4408              ADD      r0,r0,r1              ;414
0001ce  f8ad0016          STRH     r0,[sp,#0x16]         ;414
0001d2  1b80              SUBS     r0,r0,r6              ;415
0001d4  1c40              ADDS     r0,r0,#1              ;415
0001d6  f8ad0012          STRH     r0,[sp,#0x12]         ;415
                  |L9.474|
0001da  f8d90050          LDR      r0,[r9,#0x50]         ;418
0001de  f06f417f          MVN      r1,#0xff000000        ;418
0001e2  1a08              SUBS     r0,r1,r0              ;418
0001e4  f7fffffe          BL       LCD_SetColor
0001e8  2100              MOVS     r1,#0                 ;419
0001ea  a804              ADD      r0,sp,#0x10           ;419
0001ec  f7fffffe          BL       GUI_DrawFocusRect
                  |L9.496|
0001f0  2000              MOVS     r0,#0                 ;424
0001f2  e724              B        |L9.62|
;;;426    
                          ENDP

                  |L9.500|
                          DCD      0x00d3d3d3
                  |L9.504|
                          DCD      GUI_Context

                          AREA ||i.LISTBOX_SetSel||, CODE, READONLY, ALIGN=1

                  LISTBOX_SetSel PROC
;;;1215   */
;;;1216   void LISTBOX_SetSel (LISTBOX_Handle hObj, int NewSel) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  460c              MOV      r4,r1
000006  0006              MOVS     r6,r0
000008  d038              BEQ      |L10.124|
;;;1217     if (hObj) {
;;;1218       LISTBOX_Obj* pObj;
;;;1219       int MaxSel;
;;;1220       WM_LOCK();
;;;1221       pObj = LISTBOX_H2P(hObj);
00000a  f7fffffe          BL       GUI_ALLOC_h2p
00000e  4605              MOV      r5,r0
;;;1222       MaxSel = LISTBOX__GetNumItems(pObj);
000010  f7fffffe          BL       LISTBOX__GetNumItems
;;;1223       MaxSel = MaxSel ? MaxSel - 1 : 0;
000014  b100              CBZ      r0,|L10.24|
000016  1e40              SUBS     r0,r0,#1
                  |L10.24|
;;;1224       if (NewSel > MaxSel) {
000018  4284              CMP      r4,r0
00001a  dd00              BLE      |L10.30|
;;;1225         NewSel = MaxSel;
00001c  4604              MOV      r4,r0
                  |L10.30|
;;;1226       }
;;;1227       if (NewSel < 0) {
;;;1228         NewSel = -1;
00001e  f04f37ff          MOV      r7,#0xffffffff
000022  2c00              CMP      r4,#0                 ;1227
000024  db0a              BLT      |L10.60|
;;;1229       } else {
;;;1230         WM_HMEM hItem = GUI_ARRAY_GethItem(&pObj->ItemArray, NewSel);
000026  4621              MOV      r1,r4
000028  f1050028          ADD      r0,r5,#0x28
00002c  f7fffffe          BL       GUI_ARRAY_GethItem
;;;1231         if (hItem) {
000030  b128              CBZ      r0,|L10.62|
;;;1232           LISTBOX_ITEM* pItem = (LISTBOX_ITEM*)GUI_ALLOC_h2p(hItem);
000032  f7fffffe          BL       GUI_ALLOC_h2p
;;;1233           if (pItem->Status & LISTBOX_ITEM_DISABLED) {
000036  7900              LDRB     r0,[r0,#4]
000038  0780              LSLS     r0,r0,#30
00003a  d500              BPL      |L10.62|
                  |L10.60|
;;;1234             NewSel = -1;
00003c  463c              MOV      r4,r7
                  |L10.62|
;;;1235           }
;;;1236         }
;;;1237       }
;;;1238       if (NewSel != pObj->Sel) {
00003e  f9b57082          LDRSH    r7,[r5,#0x82]
000042  42a7              CMP      r7,r4
000044  d01a              BEQ      |L10.124|
;;;1239         int OldSel;
;;;1240         OldSel    = pObj->Sel;
;;;1241         pObj->Sel = NewSel;
000046  f8a54082          STRH     r4,[r5,#0x82]
;;;1242         if (_UpdateScrollPos(hObj, pObj)) {
00004a  4629              MOV      r1,r5
00004c  4630              MOV      r0,r6
00004e  f7fffffe          BL       _UpdateScrollPos
000052  b118              CBZ      r0,|L10.92|
;;;1243           LISTBOX__InvalidateInsideArea(hObj);
000054  4630              MOV      r0,r6
000056  f7fffffe          BL       LISTBOX__InvalidateInsideArea
00005a  e009              B        |L10.112|
                  |L10.92|
;;;1244         } else {
;;;1245           LISTBOX__InvalidateItem(hObj, pObj, OldSel);
00005c  463a              MOV      r2,r7
00005e  4629              MOV      r1,r5
000060  4630              MOV      r0,r6
000062  f7fffffe          BL       LISTBOX__InvalidateItem
;;;1246           LISTBOX__InvalidateItem(hObj, pObj, NewSel);
000066  4622              MOV      r2,r4
000068  4629              MOV      r1,r5
00006a  4630              MOV      r0,r6
00006c  f7fffffe          BL       LISTBOX__InvalidateItem
                  |L10.112|
;;;1247         }
;;;1248         _NotifyOwner(hObj, WM_NOTIFICATION_SEL_CHANGED);
000070  4630              MOV      r0,r6
000072  e8bd41f0          POP      {r4-r8,lr}
000076  2104              MOVS     r1,#4
000078  f7ffbffe          B.W      _NotifyOwner
                  |L10.124|
;;;1249       }
;;;1250       WM_UNLOCK();
;;;1251     }
;;;1252   }
00007c  e8bd81f0          POP      {r4-r8,pc}
;;;1253   
                          ENDP


                          AREA ||i.LISTBOX_SetText||, CODE, READONLY, ALIGN=1

                  LISTBOX_SetText PROC
;;;1196   */
;;;1197   void LISTBOX_SetText(LISTBOX_Handle hObj, const GUI_ConstString* ppText) {
000000  b570              PUSH     {r4-r6,lr}
000002  460d              MOV      r5,r1
000004  0006              MOVS     r6,r0
000006  d011              BEQ      |L11.44|
;;;1198     if (hObj) {
;;;1199       int i;
;;;1200       const char* s;
;;;1201       WM_LOCK();
;;;1202       if (ppText) {
000008  b14d              CBZ      r5,|L11.30|
;;;1203         for (i = 0; (s = *(ppText+i)) != 0; i++) {
00000a  2400              MOVS     r4,#0
00000c  e003              B        |L11.22|
                  |L11.14|
;;;1204           LISTBOX_AddString(hObj, s);
00000e  4630              MOV      r0,r6
000010  f7fffffe          BL       LISTBOX_AddString
000014  1c64              ADDS     r4,r4,#1
                  |L11.22|
000016  f8551024          LDR      r1,[r5,r4,LSL #2]     ;1203
00001a  2900              CMP      r1,#0                 ;1203
00001c  d1f7              BNE      |L11.14|
                  |L11.30|
;;;1205         }
;;;1206       }
;;;1207       LISTBOX_InvalidateItem(hObj, LISTBOX_ALL_ITEMS);
00001e  4630              MOV      r0,r6
000020  e8bd4070          POP      {r4-r6,lr}
000024  f04f31ff          MOV      r1,#0xffffffff
000028  f7ffbffe          B.W      LISTBOX_InvalidateItem
                  |L11.44|
;;;1208       WM_UNLOCK();
;;;1209     }
;;;1210   }
00002c  bd70              POP      {r4-r6,pc}
;;;1211   
                          ENDP


                          AREA ||i.LISTBOX_UpdateScrollers||, CODE, READONLY, ALIGN=1

                  LISTBOX_UpdateScrollers PROC
;;;504    */
;;;505    int LISTBOX_UpdateScrollers(LISTBOX_Handle hObj) {
000000  b57c              PUSH     {r2-r6,lr}
000002  4605              MOV      r5,r0
;;;506      _ManageAutoScroll(hObj);
000004  f7fffffe          BL       _ManageAutoScroll
000008  4628              MOV      r0,r5
00000a  f7fffffe          BL       GUI_ALLOC_h2p
00000e  4604              MOV      r4,r0
000010  f7fffffe          BL       LISTBOX__GetNumItems
000014  6320              STR      r0,[r4,#0x30]
000016  4629              MOV      r1,r5
000018  4620              MOV      r0,r4
00001a  f7fffffe          BL       _GetNumVisItems
00001e  63a0              STR      r0,[r4,#0x38]
000020  4669              MOV      r1,sp
000022  4628              MOV      r0,r5
000024  f7fffffe          BL       WM_GetInsideRectExScrollbar
000028  4628              MOV      r0,r5
00002a  f7fffffe          BL       _GetContentsSizeX
00002e  63e0              STR      r0,[r4,#0x3c]
000030  f9bd0004          LDRSH    r0,[sp,#4]
000034  f9bd1000          LDRSH    r1,[sp,#0]
000038  1a40              SUBS     r0,r0,r1
00003a  1c40              ADDS     r0,r0,#1
00003c  6460              STR      r0,[r4,#0x44]
00003e  4621              MOV      r1,r4
000040  4628              MOV      r0,r5
000042  f7fffffe          BL       _UpdateScrollPos
;;;507      return _CalcScrollParas(hObj);
;;;508    }
000046  bd7c              POP      {r2-r6,pc}
;;;509    
                          ENDP


                          AREA ||i.LISTBOX__GetNumItems||, CODE, READONLY, ALIGN=1

                  LISTBOX__GetNumItems PROC
;;;859    */
;;;860    unsigned LISTBOX__GetNumItems(const LISTBOX_Obj* pObj) {
000000  3028              ADDS     r0,r0,#0x28
;;;861      return GUI_ARRAY_GetNumItems(&pObj->ItemArray);
000002  f7ffbffe          B.W      GUI_ARRAY_GetNumItems
;;;862    }
;;;863    
                          ENDP


                          AREA ||i.LISTBOX__GetpString||, CODE, READONLY, ALIGN=1

                  LISTBOX__GetpString PROC
;;;870    */
;;;871    const char* LISTBOX__GetpString(const LISTBOX_Obj* pObj, int Index) {
000000  b510              PUSH     {r4,lr}
;;;872      const char* s = NULL;
000002  2400              MOVS     r4,#0
000004  3028              ADDS     r0,r0,#0x28
;;;873      LISTBOX_ITEM* pItem = (LISTBOX_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000006  f7fffffe          BL       GUI_ARRAY_GetpItem
;;;874      if (pItem) {
00000a  b100              CBZ      r0,|L14.14|
00000c  1d44              ADDS     r4,r0,#5
                  |L14.14|
;;;875        s = pItem->acText;
;;;876      }
;;;877      return s;
00000e  4620              MOV      r0,r4
;;;878    }
000010  bd10              POP      {r4,pc}
;;;879    
                          ENDP


                          AREA ||i.LISTBOX__InvalidateInsideArea||, CODE, READONLY, ALIGN=1

                  LISTBOX__InvalidateInsideArea PROC
;;;896    */
;;;897    void LISTBOX__InvalidateInsideArea(LISTBOX_Handle hObj) {
000000  b51c              PUSH     {r2-r4,lr}
000002  4604              MOV      r4,r0
;;;898      GUI_RECT Rect;
;;;899      WM_GetInsideRectExScrollbar(hObj, &Rect);
000004  4669              MOV      r1,sp
000006  f7fffffe          BL       WM_GetInsideRectExScrollbar
;;;900      WM_InvalidateRect(hObj, &Rect);
00000a  4669              MOV      r1,sp
00000c  4620              MOV      r0,r4
00000e  f7fffffe          BL       WM_InvalidateRect
;;;901    }
000012  bd1c              POP      {r2-r4,pc}
;;;902    
                          ENDP


                          AREA ||i.LISTBOX__InvalidateItem||, CODE, READONLY, ALIGN=1

                  LISTBOX__InvalidateItem PROC
;;;906    */
;;;907    void LISTBOX__InvalidateItem(LISTBOX_Handle hObj, const LISTBOX_Obj* pObj, int Sel) {
000000  e92d41fc          PUSH     {r2-r8,lr}
000004  0015              MOVS     r5,r2
000006  460f              MOV      r7,r1
000008  4606              MOV      r6,r0
00000a  d41a              BMI      |L16.66|
;;;908      if (Sel >= 0) {
;;;909        int ItemPosY;
;;;910        ItemPosY = _GetItemPosY(hObj, pObj, Sel);
00000c  f7fffffe          BL       _GetItemPosY
000010  0004              MOVS     r4,r0
;;;911        if (ItemPosY >= 0) {
000012  d416              BMI      |L16.66|
;;;912          GUI_RECT Rect;
;;;913          int ItemDistY;
;;;914          ItemDistY = _GetItemSizeY(hObj, pObj, Sel);
000014  462a              MOV      r2,r5
000016  4639              MOV      r1,r7
000018  4630              MOV      r0,r6
00001a  f7fffffe          BL       _GetItemSizeY
00001e  4605              MOV      r5,r0
;;;915          WM_GetInsideRectExScrollbar(hObj, &Rect);
000020  4669              MOV      r1,sp
000022  4630              MOV      r0,r6
000024  f7fffffe          BL       WM_GetInsideRectExScrollbar
;;;916          Rect.y0 += ItemPosY;
000028  f8bd0002          LDRH     r0,[sp,#2]
00002c  1e6d              SUBS     r5,r5,#1
00002e  1901              ADDS     r1,r0,r4
;;;917          Rect.y1  = Rect.y0 + ItemDistY - 1;
000030  1948              ADDS     r0,r1,r5
000032  f8ad1002          STRH     r1,[sp,#2]            ;916
000036  f8ad0006          STRH     r0,[sp,#6]
;;;918          WM_InvalidateRect(hObj, &Rect);
00003a  4669              MOV      r1,sp
00003c  4630              MOV      r0,r6
00003e  f7fffffe          BL       WM_InvalidateRect
                  |L16.66|
;;;919        }
;;;920      }
;;;921    }
000042  e8bd81fc          POP      {r2-r8,pc}
;;;922    
                          ENDP


                          AREA ||i.LISTBOX__InvalidateItemAndBelow||, CODE, READONLY, ALIGN=1

                  LISTBOX__InvalidateItemAndBelow PROC
;;;926    */
;;;927    void LISTBOX__InvalidateItemAndBelow(LISTBOX_Handle hObj, const LISTBOX_Obj* pObj, int Sel) {
000000  b57c              PUSH     {r2-r6,lr}
000002  4605              MOV      r5,r0
;;;928      if (Sel >= 0) {
000004  2a00              CMP      r2,#0
000006  db10              BLT      |L17.42|
;;;929        int ItemPosY;
;;;930        ItemPosY = _GetItemPosY(hObj, pObj, Sel);
000008  f7fffffe          BL       _GetItemPosY
00000c  0004              MOVS     r4,r0
;;;931        if (ItemPosY >= 0) {
00000e  d40c              BMI      |L17.42|
;;;932          GUI_RECT Rect;
;;;933          WM_GetInsideRectExScrollbar(hObj, &Rect);
000010  4669              MOV      r1,sp
000012  4628              MOV      r0,r5
000014  f7fffffe          BL       WM_GetInsideRectExScrollbar
;;;934          Rect.y0 += ItemPosY;
000018  f8bd0002          LDRH     r0,[sp,#2]
;;;935          WM_InvalidateRect(hObj, &Rect);
00001c  4669              MOV      r1,sp
00001e  4420              ADD      r0,r0,r4              ;934
000020  f8ad0002          STRH     r0,[sp,#2]            ;934
000024  4628              MOV      r0,r5
000026  f7fffffe          BL       WM_InvalidateRect
                  |L17.42|
;;;936        }
;;;937      }
;;;938    }
00002a  bd7c              POP      {r2-r6,pc}
;;;939    
                          ENDP


                          AREA ||i.LISTBOX__InvalidateItemSize||, CODE, READONLY, ALIGN=1

                  LISTBOX__InvalidateItemSize PROC
;;;883    */
;;;884    void LISTBOX__InvalidateItemSize(const LISTBOX_Obj* pObj, unsigned Index) {
000000  b510              PUSH     {r4,lr}
000002  3028              ADDS     r0,r0,#0x28
;;;885      LISTBOX_ITEM* pItem;
;;;886      pItem = (LISTBOX_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
000004  f7fffffe          BL       GUI_ARRAY_GetpItem
;;;887      if (pItem) {
000008  2800              CMP      r0,#0
00000a  d002              BEQ      |L18.18|
;;;888        pItem->xSize = 0;
00000c  2100              MOVS     r1,#0
00000e  8001              STRH     r1,[r0,#0]
;;;889        pItem->ySize = 0;
000010  8041              STRH     r1,[r0,#2]
                  |L18.18|
;;;890      }
;;;891    }
000012  bd10              POP      {r4,pc}
;;;892    
                          ENDP


                          AREA ||i.LISTBOX__SetScrollbarColor||, CODE, READONLY, ALIGN=2

                  LISTBOX__SetScrollbarColor PROC
;;;960    */
;;;961    void LISTBOX__SetScrollbarColor(LISTBOX_Handle hObj, const LISTBOX_Obj* pObj) {
000000  e92d47f0          PUSH     {r4-r10,lr}
000004  460e              MOV      r6,r1
000006  4604              MOV      r4,r0
;;;962      WM_HWIN hBarH, hBarV;
;;;963      int i;
;;;964      hBarH = WM_GetDialogItem(hObj, GUI_ID_HSCROLL);
000008  21ff              MOVS     r1,#0xff
00000a  f7fffffe          BL       WM_GetDialogItem
00000e  4681              MOV      r9,r0
;;;965      hBarV = WM_GetDialogItem(hObj, GUI_ID_VSCROLL);
000010  21fe              MOVS     r1,#0xfe
000012  4620              MOV      r0,r4
000014  f7fffffe          BL       WM_GetDialogItem
000018  4605              MOV      r5,r0
;;;966      if (hBarH || hBarV) {
00001a  ea590005          ORRS     r0,r9,r5
00001e  d014              BEQ      |L19.74|
;;;967        for (i = 0; i < GUI_COUNTOF(pObj->Props.aScrollbarColor); i++) {
000020  2400              MOVS     r4,#0
;;;968          if (pObj->Props.aScrollbarColor[i] != GUI_INVALID_COLOR) {
000022  f06f4870          MVN      r8,#0xf0000000
000026  bf00              NOP      
                  |L19.40|
000028  eb060784          ADD      r7,r6,r4,LSL #2
00002c  6f3a              LDR      r2,[r7,#0x70]
00002e  4542              CMP      r2,r8
000030  d008              BEQ      |L19.68|
;;;969            SCROLLBAR_SetColor(hBarH, i, pObj->Props.aScrollbarColor[i]);
000032  4621              MOV      r1,r4
000034  4648              MOV      r0,r9
000036  f7fffffe          BL       SCROLLBAR_SetColor
;;;970            SCROLLBAR_SetColor(hBarV, i, pObj->Props.aScrollbarColor[i]);
00003a  4621              MOV      r1,r4
00003c  4628              MOV      r0,r5
00003e  6f3a              LDR      r2,[r7,#0x70]
000040  f7fffffe          BL       SCROLLBAR_SetColor
                  |L19.68|
000044  1c64              ADDS     r4,r4,#1
000046  2c03              CMP      r4,#3                 ;967
000048  d3ee              BCC      |L19.40|
                  |L19.74|
;;;971          }
;;;972        }
;;;973      }
;;;974    }
00004a  e8bd87f0          POP      {r4-r10,pc}
;;;975    
                          ENDP


                          AREA ||i.LISTBOX__SetScrollbarWidth||, CODE, READONLY, ALIGN=1

                  LISTBOX__SetScrollbarWidth PROC
;;;943    */
;;;944    void LISTBOX__SetScrollbarWidth(LISTBOX_Handle hObj, const LISTBOX_Obj* pObj) {
000000  b570              PUSH     {r4-r6,lr}
;;;945      WM_HWIN hBarH, hBarV;
;;;946      int Width;
;;;947      Width = pObj->ScrollbarWidth;
000002  f8914085          LDRB     r4,[r1,#0x85]
000006  4605              MOV      r5,r0                 ;944
000008  b914              CBNZ     r4,|L20.16|
;;;948      if (Width == 0) {
;;;949        Width = SCROLLBAR_GetDefaultWidth();
00000a  f7fffffe          BL       SCROLLBAR_GetDefaultWidth
00000e  4604              MOV      r4,r0
                  |L20.16|
;;;950      }
;;;951      hBarH = WM_GetDialogItem(hObj, GUI_ID_HSCROLL);
000010  21ff              MOVS     r1,#0xff
000012  4628              MOV      r0,r5
000014  f7fffffe          BL       WM_GetDialogItem
000018  4606              MOV      r6,r0
;;;952      hBarV = WM_GetDialogItem(hObj, GUI_ID_VSCROLL);
00001a  21fe              MOVS     r1,#0xfe
00001c  4628              MOV      r0,r5
00001e  f7fffffe          BL       WM_GetDialogItem
000022  4605              MOV      r5,r0
;;;953      SCROLLBAR_SetWidth(hBarH, Width);
000024  4621              MOV      r1,r4
000026  4630              MOV      r0,r6
000028  f7fffffe          BL       SCROLLBAR_SetWidth
;;;954      SCROLLBAR_SetWidth(hBarV, Width);
00002c  4621              MOV      r1,r4
00002e  4628              MOV      r0,r5
000030  e8bd4070          POP      {r4-r6,lr}
000034  f7ffbffe          B.W      SCROLLBAR_SetWidth
;;;955    }
;;;956    
                          ENDP


                          AREA ||i._AddKey||, CODE, READONLY, ALIGN=1

                  _AddKey PROC
;;;795    */
;;;796    static int _AddKey(LISTBOX_Handle hObj, int Key) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  460c              MOV      r4,r1
000006  4605              MOV      r5,r0
;;;797      LISTBOX_Obj* pObj;
;;;798      pObj = LISTBOX_H2P(hObj);
000008  f7fffffe          BL       GUI_ALLOC_h2p
;;;799      switch (Key) {
00000c  2c12              CMP      r4,#0x12
00000e  d01d              BEQ      |L21.76|
000010  dc04              BGT      |L21.28|
000012  2c10              CMP      r4,#0x10
000014  d026              BEQ      |L21.100|
000016  2c11              CMP      r4,#0x11
000018  d104              BNE      |L21.36|
00001a  e031              B        |L21.128|
                  |L21.28|
00001c  2c13              CMP      r4,#0x13
00001e  d02b              BEQ      |L21.120|
000020  2c20              CMP      r4,#0x20
000022  d00c              BEQ      |L21.62|
                  |L21.36|
;;;800      case GUI_KEY_SPACE:
;;;801        _ToggleMultiSel(hObj, pObj, pObj->Sel);
;;;802        return 1;               /* Key has been consumed */
;;;803      case GUI_KEY_RIGHT:
;;;804        if (WM_SetScrollValue(&pObj->ScrollStateH, pObj->ScrollStateH.v + pObj->Props.ScrollStepH)) {
;;;805          LISTBOX_UpdateScrollers(hObj);
;;;806          LISTBOX__InvalidateInsideArea(hObj);
;;;807        }
;;;808        return 1;               /* Key has been consumed */
;;;809      case GUI_KEY_LEFT:
;;;810        if (WM_SetScrollValue(&pObj->ScrollStateH, pObj->ScrollStateH.v - pObj->Props.ScrollStepH)) {
;;;811          LISTBOX_UpdateScrollers(hObj);
;;;812          LISTBOX__InvalidateInsideArea(hObj);
;;;813        }
;;;814        return 1;               /* Key has been consumed */
;;;815      case GUI_KEY_DOWN:
;;;816        LISTBOX_IncSel(hObj);
;;;817        return 1;               /* Key has been consumed */
;;;818      case GUI_KEY_UP:
;;;819        LISTBOX_DecSel(hObj);
;;;820        return 1;               /* Key has been consumed */
;;;821      default:
;;;822        if(_IsAlphaNum(Key)) {
000024  4620              MOV      r0,r4
000026  f7fffffe          BL       _Tolower
00002a  f1a00161          SUB      r1,r0,#0x61
00002e  2919              CMP      r1,#0x19
000030  d92a              BLS      |L21.136|
000032  3830              SUBS     r0,r0,#0x30
000034  2809              CMP      r0,#9
000036  d927              BLS      |L21.136|
;;;823          _SelectByKey(hObj, Key);
;;;824          return 1;               /* Key has been consumed */
;;;825        }
;;;826      }
;;;827      return 0;
000038  2000              MOVS     r0,#0
                  |L21.58|
;;;828    }
00003a  e8bd81f0          POP      {r4-r8,pc}
                  |L21.62|
00003e  f9b02082          LDRSH    r2,[r0,#0x82]         ;801
000042  4601              MOV      r1,r0                 ;801
000044  4628              MOV      r0,r5                 ;801
000046  f7fffffe          BL       _ToggleMultiSel
00004a  e03b              B        |L21.196|
                  |L21.76|
00004c  f8b0204c          LDRH     r2,[r0,#0x4c]         ;804
000050  6c01              LDR      r1,[r0,#0x40]         ;804
000052  4411              ADD      r1,r1,r2              ;804
000054  e00a              B        |L21.108|
                  |L21.86|
000056  4628              MOV      r0,r5                 ;805
000058  f7fffffe          BL       LISTBOX_UpdateScrollers
00005c  4628              MOV      r0,r5                 ;806
00005e  f7fffffe          BL       LISTBOX__InvalidateInsideArea
000062  e02f              B        |L21.196|
                  |L21.100|
000064  f8b0204c          LDRH     r2,[r0,#0x4c]         ;810
000068  6c01              LDR      r1,[r0,#0x40]         ;810
00006a  1a89              SUBS     r1,r1,r2              ;810
                  |L21.108|
00006c  303c              ADDS     r0,r0,#0x3c           ;810
00006e  f7fffffe          BL       WM_SetScrollValue
000072  2800              CMP      r0,#0                 ;804
000074  d1ef              BNE      |L21.86|
000076  e025              B        |L21.196|
                  |L21.120|
000078  4628              MOV      r0,r5                 ;816
00007a  f7fffffe          BL       LISTBOX_IncSel
00007e  e021              B        |L21.196|
                  |L21.128|
000080  4628              MOV      r0,r5                 ;819
000082  f7fffffe          BL       LISTBOX_DecSel
000086  e01d              B        |L21.196|
                  |L21.136|
000088  4628              MOV      r0,r5                 ;820
00008a  f7fffffe          BL       GUI_ALLOC_h2p
00008e  4607              MOV      r7,r0                 ;820
000090  4620              MOV      r0,r4                 ;820
000092  f7fffffe          BL       _Tolower
000096  4606              MOV      r6,r0                 ;820
000098  2400              MOVS     r4,#0                 ;820
00009a  e00e              B        |L21.186|
                  |L21.156|
00009c  4621              MOV      r1,r4                 ;823
00009e  4638              MOV      r0,r7                 ;823
0000a0  f7fffffe          BL       LISTBOX__GetpString
0000a4  7800              LDRB     r0,[r0,#0]            ;823
0000a6  f7fffffe          BL       _Tolower
0000aa  42b0              CMP      r0,r6                 ;823
0000ac  d104              BNE      |L21.184|
0000ae  4621              MOV      r1,r4                 ;823
0000b0  4628              MOV      r0,r5                 ;823
0000b2  f7fffffe          BL       LISTBOX_SetSel
0000b6  e005              B        |L21.196|
                  |L21.184|
0000b8  1c64              ADDS     r4,r4,#1              ;823
                  |L21.186|
0000ba  4638              MOV      r0,r7                 ;823
0000bc  f7fffffe          BL       LISTBOX__GetNumItems
0000c0  42a0              CMP      r0,r4                 ;823
0000c2  d8eb              BHI      |L21.156|
                  |L21.196|
0000c4  2001              MOVS     r0,#1                 ;824
0000c6  e7b8              B        |L21.58|
;;;829    
                          ENDP


                          AREA ||i._CallOwnerDraw||, CODE, READONLY, ALIGN=1

                  _CallOwnerDraw PROC
;;;127    */
;;;128    static int _CallOwnerDraw(LISTBOX_Handle hObj, const LISTBOX_Obj* pObj, int Cmd, int ItemIndex) {
000000  b500              PUSH     {lr}
000002  b085              SUB      sp,sp,#0x14
;;;129      WIDGET_ITEM_DRAW_INFO ItemInfo;
;;;130      int r;
;;;131      ItemInfo.Cmd       = Cmd;
;;;132      ItemInfo.hWin      = hObj;
000004  9201              STR      r2,[sp,#4]
000006  f8ad0000          STRH     r0,[sp,#0]
;;;133      ItemInfo.ItemIndex = ItemIndex;
;;;134      if (pObj->pfDrawItem) {
00000a  9302              STR      r3,[sp,#8]
00000c  6ac9              LDR      r1,[r1,#0x2c]
;;;135        r = pObj->pfDrawItem(&ItemInfo);
;;;136      } else {
;;;137        r = LISTBOX_OwnerDraw(&ItemInfo);
00000e  4668              MOV      r0,sp
000010  b111              CBZ      r1,|L22.24|
000012  4788              BLX      r1                    ;135
                  |L22.20|
;;;138      }
;;;139      return r;
;;;140    }
000014  b005              ADD      sp,sp,#0x14
000016  bd00              POP      {pc}
                  |L22.24|
000018  f7fffffe          BL       LISTBOX_OwnerDraw
00001c  e7fa              B        |L22.20|
;;;141    
                          ENDP


                          AREA ||i._GetContentsSizeX||, CODE, READONLY, ALIGN=1

                  _GetContentsSizeX PROC
;;;201    */
;;;202    static int _GetContentsSizeX(LISTBOX_Handle hObj) {
000000  e92d5ff0          PUSH     {r4-r12,lr}
000004  4682              MOV      r10,r0
;;;203      LISTBOX_Obj* pObj;
;;;204      int i, NumItems, SizeX;
;;;205      int Result = 0;
000006  f04f0900          MOV      r9,#0
;;;206      pObj = LISTBOX_H2P(hObj);
00000a  f7fffffe          BL       GUI_ALLOC_h2p
00000e  4605              MOV      r5,r0
;;;207      NumItems = LISTBOX__GetNumItems(pObj);
000010  f7fffffe          BL       LISTBOX__GetNumItems
000014  4607              MOV      r7,r0
;;;208      for (i = 0; i < NumItems; i++) {
000016  2400              MOVS     r4,#0
000018  e01f              B        |L23.90|
                  |L23.26|
00001a  4621              MOV      r1,r4
00001c  f1050028          ADD      r0,r5,#0x28
000020  f7fffffe          BL       GUI_ARRAY_GetpItem
000024  0006              MOVS     r6,r0
000026  d003              BEQ      |L23.48|
000028  8830              LDRH     r0,[r6,#0]
00002a  ea5f0800          MOVS     r8,r0
00002e  d10e              BNE      |L23.78|
                  |L23.48|
000030  6ca8              LDR      r0,[r5,#0x48]
000032  f7fffffe          BL       GUI_SetFont
000036  4683              MOV      r11,r0
000038  4623              MOV      r3,r4
00003a  2201              MOVS     r2,#1
00003c  4629              MOV      r1,r5
00003e  4650              MOV      r0,r10
000040  f7fffffe          BL       _CallOwnerDraw
000044  4680              MOV      r8,r0
000046  4658              MOV      r0,r11
000048  f7fffffe          BL       GUI_SetFont
00004c  b10e              CBZ      r6,|L23.82|
                  |L23.78|
00004e  f8a68000          STRH     r8,[r6,#0]
                  |L23.82|
;;;209        SizeX = _GetItemSizeX(hObj, pObj, i);
;;;210        if (Result < SizeX) {
000052  45c1              CMP      r9,r8
000054  da00              BGE      |L23.88|
;;;211          Result = SizeX;
000056  46c1              MOV      r9,r8
                  |L23.88|
000058  1c64              ADDS     r4,r4,#1
                  |L23.90|
00005a  42bc              CMP      r4,r7                 ;208
00005c  dbdd              BLT      |L23.26|
;;;212        }
;;;213      }
;;;214      return Result;
00005e  4648              MOV      r0,r9
;;;215    }
000060  e8bd9ff0          POP      {r4-r12,pc}
;;;216    
                          ENDP


                          AREA ||i._GetItemPosY||, CODE, READONLY, ALIGN=1

                  _GetItemPosY PROC
;;;220    */
;;;221    static int _GetItemPosY(LISTBOX_Handle hObj, const LISTBOX_Obj* pObj, unsigned Index) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4680              MOV      r8,r0
000006  4615              MOV      r5,r2
000008  460f              MOV      r7,r1
;;;222      if (Index < LISTBOX__GetNumItems(pObj)) {
00000a  4608              MOV      r0,r1
00000c  f7fffffe          BL       LISTBOX__GetNumItems
000010  42a8              CMP      r0,r5
000012  d910              BLS      |L24.54|
;;;223        if ((int)Index >= pObj->ScrollStateV.v) {
000014  6b7c              LDR      r4,[r7,#0x34]
000016  42ac              CMP      r4,r5
000018  dc0d              BGT      |L24.54|
;;;224          unsigned i;
;;;225          int PosY = 0;
00001a  2600              MOVS     r6,#0
;;;226          for (i = pObj->ScrollStateV.v; i < Index; i++) {
00001c  e006              B        |L24.44|
                  |L24.30|
;;;227            PosY += _GetItemSizeY(hObj, pObj, i);
00001e  4622              MOV      r2,r4
000020  4639              MOV      r1,r7
000022  4640              MOV      r0,r8
000024  f7fffffe          BL       _GetItemSizeY
000028  4406              ADD      r6,r6,r0
00002a  1c64              ADDS     r4,r4,#1
                  |L24.44|
00002c  42ac              CMP      r4,r5                 ;226
00002e  d3f6              BCC      |L24.30|
;;;228          }
;;;229          return PosY;
000030  4630              MOV      r0,r6
                  |L24.50|
;;;230        }
;;;231      }
;;;232      return -1;
;;;233    }
000032  e8bd81f0          POP      {r4-r8,pc}
                  |L24.54|
000036  f04f30ff          MOV      r0,#0xffffffff        ;232
00003a  e7fa              B        |L24.50|
;;;234    
                          ENDP


                          AREA ||i._GetItemSizeY||, CODE, READONLY, ALIGN=1

                  _GetItemSizeY PROC
;;;178    */
;;;179    static int _GetItemSizeY(LISTBOX_Handle hObj, const LISTBOX_Obj* pObj, unsigned Index) {
000000  e92d47f0          PUSH     {r4-r10,lr}
000004  460e              MOV      r6,r1
000006  4681              MOV      r9,r0
000008  4690              MOV      r8,r2
;;;180      LISTBOX_ITEM* pItem;
;;;181      int ySize = 0;
;;;182      pItem = (LISTBOX_ITEM*)GUI_ARRAY_GetpItem(&pObj->ItemArray, Index);
00000a  4611              MOV      r1,r2
00000c  f1060028          ADD      r0,r6,#0x28
000010  f7fffffe          BL       GUI_ARRAY_GetpItem
000014  0004              MOVS     r4,r0
;;;183      if (pItem) {
000016  d001              BEQ      |L25.28|
;;;184        ySize = pItem->ySize;
000018  8865              LDRH     r5,[r4,#2]
00001a  b975              CBNZ     r5,|L25.58|
                  |L25.28|
;;;185      }
;;;186      if (ySize == 0) {
;;;187        const GUI_FONT GUI_UNI_PTR* pOldFont;
;;;188        pOldFont = GUI_SetFont(pObj->Props.pFont);
00001c  6cb0              LDR      r0,[r6,#0x48]
00001e  f7fffffe          BL       GUI_SetFont
000022  4607              MOV      r7,r0
;;;189        ySize    = _CallOwnerDraw(hObj, pObj, WIDGET_ITEM_GET_YSIZE, Index);
000024  4643              MOV      r3,r8
000026  2202              MOVS     r2,#2
000028  4631              MOV      r1,r6
00002a  4648              MOV      r0,r9
00002c  f7fffffe          BL       _CallOwnerDraw
000030  4605              MOV      r5,r0
;;;190        GUI_SetFont(pOldFont);
000032  4638              MOV      r0,r7
000034  f7fffffe          BL       GUI_SetFont
;;;191      }
000038  b104              CBZ      r4,|L25.60|
                  |L25.58|
;;;192      if (pItem) {
;;;193        pItem->ySize = ySize;
00003a  8065              STRH     r5,[r4,#2]
                  |L25.60|
;;;194      }
;;;195      return ySize;
00003c  4628              MOV      r0,r5
;;;196    }
00003e  e8bd87f0          POP      {r4-r10,pc}
;;;197    
                          ENDP


                          AREA ||i._GetNumVisItems||, CODE, READONLY, ALIGN=1

                  _GetNumVisItems PROC
;;;261    */
;;;262    static unsigned _GetNumVisItems(const LISTBOX_Obj* pObj, LISTBOX_Handle hObj) {
000000  e92d47f0          PUSH     {r4-r10,lr}
000004  4688              MOV      r8,r1
000006  4681              MOV      r9,r0
;;;263      int NumItems, r = 1;
000008  2401              MOVS     r4,#1
;;;264      NumItems = LISTBOX__GetNumItems(pObj);
00000a  f7fffffe          BL       LISTBOX__GetNumItems
00000e  4605              MOV      r5,r0
;;;265      if (NumItems > 1) {
000010  2801              CMP      r0,#1
000012  dd17              BLE      |L26.68|
;;;266        int i, ySize, DistY = 0;
000014  2600              MOVS     r6,#0
;;;267        ySize = _GetYSize(hObj);
000016  4640              MOV      r0,r8
000018  f7fffffe          BL       _GetYSize
00001c  4607              MOV      r7,r0
;;;268        for (i = NumItems - 1; i >= 0; i--) {
00001e  1e6c              SUBS     r4,r5,#1
000020  d409              BMI      |L26.54|
                  |L26.34|
;;;269          DistY += _GetItemSizeY(hObj, pObj, i);
000022  4622              MOV      r2,r4
000024  4649              MOV      r1,r9
000026  4640              MOV      r0,r8
000028  f7fffffe          BL       _GetItemSizeY
00002c  4406              ADD      r6,r6,r0
;;;270          if (DistY > ySize) {
00002e  42be              CMP      r6,r7
000030  dc01              BGT      |L26.54|
000032  1e64              SUBS     r4,r4,#1
000034  d5f5              BPL      |L26.34|
                  |L26.54|
;;;271            break;
;;;272          }
;;;273        }
;;;274        r = NumItems - i - 1;
000036  1b2c              SUBS     r4,r5,r4
000038  1e64              SUBS     r4,r4,#1
;;;275        if (r < 1) {
00003a  2c01              CMP      r4,#1
00003c  da02              BGE      |L26.68|
;;;276          return 1;
00003e  2001              MOVS     r0,#1
                  |L26.64|
;;;277        }
;;;278      }
;;;279      return r;
;;;280    }
000040  e8bd87f0          POP      {r4-r10,pc}
                  |L26.68|
000044  4620              MOV      r0,r4                 ;279
000046  e7fb              B        |L26.64|
;;;281    
                          ENDP


                          AREA ||i._GetYSize||, CODE, READONLY, ALIGN=1

                  _GetYSize PROC
;;;145    */
;;;146    static int _GetYSize(LISTBOX_Handle hObj) {
000000  b51c              PUSH     {r2-r4,lr}
;;;147      GUI_RECT Rect;
;;;148      WM_GetInsideRectExScrollbar(hObj, &Rect);
000002  4669              MOV      r1,sp
000004  f7fffffe          BL       WM_GetInsideRectExScrollbar
;;;149      return (Rect.y1 - Rect.y0 + 1);
000008  f9bd0006          LDRSH    r0,[sp,#6]
00000c  f9bd1002          LDRSH    r1,[sp,#2]
000010  1a40              SUBS     r0,r0,r1
000012  1c40              ADDS     r0,r0,#1
;;;150    }
000014  bd1c              POP      {r2-r4,pc}
;;;151    
                          ENDP


                          AREA ||i._ManageAutoScroll||, CODE, READONLY, ALIGN=1

                  _ManageAutoScroll PROC
;;;478    */
;;;479    static void _ManageAutoScroll(LISTBOX_Handle hObj) {
000000  b57c              PUSH     {r2-r6,lr}
000002  4605              MOV      r5,r0
;;;480      char IsRequired;
;;;481      LISTBOX_Obj* pObj = LISTBOX_H2P(hObj);
000004  f7fffffe          BL       GUI_ALLOC_h2p
000008  4604              MOV      r4,r0
;;;482      if (pObj->Flags & LISTBOX_SF_AUTOSCROLLBAR_V) {
00000a  f8900084          LDRB     r0,[r0,#0x84]
00000e  0780              LSLS     r0,r0,#30
000010  d50f              BPL      |L28.50|
;;;483        IsRequired = (_GetNumVisItems(pObj, hObj) < LISTBOX__GetNumItems(pObj));
000012  4629              MOV      r1,r5
000014  4620              MOV      r0,r4
000016  f7fffffe          BL       _GetNumVisItems
00001a  4606              MOV      r6,r0
00001c  4620              MOV      r0,r4
00001e  f7fffffe          BL       LISTBOX__GetNumItems
000022  4286              CMP      r6,r0
000024  d201              BCS      |L28.42|
000026  2101              MOVS     r1,#1
000028  e000              B        |L28.44|
                  |L28.42|
00002a  2100              MOVS     r1,#0
                  |L28.44|
;;;484        WM_SetScrollbarV(hObj, IsRequired);
00002c  4628              MOV      r0,r5
00002e  f7fffffe          BL       WM_SetScrollbarV
                  |L28.50|
;;;485      }
;;;486      if (pObj->Flags & LISTBOX_SF_AUTOSCROLLBAR_H) {
000032  f8940084          LDRB     r0,[r4,#0x84]
000036  07c0              LSLS     r0,r0,#31
000038  d015              BEQ      |L28.102|
;;;487        GUI_RECT Rect;
;;;488        int xSize, xSizeContents;
;;;489        xSizeContents = _GetContentsSizeX(hObj);
00003a  4628              MOV      r0,r5
00003c  f7fffffe          BL       _GetContentsSizeX
000040  4606              MOV      r6,r0
;;;490        WM_GetInsideRectExScrollbar(hObj, &Rect);
000042  4669              MOV      r1,sp
000044  4628              MOV      r0,r5
000046  f7fffffe          BL       WM_GetInsideRectExScrollbar
;;;491        xSize = Rect.x1 - Rect.x0 + 1;
00004a  f9bd0004          LDRSH    r0,[sp,#4]
00004e  f9bd1000          LDRSH    r1,[sp,#0]
000052  1a41              SUBS     r1,r0,r1
000054  1c49              ADDS     r1,r1,#1
;;;492        IsRequired = (xSizeContents > xSize);
000056  428e              CMP      r6,r1
000058  dd01              BLE      |L28.94|
00005a  2101              MOVS     r1,#1
00005c  e000              B        |L28.96|
                  |L28.94|
00005e  2100              MOVS     r1,#0
                  |L28.96|
;;;493        WM_SetScrollbarH(hObj, IsRequired);
000060  4628              MOV      r0,r5
000062  f7fffffe          BL       WM_SetScrollbarH
                  |L28.102|
;;;494      }
;;;495      if (pObj->ScrollbarWidth) {
000066  f8940085          LDRB     r0,[r4,#0x85]
00006a  b118              CBZ      r0,|L28.116|
;;;496        LISTBOX__SetScrollbarWidth(hObj, pObj);
00006c  4621              MOV      r1,r4
00006e  4628              MOV      r0,r5
000070  f7fffffe          BL       LISTBOX__SetScrollbarWidth
                  |L28.116|
;;;497      }
;;;498      LISTBOX__SetScrollbarColor(hObj, pObj);
000074  4621              MOV      r1,r4
000076  4628              MOV      r0,r5
000078  e8bd407c          POP      {r2-r6,lr}
00007c  f7ffbffe          B.W      LISTBOX__SetScrollbarColor
;;;499    }
;;;500    
                          ENDP


                          AREA ||i._MoveSel||, CODE, READONLY, ALIGN=1

                  _MoveSel PROC
;;;754    */
;;;755    static void _MoveSel(LISTBOX_Handle hObj, int Dir) {
000000  e92d47f0          PUSH     {r4-r10,lr}
000004  460f              MOV      r7,r1
000006  4682              MOV      r10,r0
;;;756      int Index, NewSel = -1, NumItems;
000008  f04f36ff          MOV      r6,#0xffffffff
;;;757      LISTBOX_Obj * pObj;
;;;758      pObj = LISTBOX_H2P(hObj);
00000c  f7fffffe          BL       GUI_ALLOC_h2p
000010  4605              MOV      r5,r0
;;;759      Index = LISTBOX_GetSel(hObj);
000012  4650              MOV      r0,r10
000014  f7fffffe          BL       LISTBOX_GetSel
000018  4604              MOV      r4,r0
;;;760      NumItems = LISTBOX__GetNumItems(pObj);
00001a  4628              MOV      r0,r5
00001c  f7fffffe          BL       LISTBOX__GetNumItems
000020  4680              MOV      r8,r0
;;;761      do {
;;;762        WM_HMEM hItem;
;;;763        Index += Dir;
;;;764        if ((Index < 0) || (Index >= NumItems)) {
;;;765          break;
;;;766        }
;;;767        hItem = GUI_ARRAY_GethItem(&pObj->ItemArray, Index);
000022  f1050928          ADD      r9,r5,#0x28
                  |L29.38|
000026  19e4              ADDS     r4,r4,r7              ;763
000028  d40f              BMI      |L29.74|
00002a  4544              CMP      r4,r8                 ;764
00002c  da0d              BGE      |L29.74|
00002e  4621              MOV      r1,r4
000030  4648              MOV      r0,r9
000032  f7fffffe          BL       GUI_ARRAY_GethItem
;;;768        if (hItem) {
000036  b128              CBZ      r0,|L29.68|
;;;769          LISTBOX_ITEM * pItem = (LISTBOX_ITEM *)GUI_ALLOC_h2p(hItem);
000038  f7fffffe          BL       GUI_ALLOC_h2p
;;;770          if (!(pItem->Status & LISTBOX_ITEM_DISABLED)) {
00003c  7900              LDRB     r0,[r0,#4]
00003e  0780              LSLS     r0,r0,#30
000040  d400              BMI      |L29.68|
;;;771            NewSel = Index;
000042  4626              MOV      r6,r4
                  |L29.68|
;;;772          }
;;;773        }
;;;774      } while(NewSel < 0);
000044  2e00              CMP      r6,#0
000046  dbee              BLT      |L29.38|
000048  e001              B        |L29.78|
                  |L29.74|
;;;775      if (NewSel >= 0) {
00004a  2e00              CMP      r6,#0
00004c  db05              BLT      |L29.90|
                  |L29.78|
;;;776        LISTBOX_SetSel(hObj, NewSel);
00004e  4631              MOV      r1,r6
000050  4650              MOV      r0,r10
000052  e8bd47f0          POP      {r4-r10,lr}
000056  f7ffbffe          B.W      LISTBOX_SetSel
                  |L29.90|
;;;777      } else {
;;;778        int PrevScrollStateV;
;;;779        PrevScrollStateV = pObj->ScrollStateV.v;
;;;780        pObj->ScrollStateV.v += Dir;
00005a  6b6c              LDR      r4,[r5,#0x34]
00005c  19e0              ADDS     r0,r4,r7
;;;781        WM_CheckScrollBounds(&pObj->ScrollStateV);
00005e  6368              STR      r0,[r5,#0x34]
000060  f1050030          ADD      r0,r5,#0x30
000064  f7fffffe          BL       WM_CheckScrollBounds
;;;782        if (PrevScrollStateV != pObj->ScrollStateV.v) {
000068  6b68              LDR      r0,[r5,#0x34]
00006a  42a0              CMP      r0,r4
00006c  d002              BEQ      |L29.116|
;;;783          LISTBOX__InvalidateInsideArea(hObj);
00006e  4650              MOV      r0,r10
000070  f7fffffe          BL       LISTBOX__InvalidateInsideArea
                  |L29.116|
;;;784        }
;;;785        LISTBOX_UpdateScrollers(hObj);
000074  4650              MOV      r0,r10
000076  e8bd47f0          POP      {r4-r10,lr}
00007a  f7ffbffe          B.W      LISTBOX_UpdateScrollers
;;;786      }
;;;787    }
;;;788    
                          ENDP


                          AREA ||i._NotifyOwner||, CODE, READONLY, ALIGN=1

                  _NotifyOwner PROC
;;;289    */
;;;290    static void _NotifyOwner(WM_HWIN hObj, int Notification) {
000000  b53e              PUSH     {r1-r5,lr}
000002  4605              MOV      r5,r0
;;;291      WM_MESSAGE Msg = {0};
000004  2000              MOVS     r0,#0
000006  9000              STR      r0,[sp,#0]
000008  9001              STR      r0,[sp,#4]
;;;292      WM_HWIN hOwner;
;;;293      LISTBOX_Obj* pObj    = LISTBOX_H2P(hObj);
00000a  9002              STR      r0,[sp,#8]
00000c  460c              MOV      r4,r1                 ;290
00000e  4628              MOV      r0,r5
000010  f7fffffe          BL       GUI_ALLOC_h2p
;;;294      hOwner = pObj->hOwner ? pObj->hOwner : WM_GetParent(hObj);
000014  f9b00080          LDRSH    r0,[r0,#0x80]
000018  b910              CBNZ     r0,|L30.32|
00001a  4628              MOV      r0,r5
00001c  f7fffffe          BL       WM_GetParent
                  |L30.32|
;;;295      Msg.MsgId  = WM_NOTIFY_PARENT;
000020  2126              MOVS     r1,#0x26
;;;296      Msg.Data.v = Notification;
;;;297      Msg.hWinSrc= hObj;
000022  9100              STR      r1,[sp,#0]
000024  9402              STR      r4,[sp,#8]
000026  f8ad5006          STRH     r5,[sp,#6]
;;;298      WM__SendMessage(hOwner, &Msg);
00002a  4669              MOV      r1,sp
00002c  f7fffffe          BL       WM__SendMessage
;;;299    }
000030  bd3e              POP      {r1-r5,pc}
;;;300    
                          ENDP


                          AREA ||i._OnPaint||, CODE, READONLY, ALIGN=1

                  _OnPaint PROC
;;;565    */
;;;566    static void _OnPaint(LISTBOX_Handle hObj, LISTBOX_Obj* pObj, WM_MESSAGE* pMsg) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4680              MOV      r8,r0
000006  b08c              SUB      sp,sp,#0x30
000008  4615              MOV      r5,r2
00000a  460c              MOV      r4,r1
;;;567      WIDGET_ITEM_DRAW_INFO ItemInfo;
;;;568      GUI_RECT RectInside, RectItem, ClipRect;
;;;569      int ItemDistY, NumItems, i;
;;;570      NumItems = LISTBOX__GetNumItems(pObj);
00000c  4608              MOV      r0,r1
00000e  f7fffffe          BL       LISTBOX__GetNumItems
000012  4607              MOV      r7,r0
;;;571      GUI_SetFont(pObj->Props.pFont);
000014  6ca0              LDR      r0,[r4,#0x48]
000016  f7fffffe          BL       GUI_SetFont
;;;572      /* Calculate clipping rectangle */
;;;573      ClipRect = *(const GUI_RECT*)pMsg->Data.p;
00001a  68a8              LDR      r0,[r5,#8]
00001c  6801              LDR      r1,[r0,#0]
00001e  9102              STR      r1,[sp,#8]
000020  6840              LDR      r0,[r0,#4]
;;;574      GUI_MoveRect(&ClipRect, -pObj->Widget.Win.Rect.x0, -pObj->Widget.Win.Rect.y0);
000022  9003              STR      r0,[sp,#0xc]
000024  f9b40002          LDRSH    r0,[r4,#2]
000028  4242              RSBS     r2,r0,#0
00002a  f9b40000          LDRSH    r0,[r4,#0]
00002e  4241              RSBS     r1,r0,#0
000030  a802              ADD      r0,sp,#8
000032  f7fffffe          BL       GUI_MoveRect
;;;575      WM_GetInsideRectExScrollbar(hObj, &RectInside);
000036  a904              ADD      r1,sp,#0x10
000038  4640              MOV      r0,r8
00003a  f7fffffe          BL       WM_GetInsideRectExScrollbar
;;;576      GUI__IntersectRect(&ClipRect, &RectInside);
00003e  a904              ADD      r1,sp,#0x10
000040  a802              ADD      r0,sp,#8
000042  f7fffffe          BL       GUI__IntersectRect
;;;577      RectItem.x0 = ClipRect.x0;
000046  f8bd0008          LDRH     r0,[sp,#8]
00004a  f8ad0000          STRH     r0,[sp,#0]
;;;578      RectItem.x1 = ClipRect.x1;
00004e  f8bd000c          LDRH     r0,[sp,#0xc]
000052  f8ad0004          STRH     r0,[sp,#4]
;;;579      /* Fill item info structure */
;;;580      ItemInfo.Cmd  = WIDGET_ITEM_DRAW;
000056  2000              MOVS     r0,#0
;;;581      ItemInfo.hWin = hObj;
000058  9007              STR      r0,[sp,#0x1c]
00005a  f8ad8018          STRH     r8,[sp,#0x18]
;;;582      ItemInfo.x0   = RectInside.x0 - pObj->ScrollStateH.v;
00005e  f9bd0010          LDRSH    r0,[sp,#0x10]
000062  6c21              LDR      r1,[r4,#0x40]
000064  1a40              SUBS     r0,r0,r1
;;;583      ItemInfo.y0   = RectInside.y0;
000066  9009              STR      r0,[sp,#0x24]
000068  f9bd0012          LDRSH    r0,[sp,#0x12]
;;;584      /* Do the drawing */
;;;585      for (i = pObj->ScrollStateV.v; i < NumItems; i++) {
00006c  900a              STR      r0,[sp,#0x28]
00006e  6b65              LDR      r5,[r4,#0x34]
000070  e026              B        |L31.192|
                  |L31.114|
;;;586        RectItem.y0 = ItemInfo.y0;
000072  b200              SXTH     r0,r0
;;;587        /* Break when all other rows are outside the drawing area */
;;;588        if (RectItem.y0 > ClipRect.y1) {
000074  f9bd100e          LDRSH    r1,[sp,#0xe]
000078  f8ad0002          STRH     r0,[sp,#2]            ;586
00007c  4288              CMP      r0,r1
00007e  dc21              BGT      |L31.196|
;;;589          break;
;;;590        }
;;;591        ItemDistY = _GetItemSizeY(hObj, pObj, i);
000080  462a              MOV      r2,r5
000082  4621              MOV      r1,r4
000084  4640              MOV      r0,r8
000086  f7fffffe          BL       _GetItemSizeY
00008a  4606              MOV      r6,r0
;;;592        RectItem.y1 = RectItem.y0 + ItemDistY - 1;
00008c  f8bd1002          LDRH     r1,[sp,#2]
000090  1e40              SUBS     r0,r0,#1
000092  4408              ADD      r0,r0,r1
000094  b200              SXTH     r0,r0
;;;593        /* Make sure that we draw only when row is in drawing area */
;;;594        if (RectItem.y1 >= ClipRect.y0) {
000096  f9bd100a          LDRSH    r1,[sp,#0xa]
00009a  f8ad0006          STRH     r0,[sp,#6]            ;592
00009e  4288              CMP      r0,r1
0000a0  db0a              BLT      |L31.184|
;;;595          /* Set user clip rect */
;;;596          WM_SetUserClipArea(&RectItem);
0000a2  4668              MOV      r0,sp
0000a4  f7fffffe          BL       WM_SetUserClipRect
;;;597          /* Fill item info structure */
;;;598          ItemInfo.ItemIndex = i;
;;;599          /* Draw item */
;;;600          if (pObj->pfDrawItem) {
0000a8  9508              STR      r5,[sp,#0x20]
0000aa  6ae1              LDR      r1,[r4,#0x2c]
;;;601            pObj->pfDrawItem(&ItemInfo);
;;;602          } else {
;;;603            LISTBOX_OwnerDraw(&ItemInfo);
0000ac  a806              ADD      r0,sp,#0x18
0000ae  b109              CBZ      r1,|L31.180|
0000b0  4788              BLX      r1                    ;601
0000b2  e001              B        |L31.184|
                  |L31.180|
0000b4  f7fffffe          BL       LISTBOX_OwnerDraw
                  |L31.184|
;;;604          }
;;;605        }
;;;606        ItemInfo.y0 += ItemDistY;
0000b8  980a              LDR      r0,[sp,#0x28]
0000ba  1c6d              ADDS     r5,r5,#1
0000bc  4430              ADD      r0,r0,r6
0000be  900a              STR      r0,[sp,#0x28]
                  |L31.192|
0000c0  42bd              CMP      r5,r7                 ;585
0000c2  dbd6              BLT      |L31.114|
                  |L31.196|
;;;607      }
;;;608      WM_SetUserClipArea(NULL);
0000c4  2000              MOVS     r0,#0
0000c6  f7fffffe          BL       WM_SetUserClipRect
;;;609      /* Calculate & clear 'data free' area */
;;;610      RectItem.y0 = ItemInfo.y0;
0000ca  980a              LDR      r0,[sp,#0x28]
0000cc  f8ad0002          STRH     r0,[sp,#2]
;;;611      RectItem.y1 = RectInside.y1;
0000d0  f8bd0016          LDRH     r0,[sp,#0x16]
0000d4  f8ad0006          STRH     r0,[sp,#6]
;;;612      LCD_SetBkColor(pObj->Props.aBackColor[0]);
0000d8  6d20              LDR      r0,[r4,#0x50]
0000da  f7fffffe          BL       LCD_SetBkColor
;;;613      GUI_ClearRectEx(&RectItem);
0000de  4668              MOV      r0,sp
0000e0  f7fffffe          BL       GUI_ClearRectEx
;;;614      /* Draw the 3D effect (if configured) */
;;;615      WIDGET__EFFECT_DrawDown(&pObj->Widget);
0000e4  4620              MOV      r0,r4
0000e6  f7fffffe          BL       WIDGET__EFFECT_DrawDown
;;;616    }
0000ea  b00c              ADD      sp,sp,#0x30
0000ec  e8bd81f0          POP      {r4-r8,pc}
;;;617    
                          ENDP


                          AREA ||i._OnTouch||, CODE, READONLY, ALIGN=2

                  _OnTouch PROC
;;;663    #define LISTBOX_SUPPORT_SCROLL		1
;;;664    static void _OnTouch(LISTBOX_Handle hObj, WM_MESSAGE* pMsg) {
000000  e92d41f0          PUSH     {r4-r8,lr}
000004  4607              MOV      r7,r0
;;;665      const GUI_PID_STATE* pState = (const GUI_PID_STATE*)pMsg->Data.p;
000006  2600              MOVS     r6,#0
;;;666    #if LISTBOX_SUPPORT_SCROLL
;;;667      static int yLast = -1;
;;;668      static unsigned char bScrollEvent = 0;
;;;669      if (pMsg->Data.p) {  /* Something happened in our area (pressed or released) */
;;;670        if (pState->Pressed == 0) {
;;;671    	yLast = -1;
000008  4c21              LDR      r4,|L32.144|
00000a  688d              LDR      r5,[r1,#8]            ;664
00000c  1e70              SUBS     r0,r6,#1
00000e  b3bd              CBZ      r5,|L32.128|
000010  7a29              LDRB     r1,[r5,#8]            ;670
000012  b1e9              CBZ      r1,|L32.80|
;;;672    	if(bScrollEvent == 0)
;;;673    	{
;;;674          		_NotifyOwner(hObj, WM_NOTIFICATION_RELEASED);
;;;675    	}
;;;676    	bScrollEvent = 0;
;;;677        }
;;;678        else
;;;679        {
;;;680        	if(yLast == -1)
000014  6860              LDR      r0,[r4,#4]  ; yLast
000016  1c40              ADDS     r0,r0,#1
000018  d024              BEQ      |L32.100|
;;;681        	{
;;;682    		yLast = pState->y;
;;;683    		return;
;;;684        	}
;;;685    	else
;;;686    	{
;;;687    	    	WM_HWIN hWin=WM_GetDialogItem(hObj, GUI_ID_VSCROLL);
00001a  21fe              MOVS     r1,#0xfe
00001c  4638              MOV      r0,r7
00001e  f7fffffe          BL       WM_GetDialogItem
000022  4606              MOV      r6,r0
;;;688    		LISTBOX_Obj* pObj = LISTBOX_H2P(hObj);
000024  4638              MOV      r0,r7
000026  f7fffffe          BL       GUI_ALLOC_h2p
;;;689    		unsigned short nOffset = (pObj->ItemSpacing ) >> 1;
00002a  f8b00086          LDRH     r0,[r0,#0x86]
;;;690    		if(pState->y>=yLast)
00002e  6869              LDR      r1,[r5,#4]
000030  6862              LDR      r2,[r4,#4]  ; yLast
000032  0840              LSRS     r0,r0,#1              ;689
;;;691    		{
;;;692    			if((pState->y-yLast) > nOffset)
;;;693    			{
;;;694    				yLast = pState->y + nOffset;
;;;695    				bScrollEvent = 1;
000034  2301              MOVS     r3,#1
000036  4291              CMP      r1,r2                 ;690
000038  db17              BLT      |L32.106|
00003a  1a8a              SUBS     r2,r1,r2              ;692
00003c  4282              CMP      r2,r0                 ;692
00003e  dd0f              BLE      |L32.96|
000040  4408              ADD      r0,r0,r1              ;694
000042  6060              STR      r0,[r4,#4]  ; yLast
000044  7023              STRB     r3,[r4,#0]
;;;696    				SCROLLBAR_Dec(hWin);
000046  4630              MOV      r0,r6
000048  e8bd41f0          POP      {r4-r8,lr}
00004c  f7ffbffe          B.W      SCROLLBAR_Dec
                  |L32.80|
000050  6060              STR      r0,[r4,#4]            ;672  ; yLast
000052  7820              LDRB     r0,[r4,#0]            ;672  ; bScrollEvent
000054  b918              CBNZ     r0,|L32.94|
000056  2102              MOVS     r1,#2                 ;674
000058  4638              MOV      r0,r7                 ;674
00005a  f7fffffe          BL       _NotifyOwner
                  |L32.94|
00005e  7026              STRB     r6,[r4,#0]            ;676
                  |L32.96|
;;;697    			}
;;;698    		}
;;;699    		else
;;;700    		{
;;;701    			if((yLast-pState->y)>nOffset)
;;;702    			{
;;;703    				yLast = pState->y - nOffset;
;;;704    				bScrollEvent = 1;
;;;705    				SCROLLBAR_Inc(hWin);
;;;706    			}
;;;707    		}
;;;708    	}
;;;709        }
;;;710      } 
;;;711      else {     /* Mouse moved out */
;;;712      	bScrollEvent = 0;
;;;713    	yLast = -1;
;;;714        _NotifyOwner(hObj, WM_NOTIFICATION_MOVED_OUT);
;;;715      }
;;;716    #else
;;;717    	  if (pMsg->Data.p) {  /* Something happened in our area (pressed or released) */
;;;718    	    if (pState->Pressed == 0) {
;;;719    	      _NotifyOwner(hObj, WM_NOTIFICATION_RELEASED);
;;;720    	    }
;;;721      } else {     /* Mouse moved out */
;;;722        _NotifyOwner(hObj, WM_NOTIFICATION_MOVED_OUT);
;;;723      }
;;;724    #endif
;;;725    }
000060  e8bd81f0          POP      {r4-r8,pc}
                  |L32.100|
000064  6868              LDR      r0,[r5,#4]            ;682
000066  6060              STR      r0,[r4,#4]            ;683  ; yLast
000068  e7fa              B        |L32.96|
                  |L32.106|
00006a  1a52              SUBS     r2,r2,r1              ;701
00006c  4282              CMP      r2,r0                 ;701
00006e  ddf7              BLE      |L32.96|
000070  1a08              SUBS     r0,r1,r0              ;703
000072  6060              STR      r0,[r4,#4]            ;704  ; yLast
000074  7023              STRB     r3,[r4,#0]            ;704
000076  4630              MOV      r0,r6                 ;705
000078  e8bd41f0          POP      {r4-r8,lr}            ;705
00007c  f7ffbffe          B.W      SCROLLBAR_Inc
                  |L32.128|
000080  7026              STRB     r6,[r4,#0]            ;712
000082  6060              STR      r0,[r4,#4]            ;714  ; yLast
000084  4638              MOV      r0,r7                 ;714
000086  e8bd41f0          POP      {r4-r8,lr}            ;714
00008a  2103              MOVS     r1,#3                 ;714
00008c  f7ffbffe          B.W      _NotifyOwner
;;;726    
                          ENDP

                  |L32.144|
                          DCD      ||.data||

                          AREA ||i._ToggleMultiSel||, CODE, READONLY, ALIGN=1

                  _ToggleMultiSel PROC
;;;621    */
;;;622    static void _ToggleMultiSel(LISTBOX_Handle hObj, LISTBOX_Obj* pObj, int Sel) {
000000  b570              PUSH     {r4-r6,lr}
000002  4606              MOV      r6,r0
;;;623      if (pObj->Flags & LISTBOX_SF_MULTISEL) {
000004  f8910084          LDRB     r0,[r1,#0x84]
000008  460c              MOV      r4,r1                 ;622
00000a  4615              MOV      r5,r2                 ;622
00000c  0740              LSLS     r0,r0,#29
00000e  d519              BPL      |L33.68|
;;;624        WM_HMEM hItem = GUI_ARRAY_GethItem(&pObj->ItemArray, Sel);
000010  4611              MOV      r1,r2
000012  f1040028          ADD      r0,r4,#0x28
000016  f7fffffe          BL       GUI_ARRAY_GethItem
;;;625        if (hItem) {
00001a  2800              CMP      r0,#0
00001c  d012              BEQ      |L33.68|
;;;626          LISTBOX_ITEM * pItem = (LISTBOX_ITEM *)GUI_ALLOC_h2p(hItem);
00001e  f7fffffe          BL       GUI_ALLOC_h2p
;;;627          if (!(pItem->Status & LISTBOX_ITEM_DISABLED)) {
000022  7901              LDRB     r1,[r0,#4]
000024  078a              LSLS     r2,r1,#30
000026  d40d              BMI      |L33.68|
;;;628            pItem->Status ^= LISTBOX_ITEM_SELECTED;
000028  f0810101          EOR      r1,r1,#1
00002c  7101              STRB     r1,[r0,#4]
;;;629            _NotifyOwner(hObj, WM_NOTIFICATION_SEL_CHANGED);
00002e  2104              MOVS     r1,#4
000030  4630              MOV      r0,r6
000032  f7fffffe          BL       _NotifyOwner
;;;630            LISTBOX__InvalidateItem(hObj, pObj, Sel);
000036  462a              MOV      r2,r5
000038  4621              MOV      r1,r4
00003a  4630              MOV      r0,r6
00003c  e8bd4070          POP      {r4-r6,lr}
000040  f7ffbffe          B.W      LISTBOX__InvalidateItem
                  |L33.68|
;;;631          }
;;;632        }
;;;633      }
;;;634    }
000044  bd70              POP      {r4-r6,pc}
;;;635    
                          ENDP


                          AREA ||i._Tolower||, CODE, READONLY, ALIGN=1

                  _Tolower PROC
;;;513    */
;;;514    static int _Tolower(int Key) {
000000  f1a00141          SUB      r1,r0,#0x41
;;;515      if ((Key >= 0x41) && (Key <= 0x5a)) {
000004  2919              CMP      r1,#0x19
000006  d800              BHI      |L34.10|
000008  3020              ADDS     r0,r0,#0x20           ;514
                  |L34.10|
;;;516        Key += 0x20;
;;;517      }
;;;518      return Key;
;;;519    }
00000a  4770              BX       lr
;;;520    
                          ENDP


                          AREA ||i._UpdateScrollPos||, CODE, READONLY, ALIGN=1

                  _UpdateScrollPos PROC
;;;438    */
;;;439    static int _UpdateScrollPos(LISTBOX_Handle hObj, LISTBOX_Obj* pObj) {
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;440      int PrevScrollStateV;
;;;441      PrevScrollStateV = pObj->ScrollStateV.v;
;;;442      if (pObj->Sel >= 0) {
000004  f9b15082          LDRSH    r5,[r1,#0x82]
000008  6b4f              LDR      r7,[r1,#0x34]
00000a  4606              MOV      r6,r0                 ;439
00000c  460c              MOV      r4,r1                 ;439
00000e  2d00              CMP      r5,#0
000010  db25              BLT      |L35.94|
000012  4608              MOV      r0,r1                 ;439
000014  f7fffffe          BL       LISTBOX__GetNumItems
000018  42a8              CMP      r0,r5                 ;439
00001a  dd1a              BLE      |L35.82|
00001c  6b60              LDR      r0,[r4,#0x34]         ;439
00001e  42a8              CMP      r0,r5                 ;439
000020  dc17              BGT      |L35.82|
000022  462a              MOV      r2,r5                 ;439
000024  4621              MOV      r1,r4                 ;439
000026  4630              MOV      r0,r6                 ;439
000028  f7fffffe          BL       _GetItemPosY
00002c  4680              MOV      r8,r0                 ;439
00002e  462a              MOV      r2,r5                 ;439
000030  4621              MOV      r1,r4                 ;439
000032  4630              MOV      r0,r6                 ;439
000034  f7fffffe          BL       _GetItemSizeY
000038  eb000508          ADD      r5,r0,r8              ;439
00003c  4630              MOV      r0,r6                 ;439
00003e  f7fffffe          BL       _GetYSize
000042  42a8              CMP      r0,r5                 ;439
000044  da05              BGE      |L35.82|
;;;443        /* Check upper limit */
;;;444        if (_IsPartiallyVis(hObj, pObj)) {
;;;445          pObj->ScrollStateV.v = pObj->Sel - (pObj->ScrollStateV.PageSize - 1);
000046  f9b40082          LDRSH    r0,[r4,#0x82]
00004a  6ba1              LDR      r1,[r4,#0x38]
00004c  1a40              SUBS     r0,r0,r1
00004e  1c40              ADDS     r0,r0,#1
000050  6360              STR      r0,[r4,#0x34]
                  |L35.82|
;;;446        }
;;;447        /* Check lower limit */
;;;448        if (pObj->Sel < pObj->ScrollStateV.v) {
000052  f9b40082          LDRSH    r0,[r4,#0x82]
000056  6b61              LDR      r1,[r4,#0x34]
000058  4288              CMP      r0,r1
00005a  da00              BGE      |L35.94|
;;;449          pObj->ScrollStateV.v = pObj->Sel;
00005c  6360              STR      r0,[r4,#0x34]
                  |L35.94|
;;;450        }
;;;451      }
;;;452      WM_CheckScrollBounds(&pObj->ScrollStateV);
00005e  f1040030          ADD      r0,r4,#0x30
000062  4680              MOV      r8,r0
000064  f7fffffe          BL       WM_CheckScrollBounds
;;;453      WM_CheckScrollBounds(&pObj->ScrollStateH);
000068  f104003c          ADD      r0,r4,#0x3c
00006c  4605              MOV      r5,r0
00006e  f7fffffe          BL       WM_CheckScrollBounds
000072  462a              MOV      r2,r5
000074  4641              MOV      r1,r8
;;;454      WIDGET__SetScrollState(hObj, &pObj->ScrollStateV, &pObj->ScrollStateH);
000076  4630              MOV      r0,r6
000078  f7fffffe          BL       WIDGET__SetScrollState
;;;455      return pObj->ScrollStateV.v - PrevScrollStateV;
00007c  6b60              LDR      r0,[r4,#0x34]
00007e  1bc0              SUBS     r0,r0,r7
;;;456    }
000080  e8bd81f0          POP      {r4-r8,pc}
;;;457    
                          ENDP


                          AREA ||.data||, DATA, ALIGN=2

                  bScrollEvent
000000  00000000          DCB      0x00,0x00,0x00,0x00
                  yLast
                          DCD      0xffffffff
                  LISTBOX_DefaultProps
                          DCD      GUI_Font13_1
00000c  000a              DCW      0x000a
00000e  0000              DCB      0x00,0x00
                          DCD      0x00ffffff
                          DCD      0x00808080
                          DCD      0x00ff0000
                          DCD      0x00c0c0c0
                          DCD      0x00000000
                          DCD      0x00ffffff
                          DCD      0x00ffffff
                          DCD      0x00808080
                          DCD      0x0fffffff
                          DCD      0x0fffffff
                          DCD      0x0fffffff
00003c  0000              DCW      0x0000
00003e  0000              DCB      0x00,0x00
